var vO=Object.defineProperty;var bO=(t,e,i)=>e in t?vO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Gg=(t,e,i)=>(bO(t,typeof e!="symbol"?e+"":e,i),i);function wO(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const n=Object.getOwnPropertyDescriptor(r,s);n&&Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();var uo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xO(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function EO(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var i=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(i,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),i}var xR={exports:{}},s1={},ER={exports:{}},ri={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Am=Symbol.for("react.element"),AO=Symbol.for("react.portal"),TO=Symbol.for("react.fragment"),SO=Symbol.for("react.strict_mode"),CO=Symbol.for("react.profiler"),IO=Symbol.for("react.provider"),RO=Symbol.for("react.context"),MO=Symbol.for("react.forward_ref"),PO=Symbol.for("react.suspense"),kO=Symbol.for("react.memo"),BO=Symbol.for("react.lazy"),C3=Symbol.iterator;function LO(t){return t===null||typeof t!="object"?null:(t=C3&&t[C3]||t["@@iterator"],typeof t=="function"?t:null)}var AR={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},TR=Object.assign,SR={};function Ud(t,e,i){this.props=t,this.context=e,this.refs=SR,this.updater=i||AR}Ud.prototype.isReactComponent={};Ud.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ud.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function CR(){}CR.prototype=Ud.prototype;function Gx(t,e,i){this.props=t,this.context=e,this.refs=SR,this.updater=i||AR}var Vx=Gx.prototype=new CR;Vx.constructor=Gx;TR(Vx,Ud.prototype);Vx.isPureReactComponent=!0;var I3=Array.isArray,IR=Object.prototype.hasOwnProperty,$x={current:null},RR={key:!0,ref:!0,__self:!0,__source:!0};function MR(t,e,i){var r,s={},n=null,c=null;if(e!=null)for(r in e.ref!==void 0&&(c=e.ref),e.key!==void 0&&(n=""+e.key),e)IR.call(e,r)&&!RR.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=i;else if(1<l){for(var f=Array(l),y=0;y<l;y++)f[y]=arguments[y+2];s.children=f}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Am,type:t,key:n,ref:c,props:s,_owner:$x.current}}function OO(t,e){return{$$typeof:Am,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Hx(t){return typeof t=="object"&&t!==null&&t.$$typeof===Am}function DO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var R3=/\/+/g;function sv(t,e){return typeof t=="object"&&t!==null&&t.key!=null?DO(""+t.key):e.toString(36)}function z_(t,e,i,r,s){var n=typeof t;(n==="undefined"||n==="boolean")&&(t=null);var c=!1;if(t===null)c=!0;else switch(n){case"string":case"number":c=!0;break;case"object":switch(t.$$typeof){case Am:case AO:c=!0}}if(c)return c=t,s=s(c),t=r===""?"."+sv(c,0):r,I3(s)?(i="",t!=null&&(i=t.replace(R3,"$&/")+"/"),z_(s,e,i,"",function(y){return y})):s!=null&&(Hx(s)&&(s=OO(s,i+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(R3,"$&/")+"/")+t)),e.push(s)),1;if(c=0,r=r===""?".":r+":",I3(t))for(var l=0;l<t.length;l++){n=t[l];var f=r+sv(n,l);c+=z_(n,e,i,f,s)}else if(f=LO(t),typeof f=="function")for(t=f.call(t),l=0;!(n=t.next()).done;)n=n.value,f=r+sv(n,l++),c+=z_(n,e,i,f,s);else if(n==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return c}function Vg(t,e,i){if(t==null)return t;var r=[],s=0;return z_(t,r,"","",function(n){return e.call(i,n,s++)}),r}function FO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Hs={current:null},j_={transition:null},NO={ReactCurrentDispatcher:Hs,ReactCurrentBatchConfig:j_,ReactCurrentOwner:$x};function PR(){throw Error("act(...) is not supported in production builds of React.")}ri.Children={map:Vg,forEach:function(t,e,i){Vg(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return Vg(t,function(){e++}),e},toArray:function(t){return Vg(t,function(e){return e})||[]},only:function(t){if(!Hx(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ri.Component=Ud;ri.Fragment=TO;ri.Profiler=CO;ri.PureComponent=Gx;ri.StrictMode=SO;ri.Suspense=PO;ri.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NO;ri.act=PR;ri.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=TR({},t.props),s=t.key,n=t.ref,c=t._owner;if(e!=null){if(e.ref!==void 0&&(n=e.ref,c=$x.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(f in e)IR.call(e,f)&&!RR.hasOwnProperty(f)&&(r[f]=e[f]===void 0&&l!==void 0?l[f]:e[f])}var f=arguments.length-2;if(f===1)r.children=i;else if(1<f){l=Array(f);for(var y=0;y<f;y++)l[y]=arguments[y+2];r.children=l}return{$$typeof:Am,type:t.type,key:s,ref:n,props:r,_owner:c}};ri.createContext=function(t){return t={$$typeof:RO,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:IO,_context:t},t.Consumer=t};ri.createElement=MR;ri.createFactory=function(t){var e=MR.bind(null,t);return e.type=t,e};ri.createRef=function(){return{current:null}};ri.forwardRef=function(t){return{$$typeof:MO,render:t}};ri.isValidElement=Hx;ri.lazy=function(t){return{$$typeof:BO,_payload:{_status:-1,_result:t},_init:FO}};ri.memo=function(t,e){return{$$typeof:kO,type:t,compare:e===void 0?null:e}};ri.startTransition=function(t){var e=j_.transition;j_.transition={};try{t()}finally{j_.transition=e}};ri.unstable_act=PR;ri.useCallback=function(t,e){return Hs.current.useCallback(t,e)};ri.useContext=function(t){return Hs.current.useContext(t)};ri.useDebugValue=function(){};ri.useDeferredValue=function(t){return Hs.current.useDeferredValue(t)};ri.useEffect=function(t,e){return Hs.current.useEffect(t,e)};ri.useId=function(){return Hs.current.useId()};ri.useImperativeHandle=function(t,e,i){return Hs.current.useImperativeHandle(t,e,i)};ri.useInsertionEffect=function(t,e){return Hs.current.useInsertionEffect(t,e)};ri.useLayoutEffect=function(t,e){return Hs.current.useLayoutEffect(t,e)};ri.useMemo=function(t,e){return Hs.current.useMemo(t,e)};ri.useReducer=function(t,e,i){return Hs.current.useReducer(t,e,i)};ri.useRef=function(t){return Hs.current.useRef(t)};ri.useState=function(t){return Hs.current.useState(t)};ri.useSyncExternalStore=function(t,e,i){return Hs.current.useSyncExternalStore(t,e,i)};ri.useTransition=function(){return Hs.current.useTransition()};ri.version="18.3.1";ER.exports=ri;var dt=ER.exports;const kR=xO(dt),UO=wO({__proto__:null,default:kR},[dt]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zO=dt,jO=Symbol.for("react.element"),GO=Symbol.for("react.fragment"),VO=Object.prototype.hasOwnProperty,$O=zO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,HO={key:!0,ref:!0,__self:!0,__source:!0};function BR(t,e,i){var r,s={},n=null,c=null;i!==void 0&&(n=""+i),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(c=e.ref);for(r in e)VO.call(e,r)&&!HO.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:jO,type:t,key:n,ref:c,props:s,_owner:$O.current}}s1.Fragment=GO;s1.jsx=BR;s1.jsxs=BR;xR.exports=s1;var $e=xR.exports,Vb={},LR={exports:{}},Un={},OR={exports:{}},DR={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(et,xt){var Tt=et.length;et.push(xt);e:for(;0<Tt;){var zt=Tt-1>>>1,$t=et[zt];if(0<s($t,xt))et[zt]=xt,et[Tt]=$t,Tt=zt;else break e}}function i(et){return et.length===0?null:et[0]}function r(et){if(et.length===0)return null;var xt=et[0],Tt=et.pop();if(Tt!==xt){et[0]=Tt;e:for(var zt=0,$t=et.length,Ls=$t>>>1;zt<Ls;){var cr=2*(zt+1)-1,Dr=et[cr],Fr=cr+1,si=et[Fr];if(0>s(Dr,Tt))Fr<$t&&0>s(si,Dr)?(et[zt]=si,et[Fr]=Tt,zt=Fr):(et[zt]=Dr,et[cr]=Tt,zt=cr);else if(Fr<$t&&0>s(si,Tt))et[zt]=si,et[Fr]=Tt,zt=Fr;else break e}}return xt}function s(et,xt){var Tt=et.sortIndex-xt.sortIndex;return Tt!==0?Tt:et.id-xt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;t.unstable_now=function(){return n.now()}}else{var c=Date,l=c.now();t.unstable_now=function(){return c.now()-l}}var f=[],y=[],E=1,T=null,R=3,D=!1,V=!1,H=!1,ee=typeof setTimeout=="function"?setTimeout:null,z=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(et){for(var xt=i(y);xt!==null;){if(xt.callback===null)r(y);else if(xt.startTime<=et)r(y),xt.sortIndex=xt.expirationTime,e(f,xt);else break;xt=i(y)}}function ce(et){if(H=!1,q(et),!V)if(i(f)!==null)V=!0,ci(we);else{var xt=i(y);xt!==null&&Gt(ce,xt.startTime-et)}}function we(et,xt){V=!1,H&&(H=!1,z(me),me=-1),D=!0;var Tt=R;try{for(q(xt),T=i(f);T!==null&&(!(T.expirationTime>xt)||et&&!ze());){var zt=T.callback;if(typeof zt=="function"){T.callback=null,R=T.priorityLevel;var $t=zt(T.expirationTime<=xt);xt=t.unstable_now(),typeof $t=="function"?T.callback=$t:T===i(f)&&r(f),q(xt)}else r(f);T=i(f)}if(T!==null)var Ls=!0;else{var cr=i(y);cr!==null&&Gt(ce,cr.startTime-xt),Ls=!1}return Ls}finally{T=null,R=Tt,D=!1}}var re=!1,be=null,me=-1,Te=5,Pe=-1;function ze(){return!(t.unstable_now()-Pe<Te)}function Ke(){if(be!==null){var et=t.unstable_now();Pe=et;var xt=!0;try{xt=be(!0,et)}finally{xt?We():(re=!1,be=null)}}else re=!1}var We;if(typeof W=="function")We=function(){W(Ke)};else if(typeof MessageChannel<"u"){var Ze=new MessageChannel,Ft=Ze.port2;Ze.port1.onmessage=Ke,We=function(){Ft.postMessage(null)}}else We=function(){ee(Ke,0)};function ci(et){be=et,re||(re=!0,We())}function Gt(et,xt){me=ee(function(){et(t.unstable_now())},xt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(et){et.callback=null},t.unstable_continueExecution=function(){V||D||(V=!0,ci(we))},t.unstable_forceFrameRate=function(et){0>et||125<et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Te=0<et?Math.floor(1e3/et):5},t.unstable_getCurrentPriorityLevel=function(){return R},t.unstable_getFirstCallbackNode=function(){return i(f)},t.unstable_next=function(et){switch(R){case 1:case 2:case 3:var xt=3;break;default:xt=R}var Tt=R;R=xt;try{return et()}finally{R=Tt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(et,xt){switch(et){case 1:case 2:case 3:case 4:case 5:break;default:et=3}var Tt=R;R=et;try{return xt()}finally{R=Tt}},t.unstable_scheduleCallback=function(et,xt,Tt){var zt=t.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?zt+Tt:zt):Tt=zt,et){case 1:var $t=-1;break;case 2:$t=250;break;case 5:$t=1073741823;break;case 4:$t=1e4;break;default:$t=5e3}return $t=Tt+$t,et={id:E++,callback:xt,priorityLevel:et,startTime:Tt,expirationTime:$t,sortIndex:-1},Tt>zt?(et.sortIndex=Tt,e(y,et),i(f)===null&&et===i(y)&&(H?(z(me),me=-1):H=!0,Gt(ce,Tt-zt))):(et.sortIndex=$t,e(f,et),V||D||(V=!0,ci(we))),et},t.unstable_shouldYield=ze,t.unstable_wrapCallback=function(et){var xt=R;return function(){var Tt=R;R=xt;try{return et.apply(this,arguments)}finally{R=Tt}}}})(DR);OR.exports=DR;var qO=OR.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WO=dt,Nn=qO;function tt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var FR=new Set,Kf={};function Su(t,e){wd(t,e),wd(t+"Capture",e)}function wd(t,e){for(Kf[t]=e,t=0;t<e.length;t++)FR.add(e[t])}var Xa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$b=Object.prototype.hasOwnProperty,XO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,M3={},P3={};function KO(t){return $b.call(P3,t)?!0:$b.call(M3,t)?!1:XO.test(t)?P3[t]=!0:(M3[t]=!0,!1)}function JO(t,e,i,r){if(i!==null&&i.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ZO(t,e,i,r){if(e===null||typeof e>"u"||JO(t,e,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function qs(t,e,i,r,s,n,c){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=n,this.removeEmptyString=c}var ds={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ds[t]=new qs(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ds[e]=new qs(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ds[t]=new qs(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ds[t]=new qs(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ds[t]=new qs(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ds[t]=new qs(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ds[t]=new qs(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ds[t]=new qs(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ds[t]=new qs(t,5,!1,t.toLowerCase(),null,!1,!1)});var qx=/[\-:]([a-z])/g;function Wx(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(qx,Wx);ds[e]=new qs(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(qx,Wx);ds[e]=new qs(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(qx,Wx);ds[e]=new qs(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ds[t]=new qs(t,1,!1,t.toLowerCase(),null,!1,!1)});ds.xlinkHref=new qs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ds[t]=new qs(t,1,!1,t.toLowerCase(),null,!0,!0)});function Xx(t,e,i,r){var s=ds.hasOwnProperty(e)?ds[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ZO(e,i,s,r)&&(i=null),r||s===null?KO(e)&&(i===null?t.removeAttribute(e):t.setAttribute(e,""+i)):s.mustUseProperty?t[s.propertyName]=i===null?s.type===3?!1:"":i:(e=s.attributeName,r=s.attributeNamespace,i===null?t.removeAttribute(e):(s=s.type,i=s===3||s===4&&i===!0?"":""+i,r?t.setAttributeNS(r,e,i):t.setAttribute(e,i))))}var el=WO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$g=Symbol.for("react.element"),Gh=Symbol.for("react.portal"),Vh=Symbol.for("react.fragment"),Kx=Symbol.for("react.strict_mode"),Hb=Symbol.for("react.profiler"),NR=Symbol.for("react.provider"),UR=Symbol.for("react.context"),Jx=Symbol.for("react.forward_ref"),qb=Symbol.for("react.suspense"),Wb=Symbol.for("react.suspense_list"),Zx=Symbol.for("react.memo"),Gl=Symbol.for("react.lazy"),zR=Symbol.for("react.offscreen"),k3=Symbol.iterator;function Jp(t){return t===null||typeof t!="object"?null:(t=k3&&t[k3]||t["@@iterator"],typeof t=="function"?t:null)}var lr=Object.assign,nv;function yf(t){if(nv===void 0)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);nv=e&&e[1]||""}return`
`+nv+t}var ov=!1;function av(t,e){if(!t||ov)return"";ov=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(y){var r=y}Reflect.construct(t,[],e)}else{try{e.call()}catch(y){r=y}t.call(e.prototype)}else{try{throw Error()}catch(y){r=y}t()}}catch(y){if(y&&r&&typeof y.stack=="string"){for(var s=y.stack.split(`
`),n=r.stack.split(`
`),c=s.length-1,l=n.length-1;1<=c&&0<=l&&s[c]!==n[l];)l--;for(;1<=c&&0<=l;c--,l--)if(s[c]!==n[l]){if(c!==1||l!==1)do if(c--,l--,0>l||s[c]!==n[l]){var f=`
`+s[c].replace(" at new "," at ");return t.displayName&&f.includes("<anonymous>")&&(f=f.replace("<anonymous>",t.displayName)),f}while(1<=c&&0<=l);break}}}finally{ov=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?yf(t):""}function YO(t){switch(t.tag){case 5:return yf(t.type);case 16:return yf("Lazy");case 13:return yf("Suspense");case 19:return yf("SuspenseList");case 0:case 2:case 15:return t=av(t.type,!1),t;case 11:return t=av(t.type.render,!1),t;case 1:return t=av(t.type,!0),t;default:return""}}function Xb(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Vh:return"Fragment";case Gh:return"Portal";case Hb:return"Profiler";case Kx:return"StrictMode";case qb:return"Suspense";case Wb:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case UR:return(t.displayName||"Context")+".Consumer";case NR:return(t._context.displayName||"Context")+".Provider";case Jx:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Zx:return e=t.displayName||null,e!==null?e:Xb(t.type)||"Memo";case Gl:e=t._payload,t=t._init;try{return Xb(t(e))}catch{}}return null}function QO(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Xb(e);case 8:return e===Kx?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function uc(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function jR(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eD(t){var e=jR(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var s=i.get,n=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(c){r=""+c,n.call(this,c)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(c){r=""+c},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Hg(t){t._valueTracker||(t._valueTracker=eD(t))}function GR(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),r="";return t&&(r=jR(t)?t.checked?"true":"false":t.value),t=r,t!==i?(e.setValue(t),!0):!1}function h0(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Kb(t,e){var i=e.checked;return lr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??t._wrapperState.initialChecked})}function B3(t,e){var i=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;i=uc(e.value!=null?e.value:i),t._wrapperState={initialChecked:r,initialValue:i,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function VR(t,e){e=e.checked,e!=null&&Xx(t,"checked",e,!1)}function Jb(t,e){VR(t,e);var i=uc(e.value),r=e.type;if(i!=null)r==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Zb(t,e.type,i):e.hasOwnProperty("defaultValue")&&Zb(t,e.type,uc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function L3(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function Zb(t,e,i){(e!=="number"||h0(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var vf=Array.isArray;function ld(t,e,i,r){if(t=t.options,e){e={};for(var s=0;s<i.length;s++)e["$"+i[s]]=!0;for(i=0;i<t.length;i++)s=e.hasOwnProperty("$"+t[i].value),t[i].selected!==s&&(t[i].selected=s),s&&r&&(t[i].defaultSelected=!0)}else{for(i=""+uc(i),e=null,s=0;s<t.length;s++){if(t[s].value===i){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Yb(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(tt(91));return lr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function O3(t,e){var i=e.value;if(i==null){if(i=e.children,e=e.defaultValue,i!=null){if(e!=null)throw Error(tt(92));if(vf(i)){if(1<i.length)throw Error(tt(93));i=i[0]}e=i}e==null&&(e=""),i=e}t._wrapperState={initialValue:uc(i)}}function $R(t,e){var i=uc(e.value),r=uc(e.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),e.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),r!=null&&(t.defaultValue=""+r)}function D3(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function HR(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qb(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?HR(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var qg,qR=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,i,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,i,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(qg=qg||document.createElement("div"),qg.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=qg.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Jf(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=e;return}}t.textContent=e}var Pf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tD=["Webkit","ms","Moz","O"];Object.keys(Pf).forEach(function(t){tD.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Pf[e]=Pf[t]})});function WR(t,e,i){return e==null||typeof e=="boolean"||e===""?"":i||typeof e!="number"||e===0||Pf.hasOwnProperty(t)&&Pf[t]?(""+e).trim():e+"px"}function XR(t,e){t=t.style;for(var i in e)if(e.hasOwnProperty(i)){var r=i.indexOf("--")===0,s=WR(i,e[i],r);i==="float"&&(i="cssFloat"),r?t.setProperty(i,s):t[i]=s}}var iD=lr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ew(t,e){if(e){if(iD[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(tt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(tt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(tt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(tt(62))}}function tw(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var iw=null;function Yx(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var rw=null,cd=null,ud=null;function F3(t){if(t=Cm(t)){if(typeof rw!="function")throw Error(tt(280));var e=t.stateNode;e&&(e=c1(e),rw(t.stateNode,t.type,e))}}function KR(t){cd?ud?ud.push(t):ud=[t]:cd=t}function JR(){if(cd){var t=cd,e=ud;if(ud=cd=null,F3(t),e)for(t=0;t<e.length;t++)F3(e[t])}}function ZR(t,e){return t(e)}function YR(){}var lv=!1;function QR(t,e,i){if(lv)return t(e,i);lv=!0;try{return ZR(t,e,i)}finally{lv=!1,(cd!==null||ud!==null)&&(YR(),JR())}}function Zf(t,e){var i=t.stateNode;if(i===null)return null;var r=c1(i);if(r===null)return null;i=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(tt(231,e,typeof i));return i}var sw=!1;if(Xa)try{var Zp={};Object.defineProperty(Zp,"passive",{get:function(){sw=!0}}),window.addEventListener("test",Zp,Zp),window.removeEventListener("test",Zp,Zp)}catch{sw=!1}function rD(t,e,i,r,s,n,c,l,f){var y=Array.prototype.slice.call(arguments,3);try{e.apply(i,y)}catch(E){this.onError(E)}}var kf=!1,d0=null,p0=!1,nw=null,sD={onError:function(t){kf=!0,d0=t}};function nD(t,e,i,r,s,n,c,l,f){kf=!1,d0=null,rD.apply(sD,arguments)}function oD(t,e,i,r,s,n,c,l,f){if(nD.apply(this,arguments),kf){if(kf){var y=d0;kf=!1,d0=null}else throw Error(tt(198));p0||(p0=!0,nw=y)}}function Cu(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(i=e.return),t=e.return;while(t)}return e.tag===3?i:null}function e5(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function N3(t){if(Cu(t)!==t)throw Error(tt(188))}function aD(t){var e=t.alternate;if(!e){if(e=Cu(t),e===null)throw Error(tt(188));return e!==t?null:t}for(var i=t,r=e;;){var s=i.return;if(s===null)break;var n=s.alternate;if(n===null){if(r=s.return,r!==null){i=r;continue}break}if(s.child===n.child){for(n=s.child;n;){if(n===i)return N3(s),t;if(n===r)return N3(s),e;n=n.sibling}throw Error(tt(188))}if(i.return!==r.return)i=s,r=n;else{for(var c=!1,l=s.child;l;){if(l===i){c=!0,i=s,r=n;break}if(l===r){c=!0,r=s,i=n;break}l=l.sibling}if(!c){for(l=n.child;l;){if(l===i){c=!0,i=n,r=s;break}if(l===r){c=!0,r=n,i=s;break}l=l.sibling}if(!c)throw Error(tt(189))}}if(i.alternate!==r)throw Error(tt(190))}if(i.tag!==3)throw Error(tt(188));return i.stateNode.current===i?t:e}function t5(t){return t=aD(t),t!==null?i5(t):null}function i5(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=i5(t);if(e!==null)return e;t=t.sibling}return null}var r5=Nn.unstable_scheduleCallback,U3=Nn.unstable_cancelCallback,lD=Nn.unstable_shouldYield,cD=Nn.unstable_requestPaint,_r=Nn.unstable_now,uD=Nn.unstable_getCurrentPriorityLevel,Qx=Nn.unstable_ImmediatePriority,s5=Nn.unstable_UserBlockingPriority,f0=Nn.unstable_NormalPriority,hD=Nn.unstable_LowPriority,n5=Nn.unstable_IdlePriority,n1=null,pa=null;function dD(t){if(pa&&typeof pa.onCommitFiberRoot=="function")try{pa.onCommitFiberRoot(n1,t,void 0,(t.current.flags&128)===128)}catch{}}var Lo=Math.clz32?Math.clz32:mD,pD=Math.log,fD=Math.LN2;function mD(t){return t>>>=0,t===0?32:31-(pD(t)/fD|0)|0}var Wg=64,Xg=4194304;function bf(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function m0(t,e){var i=t.pendingLanes;if(i===0)return 0;var r=0,s=t.suspendedLanes,n=t.pingedLanes,c=i&268435455;if(c!==0){var l=c&~s;l!==0?r=bf(l):(n&=c,n!==0&&(r=bf(n)))}else c=i&~s,c!==0?r=bf(c):n!==0&&(r=bf(n));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,n=e&-e,s>=n||s===16&&(n&4194240)!==0))return e;if(r&4&&(r|=i&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)i=31-Lo(e),s=1<<i,r|=t[i],e&=~s;return r}function gD(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _D(t,e){for(var i=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,n=t.pendingLanes;0<n;){var c=31-Lo(n),l=1<<c,f=s[c];f===-1?(!(l&i)||l&r)&&(s[c]=gD(l,e)):f<=e&&(t.expiredLanes|=l),n&=~l}}function ow(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function o5(){var t=Wg;return Wg<<=1,!(Wg&4194240)&&(Wg=64),t}function cv(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function Tm(t,e,i){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Lo(e),t[e]=i}function yD(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<i;){var s=31-Lo(i),n=1<<s;e[s]=0,r[s]=-1,t[s]=-1,i&=~n}}function e2(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var r=31-Lo(i),s=1<<r;s&e|t[r]&e&&(t[r]|=e),i&=~s}}var Ci=0;function a5(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var l5,t2,c5,u5,h5,aw=!1,Kg=[],ec=null,tc=null,ic=null,Yf=new Map,Qf=new Map,Hl=[],vD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function z3(t,e){switch(t){case"focusin":case"focusout":ec=null;break;case"dragenter":case"dragleave":tc=null;break;case"mouseover":case"mouseout":ic=null;break;case"pointerover":case"pointerout":Yf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qf.delete(e.pointerId)}}function Yp(t,e,i,r,s,n){return t===null||t.nativeEvent!==n?(t={blockedOn:e,domEventName:i,eventSystemFlags:r,nativeEvent:n,targetContainers:[s]},e!==null&&(e=Cm(e),e!==null&&t2(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function bD(t,e,i,r,s){switch(e){case"focusin":return ec=Yp(ec,t,e,i,r,s),!0;case"dragenter":return tc=Yp(tc,t,e,i,r,s),!0;case"mouseover":return ic=Yp(ic,t,e,i,r,s),!0;case"pointerover":var n=s.pointerId;return Yf.set(n,Yp(Yf.get(n)||null,t,e,i,r,s)),!0;case"gotpointercapture":return n=s.pointerId,Qf.set(n,Yp(Qf.get(n)||null,t,e,i,r,s)),!0}return!1}function d5(t){var e=nu(t.target);if(e!==null){var i=Cu(e);if(i!==null){if(e=i.tag,e===13){if(e=e5(i),e!==null){t.blockedOn=e,h5(t.priority,function(){c5(i)});return}}else if(e===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function G_(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var i=lw(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(i===null){i=t.nativeEvent;var r=new i.constructor(i.type,i);iw=r,i.target.dispatchEvent(r),iw=null}else return e=Cm(i),e!==null&&t2(e),t.blockedOn=i,!1;e.shift()}return!0}function j3(t,e,i){G_(t)&&i.delete(e)}function wD(){aw=!1,ec!==null&&G_(ec)&&(ec=null),tc!==null&&G_(tc)&&(tc=null),ic!==null&&G_(ic)&&(ic=null),Yf.forEach(j3),Qf.forEach(j3)}function Qp(t,e){t.blockedOn===e&&(t.blockedOn=null,aw||(aw=!0,Nn.unstable_scheduleCallback(Nn.unstable_NormalPriority,wD)))}function em(t){function e(s){return Qp(s,t)}if(0<Kg.length){Qp(Kg[0],t);for(var i=1;i<Kg.length;i++){var r=Kg[i];r.blockedOn===t&&(r.blockedOn=null)}}for(ec!==null&&Qp(ec,t),tc!==null&&Qp(tc,t),ic!==null&&Qp(ic,t),Yf.forEach(e),Qf.forEach(e),i=0;i<Hl.length;i++)r=Hl[i],r.blockedOn===t&&(r.blockedOn=null);for(;0<Hl.length&&(i=Hl[0],i.blockedOn===null);)d5(i),i.blockedOn===null&&Hl.shift()}var hd=el.ReactCurrentBatchConfig,g0=!0;function xD(t,e,i,r){var s=Ci,n=hd.transition;hd.transition=null;try{Ci=1,i2(t,e,i,r)}finally{Ci=s,hd.transition=n}}function ED(t,e,i,r){var s=Ci,n=hd.transition;hd.transition=null;try{Ci=4,i2(t,e,i,r)}finally{Ci=s,hd.transition=n}}function i2(t,e,i,r){if(g0){var s=lw(t,e,i,r);if(s===null)vv(t,e,r,_0,i),z3(t,r);else if(bD(s,t,e,i,r))r.stopPropagation();else if(z3(t,r),e&4&&-1<vD.indexOf(t)){for(;s!==null;){var n=Cm(s);if(n!==null&&l5(n),n=lw(t,e,i,r),n===null&&vv(t,e,r,_0,i),n===s)break;s=n}s!==null&&r.stopPropagation()}else vv(t,e,r,null,i)}}var _0=null;function lw(t,e,i,r){if(_0=null,t=Yx(r),t=nu(t),t!==null)if(e=Cu(t),e===null)t=null;else if(i=e.tag,i===13){if(t=e5(e),t!==null)return t;t=null}else if(i===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return _0=t,null}function p5(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uD()){case Qx:return 1;case s5:return 4;case f0:case hD:return 16;case n5:return 536870912;default:return 16}default:return 16}}var Xl=null,r2=null,V_=null;function f5(){if(V_)return V_;var t,e=r2,i=e.length,r,s="value"in Xl?Xl.value:Xl.textContent,n=s.length;for(t=0;t<i&&e[t]===s[t];t++);var c=i-t;for(r=1;r<=c&&e[i-r]===s[n-r];r++);return V_=s.slice(t,1<r?1-r:void 0)}function $_(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Jg(){return!0}function G3(){return!1}function zn(t){function e(i,r,s,n,c){this._reactName=i,this._targetInst=s,this.type=r,this.nativeEvent=n,this.target=c,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(i=t[l],this[l]=i?i(n):n[l]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?Jg:G3,this.isPropagationStopped=G3,this}return lr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Jg)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Jg)},persist:function(){},isPersistent:Jg}),e}var zd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},s2=zn(zd),Sm=lr({},zd,{view:0,detail:0}),AD=zn(Sm),uv,hv,ef,o1=lr({},Sm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:n2,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ef&&(ef&&t.type==="mousemove"?(uv=t.screenX-ef.screenX,hv=t.screenY-ef.screenY):hv=uv=0,ef=t),uv)},movementY:function(t){return"movementY"in t?t.movementY:hv}}),V3=zn(o1),TD=lr({},o1,{dataTransfer:0}),SD=zn(TD),CD=lr({},Sm,{relatedTarget:0}),dv=zn(CD),ID=lr({},zd,{animationName:0,elapsedTime:0,pseudoElement:0}),RD=zn(ID),MD=lr({},zd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),PD=zn(MD),kD=lr({},zd,{data:0}),$3=zn(kD),BD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},LD={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},OD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DD(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=OD[t])?!!e[t]:!1}function n2(){return DD}var FD=lr({},Sm,{key:function(t){if(t.key){var e=BD[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=$_(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?LD[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:n2,charCode:function(t){return t.type==="keypress"?$_(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?$_(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),ND=zn(FD),UD=lr({},o1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),H3=zn(UD),zD=lr({},Sm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:n2}),jD=zn(zD),GD=lr({},zd,{propertyName:0,elapsedTime:0,pseudoElement:0}),VD=zn(GD),$D=lr({},o1,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),HD=zn($D),qD=[9,13,27,32],o2=Xa&&"CompositionEvent"in window,Bf=null;Xa&&"documentMode"in document&&(Bf=document.documentMode);var WD=Xa&&"TextEvent"in window&&!Bf,m5=Xa&&(!o2||Bf&&8<Bf&&11>=Bf),q3=String.fromCharCode(32),W3=!1;function g5(t,e){switch(t){case"keyup":return qD.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _5(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var $h=!1;function XD(t,e){switch(t){case"compositionend":return _5(e);case"keypress":return e.which!==32?null:(W3=!0,q3);case"textInput":return t=e.data,t===q3&&W3?null:t;default:return null}}function KD(t,e){if($h)return t==="compositionend"||!o2&&g5(t,e)?(t=f5(),V_=r2=Xl=null,$h=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return m5&&e.locale!=="ko"?null:e.data;default:return null}}var JD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function X3(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!JD[t.type]:e==="textarea"}function y5(t,e,i,r){KR(r),e=y0(e,"onChange"),0<e.length&&(i=new s2("onChange","change",null,i,r),t.push({event:i,listeners:e}))}var Lf=null,tm=null;function ZD(t){R5(t,0)}function a1(t){var e=Wh(t);if(GR(e))return t}function YD(t,e){if(t==="change")return e}var v5=!1;if(Xa){var pv;if(Xa){var fv="oninput"in document;if(!fv){var K3=document.createElement("div");K3.setAttribute("oninput","return;"),fv=typeof K3.oninput=="function"}pv=fv}else pv=!1;v5=pv&&(!document.documentMode||9<document.documentMode)}function J3(){Lf&&(Lf.detachEvent("onpropertychange",b5),tm=Lf=null)}function b5(t){if(t.propertyName==="value"&&a1(tm)){var e=[];y5(e,tm,t,Yx(t)),QR(ZD,e)}}function QD(t,e,i){t==="focusin"?(J3(),Lf=e,tm=i,Lf.attachEvent("onpropertychange",b5)):t==="focusout"&&J3()}function e8(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return a1(tm)}function t8(t,e){if(t==="click")return a1(e)}function i8(t,e){if(t==="input"||t==="change")return a1(e)}function r8(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var No=typeof Object.is=="function"?Object.is:r8;function im(t,e){if(No(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var s=i[r];if(!$b.call(e,s)||!No(t[s],e[s]))return!1}return!0}function Z3(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Y3(t,e){var i=Z3(t);t=0;for(var r;i;){if(i.nodeType===3){if(r=t+i.textContent.length,t<=e&&r>=e)return{node:i,offset:e-t};t=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Z3(i)}}function w5(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?w5(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function x5(){for(var t=window,e=h0();e instanceof t.HTMLIFrameElement;){try{var i=typeof e.contentWindow.location.href=="string"}catch{i=!1}if(i)t=e.contentWindow;else break;e=h0(t.document)}return e}function a2(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function s8(t){var e=x5(),i=t.focusedElem,r=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&w5(i.ownerDocument.documentElement,i)){if(r!==null&&a2(i)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if(t=(e=i.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=i.textContent.length,n=Math.min(r.start,s);r=r.end===void 0?n:Math.min(r.end,s),!t.extend&&n>r&&(s=r,r=n,n=s),s=Y3(i,n);var c=Y3(i,r);s&&c&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==c.node||t.focusOffset!==c.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),n>r?(t.addRange(e),t.extend(c.node,c.offset)):(e.setEnd(c.node,c.offset),t.addRange(e)))}}for(e=[],t=i;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<e.length;i++)t=e[i],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var n8=Xa&&"documentMode"in document&&11>=document.documentMode,Hh=null,cw=null,Of=null,uw=!1;function Q3(t,e,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;uw||Hh==null||Hh!==h0(r)||(r=Hh,"selectionStart"in r&&a2(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Of&&im(Of,r)||(Of=r,r=y0(cw,"onSelect"),0<r.length&&(e=new s2("onSelect","select",null,e,i),t.push({event:e,listeners:r}),e.target=Hh)))}function Zg(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var qh={animationend:Zg("Animation","AnimationEnd"),animationiteration:Zg("Animation","AnimationIteration"),animationstart:Zg("Animation","AnimationStart"),transitionend:Zg("Transition","TransitionEnd")},mv={},E5={};Xa&&(E5=document.createElement("div").style,"AnimationEvent"in window||(delete qh.animationend.animation,delete qh.animationiteration.animation,delete qh.animationstart.animation),"TransitionEvent"in window||delete qh.transitionend.transition);function l1(t){if(mv[t])return mv[t];if(!qh[t])return t;var e=qh[t],i;for(i in e)if(e.hasOwnProperty(i)&&i in E5)return mv[t]=e[i];return t}var A5=l1("animationend"),T5=l1("animationiteration"),S5=l1("animationstart"),C5=l1("transitionend"),I5=new Map,eT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mc(t,e){I5.set(t,e),Su(e,[t])}for(var gv=0;gv<eT.length;gv++){var _v=eT[gv],o8=_v.toLowerCase(),a8=_v[0].toUpperCase()+_v.slice(1);mc(o8,"on"+a8)}mc(A5,"onAnimationEnd");mc(T5,"onAnimationIteration");mc(S5,"onAnimationStart");mc("dblclick","onDoubleClick");mc("focusin","onFocus");mc("focusout","onBlur");mc(C5,"onTransitionEnd");wd("onMouseEnter",["mouseout","mouseover"]);wd("onMouseLeave",["mouseout","mouseover"]);wd("onPointerEnter",["pointerout","pointerover"]);wd("onPointerLeave",["pointerout","pointerover"]);Su("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Su("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Su("onBeforeInput",["compositionend","keypress","textInput","paste"]);Su("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Su("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Su("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),l8=new Set("cancel close invalid load scroll toggle".split(" ").concat(wf));function tT(t,e,i){var r=t.type||"unknown-event";t.currentTarget=i,oD(r,e,void 0,t),t.currentTarget=null}function R5(t,e){e=(e&4)!==0;for(var i=0;i<t.length;i++){var r=t[i],s=r.event;r=r.listeners;e:{var n=void 0;if(e)for(var c=r.length-1;0<=c;c--){var l=r[c],f=l.instance,y=l.currentTarget;if(l=l.listener,f!==n&&s.isPropagationStopped())break e;tT(s,l,y),n=f}else for(c=0;c<r.length;c++){if(l=r[c],f=l.instance,y=l.currentTarget,l=l.listener,f!==n&&s.isPropagationStopped())break e;tT(s,l,y),n=f}}}if(p0)throw t=nw,p0=!1,nw=null,t}function Ki(t,e){var i=e[mw];i===void 0&&(i=e[mw]=new Set);var r=t+"__bubble";i.has(r)||(M5(e,t,2,!1),i.add(r))}function yv(t,e,i){var r=0;e&&(r|=4),M5(i,t,r,e)}var Yg="_reactListening"+Math.random().toString(36).slice(2);function rm(t){if(!t[Yg]){t[Yg]=!0,FR.forEach(function(i){i!=="selectionchange"&&(l8.has(i)||yv(i,!1,t),yv(i,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Yg]||(e[Yg]=!0,yv("selectionchange",!1,e))}}function M5(t,e,i,r){switch(p5(e)){case 1:var s=xD;break;case 4:s=ED;break;default:s=i2}i=s.bind(null,e,i,t),s=void 0,!sw||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,i,{capture:!0,passive:s}):t.addEventListener(e,i,!0):s!==void 0?t.addEventListener(e,i,{passive:s}):t.addEventListener(e,i,!1)}function vv(t,e,i,r,s){var n=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var c=r.tag;if(c===3||c===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(c===4)for(c=r.return;c!==null;){var f=c.tag;if((f===3||f===4)&&(f=c.stateNode.containerInfo,f===s||f.nodeType===8&&f.parentNode===s))return;c=c.return}for(;l!==null;){if(c=nu(l),c===null)return;if(f=c.tag,f===5||f===6){r=n=c;continue e}l=l.parentNode}}r=r.return}QR(function(){var y=n,E=Yx(i),T=[];e:{var R=I5.get(t);if(R!==void 0){var D=s2,V=t;switch(t){case"keypress":if($_(i)===0)break e;case"keydown":case"keyup":D=ND;break;case"focusin":V="focus",D=dv;break;case"focusout":V="blur",D=dv;break;case"beforeblur":case"afterblur":D=dv;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":D=V3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":D=SD;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":D=jD;break;case A5:case T5:case S5:D=RD;break;case C5:D=VD;break;case"scroll":D=AD;break;case"wheel":D=HD;break;case"copy":case"cut":case"paste":D=PD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":D=H3}var H=(e&4)!==0,ee=!H&&t==="scroll",z=H?R!==null?R+"Capture":null:R;H=[];for(var W=y,q;W!==null;){q=W;var ce=q.stateNode;if(q.tag===5&&ce!==null&&(q=ce,z!==null&&(ce=Zf(W,z),ce!=null&&H.push(sm(W,ce,q)))),ee)break;W=W.return}0<H.length&&(R=new D(R,V,null,i,E),T.push({event:R,listeners:H}))}}if(!(e&7)){e:{if(R=t==="mouseover"||t==="pointerover",D=t==="mouseout"||t==="pointerout",R&&i!==iw&&(V=i.relatedTarget||i.fromElement)&&(nu(V)||V[Ka]))break e;if((D||R)&&(R=E.window===E?E:(R=E.ownerDocument)?R.defaultView||R.parentWindow:window,D?(V=i.relatedTarget||i.toElement,D=y,V=V?nu(V):null,V!==null&&(ee=Cu(V),V!==ee||V.tag!==5&&V.tag!==6)&&(V=null)):(D=null,V=y),D!==V)){if(H=V3,ce="onMouseLeave",z="onMouseEnter",W="mouse",(t==="pointerout"||t==="pointerover")&&(H=H3,ce="onPointerLeave",z="onPointerEnter",W="pointer"),ee=D==null?R:Wh(D),q=V==null?R:Wh(V),R=new H(ce,W+"leave",D,i,E),R.target=ee,R.relatedTarget=q,ce=null,nu(E)===y&&(H=new H(z,W+"enter",V,i,E),H.target=q,H.relatedTarget=ee,ce=H),ee=ce,D&&V)t:{for(H=D,z=V,W=0,q=H;q;q=xh(q))W++;for(q=0,ce=z;ce;ce=xh(ce))q++;for(;0<W-q;)H=xh(H),W--;for(;0<q-W;)z=xh(z),q--;for(;W--;){if(H===z||z!==null&&H===z.alternate)break t;H=xh(H),z=xh(z)}H=null}else H=null;D!==null&&iT(T,R,D,H,!1),V!==null&&ee!==null&&iT(T,ee,V,H,!0)}}e:{if(R=y?Wh(y):window,D=R.nodeName&&R.nodeName.toLowerCase(),D==="select"||D==="input"&&R.type==="file")var we=YD;else if(X3(R))if(v5)we=i8;else{we=e8;var re=QD}else(D=R.nodeName)&&D.toLowerCase()==="input"&&(R.type==="checkbox"||R.type==="radio")&&(we=t8);if(we&&(we=we(t,y))){y5(T,we,i,E);break e}re&&re(t,R,y),t==="focusout"&&(re=R._wrapperState)&&re.controlled&&R.type==="number"&&Zb(R,"number",R.value)}switch(re=y?Wh(y):window,t){case"focusin":(X3(re)||re.contentEditable==="true")&&(Hh=re,cw=y,Of=null);break;case"focusout":Of=cw=Hh=null;break;case"mousedown":uw=!0;break;case"contextmenu":case"mouseup":case"dragend":uw=!1,Q3(T,i,E);break;case"selectionchange":if(n8)break;case"keydown":case"keyup":Q3(T,i,E)}var be;if(o2)e:{switch(t){case"compositionstart":var me="onCompositionStart";break e;case"compositionend":me="onCompositionEnd";break e;case"compositionupdate":me="onCompositionUpdate";break e}me=void 0}else $h?g5(t,i)&&(me="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(me="onCompositionStart");me&&(m5&&i.locale!=="ko"&&($h||me!=="onCompositionStart"?me==="onCompositionEnd"&&$h&&(be=f5()):(Xl=E,r2="value"in Xl?Xl.value:Xl.textContent,$h=!0)),re=y0(y,me),0<re.length&&(me=new $3(me,t,null,i,E),T.push({event:me,listeners:re}),be?me.data=be:(be=_5(i),be!==null&&(me.data=be)))),(be=WD?XD(t,i):KD(t,i))&&(y=y0(y,"onBeforeInput"),0<y.length&&(E=new $3("onBeforeInput","beforeinput",null,i,E),T.push({event:E,listeners:y}),E.data=be))}R5(T,e)})}function sm(t,e,i){return{instance:t,listener:e,currentTarget:i}}function y0(t,e){for(var i=e+"Capture",r=[];t!==null;){var s=t,n=s.stateNode;s.tag===5&&n!==null&&(s=n,n=Zf(t,i),n!=null&&r.unshift(sm(t,n,s)),n=Zf(t,e),n!=null&&r.push(sm(t,n,s))),t=t.return}return r}function xh(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function iT(t,e,i,r,s){for(var n=e._reactName,c=[];i!==null&&i!==r;){var l=i,f=l.alternate,y=l.stateNode;if(f!==null&&f===r)break;l.tag===5&&y!==null&&(l=y,s?(f=Zf(i,n),f!=null&&c.unshift(sm(i,f,l))):s||(f=Zf(i,n),f!=null&&c.push(sm(i,f,l)))),i=i.return}c.length!==0&&t.push({event:e,listeners:c})}var c8=/\r\n?/g,u8=/\u0000|\uFFFD/g;function rT(t){return(typeof t=="string"?t:""+t).replace(c8,`
`).replace(u8,"")}function Qg(t,e,i){if(e=rT(e),rT(t)!==e&&i)throw Error(tt(425))}function v0(){}var hw=null,dw=null;function pw(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var fw=typeof setTimeout=="function"?setTimeout:void 0,h8=typeof clearTimeout=="function"?clearTimeout:void 0,sT=typeof Promise=="function"?Promise:void 0,d8=typeof queueMicrotask=="function"?queueMicrotask:typeof sT<"u"?function(t){return sT.resolve(null).then(t).catch(p8)}:fw;function p8(t){setTimeout(function(){throw t})}function bv(t,e){var i=e,r=0;do{var s=i.nextSibling;if(t.removeChild(i),s&&s.nodeType===8)if(i=s.data,i==="/$"){if(r===0){t.removeChild(s),em(e);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=s}while(i);em(e)}function rc(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function nT(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(e===0)return t;e--}else i==="/$"&&e++}t=t.previousSibling}return null}var jd=Math.random().toString(36).slice(2),la="__reactFiber$"+jd,nm="__reactProps$"+jd,Ka="__reactContainer$"+jd,mw="__reactEvents$"+jd,f8="__reactListeners$"+jd,m8="__reactHandles$"+jd;function nu(t){var e=t[la];if(e)return e;for(var i=t.parentNode;i;){if(e=i[Ka]||i[la]){if(i=e.alternate,e.child!==null||i!==null&&i.child!==null)for(t=nT(t);t!==null;){if(i=t[la])return i;t=nT(t)}return e}t=i,i=t.parentNode}return null}function Cm(t){return t=t[la]||t[Ka],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Wh(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(tt(33))}function c1(t){return t[nm]||null}var gw=[],Xh=-1;function gc(t){return{current:t}}function Ji(t){0>Xh||(t.current=gw[Xh],gw[Xh]=null,Xh--)}function Gi(t,e){Xh++,gw[Xh]=t.current,t.current=e}var hc={},ks=gc(hc),pn=gc(!1),_u=hc;function xd(t,e){var i=t.type.contextTypes;if(!i)return hc;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},n;for(n in i)s[n]=e[n];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function fn(t){return t=t.childContextTypes,t!=null}function b0(){Ji(pn),Ji(ks)}function oT(t,e,i){if(ks.current!==hc)throw Error(tt(168));Gi(ks,e),Gi(pn,i)}function P5(t,e,i){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(tt(108,QO(t)||"Unknown",s));return lr({},i,r)}function w0(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||hc,_u=ks.current,Gi(ks,t),Gi(pn,pn.current),!0}function aT(t,e,i){var r=t.stateNode;if(!r)throw Error(tt(169));i?(t=P5(t,e,_u),r.__reactInternalMemoizedMergedChildContext=t,Ji(pn),Ji(ks),Gi(ks,t)):Ji(pn),Gi(pn,i)}var za=null,u1=!1,wv=!1;function k5(t){za===null?za=[t]:za.push(t)}function g8(t){u1=!0,k5(t)}function _c(){if(!wv&&za!==null){wv=!0;var t=0,e=Ci;try{var i=za;for(Ci=1;t<i.length;t++){var r=i[t];do r=r(!0);while(r!==null)}za=null,u1=!1}catch(s){throw za!==null&&(za=za.slice(t+1)),r5(Qx,_c),s}finally{Ci=e,wv=!1}}return null}var Kh=[],Jh=0,x0=null,E0=0,to=[],io=0,yu=null,ja=1,Ga="";function Yc(t,e){Kh[Jh++]=E0,Kh[Jh++]=x0,x0=t,E0=e}function B5(t,e,i){to[io++]=ja,to[io++]=Ga,to[io++]=yu,yu=t;var r=ja;t=Ga;var s=32-Lo(r)-1;r&=~(1<<s),i+=1;var n=32-Lo(e)+s;if(30<n){var c=s-s%5;n=(r&(1<<c)-1).toString(32),r>>=c,s-=c,ja=1<<32-Lo(e)+s|i<<s|r,Ga=n+t}else ja=1<<n|i<<s|r,Ga=t}function l2(t){t.return!==null&&(Yc(t,1),B5(t,1,0))}function c2(t){for(;t===x0;)x0=Kh[--Jh],Kh[Jh]=null,E0=Kh[--Jh],Kh[Jh]=null;for(;t===yu;)yu=to[--io],to[io]=null,Ga=to[--io],to[io]=null,ja=to[--io],to[io]=null}var Fn=null,On=null,ir=!1,So=null;function L5(t,e){var i=ro(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)}function lT(t,e){switch(t.tag){case 5:var i=t.type;return e=e.nodeType!==1||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Fn=t,On=rc(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Fn=t,On=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(i=yu!==null?{id:ja,overflow:Ga}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},i=ro(18,null,null,0),i.stateNode=e,i.return=t,t.child=i,Fn=t,On=null,!0):!1;default:return!1}}function _w(t){return(t.mode&1)!==0&&(t.flags&128)===0}function yw(t){if(ir){var e=On;if(e){var i=e;if(!lT(t,e)){if(_w(t))throw Error(tt(418));e=rc(i.nextSibling);var r=Fn;e&&lT(t,e)?L5(r,i):(t.flags=t.flags&-4097|2,ir=!1,Fn=t)}}else{if(_w(t))throw Error(tt(418));t.flags=t.flags&-4097|2,ir=!1,Fn=t}}}function cT(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Fn=t}function e_(t){if(t!==Fn)return!1;if(!ir)return cT(t),ir=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!pw(t.type,t.memoizedProps)),e&&(e=On)){if(_w(t))throw O5(),Error(tt(418));for(;e;)L5(t,e),e=rc(e.nextSibling)}if(cT(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(tt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(e===0){On=rc(t.nextSibling);break e}e--}else i!=="$"&&i!=="$!"&&i!=="$?"||e++}t=t.nextSibling}On=null}}else On=Fn?rc(t.stateNode.nextSibling):null;return!0}function O5(){for(var t=On;t;)t=rc(t.nextSibling)}function Ed(){On=Fn=null,ir=!1}function u2(t){So===null?So=[t]:So.push(t)}var _8=el.ReactCurrentBatchConfig;function tf(t,e,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(tt(309));var r=i.stateNode}if(!r)throw Error(tt(147,t));var s=r,n=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===n?e.ref:(e=function(c){var l=s.refs;c===null?delete l[n]:l[n]=c},e._stringRef=n,e)}if(typeof t!="string")throw Error(tt(284));if(!i._owner)throw Error(tt(290,t))}return t}function t_(t,e){throw t=Object.prototype.toString.call(e),Error(tt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function uT(t){var e=t._init;return e(t._payload)}function D5(t){function e(z,W){if(t){var q=z.deletions;q===null?(z.deletions=[W],z.flags|=16):q.push(W)}}function i(z,W){if(!t)return null;for(;W!==null;)e(z,W),W=W.sibling;return null}function r(z,W){for(z=new Map;W!==null;)W.key!==null?z.set(W.key,W):z.set(W.index,W),W=W.sibling;return z}function s(z,W){return z=ac(z,W),z.index=0,z.sibling=null,z}function n(z,W,q){return z.index=q,t?(q=z.alternate,q!==null?(q=q.index,q<W?(z.flags|=2,W):q):(z.flags|=2,W)):(z.flags|=1048576,W)}function c(z){return t&&z.alternate===null&&(z.flags|=2),z}function l(z,W,q,ce){return W===null||W.tag!==6?(W=Iv(q,z.mode,ce),W.return=z,W):(W=s(W,q),W.return=z,W)}function f(z,W,q,ce){var we=q.type;return we===Vh?E(z,W,q.props.children,ce,q.key):W!==null&&(W.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===Gl&&uT(we)===W.type)?(ce=s(W,q.props),ce.ref=tf(z,W,q),ce.return=z,ce):(ce=Z_(q.type,q.key,q.props,null,z.mode,ce),ce.ref=tf(z,W,q),ce.return=z,ce)}function y(z,W,q,ce){return W===null||W.tag!==4||W.stateNode.containerInfo!==q.containerInfo||W.stateNode.implementation!==q.implementation?(W=Rv(q,z.mode,ce),W.return=z,W):(W=s(W,q.children||[]),W.return=z,W)}function E(z,W,q,ce,we){return W===null||W.tag!==7?(W=pu(q,z.mode,ce,we),W.return=z,W):(W=s(W,q),W.return=z,W)}function T(z,W,q){if(typeof W=="string"&&W!==""||typeof W=="number")return W=Iv(""+W,z.mode,q),W.return=z,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case $g:return q=Z_(W.type,W.key,W.props,null,z.mode,q),q.ref=tf(z,null,W),q.return=z,q;case Gh:return W=Rv(W,z.mode,q),W.return=z,W;case Gl:var ce=W._init;return T(z,ce(W._payload),q)}if(vf(W)||Jp(W))return W=pu(W,z.mode,q,null),W.return=z,W;t_(z,W)}return null}function R(z,W,q,ce){var we=W!==null?W.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return we!==null?null:l(z,W,""+q,ce);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case $g:return q.key===we?f(z,W,q,ce):null;case Gh:return q.key===we?y(z,W,q,ce):null;case Gl:return we=q._init,R(z,W,we(q._payload),ce)}if(vf(q)||Jp(q))return we!==null?null:E(z,W,q,ce,null);t_(z,q)}return null}function D(z,W,q,ce,we){if(typeof ce=="string"&&ce!==""||typeof ce=="number")return z=z.get(q)||null,l(W,z,""+ce,we);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case $g:return z=z.get(ce.key===null?q:ce.key)||null,f(W,z,ce,we);case Gh:return z=z.get(ce.key===null?q:ce.key)||null,y(W,z,ce,we);case Gl:var re=ce._init;return D(z,W,q,re(ce._payload),we)}if(vf(ce)||Jp(ce))return z=z.get(q)||null,E(W,z,ce,we,null);t_(W,ce)}return null}function V(z,W,q,ce){for(var we=null,re=null,be=W,me=W=0,Te=null;be!==null&&me<q.length;me++){be.index>me?(Te=be,be=null):Te=be.sibling;var Pe=R(z,be,q[me],ce);if(Pe===null){be===null&&(be=Te);break}t&&be&&Pe.alternate===null&&e(z,be),W=n(Pe,W,me),re===null?we=Pe:re.sibling=Pe,re=Pe,be=Te}if(me===q.length)return i(z,be),ir&&Yc(z,me),we;if(be===null){for(;me<q.length;me++)be=T(z,q[me],ce),be!==null&&(W=n(be,W,me),re===null?we=be:re.sibling=be,re=be);return ir&&Yc(z,me),we}for(be=r(z,be);me<q.length;me++)Te=D(be,z,me,q[me],ce),Te!==null&&(t&&Te.alternate!==null&&be.delete(Te.key===null?me:Te.key),W=n(Te,W,me),re===null?we=Te:re.sibling=Te,re=Te);return t&&be.forEach(function(ze){return e(z,ze)}),ir&&Yc(z,me),we}function H(z,W,q,ce){var we=Jp(q);if(typeof we!="function")throw Error(tt(150));if(q=we.call(q),q==null)throw Error(tt(151));for(var re=we=null,be=W,me=W=0,Te=null,Pe=q.next();be!==null&&!Pe.done;me++,Pe=q.next()){be.index>me?(Te=be,be=null):Te=be.sibling;var ze=R(z,be,Pe.value,ce);if(ze===null){be===null&&(be=Te);break}t&&be&&ze.alternate===null&&e(z,be),W=n(ze,W,me),re===null?we=ze:re.sibling=ze,re=ze,be=Te}if(Pe.done)return i(z,be),ir&&Yc(z,me),we;if(be===null){for(;!Pe.done;me++,Pe=q.next())Pe=T(z,Pe.value,ce),Pe!==null&&(W=n(Pe,W,me),re===null?we=Pe:re.sibling=Pe,re=Pe);return ir&&Yc(z,me),we}for(be=r(z,be);!Pe.done;me++,Pe=q.next())Pe=D(be,z,me,Pe.value,ce),Pe!==null&&(t&&Pe.alternate!==null&&be.delete(Pe.key===null?me:Pe.key),W=n(Pe,W,me),re===null?we=Pe:re.sibling=Pe,re=Pe);return t&&be.forEach(function(Ke){return e(z,Ke)}),ir&&Yc(z,me),we}function ee(z,W,q,ce){if(typeof q=="object"&&q!==null&&q.type===Vh&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case $g:e:{for(var we=q.key,re=W;re!==null;){if(re.key===we){if(we=q.type,we===Vh){if(re.tag===7){i(z,re.sibling),W=s(re,q.props.children),W.return=z,z=W;break e}}else if(re.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===Gl&&uT(we)===re.type){i(z,re.sibling),W=s(re,q.props),W.ref=tf(z,re,q),W.return=z,z=W;break e}i(z,re);break}else e(z,re);re=re.sibling}q.type===Vh?(W=pu(q.props.children,z.mode,ce,q.key),W.return=z,z=W):(ce=Z_(q.type,q.key,q.props,null,z.mode,ce),ce.ref=tf(z,W,q),ce.return=z,z=ce)}return c(z);case Gh:e:{for(re=q.key;W!==null;){if(W.key===re)if(W.tag===4&&W.stateNode.containerInfo===q.containerInfo&&W.stateNode.implementation===q.implementation){i(z,W.sibling),W=s(W,q.children||[]),W.return=z,z=W;break e}else{i(z,W);break}else e(z,W);W=W.sibling}W=Rv(q,z.mode,ce),W.return=z,z=W}return c(z);case Gl:return re=q._init,ee(z,W,re(q._payload),ce)}if(vf(q))return V(z,W,q,ce);if(Jp(q))return H(z,W,q,ce);t_(z,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,W!==null&&W.tag===6?(i(z,W.sibling),W=s(W,q),W.return=z,z=W):(i(z,W),W=Iv(q,z.mode,ce),W.return=z,z=W),c(z)):i(z,W)}return ee}var Ad=D5(!0),F5=D5(!1),A0=gc(null),T0=null,Zh=null,h2=null;function d2(){h2=Zh=T0=null}function p2(t){var e=A0.current;Ji(A0),t._currentValue=e}function vw(t,e,i){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===i)break;t=t.return}}function dd(t,e){T0=t,h2=Zh=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(hn=!0),t.firstContext=null)}function ho(t){var e=t._currentValue;if(h2!==t)if(t={context:t,memoizedValue:e,next:null},Zh===null){if(T0===null)throw Error(tt(308));Zh=t,T0.dependencies={lanes:0,firstContext:t}}else Zh=Zh.next=t;return e}var ou=null;function f2(t){ou===null?ou=[t]:ou.push(t)}function N5(t,e,i,r){var s=e.interleaved;return s===null?(i.next=i,f2(e)):(i.next=s.next,s.next=i),e.interleaved=i,Ja(t,r)}function Ja(t,e){t.lanes|=e;var i=t.alternate;for(i!==null&&(i.lanes|=e),i=t,t=t.return;t!==null;)t.childLanes|=e,i=t.alternate,i!==null&&(i.childLanes|=e),i=t,t=t.return;return i.tag===3?i.stateNode:null}var Vl=!1;function m2(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function U5(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Wa(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function sc(t,e,i){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,pi&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ja(t,i)}return s=r.interleaved,s===null?(e.next=e,f2(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ja(t,i)}function H_(t,e,i){if(e=e.updateQueue,e!==null&&(e=e.shared,(i&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,i|=r,e.lanes=i,e2(t,i)}}function hT(t,e){var i=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var s=null,n=null;if(i=i.firstBaseUpdate,i!==null){do{var c={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};n===null?s=n=c:n=n.next=c,i=i.next}while(i!==null);n===null?s=n=e:n=n.next=e}else s=n=e;i={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:n,shared:r.shared,effects:r.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function S0(t,e,i,r){var s=t.updateQueue;Vl=!1;var n=s.firstBaseUpdate,c=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var f=l,y=f.next;f.next=null,c===null?n=y:c.next=y,c=f;var E=t.alternate;E!==null&&(E=E.updateQueue,l=E.lastBaseUpdate,l!==c&&(l===null?E.firstBaseUpdate=y:l.next=y,E.lastBaseUpdate=f))}if(n!==null){var T=s.baseState;c=0,E=y=f=null,l=n;do{var R=l.lane,D=l.eventTime;if((r&R)===R){E!==null&&(E=E.next={eventTime:D,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var V=t,H=l;switch(R=e,D=i,H.tag){case 1:if(V=H.payload,typeof V=="function"){T=V.call(D,T,R);break e}T=V;break e;case 3:V.flags=V.flags&-65537|128;case 0:if(V=H.payload,R=typeof V=="function"?V.call(D,T,R):V,R==null)break e;T=lr({},T,R);break e;case 2:Vl=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,R=s.effects,R===null?s.effects=[l]:R.push(l))}else D={eventTime:D,lane:R,tag:l.tag,payload:l.payload,callback:l.callback,next:null},E===null?(y=E=D,f=T):E=E.next=D,c|=R;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;R=l,l=R.next,R.next=null,s.lastBaseUpdate=R,s.shared.pending=null}}while(1);if(E===null&&(f=T),s.baseState=f,s.firstBaseUpdate=y,s.lastBaseUpdate=E,e=s.shared.interleaved,e!==null){s=e;do c|=s.lane,s=s.next;while(s!==e)}else n===null&&(s.shared.lanes=0);bu|=c,t.lanes=c,t.memoizedState=T}}function dT(t,e,i){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=i,typeof s!="function")throw Error(tt(191,s));s.call(r)}}}var Im={},fa=gc(Im),om=gc(Im),am=gc(Im);function au(t){if(t===Im)throw Error(tt(174));return t}function g2(t,e){switch(Gi(am,e),Gi(om,t),Gi(fa,Im),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Qb(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Qb(e,t)}Ji(fa),Gi(fa,e)}function Td(){Ji(fa),Ji(om),Ji(am)}function z5(t){au(am.current);var e=au(fa.current),i=Qb(e,t.type);e!==i&&(Gi(om,t),Gi(fa,i))}function _2(t){om.current===t&&(Ji(fa),Ji(om))}var or=gc(0);function C0(t){for(var e=t;e!==null;){if(e.tag===13){var i=e.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xv=[];function y2(){for(var t=0;t<xv.length;t++)xv[t]._workInProgressVersionPrimary=null;xv.length=0}var q_=el.ReactCurrentDispatcher,Ev=el.ReactCurrentBatchConfig,vu=0,ar=null,kr=null,Yr=null,I0=!1,Df=!1,lm=0,y8=0;function Ts(){throw Error(tt(321))}function v2(t,e){if(e===null)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!No(t[i],e[i]))return!1;return!0}function b2(t,e,i,r,s,n){if(vu=n,ar=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,q_.current=t===null||t.memoizedState===null?x8:E8,t=i(r,s),Df){n=0;do{if(Df=!1,lm=0,25<=n)throw Error(tt(301));n+=1,Yr=kr=null,e.updateQueue=null,q_.current=A8,t=i(r,s)}while(Df)}if(q_.current=R0,e=kr!==null&&kr.next!==null,vu=0,Yr=kr=ar=null,I0=!1,e)throw Error(tt(300));return t}function w2(){var t=lm!==0;return lm=0,t}function oa(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yr===null?ar.memoizedState=Yr=t:Yr=Yr.next=t,Yr}function po(){if(kr===null){var t=ar.alternate;t=t!==null?t.memoizedState:null}else t=kr.next;var e=Yr===null?ar.memoizedState:Yr.next;if(e!==null)Yr=e,kr=t;else{if(t===null)throw Error(tt(310));kr=t,t={memoizedState:kr.memoizedState,baseState:kr.baseState,baseQueue:kr.baseQueue,queue:kr.queue,next:null},Yr===null?ar.memoizedState=Yr=t:Yr=Yr.next=t}return Yr}function cm(t,e){return typeof e=="function"?e(t):e}function Av(t){var e=po(),i=e.queue;if(i===null)throw Error(tt(311));i.lastRenderedReducer=t;var r=kr,s=r.baseQueue,n=i.pending;if(n!==null){if(s!==null){var c=s.next;s.next=n.next,n.next=c}r.baseQueue=s=n,i.pending=null}if(s!==null){n=s.next,r=r.baseState;var l=c=null,f=null,y=n;do{var E=y.lane;if((vu&E)===E)f!==null&&(f=f.next={lane:0,action:y.action,hasEagerState:y.hasEagerState,eagerState:y.eagerState,next:null}),r=y.hasEagerState?y.eagerState:t(r,y.action);else{var T={lane:E,action:y.action,hasEagerState:y.hasEagerState,eagerState:y.eagerState,next:null};f===null?(l=f=T,c=r):f=f.next=T,ar.lanes|=E,bu|=E}y=y.next}while(y!==null&&y!==n);f===null?c=r:f.next=l,No(r,e.memoizedState)||(hn=!0),e.memoizedState=r,e.baseState=c,e.baseQueue=f,i.lastRenderedState=r}if(t=i.interleaved,t!==null){s=t;do n=s.lane,ar.lanes|=n,bu|=n,s=s.next;while(s!==t)}else s===null&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function Tv(t){var e=po(),i=e.queue;if(i===null)throw Error(tt(311));i.lastRenderedReducer=t;var r=i.dispatch,s=i.pending,n=e.memoizedState;if(s!==null){i.pending=null;var c=s=s.next;do n=t(n,c.action),c=c.next;while(c!==s);No(n,e.memoizedState)||(hn=!0),e.memoizedState=n,e.baseQueue===null&&(e.baseState=n),i.lastRenderedState=n}return[n,r]}function j5(){}function G5(t,e){var i=ar,r=po(),s=e(),n=!No(r.memoizedState,s);if(n&&(r.memoizedState=s,hn=!0),r=r.queue,x2(H5.bind(null,i,r,t),[t]),r.getSnapshot!==e||n||Yr!==null&&Yr.memoizedState.tag&1){if(i.flags|=2048,um(9,$5.bind(null,i,r,s,e),void 0,null),Qr===null)throw Error(tt(349));vu&30||V5(i,e,s)}return s}function V5(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},e=ar.updateQueue,e===null?(e={lastEffect:null,stores:null},ar.updateQueue=e,e.stores=[t]):(i=e.stores,i===null?e.stores=[t]:i.push(t))}function $5(t,e,i,r){e.value=i,e.getSnapshot=r,q5(e)&&W5(t)}function H5(t,e,i){return i(function(){q5(e)&&W5(t)})}function q5(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!No(t,i)}catch{return!0}}function W5(t){var e=Ja(t,1);e!==null&&Oo(e,t,1,-1)}function pT(t){var e=oa();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cm,lastRenderedState:t},e.queue=t,t=t.dispatch=w8.bind(null,ar,t),[e.memoizedState,t]}function um(t,e,i,r){return t={tag:t,create:e,destroy:i,deps:r,next:null},e=ar.updateQueue,e===null?(e={lastEffect:null,stores:null},ar.updateQueue=e,e.lastEffect=t.next=t):(i=e.lastEffect,i===null?e.lastEffect=t.next=t:(r=i.next,i.next=t,t.next=r,e.lastEffect=t)),t}function X5(){return po().memoizedState}function W_(t,e,i,r){var s=oa();ar.flags|=t,s.memoizedState=um(1|e,i,void 0,r===void 0?null:r)}function h1(t,e,i,r){var s=po();r=r===void 0?null:r;var n=void 0;if(kr!==null){var c=kr.memoizedState;if(n=c.destroy,r!==null&&v2(r,c.deps)){s.memoizedState=um(e,i,n,r);return}}ar.flags|=t,s.memoizedState=um(1|e,i,n,r)}function fT(t,e){return W_(8390656,8,t,e)}function x2(t,e){return h1(2048,8,t,e)}function K5(t,e){return h1(4,2,t,e)}function J5(t,e){return h1(4,4,t,e)}function Z5(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Y5(t,e,i){return i=i!=null?i.concat([t]):null,h1(4,4,Z5.bind(null,e,t),i)}function E2(){}function Q5(t,e){var i=po();e=e===void 0?null:e;var r=i.memoizedState;return r!==null&&e!==null&&v2(e,r[1])?r[0]:(i.memoizedState=[t,e],t)}function eM(t,e){var i=po();e=e===void 0?null:e;var r=i.memoizedState;return r!==null&&e!==null&&v2(e,r[1])?r[0]:(t=t(),i.memoizedState=[t,e],t)}function tM(t,e,i){return vu&21?(No(i,e)||(i=o5(),ar.lanes|=i,bu|=i,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,hn=!0),t.memoizedState=i)}function v8(t,e){var i=Ci;Ci=i!==0&&4>i?i:4,t(!0);var r=Ev.transition;Ev.transition={};try{t(!1),e()}finally{Ci=i,Ev.transition=r}}function iM(){return po().memoizedState}function b8(t,e,i){var r=oc(t);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},rM(t))sM(e,i);else if(i=N5(t,e,i,r),i!==null){var s=$s();Oo(i,t,r,s),nM(i,e,r)}}function w8(t,e,i){var r=oc(t),s={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(rM(t))sM(e,s);else{var n=t.alternate;if(t.lanes===0&&(n===null||n.lanes===0)&&(n=e.lastRenderedReducer,n!==null))try{var c=e.lastRenderedState,l=n(c,i);if(s.hasEagerState=!0,s.eagerState=l,No(l,c)){var f=e.interleaved;f===null?(s.next=s,f2(e)):(s.next=f.next,f.next=s),e.interleaved=s;return}}catch{}finally{}i=N5(t,e,s,r),i!==null&&(s=$s(),Oo(i,t,r,s),nM(i,e,r))}}function rM(t){var e=t.alternate;return t===ar||e!==null&&e===ar}function sM(t,e){Df=I0=!0;var i=t.pending;i===null?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function nM(t,e,i){if(i&4194240){var r=e.lanes;r&=t.pendingLanes,i|=r,e.lanes=i,e2(t,i)}}var R0={readContext:ho,useCallback:Ts,useContext:Ts,useEffect:Ts,useImperativeHandle:Ts,useInsertionEffect:Ts,useLayoutEffect:Ts,useMemo:Ts,useReducer:Ts,useRef:Ts,useState:Ts,useDebugValue:Ts,useDeferredValue:Ts,useTransition:Ts,useMutableSource:Ts,useSyncExternalStore:Ts,useId:Ts,unstable_isNewReconciler:!1},x8={readContext:ho,useCallback:function(t,e){return oa().memoizedState=[t,e===void 0?null:e],t},useContext:ho,useEffect:fT,useImperativeHandle:function(t,e,i){return i=i!=null?i.concat([t]):null,W_(4194308,4,Z5.bind(null,e,t),i)},useLayoutEffect:function(t,e){return W_(4194308,4,t,e)},useInsertionEffect:function(t,e){return W_(4,2,t,e)},useMemo:function(t,e){var i=oa();return e=e===void 0?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var r=oa();return e=i!==void 0?i(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=b8.bind(null,ar,t),[r.memoizedState,t]},useRef:function(t){var e=oa();return t={current:t},e.memoizedState=t},useState:pT,useDebugValue:E2,useDeferredValue:function(t){return oa().memoizedState=t},useTransition:function(){var t=pT(!1),e=t[0];return t=v8.bind(null,t[1]),oa().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var r=ar,s=oa();if(ir){if(i===void 0)throw Error(tt(407));i=i()}else{if(i=e(),Qr===null)throw Error(tt(349));vu&30||V5(r,e,i)}s.memoizedState=i;var n={value:i,getSnapshot:e};return s.queue=n,fT(H5.bind(null,r,n,t),[t]),r.flags|=2048,um(9,$5.bind(null,r,n,i,e),void 0,null),i},useId:function(){var t=oa(),e=Qr.identifierPrefix;if(ir){var i=Ga,r=ja;i=(r&~(1<<32-Lo(r)-1)).toString(32)+i,e=":"+e+"R"+i,i=lm++,0<i&&(e+="H"+i.toString(32)),e+=":"}else i=y8++,e=":"+e+"r"+i.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},E8={readContext:ho,useCallback:Q5,useContext:ho,useEffect:x2,useImperativeHandle:Y5,useInsertionEffect:K5,useLayoutEffect:J5,useMemo:eM,useReducer:Av,useRef:X5,useState:function(){return Av(cm)},useDebugValue:E2,useDeferredValue:function(t){var e=po();return tM(e,kr.memoizedState,t)},useTransition:function(){var t=Av(cm)[0],e=po().memoizedState;return[t,e]},useMutableSource:j5,useSyncExternalStore:G5,useId:iM,unstable_isNewReconciler:!1},A8={readContext:ho,useCallback:Q5,useContext:ho,useEffect:x2,useImperativeHandle:Y5,useInsertionEffect:K5,useLayoutEffect:J5,useMemo:eM,useReducer:Tv,useRef:X5,useState:function(){return Tv(cm)},useDebugValue:E2,useDeferredValue:function(t){var e=po();return kr===null?e.memoizedState=t:tM(e,kr.memoizedState,t)},useTransition:function(){var t=Tv(cm)[0],e=po().memoizedState;return[t,e]},useMutableSource:j5,useSyncExternalStore:G5,useId:iM,unstable_isNewReconciler:!1};function Eo(t,e){if(t&&t.defaultProps){e=lr({},e),t=t.defaultProps;for(var i in t)e[i]===void 0&&(e[i]=t[i]);return e}return e}function bw(t,e,i,r){e=t.memoizedState,i=i(r,e),i=i==null?e:lr({},e,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var d1={isMounted:function(t){return(t=t._reactInternals)?Cu(t)===t:!1},enqueueSetState:function(t,e,i){t=t._reactInternals;var r=$s(),s=oc(t),n=Wa(r,s);n.payload=e,i!=null&&(n.callback=i),e=sc(t,n,s),e!==null&&(Oo(e,t,s,r),H_(e,t,s))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var r=$s(),s=oc(t),n=Wa(r,s);n.tag=1,n.payload=e,i!=null&&(n.callback=i),e=sc(t,n,s),e!==null&&(Oo(e,t,s,r),H_(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=$s(),r=oc(t),s=Wa(i,r);s.tag=2,e!=null&&(s.callback=e),e=sc(t,s,r),e!==null&&(Oo(e,t,r,i),H_(e,t,r))}};function mT(t,e,i,r,s,n,c){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,n,c):e.prototype&&e.prototype.isPureReactComponent?!im(i,r)||!im(s,n):!0}function oM(t,e,i){var r=!1,s=hc,n=e.contextType;return typeof n=="object"&&n!==null?n=ho(n):(s=fn(e)?_u:ks.current,r=e.contextTypes,n=(r=r!=null)?xd(t,s):hc),e=new e(i,n),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=d1,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=n),e}function gT(t,e,i,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(i,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(i,r),e.state!==t&&d1.enqueueReplaceState(e,e.state,null)}function ww(t,e,i,r){var s=t.stateNode;s.props=i,s.state=t.memoizedState,s.refs={},m2(t);var n=e.contextType;typeof n=="object"&&n!==null?s.context=ho(n):(n=fn(e)?_u:ks.current,s.context=xd(t,n)),s.state=t.memoizedState,n=e.getDerivedStateFromProps,typeof n=="function"&&(bw(t,e,n,i),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&d1.enqueueReplaceState(s,s.state,null),S0(t,i,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Sd(t,e){try{var i="",r=e;do i+=YO(r),r=r.return;while(r);var s=i}catch(n){s=`
Error generating stack: `+n.message+`
`+n.stack}return{value:t,source:e,stack:s,digest:null}}function Sv(t,e,i){return{value:t,source:null,stack:i??null,digest:e??null}}function xw(t,e){try{console.error(e.value)}catch(i){setTimeout(function(){throw i})}}var T8=typeof WeakMap=="function"?WeakMap:Map;function aM(t,e,i){i=Wa(-1,i),i.tag=3,i.payload={element:null};var r=e.value;return i.callback=function(){P0||(P0=!0,kw=r),xw(t,e)},i}function lM(t,e,i){i=Wa(-1,i),i.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;i.payload=function(){return r(s)},i.callback=function(){xw(t,e)}}var n=t.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(i.callback=function(){xw(t,e),typeof r!="function"&&(nc===null?nc=new Set([this]):nc.add(this));var c=e.stack;this.componentDidCatch(e.value,{componentStack:c!==null?c:""})}),i}function _T(t,e,i){var r=t.pingCache;if(r===null){r=t.pingCache=new T8;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(i)||(s.add(i),t=U8.bind(null,t,e,i),e.then(t,t))}function yT(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function vT(t,e,i,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(e=Wa(-1,1),e.tag=2,sc(i,e,1))),i.lanes|=1),t)}var S8=el.ReactCurrentOwner,hn=!1;function Vs(t,e,i,r){e.child=t===null?F5(e,null,i,r):Ad(e,t.child,i,r)}function bT(t,e,i,r,s){i=i.render;var n=e.ref;return dd(e,s),r=b2(t,e,i,r,n,s),i=w2(),t!==null&&!hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Za(t,e,s)):(ir&&i&&l2(e),e.flags|=1,Vs(t,e,r,s),e.child)}function wT(t,e,i,r,s){if(t===null){var n=i.type;return typeof n=="function"&&!P2(n)&&n.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(e.tag=15,e.type=n,cM(t,e,n,r,s)):(t=Z_(i.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(n=t.child,!(t.lanes&s)){var c=n.memoizedProps;if(i=i.compare,i=i!==null?i:im,i(c,r)&&t.ref===e.ref)return Za(t,e,s)}return e.flags|=1,t=ac(n,r),t.ref=e.ref,t.return=e,e.child=t}function cM(t,e,i,r,s){if(t!==null){var n=t.memoizedProps;if(im(n,r)&&t.ref===e.ref)if(hn=!1,e.pendingProps=r=n,(t.lanes&s)!==0)t.flags&131072&&(hn=!0);else return e.lanes=t.lanes,Za(t,e,s)}return Ew(t,e,i,r,s)}function uM(t,e,i){var r=e.pendingProps,s=r.children,n=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gi(Qh,Bn),Bn|=i;else{if(!(i&1073741824))return t=n!==null?n.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Gi(Qh,Bn),Bn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=n!==null?n.baseLanes:i,Gi(Qh,Bn),Bn|=r}else n!==null?(r=n.baseLanes|i,e.memoizedState=null):r=i,Gi(Qh,Bn),Bn|=r;return Vs(t,e,s,i),e.child}function hM(t,e){var i=e.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function Ew(t,e,i,r,s){var n=fn(i)?_u:ks.current;return n=xd(e,n),dd(e,s),i=b2(t,e,i,r,n,s),r=w2(),t!==null&&!hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Za(t,e,s)):(ir&&r&&l2(e),e.flags|=1,Vs(t,e,i,s),e.child)}function xT(t,e,i,r,s){if(fn(i)){var n=!0;w0(e)}else n=!1;if(dd(e,s),e.stateNode===null)X_(t,e),oM(e,i,r),ww(e,i,r,s),r=!0;else if(t===null){var c=e.stateNode,l=e.memoizedProps;c.props=l;var f=c.context,y=i.contextType;typeof y=="object"&&y!==null?y=ho(y):(y=fn(i)?_u:ks.current,y=xd(e,y));var E=i.getDerivedStateFromProps,T=typeof E=="function"||typeof c.getSnapshotBeforeUpdate=="function";T||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(l!==r||f!==y)&&gT(e,c,r,y),Vl=!1;var R=e.memoizedState;c.state=R,S0(e,r,c,s),f=e.memoizedState,l!==r||R!==f||pn.current||Vl?(typeof E=="function"&&(bw(e,i,E,r),f=e.memoizedState),(l=Vl||mT(e,i,l,r,R,f,y))?(T||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount()),typeof c.componentDidMount=="function"&&(e.flags|=4194308)):(typeof c.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=f),c.props=r,c.state=f,c.context=y,r=l):(typeof c.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{c=e.stateNode,U5(t,e),l=e.memoizedProps,y=e.type===e.elementType?l:Eo(e.type,l),c.props=y,T=e.pendingProps,R=c.context,f=i.contextType,typeof f=="object"&&f!==null?f=ho(f):(f=fn(i)?_u:ks.current,f=xd(e,f));var D=i.getDerivedStateFromProps;(E=typeof D=="function"||typeof c.getSnapshotBeforeUpdate=="function")||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(l!==T||R!==f)&&gT(e,c,r,f),Vl=!1,R=e.memoizedState,c.state=R,S0(e,r,c,s);var V=e.memoizedState;l!==T||R!==V||pn.current||Vl?(typeof D=="function"&&(bw(e,i,D,r),V=e.memoizedState),(y=Vl||mT(e,i,y,r,R,V,f)||!1)?(E||typeof c.UNSAFE_componentWillUpdate!="function"&&typeof c.componentWillUpdate!="function"||(typeof c.componentWillUpdate=="function"&&c.componentWillUpdate(r,V,f),typeof c.UNSAFE_componentWillUpdate=="function"&&c.UNSAFE_componentWillUpdate(r,V,f)),typeof c.componentDidUpdate=="function"&&(e.flags|=4),typeof c.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof c.componentDidUpdate!="function"||l===t.memoizedProps&&R===t.memoizedState||(e.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&R===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=V),c.props=r,c.state=V,c.context=f,r=y):(typeof c.componentDidUpdate!="function"||l===t.memoizedProps&&R===t.memoizedState||(e.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&R===t.memoizedState||(e.flags|=1024),r=!1)}return Aw(t,e,i,r,n,s)}function Aw(t,e,i,r,s,n){hM(t,e);var c=(e.flags&128)!==0;if(!r&&!c)return s&&aT(e,i,!1),Za(t,e,n);r=e.stateNode,S8.current=e;var l=c&&typeof i.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&c?(e.child=Ad(e,t.child,null,n),e.child=Ad(e,null,l,n)):Vs(t,e,l,n),e.memoizedState=r.state,s&&aT(e,i,!0),e.child}function dM(t){var e=t.stateNode;e.pendingContext?oT(t,e.pendingContext,e.pendingContext!==e.context):e.context&&oT(t,e.context,!1),g2(t,e.containerInfo)}function ET(t,e,i,r,s){return Ed(),u2(s),e.flags|=256,Vs(t,e,i,r),e.child}var Tw={dehydrated:null,treeContext:null,retryLane:0};function Sw(t){return{baseLanes:t,cachePool:null,transitions:null}}function pM(t,e,i){var r=e.pendingProps,s=or.current,n=!1,c=(e.flags&128)!==0,l;if((l=c)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(n=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Gi(or,s&1),t===null)return yw(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(c=r.children,t=r.fallback,n?(r=e.mode,n=e.child,c={mode:"hidden",children:c},!(r&1)&&n!==null?(n.childLanes=0,n.pendingProps=c):n=m1(c,r,0,null),t=pu(t,r,i,null),n.return=e,t.return=e,n.sibling=t,e.child=n,e.child.memoizedState=Sw(i),e.memoizedState=Tw,t):A2(e,c));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return C8(t,e,c,r,l,s,i);if(n){n=r.fallback,c=e.mode,s=t.child,l=s.sibling;var f={mode:"hidden",children:r.children};return!(c&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=f,e.deletions=null):(r=ac(s,f),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?n=ac(l,n):(n=pu(n,c,i,null),n.flags|=2),n.return=e,r.return=e,r.sibling=n,e.child=r,r=n,n=e.child,c=t.child.memoizedState,c=c===null?Sw(i):{baseLanes:c.baseLanes|i,cachePool:null,transitions:c.transitions},n.memoizedState=c,n.childLanes=t.childLanes&~i,e.memoizedState=Tw,r}return n=t.child,t=n.sibling,r=ac(n,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=i),r.return=e,r.sibling=null,t!==null&&(i=e.deletions,i===null?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=r,e.memoizedState=null,r}function A2(t,e){return e=m1({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function i_(t,e,i,r){return r!==null&&u2(r),Ad(e,t.child,null,i),t=A2(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function C8(t,e,i,r,s,n,c){if(i)return e.flags&256?(e.flags&=-257,r=Sv(Error(tt(422))),i_(t,e,c,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(n=r.fallback,s=e.mode,r=m1({mode:"visible",children:r.children},s,0,null),n=pu(n,s,c,null),n.flags|=2,r.return=e,n.return=e,r.sibling=n,e.child=r,e.mode&1&&Ad(e,t.child,null,c),e.child.memoizedState=Sw(c),e.memoizedState=Tw,n);if(!(e.mode&1))return i_(t,e,c,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,n=Error(tt(419)),r=Sv(n,r,void 0),i_(t,e,c,r)}if(l=(c&t.childLanes)!==0,hn||l){if(r=Qr,r!==null){switch(c&-c){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|c)?0:s,s!==0&&s!==n.retryLane&&(n.retryLane=s,Ja(t,s),Oo(r,t,s,-1))}return M2(),r=Sv(Error(tt(421))),i_(t,e,c,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=z8.bind(null,t),s._reactRetry=e,null):(t=n.treeContext,On=rc(s.nextSibling),Fn=e,ir=!0,So=null,t!==null&&(to[io++]=ja,to[io++]=Ga,to[io++]=yu,ja=t.id,Ga=t.overflow,yu=e),e=A2(e,r.children),e.flags|=4096,e)}function AT(t,e,i){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),vw(t.return,e,i)}function Cv(t,e,i,r,s){var n=t.memoizedState;n===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:s}:(n.isBackwards=e,n.rendering=null,n.renderingStartTime=0,n.last=r,n.tail=i,n.tailMode=s)}function fM(t,e,i){var r=e.pendingProps,s=r.revealOrder,n=r.tail;if(Vs(t,e,r.children,i),r=or.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&AT(t,i,e);else if(t.tag===19)AT(t,i,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Gi(or,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(i=e.child,s=null;i!==null;)t=i.alternate,t!==null&&C0(t)===null&&(s=i),i=i.sibling;i=s,i===null?(s=e.child,e.child=null):(s=i.sibling,i.sibling=null),Cv(e,!1,s,i,n);break;case"backwards":for(i=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&C0(t)===null){e.child=s;break}t=s.sibling,s.sibling=i,i=s,s=t}Cv(e,!0,i,null,n);break;case"together":Cv(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function X_(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Za(t,e,i){if(t!==null&&(e.dependencies=t.dependencies),bu|=e.lanes,!(i&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(tt(153));if(e.child!==null){for(t=e.child,i=ac(t,t.pendingProps),e.child=i,i.return=e;t.sibling!==null;)t=t.sibling,i=i.sibling=ac(t,t.pendingProps),i.return=e;i.sibling=null}return e.child}function I8(t,e,i){switch(e.tag){case 3:dM(e),Ed();break;case 5:z5(e);break;case 1:fn(e.type)&&w0(e);break;case 4:g2(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Gi(A0,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Gi(or,or.current&1),e.flags|=128,null):i&e.child.childLanes?pM(t,e,i):(Gi(or,or.current&1),t=Za(t,e,i),t!==null?t.sibling:null);Gi(or,or.current&1);break;case 19:if(r=(i&e.childLanes)!==0,t.flags&128){if(r)return fM(t,e,i);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Gi(or,or.current),r)break;return null;case 22:case 23:return e.lanes=0,uM(t,e,i)}return Za(t,e,i)}var mM,Cw,gM,_M;mM=function(t,e){for(var i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};Cw=function(){};gM=function(t,e,i,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,au(fa.current);var n=null;switch(i){case"input":s=Kb(t,s),r=Kb(t,r),n=[];break;case"select":s=lr({},s,{value:void 0}),r=lr({},r,{value:void 0}),n=[];break;case"textarea":s=Yb(t,s),r=Yb(t,r),n=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=v0)}ew(i,r);var c;i=null;for(y in s)if(!r.hasOwnProperty(y)&&s.hasOwnProperty(y)&&s[y]!=null)if(y==="style"){var l=s[y];for(c in l)l.hasOwnProperty(c)&&(i||(i={}),i[c]="")}else y!=="dangerouslySetInnerHTML"&&y!=="children"&&y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(Kf.hasOwnProperty(y)?n||(n=[]):(n=n||[]).push(y,null));for(y in r){var f=r[y];if(l=s!=null?s[y]:void 0,r.hasOwnProperty(y)&&f!==l&&(f!=null||l!=null))if(y==="style")if(l){for(c in l)!l.hasOwnProperty(c)||f&&f.hasOwnProperty(c)||(i||(i={}),i[c]="");for(c in f)f.hasOwnProperty(c)&&l[c]!==f[c]&&(i||(i={}),i[c]=f[c])}else i||(n||(n=[]),n.push(y,i)),i=f;else y==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,l=l?l.__html:void 0,f!=null&&l!==f&&(n=n||[]).push(y,f)):y==="children"?typeof f!="string"&&typeof f!="number"||(n=n||[]).push(y,""+f):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&(Kf.hasOwnProperty(y)?(f!=null&&y==="onScroll"&&Ki("scroll",t),n||l===f||(n=[])):(n=n||[]).push(y,f))}i&&(n=n||[]).push("style",i);var y=n;(e.updateQueue=y)&&(e.flags|=4)}};_M=function(t,e,i,r){i!==r&&(e.flags|=4)};function rf(t,e){if(!ir)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ss(t){var e=t.alternate!==null&&t.alternate.child===t.child,i=0,r=0;if(e)for(var s=t.child;s!==null;)i|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)i|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=i,e}function R8(t,e,i){var r=e.pendingProps;switch(c2(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ss(e),null;case 1:return fn(e.type)&&b0(),Ss(e),null;case 3:return r=e.stateNode,Td(),Ji(pn),Ji(ks),y2(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(e_(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,So!==null&&(Ow(So),So=null))),Cw(t,e),Ss(e),null;case 5:_2(e);var s=au(am.current);if(i=e.type,t!==null&&e.stateNode!=null)gM(t,e,i,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(tt(166));return Ss(e),null}if(t=au(fa.current),e_(e)){r=e.stateNode,i=e.type;var n=e.memoizedProps;switch(r[la]=e,r[nm]=n,t=(e.mode&1)!==0,i){case"dialog":Ki("cancel",r),Ki("close",r);break;case"iframe":case"object":case"embed":Ki("load",r);break;case"video":case"audio":for(s=0;s<wf.length;s++)Ki(wf[s],r);break;case"source":Ki("error",r);break;case"img":case"image":case"link":Ki("error",r),Ki("load",r);break;case"details":Ki("toggle",r);break;case"input":B3(r,n),Ki("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!n.multiple},Ki("invalid",r);break;case"textarea":O3(r,n),Ki("invalid",r)}ew(i,n),s=null;for(var c in n)if(n.hasOwnProperty(c)){var l=n[c];c==="children"?typeof l=="string"?r.textContent!==l&&(n.suppressHydrationWarning!==!0&&Qg(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(n.suppressHydrationWarning!==!0&&Qg(r.textContent,l,t),s=["children",""+l]):Kf.hasOwnProperty(c)&&l!=null&&c==="onScroll"&&Ki("scroll",r)}switch(i){case"input":Hg(r),L3(r,n,!0);break;case"textarea":Hg(r),D3(r);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(r.onclick=v0)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{c=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=HR(i)),t==="http://www.w3.org/1999/xhtml"?i==="script"?(t=c.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=c.createElement(i,{is:r.is}):(t=c.createElement(i),i==="select"&&(c=t,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):t=c.createElementNS(t,i),t[la]=e,t[nm]=r,mM(t,e,!1,!1),e.stateNode=t;e:{switch(c=tw(i,r),i){case"dialog":Ki("cancel",t),Ki("close",t),s=r;break;case"iframe":case"object":case"embed":Ki("load",t),s=r;break;case"video":case"audio":for(s=0;s<wf.length;s++)Ki(wf[s],t);s=r;break;case"source":Ki("error",t),s=r;break;case"img":case"image":case"link":Ki("error",t),Ki("load",t),s=r;break;case"details":Ki("toggle",t),s=r;break;case"input":B3(t,r),s=Kb(t,r),Ki("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=lr({},r,{value:void 0}),Ki("invalid",t);break;case"textarea":O3(t,r),s=Yb(t,r),Ki("invalid",t);break;default:s=r}ew(i,s),l=s;for(n in l)if(l.hasOwnProperty(n)){var f=l[n];n==="style"?XR(t,f):n==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,f!=null&&qR(t,f)):n==="children"?typeof f=="string"?(i!=="textarea"||f!=="")&&Jf(t,f):typeof f=="number"&&Jf(t,""+f):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(Kf.hasOwnProperty(n)?f!=null&&n==="onScroll"&&Ki("scroll",t):f!=null&&Xx(t,n,f,c))}switch(i){case"input":Hg(t),L3(t,r,!1);break;case"textarea":Hg(t),D3(t);break;case"option":r.value!=null&&t.setAttribute("value",""+uc(r.value));break;case"select":t.multiple=!!r.multiple,n=r.value,n!=null?ld(t,!!r.multiple,n,!1):r.defaultValue!=null&&ld(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=v0)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ss(e),null;case 6:if(t&&e.stateNode!=null)_M(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(tt(166));if(i=au(am.current),au(fa.current),e_(e)){if(r=e.stateNode,i=e.memoizedProps,r[la]=e,(n=r.nodeValue!==i)&&(t=Fn,t!==null))switch(t.tag){case 3:Qg(r.nodeValue,i,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Qg(r.nodeValue,i,(t.mode&1)!==0)}n&&(e.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[la]=e,e.stateNode=r}return Ss(e),null;case 13:if(Ji(or),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ir&&On!==null&&e.mode&1&&!(e.flags&128))O5(),Ed(),e.flags|=98560,n=!1;else if(n=e_(e),r!==null&&r.dehydrated!==null){if(t===null){if(!n)throw Error(tt(318));if(n=e.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(tt(317));n[la]=e}else Ed(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ss(e),n=!1}else So!==null&&(Ow(So),So=null),n=!0;if(!n)return e.flags&65536?e:null}return e.flags&128?(e.lanes=i,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||or.current&1?Lr===0&&(Lr=3):M2())),e.updateQueue!==null&&(e.flags|=4),Ss(e),null);case 4:return Td(),Cw(t,e),t===null&&rm(e.stateNode.containerInfo),Ss(e),null;case 10:return p2(e.type._context),Ss(e),null;case 17:return fn(e.type)&&b0(),Ss(e),null;case 19:if(Ji(or),n=e.memoizedState,n===null)return Ss(e),null;if(r=(e.flags&128)!==0,c=n.rendering,c===null)if(r)rf(n,!1);else{if(Lr!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(c=C0(t),c!==null){for(e.flags|=128,rf(n,!1),r=c.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=i,i=e.child;i!==null;)n=i,t=r,n.flags&=14680066,c=n.alternate,c===null?(n.childLanes=0,n.lanes=t,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=c.childLanes,n.lanes=c.lanes,n.child=c.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=c.memoizedProps,n.memoizedState=c.memoizedState,n.updateQueue=c.updateQueue,n.type=c.type,t=c.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return Gi(or,or.current&1|2),e.child}t=t.sibling}n.tail!==null&&_r()>Cd&&(e.flags|=128,r=!0,rf(n,!1),e.lanes=4194304)}else{if(!r)if(t=C0(c),t!==null){if(e.flags|=128,r=!0,i=t.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),rf(n,!0),n.tail===null&&n.tailMode==="hidden"&&!c.alternate&&!ir)return Ss(e),null}else 2*_r()-n.renderingStartTime>Cd&&i!==1073741824&&(e.flags|=128,r=!0,rf(n,!1),e.lanes=4194304);n.isBackwards?(c.sibling=e.child,e.child=c):(i=n.last,i!==null?i.sibling=c:e.child=c,n.last=c)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=_r(),e.sibling=null,i=or.current,Gi(or,r?i&1|2:i&1),e):(Ss(e),null);case 22:case 23:return R2(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Bn&1073741824&&(Ss(e),e.subtreeFlags&6&&(e.flags|=8192)):Ss(e),null;case 24:return null;case 25:return null}throw Error(tt(156,e.tag))}function M8(t,e){switch(c2(e),e.tag){case 1:return fn(e.type)&&b0(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Td(),Ji(pn),Ji(ks),y2(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return _2(e),null;case 13:if(Ji(or),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(tt(340));Ed()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ji(or),null;case 4:return Td(),null;case 10:return p2(e.type._context),null;case 22:case 23:return R2(),null;case 24:return null;default:return null}}var r_=!1,Ps=!1,P8=typeof WeakSet=="function"?WeakSet:Set,At=null;function Yh(t,e){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){dr(t,e,r)}else i.current=null}function Iw(t,e,i){try{i()}catch(r){dr(t,e,r)}}var TT=!1;function k8(t,e){if(hw=g0,t=x5(),a2(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var s=r.anchorOffset,n=r.focusNode;r=r.focusOffset;try{i.nodeType,n.nodeType}catch{i=null;break e}var c=0,l=-1,f=-1,y=0,E=0,T=t,R=null;t:for(;;){for(var D;T!==i||s!==0&&T.nodeType!==3||(l=c+s),T!==n||r!==0&&T.nodeType!==3||(f=c+r),T.nodeType===3&&(c+=T.nodeValue.length),(D=T.firstChild)!==null;)R=T,T=D;for(;;){if(T===t)break t;if(R===i&&++y===s&&(l=c),R===n&&++E===r&&(f=c),(D=T.nextSibling)!==null)break;T=R,R=T.parentNode}T=D}i=l===-1||f===-1?null:{start:l,end:f}}else i=null}i=i||{start:0,end:0}}else i=null;for(dw={focusedElem:t,selectionRange:i},g0=!1,At=e;At!==null;)if(e=At,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,At=t;else for(;At!==null;){e=At;try{var V=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(V!==null){var H=V.memoizedProps,ee=V.memoizedState,z=e.stateNode,W=z.getSnapshotBeforeUpdate(e.elementType===e.type?H:Eo(e.type,H),ee);z.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var q=e.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(tt(163))}}catch(ce){dr(e,e.return,ce)}if(t=e.sibling,t!==null){t.return=e.return,At=t;break}At=e.return}return V=TT,TT=!1,V}function Ff(t,e,i){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var n=s.destroy;s.destroy=void 0,n!==void 0&&Iw(e,i,n)}s=s.next}while(s!==r)}}function p1(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var i=e=e.next;do{if((i.tag&t)===t){var r=i.create;i.destroy=r()}i=i.next}while(i!==e)}}function Rw(t){var e=t.ref;if(e!==null){var i=t.stateNode;switch(t.tag){case 5:t=i;break;default:t=i}typeof e=="function"?e(t):e.current=t}}function yM(t){var e=t.alternate;e!==null&&(t.alternate=null,yM(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[la],delete e[nm],delete e[mw],delete e[f8],delete e[m8])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function vM(t){return t.tag===5||t.tag===3||t.tag===4}function ST(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||vM(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Mw(t,e,i){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?i.nodeType===8?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(i.nodeType===8?(e=i.parentNode,e.insertBefore(t,i)):(e=i,e.appendChild(t)),i=i._reactRootContainer,i!=null||e.onclick!==null||(e.onclick=v0));else if(r!==4&&(t=t.child,t!==null))for(Mw(t,e,i),t=t.sibling;t!==null;)Mw(t,e,i),t=t.sibling}function Pw(t,e,i){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Pw(t,e,i),t=t.sibling;t!==null;)Pw(t,e,i),t=t.sibling}var us=null,Ao=!1;function Bl(t,e,i){for(i=i.child;i!==null;)bM(t,e,i),i=i.sibling}function bM(t,e,i){if(pa&&typeof pa.onCommitFiberUnmount=="function")try{pa.onCommitFiberUnmount(n1,i)}catch{}switch(i.tag){case 5:Ps||Yh(i,e);case 6:var r=us,s=Ao;us=null,Bl(t,e,i),us=r,Ao=s,us!==null&&(Ao?(t=us,i=i.stateNode,t.nodeType===8?t.parentNode.removeChild(i):t.removeChild(i)):us.removeChild(i.stateNode));break;case 18:us!==null&&(Ao?(t=us,i=i.stateNode,t.nodeType===8?bv(t.parentNode,i):t.nodeType===1&&bv(t,i),em(t)):bv(us,i.stateNode));break;case 4:r=us,s=Ao,us=i.stateNode.containerInfo,Ao=!0,Bl(t,e,i),us=r,Ao=s;break;case 0:case 11:case 14:case 15:if(!Ps&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var n=s,c=n.destroy;n=n.tag,c!==void 0&&(n&2||n&4)&&Iw(i,e,c),s=s.next}while(s!==r)}Bl(t,e,i);break;case 1:if(!Ps&&(Yh(i,e),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(l){dr(i,e,l)}Bl(t,e,i);break;case 21:Bl(t,e,i);break;case 22:i.mode&1?(Ps=(r=Ps)||i.memoizedState!==null,Bl(t,e,i),Ps=r):Bl(t,e,i);break;default:Bl(t,e,i)}}function CT(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new P8),e.forEach(function(r){var s=j8.bind(null,t,r);i.has(r)||(i.add(r),r.then(s,s))})}}function bo(t,e){var i=e.deletions;if(i!==null)for(var r=0;r<i.length;r++){var s=i[r];try{var n=t,c=e,l=c;e:for(;l!==null;){switch(l.tag){case 5:us=l.stateNode,Ao=!1;break e;case 3:us=l.stateNode.containerInfo,Ao=!0;break e;case 4:us=l.stateNode.containerInfo,Ao=!0;break e}l=l.return}if(us===null)throw Error(tt(160));bM(n,c,s),us=null,Ao=!1;var f=s.alternate;f!==null&&(f.return=null),s.return=null}catch(y){dr(s,e,y)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)wM(e,t),e=e.sibling}function wM(t,e){var i=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(bo(e,t),Qo(t),r&4){try{Ff(3,t,t.return),p1(3,t)}catch(H){dr(t,t.return,H)}try{Ff(5,t,t.return)}catch(H){dr(t,t.return,H)}}break;case 1:bo(e,t),Qo(t),r&512&&i!==null&&Yh(i,i.return);break;case 5:if(bo(e,t),Qo(t),r&512&&i!==null&&Yh(i,i.return),t.flags&32){var s=t.stateNode;try{Jf(s,"")}catch(H){dr(t,t.return,H)}}if(r&4&&(s=t.stateNode,s!=null)){var n=t.memoizedProps,c=i!==null?i.memoizedProps:n,l=t.type,f=t.updateQueue;if(t.updateQueue=null,f!==null)try{l==="input"&&n.type==="radio"&&n.name!=null&&VR(s,n),tw(l,c);var y=tw(l,n);for(c=0;c<f.length;c+=2){var E=f[c],T=f[c+1];E==="style"?XR(s,T):E==="dangerouslySetInnerHTML"?qR(s,T):E==="children"?Jf(s,T):Xx(s,E,T,y)}switch(l){case"input":Jb(s,n);break;case"textarea":$R(s,n);break;case"select":var R=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!n.multiple;var D=n.value;D!=null?ld(s,!!n.multiple,D,!1):R!==!!n.multiple&&(n.defaultValue!=null?ld(s,!!n.multiple,n.defaultValue,!0):ld(s,!!n.multiple,n.multiple?[]:"",!1))}s[nm]=n}catch(H){dr(t,t.return,H)}}break;case 6:if(bo(e,t),Qo(t),r&4){if(t.stateNode===null)throw Error(tt(162));s=t.stateNode,n=t.memoizedProps;try{s.nodeValue=n}catch(H){dr(t,t.return,H)}}break;case 3:if(bo(e,t),Qo(t),r&4&&i!==null&&i.memoizedState.isDehydrated)try{em(e.containerInfo)}catch(H){dr(t,t.return,H)}break;case 4:bo(e,t),Qo(t);break;case 13:bo(e,t),Qo(t),s=t.child,s.flags&8192&&(n=s.memoizedState!==null,s.stateNode.isHidden=n,!n||s.alternate!==null&&s.alternate.memoizedState!==null||(C2=_r())),r&4&&CT(t);break;case 22:if(E=i!==null&&i.memoizedState!==null,t.mode&1?(Ps=(y=Ps)||E,bo(e,t),Ps=y):bo(e,t),Qo(t),r&8192){if(y=t.memoizedState!==null,(t.stateNode.isHidden=y)&&!E&&t.mode&1)for(At=t,E=t.child;E!==null;){for(T=At=E;At!==null;){switch(R=At,D=R.child,R.tag){case 0:case 11:case 14:case 15:Ff(4,R,R.return);break;case 1:Yh(R,R.return);var V=R.stateNode;if(typeof V.componentWillUnmount=="function"){r=R,i=R.return;try{e=r,V.props=e.memoizedProps,V.state=e.memoizedState,V.componentWillUnmount()}catch(H){dr(r,i,H)}}break;case 5:Yh(R,R.return);break;case 22:if(R.memoizedState!==null){RT(T);continue}}D!==null?(D.return=R,At=D):RT(T)}E=E.sibling}e:for(E=null,T=t;;){if(T.tag===5){if(E===null){E=T;try{s=T.stateNode,y?(n=s.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"):(l=T.stateNode,f=T.memoizedProps.style,c=f!=null&&f.hasOwnProperty("display")?f.display:null,l.style.display=WR("display",c))}catch(H){dr(t,t.return,H)}}}else if(T.tag===6){if(E===null)try{T.stateNode.nodeValue=y?"":T.memoizedProps}catch(H){dr(t,t.return,H)}}else if((T.tag!==22&&T.tag!==23||T.memoizedState===null||T===t)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===t)break e;for(;T.sibling===null;){if(T.return===null||T.return===t)break e;E===T&&(E=null),T=T.return}E===T&&(E=null),T.sibling.return=T.return,T=T.sibling}}break;case 19:bo(e,t),Qo(t),r&4&&CT(t);break;case 21:break;default:bo(e,t),Qo(t)}}function Qo(t){var e=t.flags;if(e&2){try{e:{for(var i=t.return;i!==null;){if(vM(i)){var r=i;break e}i=i.return}throw Error(tt(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Jf(s,""),r.flags&=-33);var n=ST(t);Pw(t,n,s);break;case 3:case 4:var c=r.stateNode.containerInfo,l=ST(t);Mw(t,l,c);break;default:throw Error(tt(161))}}catch(f){dr(t,t.return,f)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function B8(t,e,i){At=t,xM(t)}function xM(t,e,i){for(var r=(t.mode&1)!==0;At!==null;){var s=At,n=s.child;if(s.tag===22&&r){var c=s.memoizedState!==null||r_;if(!c){var l=s.alternate,f=l!==null&&l.memoizedState!==null||Ps;l=r_;var y=Ps;if(r_=c,(Ps=f)&&!y)for(At=s;At!==null;)c=At,f=c.child,c.tag===22&&c.memoizedState!==null?MT(s):f!==null?(f.return=c,At=f):MT(s);for(;n!==null;)At=n,xM(n),n=n.sibling;At=s,r_=l,Ps=y}IT(t)}else s.subtreeFlags&8772&&n!==null?(n.return=s,At=n):IT(t)}}function IT(t){for(;At!==null;){var e=At;if(e.flags&8772){var i=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ps||p1(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ps)if(i===null)r.componentDidMount();else{var s=e.elementType===e.type?i.memoizedProps:Eo(e.type,i.memoizedProps);r.componentDidUpdate(s,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var n=e.updateQueue;n!==null&&dT(e,n,r);break;case 3:var c=e.updateQueue;if(c!==null){if(i=null,e.child!==null)switch(e.child.tag){case 5:i=e.child.stateNode;break;case 1:i=e.child.stateNode}dT(e,c,i)}break;case 5:var l=e.stateNode;if(i===null&&e.flags&4){i=l;var f=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":f.autoFocus&&i.focus();break;case"img":f.src&&(i.src=f.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var y=e.alternate;if(y!==null){var E=y.memoizedState;if(E!==null){var T=E.dehydrated;T!==null&&em(T)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(tt(163))}Ps||e.flags&512&&Rw(e)}catch(R){dr(e,e.return,R)}}if(e===t){At=null;break}if(i=e.sibling,i!==null){i.return=e.return,At=i;break}At=e.return}}function RT(t){for(;At!==null;){var e=At;if(e===t){At=null;break}var i=e.sibling;if(i!==null){i.return=e.return,At=i;break}At=e.return}}function MT(t){for(;At!==null;){var e=At;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{p1(4,e)}catch(f){dr(e,i,f)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(f){dr(e,s,f)}}var n=e.return;try{Rw(e)}catch(f){dr(e,n,f)}break;case 5:var c=e.return;try{Rw(e)}catch(f){dr(e,c,f)}}}catch(f){dr(e,e.return,f)}if(e===t){At=null;break}var l=e.sibling;if(l!==null){l.return=e.return,At=l;break}At=e.return}}var L8=Math.ceil,M0=el.ReactCurrentDispatcher,T2=el.ReactCurrentOwner,ao=el.ReactCurrentBatchConfig,pi=0,Qr=null,Cr=null,hs=0,Bn=0,Qh=gc(0),Lr=0,hm=null,bu=0,f1=0,S2=0,Nf=null,cn=null,C2=0,Cd=1/0,Oa=null,P0=!1,kw=null,nc=null,s_=!1,Kl=null,k0=0,Uf=0,Bw=null,K_=-1,J_=0;function $s(){return pi&6?_r():K_!==-1?K_:K_=_r()}function oc(t){return t.mode&1?pi&2&&hs!==0?hs&-hs:_8.transition!==null?(J_===0&&(J_=o5()),J_):(t=Ci,t!==0||(t=window.event,t=t===void 0?16:p5(t.type)),t):1}function Oo(t,e,i,r){if(50<Uf)throw Uf=0,Bw=null,Error(tt(185));Tm(t,i,r),(!(pi&2)||t!==Qr)&&(t===Qr&&(!(pi&2)&&(f1|=i),Lr===4&&ql(t,hs)),mn(t,r),i===1&&pi===0&&!(e.mode&1)&&(Cd=_r()+500,u1&&_c()))}function mn(t,e){var i=t.callbackNode;_D(t,e);var r=m0(t,t===Qr?hs:0);if(r===0)i!==null&&U3(i),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(i!=null&&U3(i),e===1)t.tag===0?g8(PT.bind(null,t)):k5(PT.bind(null,t)),d8(function(){!(pi&6)&&_c()}),i=null;else{switch(a5(r)){case 1:i=Qx;break;case 4:i=s5;break;case 16:i=f0;break;case 536870912:i=n5;break;default:i=f0}i=MM(i,EM.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function EM(t,e){if(K_=-1,J_=0,pi&6)throw Error(tt(327));var i=t.callbackNode;if(pd()&&t.callbackNode!==i)return null;var r=m0(t,t===Qr?hs:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=B0(t,r);else{e=r;var s=pi;pi|=2;var n=TM();(Qr!==t||hs!==e)&&(Oa=null,Cd=_r()+500,du(t,e));do try{F8();break}catch(l){AM(t,l)}while(1);d2(),M0.current=n,pi=s,Cr!==null?e=0:(Qr=null,hs=0,e=Lr)}if(e!==0){if(e===2&&(s=ow(t),s!==0&&(r=s,e=Lw(t,s))),e===1)throw i=hm,du(t,0),ql(t,r),mn(t,_r()),i;if(e===6)ql(t,r);else{if(s=t.current.alternate,!(r&30)&&!O8(s)&&(e=B0(t,r),e===2&&(n=ow(t),n!==0&&(r=n,e=Lw(t,n))),e===1))throw i=hm,du(t,0),ql(t,r),mn(t,_r()),i;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(tt(345));case 2:Qc(t,cn,Oa);break;case 3:if(ql(t,r),(r&130023424)===r&&(e=C2+500-_r(),10<e)){if(m0(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){$s(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=fw(Qc.bind(null,t,cn,Oa),e);break}Qc(t,cn,Oa);break;case 4:if(ql(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var c=31-Lo(r);n=1<<c,c=e[c],c>s&&(s=c),r&=~n}if(r=s,r=_r()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*L8(r/1960))-r,10<r){t.timeoutHandle=fw(Qc.bind(null,t,cn,Oa),r);break}Qc(t,cn,Oa);break;case 5:Qc(t,cn,Oa);break;default:throw Error(tt(329))}}}return mn(t,_r()),t.callbackNode===i?EM.bind(null,t):null}function Lw(t,e){var i=Nf;return t.current.memoizedState.isDehydrated&&(du(t,e).flags|=256),t=B0(t,e),t!==2&&(e=cn,cn=i,e!==null&&Ow(e)),t}function Ow(t){cn===null?cn=t:cn.push.apply(cn,t)}function O8(t){for(var e=t;;){if(e.flags&16384){var i=e.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var s=i[r],n=s.getSnapshot;s=s.value;try{if(!No(n(),s))return!1}catch{return!1}}}if(i=e.child,e.subtreeFlags&16384&&i!==null)i.return=e,e=i;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ql(t,e){for(e&=~S2,e&=~f1,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-Lo(e),r=1<<i;t[i]=-1,e&=~r}}function PT(t){if(pi&6)throw Error(tt(327));pd();var e=m0(t,0);if(!(e&1))return mn(t,_r()),null;var i=B0(t,e);if(t.tag!==0&&i===2){var r=ow(t);r!==0&&(e=r,i=Lw(t,r))}if(i===1)throw i=hm,du(t,0),ql(t,e),mn(t,_r()),i;if(i===6)throw Error(tt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Qc(t,cn,Oa),mn(t,_r()),null}function I2(t,e){var i=pi;pi|=1;try{return t(e)}finally{pi=i,pi===0&&(Cd=_r()+500,u1&&_c())}}function wu(t){Kl!==null&&Kl.tag===0&&!(pi&6)&&pd();var e=pi;pi|=1;var i=ao.transition,r=Ci;try{if(ao.transition=null,Ci=1,t)return t()}finally{Ci=r,ao.transition=i,pi=e,!(pi&6)&&_c()}}function R2(){Bn=Qh.current,Ji(Qh)}function du(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,h8(i)),Cr!==null)for(i=Cr.return;i!==null;){var r=i;switch(c2(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&b0();break;case 3:Td(),Ji(pn),Ji(ks),y2();break;case 5:_2(r);break;case 4:Td();break;case 13:Ji(or);break;case 19:Ji(or);break;case 10:p2(r.type._context);break;case 22:case 23:R2()}i=i.return}if(Qr=t,Cr=t=ac(t.current,null),hs=Bn=e,Lr=0,hm=null,S2=f1=bu=0,cn=Nf=null,ou!==null){for(e=0;e<ou.length;e++)if(i=ou[e],r=i.interleaved,r!==null){i.interleaved=null;var s=r.next,n=i.pending;if(n!==null){var c=n.next;n.next=s,r.next=c}i.pending=r}ou=null}return t}function AM(t,e){do{var i=Cr;try{if(d2(),q_.current=R0,I0){for(var r=ar.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}I0=!1}if(vu=0,Yr=kr=ar=null,Df=!1,lm=0,T2.current=null,i===null||i.return===null){Lr=1,hm=e,Cr=null;break}e:{var n=t,c=i.return,l=i,f=e;if(e=hs,l.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){var y=f,E=l,T=E.tag;if(!(E.mode&1)&&(T===0||T===11||T===15)){var R=E.alternate;R?(E.updateQueue=R.updateQueue,E.memoizedState=R.memoizedState,E.lanes=R.lanes):(E.updateQueue=null,E.memoizedState=null)}var D=yT(c);if(D!==null){D.flags&=-257,vT(D,c,l,n,e),D.mode&1&&_T(n,y,e),e=D,f=y;var V=e.updateQueue;if(V===null){var H=new Set;H.add(f),e.updateQueue=H}else V.add(f);break e}else{if(!(e&1)){_T(n,y,e),M2();break e}f=Error(tt(426))}}else if(ir&&l.mode&1){var ee=yT(c);if(ee!==null){!(ee.flags&65536)&&(ee.flags|=256),vT(ee,c,l,n,e),u2(Sd(f,l));break e}}n=f=Sd(f,l),Lr!==4&&(Lr=2),Nf===null?Nf=[n]:Nf.push(n),n=c;do{switch(n.tag){case 3:n.flags|=65536,e&=-e,n.lanes|=e;var z=aM(n,f,e);hT(n,z);break e;case 1:l=f;var W=n.type,q=n.stateNode;if(!(n.flags&128)&&(typeof W.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(nc===null||!nc.has(q)))){n.flags|=65536,e&=-e,n.lanes|=e;var ce=lM(n,l,e);hT(n,ce);break e}}n=n.return}while(n!==null)}CM(i)}catch(we){e=we,Cr===i&&i!==null&&(Cr=i=i.return);continue}break}while(1)}function TM(){var t=M0.current;return M0.current=R0,t===null?R0:t}function M2(){(Lr===0||Lr===3||Lr===2)&&(Lr=4),Qr===null||!(bu&268435455)&&!(f1&268435455)||ql(Qr,hs)}function B0(t,e){var i=pi;pi|=2;var r=TM();(Qr!==t||hs!==e)&&(Oa=null,du(t,e));do try{D8();break}catch(s){AM(t,s)}while(1);if(d2(),pi=i,M0.current=r,Cr!==null)throw Error(tt(261));return Qr=null,hs=0,Lr}function D8(){for(;Cr!==null;)SM(Cr)}function F8(){for(;Cr!==null&&!lD();)SM(Cr)}function SM(t){var e=RM(t.alternate,t,Bn);t.memoizedProps=t.pendingProps,e===null?CM(t):Cr=e,T2.current=null}function CM(t){var e=t;do{var i=e.alternate;if(t=e.return,e.flags&32768){if(i=M8(i,e),i!==null){i.flags&=32767,Cr=i;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Lr=6,Cr=null;return}}else if(i=R8(i,e,Bn),i!==null){Cr=i;return}if(e=e.sibling,e!==null){Cr=e;return}Cr=e=t}while(e!==null);Lr===0&&(Lr=5)}function Qc(t,e,i){var r=Ci,s=ao.transition;try{ao.transition=null,Ci=1,N8(t,e,i,r)}finally{ao.transition=s,Ci=r}return null}function N8(t,e,i,r){do pd();while(Kl!==null);if(pi&6)throw Error(tt(327));i=t.finishedWork;var s=t.finishedLanes;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(tt(177));t.callbackNode=null,t.callbackPriority=0;var n=i.lanes|i.childLanes;if(yD(t,n),t===Qr&&(Cr=Qr=null,hs=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||s_||(s_=!0,MM(f0,function(){return pd(),null})),n=(i.flags&15990)!==0,i.subtreeFlags&15990||n){n=ao.transition,ao.transition=null;var c=Ci;Ci=1;var l=pi;pi|=4,T2.current=null,k8(t,i),wM(i,t),s8(dw),g0=!!hw,dw=hw=null,t.current=i,B8(i),cD(),pi=l,Ci=c,ao.transition=n}else t.current=i;if(s_&&(s_=!1,Kl=t,k0=s),n=t.pendingLanes,n===0&&(nc=null),dD(i.stateNode),mn(t,_r()),e!==null)for(r=t.onRecoverableError,i=0;i<e.length;i++)s=e[i],r(s.value,{componentStack:s.stack,digest:s.digest});if(P0)throw P0=!1,t=kw,kw=null,t;return k0&1&&t.tag!==0&&pd(),n=t.pendingLanes,n&1?t===Bw?Uf++:(Uf=0,Bw=t):Uf=0,_c(),null}function pd(){if(Kl!==null){var t=a5(k0),e=ao.transition,i=Ci;try{if(ao.transition=null,Ci=16>t?16:t,Kl===null)var r=!1;else{if(t=Kl,Kl=null,k0=0,pi&6)throw Error(tt(331));var s=pi;for(pi|=4,At=t.current;At!==null;){var n=At,c=n.child;if(At.flags&16){var l=n.deletions;if(l!==null){for(var f=0;f<l.length;f++){var y=l[f];for(At=y;At!==null;){var E=At;switch(E.tag){case 0:case 11:case 15:Ff(8,E,n)}var T=E.child;if(T!==null)T.return=E,At=T;else for(;At!==null;){E=At;var R=E.sibling,D=E.return;if(yM(E),E===y){At=null;break}if(R!==null){R.return=D,At=R;break}At=D}}}var V=n.alternate;if(V!==null){var H=V.child;if(H!==null){V.child=null;do{var ee=H.sibling;H.sibling=null,H=ee}while(H!==null)}}At=n}}if(n.subtreeFlags&2064&&c!==null)c.return=n,At=c;else e:for(;At!==null;){if(n=At,n.flags&2048)switch(n.tag){case 0:case 11:case 15:Ff(9,n,n.return)}var z=n.sibling;if(z!==null){z.return=n.return,At=z;break e}At=n.return}}var W=t.current;for(At=W;At!==null;){c=At;var q=c.child;if(c.subtreeFlags&2064&&q!==null)q.return=c,At=q;else e:for(c=W;At!==null;){if(l=At,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:p1(9,l)}}catch(we){dr(l,l.return,we)}if(l===c){At=null;break e}var ce=l.sibling;if(ce!==null){ce.return=l.return,At=ce;break e}At=l.return}}if(pi=s,_c(),pa&&typeof pa.onPostCommitFiberRoot=="function")try{pa.onPostCommitFiberRoot(n1,t)}catch{}r=!0}return r}finally{Ci=i,ao.transition=e}}return!1}function kT(t,e,i){e=Sd(i,e),e=aM(t,e,1),t=sc(t,e,1),e=$s(),t!==null&&(Tm(t,1,e),mn(t,e))}function dr(t,e,i){if(t.tag===3)kT(t,t,i);else for(;e!==null;){if(e.tag===3){kT(e,t,i);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(nc===null||!nc.has(r))){t=Sd(i,t),t=lM(e,t,1),e=sc(e,t,1),t=$s(),e!==null&&(Tm(e,1,t),mn(e,t));break}}e=e.return}}function U8(t,e,i){var r=t.pingCache;r!==null&&r.delete(e),e=$s(),t.pingedLanes|=t.suspendedLanes&i,Qr===t&&(hs&i)===i&&(Lr===4||Lr===3&&(hs&130023424)===hs&&500>_r()-C2?du(t,0):S2|=i),mn(t,e)}function IM(t,e){e===0&&(t.mode&1?(e=Xg,Xg<<=1,!(Xg&130023424)&&(Xg=4194304)):e=1);var i=$s();t=Ja(t,e),t!==null&&(Tm(t,e,i),mn(t,i))}function z8(t){var e=t.memoizedState,i=0;e!==null&&(i=e.retryLane),IM(t,i)}function j8(t,e){var i=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(i=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(tt(314))}r!==null&&r.delete(e),IM(t,i)}var RM;RM=function(t,e,i){if(t!==null)if(t.memoizedProps!==e.pendingProps||pn.current)hn=!0;else{if(!(t.lanes&i)&&!(e.flags&128))return hn=!1,I8(t,e,i);hn=!!(t.flags&131072)}else hn=!1,ir&&e.flags&1048576&&B5(e,E0,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;X_(t,e),t=e.pendingProps;var s=xd(e,ks.current);dd(e,i),s=b2(null,e,r,t,s,i);var n=w2();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,fn(r)?(n=!0,w0(e)):n=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,m2(e),s.updater=d1,e.stateNode=s,s._reactInternals=e,ww(e,r,t,i),e=Aw(null,e,r,!0,n,i)):(e.tag=0,ir&&n&&l2(e),Vs(null,e,s,i),e=e.child),e;case 16:r=e.elementType;e:{switch(X_(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=V8(r),t=Eo(r,t),s){case 0:e=Ew(null,e,r,t,i);break e;case 1:e=xT(null,e,r,t,i);break e;case 11:e=bT(null,e,r,t,i);break e;case 14:e=wT(null,e,r,Eo(r.type,t),i);break e}throw Error(tt(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Eo(r,s),Ew(t,e,r,s,i);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Eo(r,s),xT(t,e,r,s,i);case 3:e:{if(dM(e),t===null)throw Error(tt(387));r=e.pendingProps,n=e.memoizedState,s=n.element,U5(t,e),S0(e,r,null,i);var c=e.memoizedState;if(r=c.element,n.isDehydrated)if(n={element:r,isDehydrated:!1,cache:c.cache,pendingSuspenseBoundaries:c.pendingSuspenseBoundaries,transitions:c.transitions},e.updateQueue.baseState=n,e.memoizedState=n,e.flags&256){s=Sd(Error(tt(423)),e),e=ET(t,e,r,i,s);break e}else if(r!==s){s=Sd(Error(tt(424)),e),e=ET(t,e,r,i,s);break e}else for(On=rc(e.stateNode.containerInfo.firstChild),Fn=e,ir=!0,So=null,i=F5(e,null,r,i),e.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Ed(),r===s){e=Za(t,e,i);break e}Vs(t,e,r,i)}e=e.child}return e;case 5:return z5(e),t===null&&yw(e),r=e.type,s=e.pendingProps,n=t!==null?t.memoizedProps:null,c=s.children,pw(r,s)?c=null:n!==null&&pw(r,n)&&(e.flags|=32),hM(t,e),Vs(t,e,c,i),e.child;case 6:return t===null&&yw(e),null;case 13:return pM(t,e,i);case 4:return g2(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ad(e,null,r,i):Vs(t,e,r,i),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Eo(r,s),bT(t,e,r,s,i);case 7:return Vs(t,e,e.pendingProps,i),e.child;case 8:return Vs(t,e,e.pendingProps.children,i),e.child;case 12:return Vs(t,e,e.pendingProps.children,i),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,n=e.memoizedProps,c=s.value,Gi(A0,r._currentValue),r._currentValue=c,n!==null)if(No(n.value,c)){if(n.children===s.children&&!pn.current){e=Za(t,e,i);break e}}else for(n=e.child,n!==null&&(n.return=e);n!==null;){var l=n.dependencies;if(l!==null){c=n.child;for(var f=l.firstContext;f!==null;){if(f.context===r){if(n.tag===1){f=Wa(-1,i&-i),f.tag=2;var y=n.updateQueue;if(y!==null){y=y.shared;var E=y.pending;E===null?f.next=f:(f.next=E.next,E.next=f),y.pending=f}}n.lanes|=i,f=n.alternate,f!==null&&(f.lanes|=i),vw(n.return,i,e),l.lanes|=i;break}f=f.next}}else if(n.tag===10)c=n.type===e.type?null:n.child;else if(n.tag===18){if(c=n.return,c===null)throw Error(tt(341));c.lanes|=i,l=c.alternate,l!==null&&(l.lanes|=i),vw(c,i,e),c=n.sibling}else c=n.child;if(c!==null)c.return=n;else for(c=n;c!==null;){if(c===e){c=null;break}if(n=c.sibling,n!==null){n.return=c.return,c=n;break}c=c.return}n=c}Vs(t,e,s.children,i),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,dd(e,i),s=ho(s),r=r(s),e.flags|=1,Vs(t,e,r,i),e.child;case 14:return r=e.type,s=Eo(r,e.pendingProps),s=Eo(r.type,s),wT(t,e,r,s,i);case 15:return cM(t,e,e.type,e.pendingProps,i);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Eo(r,s),X_(t,e),e.tag=1,fn(r)?(t=!0,w0(e)):t=!1,dd(e,i),oM(e,r,s),ww(e,r,s,i),Aw(null,e,r,!0,t,i);case 19:return fM(t,e,i);case 22:return uM(t,e,i)}throw Error(tt(156,e.tag))};function MM(t,e){return r5(t,e)}function G8(t,e,i,r){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ro(t,e,i,r){return new G8(t,e,i,r)}function P2(t){return t=t.prototype,!(!t||!t.isReactComponent)}function V8(t){if(typeof t=="function")return P2(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Jx)return 11;if(t===Zx)return 14}return 2}function ac(t,e){var i=t.alternate;return i===null?(i=ro(t.tag,e,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&14680064,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function Z_(t,e,i,r,s,n){var c=2;if(r=t,typeof t=="function")P2(t)&&(c=1);else if(typeof t=="string")c=5;else e:switch(t){case Vh:return pu(i.children,s,n,e);case Kx:c=8,s|=8;break;case Hb:return t=ro(12,i,e,s|2),t.elementType=Hb,t.lanes=n,t;case qb:return t=ro(13,i,e,s),t.elementType=qb,t.lanes=n,t;case Wb:return t=ro(19,i,e,s),t.elementType=Wb,t.lanes=n,t;case zR:return m1(i,s,n,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case NR:c=10;break e;case UR:c=9;break e;case Jx:c=11;break e;case Zx:c=14;break e;case Gl:c=16,r=null;break e}throw Error(tt(130,t==null?t:typeof t,""))}return e=ro(c,i,e,s),e.elementType=t,e.type=r,e.lanes=n,e}function pu(t,e,i,r){return t=ro(7,t,r,e),t.lanes=i,t}function m1(t,e,i,r){return t=ro(22,t,r,e),t.elementType=zR,t.lanes=i,t.stateNode={isHidden:!1},t}function Iv(t,e,i){return t=ro(6,t,null,e),t.lanes=i,t}function Rv(t,e,i){return e=ro(4,t.children!==null?t.children:[],t.key,e),e.lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function $8(t,e,i,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cv(0),this.expirationTimes=cv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cv(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function k2(t,e,i,r,s,n,c,l,f){return t=new $8(t,e,i,l,f),e===1?(e=1,n===!0&&(e|=8)):e=0,n=ro(3,null,null,e),t.current=n,n.stateNode=t,n.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},m2(n),t}function H8(t,e,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gh,key:r==null?null:""+r,children:t,containerInfo:e,implementation:i}}function PM(t){if(!t)return hc;t=t._reactInternals;e:{if(Cu(t)!==t||t.tag!==1)throw Error(tt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(fn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(tt(171))}if(t.tag===1){var i=t.type;if(fn(i))return P5(t,i,e)}return e}function kM(t,e,i,r,s,n,c,l,f){return t=k2(i,r,!0,t,s,n,c,l,f),t.context=PM(null),i=t.current,r=$s(),s=oc(i),n=Wa(r,s),n.callback=e??null,sc(i,n,s),t.current.lanes=s,Tm(t,s,r),mn(t,r),t}function g1(t,e,i,r){var s=e.current,n=$s(),c=oc(s);return i=PM(i),e.context===null?e.context=i:e.pendingContext=i,e=Wa(n,c),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=sc(s,e,c),t!==null&&(Oo(t,s,c,n),H_(t,s,c)),c}function L0(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function BT(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<e?i:e}}function B2(t,e){BT(t,e),(t=t.alternate)&&BT(t,e)}function q8(){return null}var BM=typeof reportError=="function"?reportError:function(t){console.error(t)};function L2(t){this._internalRoot=t}_1.prototype.render=L2.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(tt(409));g1(t,e,null,null)};_1.prototype.unmount=L2.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;wu(function(){g1(null,t,null,null)}),e[Ka]=null}};function _1(t){this._internalRoot=t}_1.prototype.unstable_scheduleHydration=function(t){if(t){var e=u5();t={blockedOn:null,target:t,priority:e};for(var i=0;i<Hl.length&&e!==0&&e<Hl[i].priority;i++);Hl.splice(i,0,t),i===0&&d5(t)}};function O2(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function y1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function LT(){}function W8(t,e,i,r,s){if(s){if(typeof r=="function"){var n=r;r=function(){var y=L0(c);n.call(y)}}var c=kM(e,r,t,0,null,!1,!1,"",LT);return t._reactRootContainer=c,t[Ka]=c.current,rm(t.nodeType===8?t.parentNode:t),wu(),c}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var y=L0(f);l.call(y)}}var f=k2(t,0,!1,null,null,!1,!1,"",LT);return t._reactRootContainer=f,t[Ka]=f.current,rm(t.nodeType===8?t.parentNode:t),wu(function(){g1(e,f,i,r)}),f}function v1(t,e,i,r,s){var n=i._reactRootContainer;if(n){var c=n;if(typeof s=="function"){var l=s;s=function(){var f=L0(c);l.call(f)}}g1(e,c,t,s)}else c=W8(i,e,t,s,r);return L0(c)}l5=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=bf(e.pendingLanes);i!==0&&(e2(e,i|1),mn(e,_r()),!(pi&6)&&(Cd=_r()+500,_c()))}break;case 13:wu(function(){var r=Ja(t,1);if(r!==null){var s=$s();Oo(r,t,1,s)}}),B2(t,1)}};t2=function(t){if(t.tag===13){var e=Ja(t,134217728);if(e!==null){var i=$s();Oo(e,t,134217728,i)}B2(t,134217728)}};c5=function(t){if(t.tag===13){var e=oc(t),i=Ja(t,e);if(i!==null){var r=$s();Oo(i,t,e,r)}B2(t,e)}};u5=function(){return Ci};h5=function(t,e){var i=Ci;try{return Ci=t,e()}finally{Ci=i}};rw=function(t,e,i){switch(e){case"input":if(Jb(t,i),e=i.name,i.type==="radio"&&e!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var r=i[e];if(r!==t&&r.form===t.form){var s=c1(r);if(!s)throw Error(tt(90));GR(r),Jb(r,s)}}}break;case"textarea":$R(t,i);break;case"select":e=i.value,e!=null&&ld(t,!!i.multiple,e,!1)}};ZR=I2;YR=wu;var X8={usingClientEntryPoint:!1,Events:[Cm,Wh,c1,KR,JR,I2]},sf={findFiberByHostInstance:nu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},K8={bundleType:sf.bundleType,version:sf.version,rendererPackageName:sf.rendererPackageName,rendererConfig:sf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:el.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=t5(t),t===null?null:t.stateNode},findFiberByHostInstance:sf.findFiberByHostInstance||q8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var n_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!n_.isDisabled&&n_.supportsFiber)try{n1=n_.inject(K8),pa=n_}catch{}}Un.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X8;Un.createPortal=function(t,e){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!O2(e))throw Error(tt(200));return H8(t,e,null,i)};Un.createRoot=function(t,e){if(!O2(t))throw Error(tt(299));var i=!1,r="",s=BM;return e!=null&&(e.unstable_strictMode===!0&&(i=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=k2(t,1,!1,null,null,i,!1,r,s),t[Ka]=e.current,rm(t.nodeType===8?t.parentNode:t),new L2(e)};Un.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(tt(188)):(t=Object.keys(t).join(","),Error(tt(268,t)));return t=t5(e),t=t===null?null:t.stateNode,t};Un.flushSync=function(t){return wu(t)};Un.hydrate=function(t,e,i){if(!y1(e))throw Error(tt(200));return v1(null,t,e,!0,i)};Un.hydrateRoot=function(t,e,i){if(!O2(t))throw Error(tt(405));var r=i!=null&&i.hydratedSources||null,s=!1,n="",c=BM;if(i!=null&&(i.unstable_strictMode===!0&&(s=!0),i.identifierPrefix!==void 0&&(n=i.identifierPrefix),i.onRecoverableError!==void 0&&(c=i.onRecoverableError)),e=kM(e,null,t,1,i??null,s,!1,n,c),t[Ka]=e.current,rm(t),r)for(t=0;t<r.length;t++)i=r[t],s=i._getVersion,s=s(i._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[i,s]:e.mutableSourceEagerHydrationData.push(i,s);return new _1(e)};Un.render=function(t,e,i){if(!y1(e))throw Error(tt(200));return v1(null,t,e,!1,i)};Un.unmountComponentAtNode=function(t){if(!y1(t))throw Error(tt(40));return t._reactRootContainer?(wu(function(){v1(null,null,t,!1,function(){t._reactRootContainer=null,t[Ka]=null})}),!0):!1};Un.unstable_batchedUpdates=I2;Un.unstable_renderSubtreeIntoContainer=function(t,e,i,r){if(!y1(i))throw Error(tt(200));if(t==null||t._reactInternals===void 0)throw Error(tt(38));return v1(t,e,i,!1,r)};Un.version="18.3.1-next-f1338f8080-20240426";function LM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(LM)}catch(t){console.error(t)}}LM(),LR.exports=Un;var J8=LR.exports,OT=J8;Vb.createRoot=OT.createRoot,Vb.hydrateRoot=OT.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function O0(){return O0=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},O0.apply(this,arguments)}var Jl;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Jl||(Jl={}));const DT="popstate";function Z8(t){t===void 0&&(t={});function e(r,s){let{pathname:n,search:c,hash:l}=r.location;return Dw("",{pathname:n,search:c,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function i(r,s){return typeof s=="string"?s:DM(s)}return Q8(e,i,null,t)}function gn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function OM(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Y8(){return Math.random().toString(36).substr(2,8)}function FT(t,e){return{usr:t.state,key:t.key,idx:e}}function Dw(t,e,i,r){return i===void 0&&(i=null),O0({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?b1(e):e,{state:i,key:e&&e.key||r||Y8()})}function DM(t){let{pathname:e="/",search:i="",hash:r=""}=t;return i&&i!=="?"&&(e+=i.charAt(0)==="?"?i:"?"+i),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function b1(t){let e={};if(t){let i=t.indexOf("#");i>=0&&(e.hash=t.substr(i),t=t.substr(0,i));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function Q8(t,e,i,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:n=!1}=r,c=s.history,l=Jl.Pop,f=null,y=E();y==null&&(y=0,c.replaceState(O0({},c.state,{idx:y}),""));function E(){return(c.state||{idx:null}).idx}function T(){l=Jl.Pop;let ee=E(),z=ee==null?null:ee-y;y=ee,f&&f({action:l,location:H.location,delta:z})}function R(ee,z){l=Jl.Push;let W=Dw(H.location,ee,z);i&&i(W,ee),y=E()+1;let q=FT(W,y),ce=H.createHref(W);try{c.pushState(q,"",ce)}catch(we){if(we instanceof DOMException&&we.name==="DataCloneError")throw we;s.location.assign(ce)}n&&f&&f({action:l,location:H.location,delta:1})}function D(ee,z){l=Jl.Replace;let W=Dw(H.location,ee,z);i&&i(W,ee),y=E();let q=FT(W,y),ce=H.createHref(W);c.replaceState(q,"",ce),n&&f&&f({action:l,location:H.location,delta:0})}function V(ee){let z=s.location.origin!=="null"?s.location.origin:s.location.href,W=typeof ee=="string"?ee:DM(ee);return W=W.replace(/ $/,"%20"),gn(z,"No window.location.(origin|href) available to create URL for href: "+W),new URL(W,z)}let H={get action(){return l},get location(){return t(s,c)},listen(ee){if(f)throw new Error("A history only accepts one active listener");return s.addEventListener(DT,T),f=ee,()=>{s.removeEventListener(DT,T),f=null}},createHref(ee){return e(s,ee)},createURL:V,encodeLocation(ee){let z=V(ee);return{pathname:z.pathname,search:z.search,hash:z.hash}},push:R,replace:D,go(ee){return c.go(ee)}};return H}var NT;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(NT||(NT={}));function eF(t,e,i){return i===void 0&&(i="/"),tF(t,e,i,!1)}function tF(t,e,i,r){let s=typeof e=="string"?b1(e):e,n=UM(s.pathname||"/",i);if(n==null)return null;let c=FM(t);iF(c);let l=null;for(let f=0;l==null&&f<c.length;++f){let y=pF(n);l=hF(c[f],y,r)}return l}function FM(t,e,i,r){e===void 0&&(e=[]),i===void 0&&(i=[]),r===void 0&&(r="");let s=(n,c,l)=>{let f={relativePath:l===void 0?n.path||"":l,caseSensitive:n.caseSensitive===!0,childrenIndex:c,route:n};f.relativePath.startsWith("/")&&(gn(f.relativePath.startsWith(r),'Absolute route path "'+f.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),f.relativePath=f.relativePath.slice(r.length));let y=fd([r,f.relativePath]),E=i.concat(f);n.children&&n.children.length>0&&(gn(n.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+y+'".')),FM(n.children,e,E,y)),!(n.path==null&&!n.index)&&e.push({path:y,score:cF(y,n.index),routesMeta:E})};return t.forEach((n,c)=>{var l;if(n.path===""||!((l=n.path)!=null&&l.includes("?")))s(n,c);else for(let f of NM(n.path))s(n,c,f)}),e}function NM(t){let e=t.split("/");if(e.length===0)return[];let[i,...r]=e,s=i.endsWith("?"),n=i.replace(/\?$/,"");if(r.length===0)return s?[n,""]:[n];let c=NM(r.join("/")),l=[];return l.push(...c.map(f=>f===""?n:[n,f].join("/"))),s&&l.push(...c),l.map(f=>t.startsWith("/")&&f===""?"/":f)}function iF(t){t.sort((e,i)=>e.score!==i.score?i.score-e.score:uF(e.routesMeta.map(r=>r.childrenIndex),i.routesMeta.map(r=>r.childrenIndex)))}const rF=/^:[\w-]+$/,sF=3,nF=2,oF=1,aF=10,lF=-2,UT=t=>t==="*";function cF(t,e){let i=t.split("/"),r=i.length;return i.some(UT)&&(r+=lF),e&&(r+=nF),i.filter(s=>!UT(s)).reduce((s,n)=>s+(rF.test(n)?sF:n===""?oF:aF),r)}function uF(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function hF(t,e,i){i===void 0&&(i=!1);let{routesMeta:r}=t,s={},n="/",c=[];for(let l=0;l<r.length;++l){let f=r[l],y=l===r.length-1,E=n==="/"?e:e.slice(n.length)||"/",T=zT({path:f.relativePath,caseSensitive:f.caseSensitive,end:y},E),R=f.route;if(!T&&y&&i&&!r[r.length-1].route.index&&(T=zT({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},E)),!T)return null;Object.assign(s,T.params),c.push({params:s,pathname:fd([n,T.pathname]),pathnameBase:fF(fd([n,T.pathnameBase])),route:R}),T.pathnameBase!=="/"&&(n=fd([n,T.pathnameBase]))}return c}function zT(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[i,r]=dF(t.path,t.caseSensitive,t.end),s=e.match(i);if(!s)return null;let n=s[0],c=n.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((y,E,T)=>{let{paramName:R,isOptional:D}=E;if(R==="*"){let H=l[T]||"";c=n.slice(0,n.length-H.length).replace(/(.)\/+$/,"$1")}const V=l[T];return D&&!V?y[R]=void 0:y[R]=(V||"").replace(/%2F/g,"/"),y},{}),pathname:n,pathnameBase:c,pattern:t}}function dF(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!0),OM(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,l,f)=>(r.push({paramName:l,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function pF(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return OM(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function UM(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let i=e.endsWith("/")?e.length-1:e.length,r=t.charAt(i);return r&&r!=="/"?null:t.slice(i)||"/"}const fd=t=>t.join("/").replace(/\/\/+/g,"/"),fF=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/");function mF(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const zM=["post","put","patch","delete"];new Set(zM);const gF=["get",...zM];new Set(gF);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function D0(){return D0=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},D0.apply(this,arguments)}const _F=dt.createContext(null),yF=dt.createContext(null),jM=dt.createContext(null),w1=dt.createContext(null),x1=dt.createContext({outlet:null,matches:[],isDataRoute:!1}),GM=dt.createContext(null);function D2(){return dt.useContext(w1)!=null}function vF(){return D2()||gn(!1),dt.useContext(w1).location}function bF(t,e){return wF(t,e)}function wF(t,e,i,r){D2()||gn(!1);let{navigator:s}=dt.useContext(jM),{matches:n}=dt.useContext(x1),c=n[n.length-1],l=c?c.params:{};c&&c.pathname;let f=c?c.pathnameBase:"/";c&&c.route;let y=vF(),E;if(e){var T;let ee=typeof e=="string"?b1(e):e;f==="/"||(T=ee.pathname)!=null&&T.startsWith(f)||gn(!1),E=ee}else E=y;let R=E.pathname||"/",D=R;if(f!=="/"){let ee=f.replace(/^\//,"").split("/");D="/"+R.replace(/^\//,"").split("/").slice(ee.length).join("/")}let V=eF(t,{pathname:D}),H=SF(V&&V.map(ee=>Object.assign({},ee,{params:Object.assign({},l,ee.params),pathname:fd([f,s.encodeLocation?s.encodeLocation(ee.pathname).pathname:ee.pathname]),pathnameBase:ee.pathnameBase==="/"?f:fd([f,s.encodeLocation?s.encodeLocation(ee.pathnameBase).pathname:ee.pathnameBase])})),n,i,r);return e&&H?dt.createElement(w1.Provider,{value:{location:D0({pathname:"/",search:"",hash:"",state:null,key:"default"},E),navigationType:Jl.Pop}},H):H}function xF(){let t=MF(),e=mF(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),i=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},n=null;return dt.createElement(dt.Fragment,null,dt.createElement("h2",null,"Unexpected Application Error!"),dt.createElement("h3",{style:{fontStyle:"italic"}},e),i?dt.createElement("pre",{style:s},i):null,n)}const EF=dt.createElement(xF,null);class AF extends dt.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,i){return i.location!==e.location||i.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:i.error,location:i.location,revalidation:e.revalidation||i.revalidation}}componentDidCatch(e,i){console.error("React Router caught the following error during render",e,i)}render(){return this.state.error!==void 0?dt.createElement(x1.Provider,{value:this.props.routeContext},dt.createElement(GM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function TF(t){let{routeContext:e,match:i,children:r}=t,s=dt.useContext(_F);return s&&s.static&&s.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=i.route.id),dt.createElement(x1.Provider,{value:e},r)}function SF(t,e,i,r){var s;if(e===void 0&&(e=[]),i===void 0&&(i=null),r===void 0&&(r=null),t==null){var n;if(!i)return null;if(i.errors)t=i.matches;else if((n=r)!=null&&n.v7_partialHydration&&e.length===0&&!i.initialized&&i.matches.length>0)t=i.matches;else return null}let c=t,l=(s=i)==null?void 0:s.errors;if(l!=null){let E=c.findIndex(T=>T.route.id&&(l==null?void 0:l[T.route.id])!==void 0);E>=0||gn(!1),c=c.slice(0,Math.min(c.length,E+1))}let f=!1,y=-1;if(i&&r&&r.v7_partialHydration)for(let E=0;E<c.length;E++){let T=c[E];if((T.route.HydrateFallback||T.route.hydrateFallbackElement)&&(y=E),T.route.id){let{loaderData:R,errors:D}=i,V=T.route.loader&&R[T.route.id]===void 0&&(!D||D[T.route.id]===void 0);if(T.route.lazy||V){f=!0,y>=0?c=c.slice(0,y+1):c=[c[0]];break}}}return c.reduceRight((E,T,R)=>{let D,V=!1,H=null,ee=null;i&&(D=l&&T.route.id?l[T.route.id]:void 0,H=T.route.errorElement||EF,f&&(y<0&&R===0?(PF("route-fallback",!1),V=!0,ee=null):y===R&&(V=!0,ee=T.route.hydrateFallbackElement||null)));let z=e.concat(c.slice(0,R+1)),W=()=>{let q;return D?q=H:V?q=ee:T.route.Component?q=dt.createElement(T.route.Component,null):T.route.element?q=T.route.element:q=E,dt.createElement(TF,{match:T,routeContext:{outlet:E,matches:z,isDataRoute:i!=null},children:q})};return i&&(T.route.ErrorBoundary||T.route.errorElement||R===0)?dt.createElement(AF,{location:i.location,revalidation:i.revalidation,component:H,error:D,children:W(),routeContext:{outlet:null,matches:z,isDataRoute:!0}}):W()},null)}var Fw=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Fw||{});function CF(t){let e=dt.useContext(yF);return e||gn(!1),e}function IF(t){let e=dt.useContext(x1);return e||gn(!1),e}function RF(t){let e=IF(),i=e.matches[e.matches.length-1];return i.route.id||gn(!1),i.route.id}function MF(){var t;let e=dt.useContext(GM),i=CF(Fw.UseRouteError),r=RF(Fw.UseRouteError);return e!==void 0?e:(t=i.errors)==null?void 0:t[r]}const jT={};function PF(t,e,i){!e&&!jT[t]&&(jT[t]=!0)}function kF(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function VM(t){gn(!1)}function BF(t){let{basename:e="/",children:i=null,location:r,navigationType:s=Jl.Pop,navigator:n,static:c=!1,future:l}=t;D2()&&gn(!1);let f=e.replace(/^\/*/,"/"),y=dt.useMemo(()=>({basename:f,navigator:n,static:c,future:D0({v7_relativeSplatPath:!1},l)}),[f,l,n,c]);typeof r=="string"&&(r=b1(r));let{pathname:E="/",search:T="",hash:R="",state:D=null,key:V="default"}=r,H=dt.useMemo(()=>{let ee=UM(E,f);return ee==null?null:{location:{pathname:ee,search:T,hash:R,state:D,key:V},navigationType:s}},[f,E,T,R,D,V,s]);return H==null?null:dt.createElement(jM.Provider,{value:y},dt.createElement(w1.Provider,{children:i,value:H}))}function LF(t){let{children:e,location:i}=t;return bF(Nw(e),i)}new Promise(()=>{});function Nw(t,e){e===void 0&&(e=[]);let i=[];return dt.Children.forEach(t,(r,s)=>{if(!dt.isValidElement(r))return;let n=[...e,s];if(r.type===dt.Fragment){i.push.apply(i,Nw(r.props.children,n));return}r.type!==VM&&gn(!1),!r.props.index||!r.props.children||gn(!1);let c={id:r.props.id||n.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(c.children=Nw(r.props.children,n)),i.push(c)}),i}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const OF="6";try{window.__reactRouterVersion=OF}catch{}const DF="startTransition",GT=UO[DF];function FF(t){let{basename:e,children:i,future:r,window:s}=t,n=dt.useRef();n.current==null&&(n.current=Z8({window:s,v5Compat:!0}));let c=n.current,[l,f]=dt.useState({action:c.action,location:c.location}),{v7_startTransition:y}=r||{},E=dt.useCallback(T=>{y&&GT?GT(()=>f(T)):f(T)},[f,y]);return dt.useLayoutEffect(()=>c.listen(E),[c,E]),dt.useEffect(()=>kF(r),[r]),dt.createElement(BF,{basename:e,children:i,location:l.location,navigationType:l.action,navigator:c,future:r})}var VT;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(VT||(VT={}));var $T;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})($T||($T={}));(function(){try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;top:0;right:0;bottom:0;left:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}.psv-navbar{display:none!important}`)),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();var NF=Object.defineProperty,UF=(t,e,i)=>e in t?NF(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,O=(t,e,i)=>UF(t,typeof e!="symbol"?e+"":e,i);function $M(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const n=Object.getOwnPropertyDescriptor(r,s);n&&Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var zF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function HM(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var qM={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(t,e){(function(i,r){t.exports=r()})(zF,function(){var i={},r={};function s(c,l,f){if(r[c]=f,c==="index"){var y="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",E={};return r.shared(E),r.index(i,E),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([y],{type:"text/javascript"}))),i}}s("shared",["exports"],function(c){function l(u,a,h,p){return new(h||(h=Promise))(function(_,w){function x(P){try{C(p.next(P))}catch(k){w(k)}}function A(P){try{C(p.throw(P))}catch(k){w(k)}}function C(P){var k;P.done?_(P.value):(k=P.value,k instanceof h?k:new h(function(L){L(k)})).then(x,A)}C((p=p.apply(u,a||[])).next())})}function f(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var y=E;function E(u,a){this.x=u,this.y=a}E.prototype={clone:function(){return new E(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,a){return this.clone()._rotateAround(u,a)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var a=u.x-this.x,h=u.y-this.y;return a*a+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,a){return Math.atan2(this.x*a-this.y*u,this.x*u+this.y*a)},_matMult:function(u){var a=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=a,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var a=Math.cos(u),h=Math.sin(u),p=h*this.x+a*this.y;return this.x=a*this.x-h*this.y,this.y=p,this},_rotateAround:function(u,a){var h=Math.cos(u),p=Math.sin(u),_=a.y+p*(this.x-a.x)+h*(this.y-a.y);return this.x=a.x+h*(this.x-a.x)-p*(this.y-a.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},E.convert=function(u){return u instanceof E?u:Array.isArray(u)?new E(u[0],u[1]):u};var T=f(y),R=D;function D(u,a,h,p){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=a,this.p2x=h,this.p2y=p}D.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,a){if(a===void 0&&(a=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,p=0;p<8;p++){var _=this.sampleCurveX(h)-u;if(Math.abs(_)<a)return h;var w=this.sampleCurveDerivativeX(h);if(Math.abs(w)<1e-6)break;h-=_/w}var x=0,A=1;for(h=u,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-u)<a));p++)u>_?x=h:A=h,h=.5*(A-x)+x;return h},solve:function(u,a){return this.sampleCurveY(this.solveCurveX(u,a))}};var V=f(R);let H,ee;function z(){return H==null&&(H=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),H}function W(){if(ee==null&&(ee=!1,z())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let h=0;h<5*5;h++){const p=4*h;u.fillStyle=`rgb(${p},${p+1},${p+2})`,u.fillRect(h%5,Math.floor(h/5),1,1)}const a=u.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&a[h]!==h){ee=!0;break}}}return ee||!1}function q(u,a,h,p){const _=new V(u,a,h,p);return w=>_.solve(w)}const ce=q(.25,.1,.25,1);function we(u,a,h){return Math.min(h,Math.max(a,u))}function re(u,a,h){const p=h-a,_=((u-a)%p+p)%p+a;return _===a?h:_}function be(u,...a){for(const h of a)for(const p in h)u[p]=h[p];return u}let me=1;function Te(u,a,h){const p={};for(const _ in u)p[_]=a.call(this,u[_],_,u);return p}function Pe(u,a,h){const p={};for(const _ in u)a.call(this,u[_],_,u)&&(p[_]=u[_]);return p}function ze(u){return Array.isArray(u)?u.map(ze):typeof u=="object"&&u?Te(u,ze):u}const Ke={};function We(u){Ke[u]||(typeof console<"u"&&console.warn(u),Ke[u]=!0)}function Ze(u,a,h){return(h.y-u.y)*(a.x-u.x)>(a.y-u.y)*(h.x-u.x)}function Ft(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let ci=null;function Gt(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function xt(u,a,h,p,_){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(u,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const A=x.startsWith("BGR"),C=new Uint8ClampedArray(p*_*4);if(yield w.copyTo(C,function(P,k,L,U,$){const J=4*Math.max(-k,0),Z=(Math.max(0,L)-L)*U*4+J,ae=4*U,he=Math.max(0,k),Me=Math.max(0,L);return{rect:{x:he,y:Me,width:Math.min(P.width,k+U)-he,height:Math.min(P.height,L+$)-Me},layout:[{offset:Z,stride:ae}]}}(u,a,h,p,_)),A)for(let P=0;P<C.length;P+=4){const k=C[P];C[P]=C[P+2],C[P+2]=k}return C}finally{w.close()}})}let Tt,zt;const $t="AbortError";function Ls(){return new Error($t)}const cr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Dr(u){return cr.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const Fr="global-dispatcher";class si extends Error{constructor(a,h,p,_){super(`AJAXError: ${h} (${a}): ${p}`),this.status=a,this.statusText=h,this.url=p,this.body=_}}const fr=()=>Ft(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,wi=function(u,a){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const p=Dr(u.url);if(p)return p(u,a);if(Ft(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:Fr},a)}if(!(/^file:/.test(h=u.url)||/^file:/.test(fr())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,_){return l(this,void 0,void 0,function*(){const w=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:fr(),signal:_.signal});p.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const P=yield x.blob();throw new si(x.status,x.statusText,p.url,P)}let A;A=p.type==="arrayBuffer"||p.type==="image"?x.arrayBuffer():p.type==="json"?x.json():x.text();const C=yield A;if(_.signal.aborted)throw Ls();return{data:C,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(u,a);if(Ft(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:Fr},a)}var h;return function(p,_){return new Promise((w,x)=>{var A;const C=new XMLHttpRequest;C.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(C.responseType="arraybuffer");for(const P in p.headers)C.setRequestHeader(P,p.headers[P]);p.type==="json"&&(C.responseType="text",!((A=p.headers)===null||A===void 0)&&A.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=p.credentials==="include",C.onerror=()=>{x(new Error(C.statusText))},C.onload=()=>{if(!_.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let P=C.response;if(p.type==="json")try{P=JSON.parse(C.response)}catch(k){return void x(k)}w({data:P,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const P=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});x(new si(C.status,C.statusText,p.url,P))}},_.signal.addEventListener("abort",()=>{C.abort(),x(Ls())}),C.send(p.body)})}(u,a)};function Zi(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const a=new URL(u),h=window.location;return a.protocol===h.protocol&&a.host===h.host}function Gn(u,a,h){h[u]&&h[u].indexOf(a)!==-1||(h[u]=h[u]||[],h[u].push(a))}function ts(u,a,h){if(h&&h[u]){const p=h[u].indexOf(a);p!==-1&&h[u].splice(p,1)}}class ps{constructor(a,h={}){be(this,h),this.type=a}}class fs extends ps{constructor(a,h={}){super("error",be({error:a},h))}}class Ws{on(a,h){return this._listeners=this._listeners||{},Gn(a,h,this._listeners),this}off(a,h){return ts(a,h,this._listeners),ts(a,h,this._oneTimeListeners),this}once(a,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Gn(a,h,this._oneTimeListeners),this):new Promise(p=>this.once(a,p))}fire(a,h){typeof a=="string"&&(a=new ps(a,h||{}));const p=a.type;if(this.listens(p)){a.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const A of _)A.call(this,a);const w=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const A of w)ts(p,A,this._oneTimeListeners),A.call(this,a);const x=this._eventedParent;x&&(be(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(a))}else a instanceof fs&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,h){return this._eventedParent=a,this._eventedParentData=h,this}}var Oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const is=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function jo(u,a){const h={};for(const p in u)p!=="ref"&&(h[p]=u[p]);return is.forEach(p=>{p in a&&(h[p]=a[p])}),h}function Yt(u,a){if(Array.isArray(u)){if(!Array.isArray(a)||u.length!==a.length)return!1;for(let h=0;h<u.length;h++)if(!Yt(u[h],a[h]))return!1;return!0}if(typeof u=="object"&&u!==null&&a!==null){if(typeof a!="object"||Object.keys(u).length!==Object.keys(a).length)return!1;for(const h in u)if(!Yt(u[h],a[h]))return!1;return!0}return u===a}function xi(u,a){u.push(a)}function vr(u,a,h){xi(h,{command:"addSource",args:[u,a[u]]})}function Vn(u,a,h){xi(a,{command:"removeSource",args:[u]}),h[u]=!0}function _n(u,a,h,p){Vn(u,h,p),vr(u,a,h)}function Go(u,a,h){let p;for(p in u[h])if(Object.prototype.hasOwnProperty.call(u[h],p)&&p!=="data"&&!Yt(u[h][p],a[h][p]))return!1;for(p in a[h])if(Object.prototype.hasOwnProperty.call(a[h],p)&&p!=="data"&&!Yt(u[h][p],a[h][p]))return!1;return!0}function ms(u,a,h,p,_,w){u=u||{},a=a||{};for(const x in u)Object.prototype.hasOwnProperty.call(u,x)&&(Yt(u[x],a[x])||h.push({command:w,args:[p,x,a[x],_]}));for(const x in a)Object.prototype.hasOwnProperty.call(a,x)&&!Object.prototype.hasOwnProperty.call(u,x)&&(Yt(u[x],a[x])||h.push({command:w,args:[p,x,a[x],_]}))}function ga(u){return u.id}function Vo(u,a){return u[a.id]=a,u}class Je{constructor(a,h,p,_){this.message=(a?`${a}: `:"")+p,_&&(this.identifier=_),h!=null&&h.__line__&&(this.line=h.__line__)}}function Os(u,...a){for(const h of a)for(const p in h)u[p]=h[p];return u}class br extends Error{constructor(a,h){super(h),this.message=h,this.key=a}}class rs{constructor(a,h=[]){this.parent=a,this.bindings={};for(const[p,_]of h)this.bindings[p]=_}concat(a){return new rs(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Xs={kind:"null"},st={kind:"number"},Nt={kind:"string"},Mt={kind:"boolean"},Nr={kind:"color"},Ds={kind:"object"},Pt={kind:"value"},Ks={kind:"collator"},yn={kind:"formatted"},vn={kind:"padding"},Fs={kind:"resolvedImage"},ue={kind:"variableAnchorOffsetCollection"};function G(u,a){return{kind:"array",itemType:u,N:a}}function j(u){if(u.kind==="array"){const a=j(u.itemType);return typeof u.N=="number"?`array<${a}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${a}>`}return u.kind}const Y=[Xs,st,Nt,Mt,Nr,yn,Ds,G(Pt),vn,Fs,ue];function oe(u,a){if(a.kind==="error")return null;if(u.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!oe(u.itemType,a.itemType))&&(typeof u.N!="number"||u.N===a.N))return null}else{if(u.kind===a.kind)return null;if(u.kind==="value"){for(const h of Y)if(!oe(h,a))return null}}return`Expected ${j(u)} but found ${j(a)} instead.`}function ye(u,a){return a.some(h=>h.kind===u.kind)}function Ee(u,a){return a.some(h=>h==="null"?u===null:h==="array"?Array.isArray(u):h==="object"?u&&!Array.isArray(u)&&typeof u=="object":h===typeof u)}function Re(u,a){return u.kind==="array"&&a.kind==="array"?u.itemType.kind===a.itemType.kind&&typeof u.N=="number":u.kind===a.kind}const fe=.96422,Ne=.82521,Ve=4/29,De=6/29,Ye=3*De*De,wt=De*De*De,St=Math.PI/180,Zt=180/Math.PI;function Ot(u){return(u%=360)<0&&(u+=360),u}function Xt([u,a,h,p]){let _,w;const x=Vi((.2225045*(u=jt(u))+.7168786*(a=jt(a))+.0606169*(h=jt(h)))/1);u===a&&a===h?_=w=x:(_=Vi((.4360747*u+.3850649*a+.1430804*h)/fe),w=Vi((.0139322*u+.0971045*a+.7141733*h)/Ne));const A=116*x-16;return[A<0?0:A,500*(_-x),200*(x-w),p]}function jt(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Vi(u){return u>wt?Math.pow(u,1/3):u/Ye+Ve}function Ai([u,a,h,p]){let _=(u+16)/116,w=isNaN(a)?_:_+a/500,x=isNaN(h)?_:_-h/200;return _=1*Qt(_),w=fe*Qt(w),x=Ne*Qt(x),[Dt(3.1338561*w-1.6168667*_-.4906146*x),Dt(-.9787684*w+1.9161415*_+.033454*x),Dt(.0719453*w-.2289914*_+1.4052427*x),p]}function Dt(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Qt(u){return u>De?u*u*u:Ye*(u-Ve)}function hi(u){return parseInt(u.padEnd(2,u),16)/255}function $i(u,a){return sr(a?u/100:u,0,1)}function sr(u,a,h){return Math.min(Math.max(a,u),h)}function Ir(u){return!u.some(Number.isNaN)}const $o={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ti{constructor(a,h,p,_=1,w=!0){this.r=a,this.g=h,this.b=p,this.a=_,w||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[a,h,p,_]))}static parse(a){if(a instanceof ti)return a;if(typeof a!="string")return;const h=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=$o[p];if(_){const[x,A,C]=_;return[x/255,A/255,C/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const x=p.length<6?1:2;let A=1;return[hi(p.slice(A,A+=x)),hi(p.slice(A,A+=x)),hi(p.slice(A,A+=x)),hi(p.slice(A,A+x)||"ff")]}if(p.startsWith("rgb")){const x=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[A,C,P,k,L,U,$,J,Z,ae,he,Me]=x,ve=[k||" ",$||" ",ae].join("");if(ve==="  "||ve==="  /"||ve===",,"||ve===",,,"){const Se=[P,U,Z].join(""),Fe=Se==="%%%"?100:Se===""?255:0;if(Fe){const He=[sr(+C/Fe,0,1),sr(+L/Fe,0,1),sr(+J/Fe,0,1),he?$i(+he,Me):1];if(Ir(He))return He}}return}}const w=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,A,C,P,k,L,U,$,J]=w,Z=[C||" ",k||" ",U].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const ae=[+A,sr(+P,0,100),sr(+L,0,100),$?$i(+$,J):1];if(Ir(ae))return function([he,Me,ve,Se]){function Fe(He){const ht=(He+he/30)%12,It=Me*Math.min(ve,1-ve);return ve-It*Math.max(-1,Math.min(ht-3,9-ht,1))}return he=Ot(he),Me/=100,ve/=100,[Fe(0),Fe(8),Fe(4),Se]}(ae)}}}(a);return h?new ti(...h,!1):void 0}get rgb(){const{r:a,g:h,b:p,a:_}=this,w=_||1/0;return this.overwriteGetter("rgb",[a/w,h/w,p/w,_])}get hcl(){return this.overwriteGetter("hcl",function(a){const[h,p,_,w]=Xt(a),x=Math.sqrt(p*p+_*_);return[Math.round(1e4*x)?Ot(Math.atan2(_,p)*Zt):NaN,x,h,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Xt(this.rgb))}overwriteGetter(a,h){return Object.defineProperty(this,a,{value:h}),h}toString(){const[a,h,p,_]=this.rgb;return`rgba(${[a,h,p].map(w=>Math.round(255*w)).join(",")},${_})`}}ti.black=new ti(0,0,0,1),ti.white=new ti(1,1,1,1),ti.transparent=new ti(0,0,0,0),ti.red=new ti(1,0,0,1);class Ur{constructor(a,h,p){this.sensitivity=a?h?"variant":"case":h?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,h){return this.collator.compare(a,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $n{constructor(a,h,p,_,w){this.text=a,this.image=h,this.scale=p,this.fontStack=_,this.textColor=w}}class Yi{constructor(a){this.sections=a}static fromString(a){return new Yi([new $n(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof Yi?a:Yi.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class Hi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Hi)return a;if(typeof a=="number")return new Hi([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const h of a)if(typeof h!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new Hi(a)}}toString(){return JSON.stringify(this.values)}}const _a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class qi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof qi)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let h=0;h<a.length;h+=2){const p=a[h],_=a[h+1];if(typeof p!="string"||!_a.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new qi(a)}}toString(){return JSON.stringify(this.values)}}class Wi{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new Wi({name:a,available:!1}):null}}function fo(u,a,h,p){return typeof u=="number"&&u>=0&&u<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof h=="number"&&h>=0&&h<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,a,h,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,a,h,p]:[u,a,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Hn(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof ti||u instanceof Ur||u instanceof Yi||u instanceof Hi||u instanceof qi||u instanceof Wi)return!0;if(Array.isArray(u)){for(const a of u)if(!Hn(a))return!1;return!0}if(typeof u=="object"){for(const a in u)if(!Hn(u[a]))return!1;return!0}return!1}function Di(u){if(u===null)return Xs;if(typeof u=="string")return Nt;if(typeof u=="boolean")return Mt;if(typeof u=="number")return st;if(u instanceof ti)return Nr;if(u instanceof Ur)return Ks;if(u instanceof Yi)return yn;if(u instanceof Hi)return vn;if(u instanceof qi)return ue;if(u instanceof Wi)return Fs;if(Array.isArray(u)){const a=u.length;let h;for(const p of u){const _=Di(p);if(h){if(h===_)continue;h=Pt;break}h=_}return G(h||Pt,a)}return Ds}function Rr(u){const a=typeof u;return u===null?"":a==="string"||a==="number"||a==="boolean"?String(u):u instanceof ti||u instanceof Yi||u instanceof Hi||u instanceof qi||u instanceof Wi?u.toString():JSON.stringify(u)}class zr{constructor(a,h){this.type=a,this.value=h}static parse(a,h){if(a.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Hn(a[1]))return h.error("invalid value");const p=a[1];let _=Di(p);const w=h.expectedType;return _.kind!=="array"||_.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(_=w),new zr(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Fi{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const Ho={string:Nt,number:st,boolean:Mt,object:Ds};class ss{constructor(a,h){this.type=a,this.args=h}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");let p,_=1;const w=a[0];if(w==="array"){let A,C;if(a.length>2){const P=a[1];if(typeof P!="string"||!(P in Ho)||P==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);A=Ho[P],_++}else A=Pt;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return h.error('The length argument to "array" must be a positive integer literal',2);C=a[2],_++}p=G(A,C)}else{if(!Ho[w])throw new Error(`Types doesn't contain name = ${w}`);p=Ho[w]}const x=[];for(;_<a.length;_++){const A=h.parse(a[_],_,Pt);if(!A)return null;x.push(A)}return new ss(p,x)}evaluate(a){for(let h=0;h<this.args.length;h++){const p=this.args[h].evaluate(a);if(!oe(this.type,Di(p)))return p;if(h===this.args.length-1)throw new Fi(`Expected value to be of type ${j(this.type)}, but found ${j(Di(p))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const ya={"to-boolean":Mt,"to-color":Nr,"to-number":st,"to-string":Nt};class jr{constructor(a,h){this.type=a,this.args=h}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");const p=a[0];if(!ya[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&a.length!==2)return h.error("Expected one argument.");const _=ya[p],w=[];for(let x=1;x<a.length;x++){const A=h.parse(a[x],x,Pt);if(!A)return null;w.push(A)}return new jr(_,w)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let h,p;for(const _ of this.args){if(h=_.evaluate(a),p=null,h instanceof ti)return h;if(typeof h=="string"){const w=a.parseColor(h);if(w)return w}else if(Array.isArray(h)&&(p=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:fo(h[0],h[1],h[2],h[3]),!p))return new ti(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Fi(p||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const p of this.args){h=p.evaluate(a);const _=Hi.parse(h);if(_)return _}throw new Fi(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const p of this.args){h=p.evaluate(a);const _=qi.parse(h);if(_)return _}throw new Fi(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const p of this.args){if(h=p.evaluate(a),h===null)return 0;const _=Number(h);if(!isNaN(_))return _}throw new Fi(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Yi.fromString(Rr(this.args[0].evaluate(a)));case"resolvedImage":return Wi.fromString(Rr(this.args[0].evaluate(a)));default:return Rr(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const qn=["Unknown","Point","LineString","Polygon"];class il{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let h=this._parseColorCache[a];return h||(h=this._parseColorCache[a]=ti.parse(a)),h}}class Wn{constructor(a,h,p=[],_,w=new rs,x=[]){this.registry=a,this.path=p,this.key=p.map(A=>`[${A}]`).join(""),this.scope=w,this.errors=x,this.expectedType=_,this._isConstant=h}parse(a,h,p,_,w={}){return h?this.concat(h,p,_)._parse(a,w):this._parse(a,w)}_parse(a,h){function p(_,w,x){return x==="assert"?new ss(w,[_]):x==="coerce"?new jr(w,[_]):_}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=a[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[_];if(w){let x=w.parse(a,this);if(!x)return null;if(this.expectedType){const A=this.expectedType,C=x.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||C.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(A.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(A.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(A,C))return null}else x=p(x,A,h.typeAnnotation||"coerce");else x=p(x,A,h.typeAnnotation||"coerce");else x=p(x,A,h.typeAnnotation||"coerce");else x=p(x,A,h.typeAnnotation||"assert")}if(!(x instanceof zr)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const A=new il;try{x=new zr(x.type,x.evaluate(A))}catch(C){return this.error(C.message),null}}return x}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,h,p){const _=typeof a=="number"?this.path.concat(a):this.path,w=p?this.scope.concat(p):this.scope;return new Wn(this.registry,this._isConstant,_,h||null,w,this.errors)}error(a,...h){const p=`${this.key}${h.map(_=>`[${_}]`).join("")}`;this.errors.push(new br(p,a))}checkSubtype(a,h){const p=oe(a,h);return p&&this.error(p),p}}class Js{constructor(a,h){this.type=h.type,this.bindings=[].concat(a),this.result=h}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const h of this.bindings)a(h[1]);a(this.result)}static parse(a,h){if(a.length<4)return h.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const p=[];for(let w=1;w<a.length-1;w+=2){const x=a[w];if(typeof x!="string")return h.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return h.error("Variable names must contain only alphanumeric characters or '_'.",w);const A=h.parse(a[w+1],w+1);if(!A)return null;p.push([x,A])}const _=h.parse(a[a.length-1],a.length-1,h.expectedType,p);return _?new Js(p,_):null}outputDefined(){return this.result.outputDefined()}}class ei{constructor(a,h){this.type=h.type,this.name=a,this.boundExpression=h}static parse(a,h){if(a.length!==2||typeof a[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const p=a[1];return h.scope.has(p)?new ei(p,h.scope.get(p)):h.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class wc{constructor(a,h,p){this.type=a,this.index=h,this.input=p}static parse(a,h){if(a.length!==3)return h.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=h.parse(a[1],1,st),_=h.parse(a[2],2,G(h.expectedType||Pt));return p&&_?new wc(_.type.itemType,p,_):null}evaluate(a){const h=this.index.evaluate(a),p=this.input.evaluate(a);if(h<0)throw new Fi(`Array index out of bounds: ${h} < 0.`);if(h>=p.length)throw new Fi(`Array index out of bounds: ${h} > ${p.length-1}.`);if(h!==Math.floor(h))throw new Fi(`Array index must be an integer, but found ${h} instead.`);return p[h]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class xc{constructor(a,h){this.type=Mt,this.needle=a,this.haystack=h}static parse(a,h){if(a.length!==3)return h.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=h.parse(a[1],1,Pt),_=h.parse(a[2],2,Pt);return p&&_?ye(p.type,[Mt,Nt,st,Xs,Pt])?new xc(p,_):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(p.type)} instead`):null}evaluate(a){const h=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!p)return!1;if(!Ee(h,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${j(Di(h))} instead.`);if(!Ee(p,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${j(Di(p))} instead.`);return p.indexOf(h)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class K{constructor(a,h,p){this.type=st,this.needle=a,this.haystack=h,this.fromIndex=p}static parse(a,h){if(a.length<=2||a.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=h.parse(a[1],1,Pt),_=h.parse(a[2],2,Pt);if(!p||!_)return null;if(!ye(p.type,[Mt,Nt,st,Xs,Pt]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(p.type)} instead`);if(a.length===4){const w=h.parse(a[3],3,st);return w?new K(p,_,w):null}return new K(p,_)}evaluate(a){const h=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!Ee(h,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${j(Di(h))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(a)),Ee(p,["string"])){const w=p.indexOf(h,_);return w===-1?-1:[...p.slice(0,w)].length}if(Ee(p,["array"]))return p.indexOf(h,_);throw new Fi(`Expected second argument to be of type array or string, but found ${j(Di(p))} instead.`)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class ie{constructor(a,h,p,_,w,x){this.inputType=a,this.type=h,this.input=p,this.cases=_,this.outputs=w,this.otherwise=x}static parse(a,h){if(a.length<5)return h.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return h.error("Expected an even number of arguments.");let p,_;h.expectedType&&h.expectedType.kind!=="value"&&(_=h.expectedType);const w={},x=[];for(let P=2;P<a.length-1;P+=2){let k=a[P];const L=a[P+1];Array.isArray(k)||(k=[k]);const U=h.concat(P);if(k.length===0)return U.error("Expected at least one branch label.");for(const J of k){if(typeof J!="number"&&typeof J!="string")return U.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return U.error("Numeric branch labels must be integer values.");if(p){if(U.checkSubtype(p,Di(J)))return null}else p=Di(J);if(w[String(J)]!==void 0)return U.error("Branch labels must be unique.");w[String(J)]=x.length}const $=h.parse(L,P,_);if(!$)return null;_=_||$.type,x.push($)}const A=h.parse(a[1],1,Pt);if(!A)return null;const C=h.parse(a[a.length-1],a.length-1,_);return C?A.type.kind!=="value"&&h.concat(1).checkSubtype(p,A.type)?null:new ie(p,_,A,w,x,C):null}evaluate(a){const h=this.input.evaluate(a);return(Di(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class _e{constructor(a,h,p){this.type=a,this.branches=h,this.otherwise=p}static parse(a,h){if(a.length<4)return h.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return h.error("Expected an odd number of arguments.");let p;h.expectedType&&h.expectedType.kind!=="value"&&(p=h.expectedType);const _=[];for(let x=1;x<a.length-1;x+=2){const A=h.parse(a[x],x,Mt);if(!A)return null;const C=h.parse(a[x+1],x+1,p);if(!C)return null;_.push([A,C]),p=p||C.type}const w=h.parse(a[a.length-1],a.length-1,p);if(!w)return null;if(!p)throw new Error("Can't infer output type");return new _e(p,_,w)}evaluate(a){for(const[h,p]of this.branches)if(h.evaluate(a))return p.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[h,p]of this.branches)a(h),a(p);a(this.otherwise)}outputDefined(){return this.branches.every(([a,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class Ue{constructor(a,h,p,_){this.type=a,this.input=h,this.beginIndex=p,this.endIndex=_}static parse(a,h){if(a.length<=2||a.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=h.parse(a[1],1,Pt),_=h.parse(a[2],2,st);if(!p||!_)return null;if(!ye(p.type,[G(Pt),Nt,Pt]))return h.error(`Expected first argument to be of type array or string, but found ${j(p.type)} instead`);if(a.length===4){const w=h.parse(a[3],3,st);return w?new Ue(p.type,p,_,w):null}return new Ue(p.type,p,_)}evaluate(a){const h=this.input.evaluate(a),p=this.beginIndex.evaluate(a);let _;if(this.endIndex&&(_=this.endIndex.evaluate(a)),Ee(h,["string"]))return[...h].slice(p,_).join("");if(Ee(h,["array"]))return h.slice(p,_);throw new Fi(`Expected first argument to be of type array or string, but found ${j(Di(h))} instead.`)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function qe(u,a){const h=u.length-1;let p,_,w=0,x=h,A=0;for(;w<=x;)if(A=Math.floor((w+x)/2),p=u[A],_=u[A+1],p<=a){if(A===h||a<_)return A;w=A+1}else{if(!(p>a))throw new Fi("Input is not a number.");x=A-1}return 0}class Ct{constructor(a,h,p){this.type=a,this.input=h,this.labels=[],this.outputs=[];for(const[_,w]of p)this.labels.push(_),this.outputs.push(w)}static parse(a,h){if(a.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");const p=h.parse(a[1],1,st);if(!p)return null;const _=[];let w=null;h.expectedType&&h.expectedType.kind!=="value"&&(w=h.expectedType);for(let x=1;x<a.length;x+=2){const A=x===1?-1/0:a[x],C=a[x+1],P=x,k=x+1;if(typeof A!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(_.length&&_[_.length-1][0]>=A)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const L=h.parse(C,k,w);if(!L)return null;w=w||L.type,_.push([A,L])}return new Ct(w,p,_)}evaluate(a){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(a);const _=this.input.evaluate(a);if(_<=h[0])return p[0].evaluate(a);const w=h.length;return _>=h[w-1]?p[w-1].evaluate(a):p[qe(h,_)].evaluate(a)}eachChild(a){a(this.input);for(const h of this.outputs)a(h)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function qt(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Ni=gs;function gs(u,a,h,p){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=a,this.p2x=h,this.p2y=p}gs.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,a){if(a===void 0&&(a=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,p=0;p<8;p++){var _=this.sampleCurveX(h)-u;if(Math.abs(_)<a)return h;var w=this.sampleCurveDerivativeX(h);if(Math.abs(w)<1e-6)break;h-=_/w}var x=0,A=1;for(h=u,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-u)<a));p++)u>_?x=h:A=h,h=.5*(A-x)+x;return h},solve:function(u,a){return this.sampleCurveY(this.solveCurveX(u,a))}};var ns=qt(Ni);function wr(u,a,h){return u+h*(a-u)}function Ec(u,a,h){return u.map((p,_)=>wr(p,a[_],h))}const _s={number:wr,color:function(u,a,h,p="rgb"){switch(p){case"rgb":{const[_,w,x,A]=Ec(u.rgb,a.rgb,h);return new ti(_,w,x,A,!1)}case"hcl":{const[_,w,x,A]=u.hcl,[C,P,k,L]=a.hcl;let U,$;if(isNaN(_)||isNaN(C))isNaN(_)?isNaN(C)?U=NaN:(U=C,x!==1&&x!==0||($=P)):(U=_,k!==1&&k!==0||($=w));else{let Me=C-_;C>_&&Me>180?Me-=360:C<_&&_-C>180&&(Me+=360),U=_+h*Me}const[J,Z,ae,he]=function([Me,ve,Se,Fe]){return Me=isNaN(Me)?0:Me*St,Ai([Se,Math.cos(Me)*ve,Math.sin(Me)*ve,Fe])}([U,$??wr(w,P,h),wr(x,k,h),wr(A,L,h)]);return new ti(J,Z,ae,he,!1)}case"lab":{const[_,w,x,A]=Ai(Ec(u.lab,a.lab,h));return new ti(_,w,x,A,!1)}}},array:Ec,padding:function(u,a,h){return new Hi(Ec(u.values,a.values,h))},variableAnchorOffsetCollection:function(u,a,h){const p=u.values,_=a.values;if(p.length!==_.length)throw new Fi(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${a.toString()}`);const w=[];for(let x=0;x<p.length;x+=2){if(p[x]!==_[x])throw new Fi(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${p[x]}, to[${x}]: ${_[x]}`);w.push(p[x]);const[A,C]=p[x+1],[P,k]=_[x+1];w.push([wr(A,P,h),wr(C,k,h)])}return new qi(w)}};class ys{constructor(a,h,p,_,w){this.type=a,this.operator=h,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[x,A]of w)this.labels.push(x),this.outputs.push(A)}static interpolationFactor(a,h,p,_){let w=0;if(a.name==="exponential")w=Bu(h,a.base,p,_);else if(a.name==="linear")w=Bu(h,1,p,_);else if(a.name==="cubic-bezier"){const x=a.controlPoints;w=new ns(x[0],x[1],x[2],x[3]).solve(Bu(h,1,p,_))}return w}static parse(a,h){let[p,_,w,...x]=a;if(!Array.isArray(_)||_.length===0)return h.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const P=_[1];if(typeof P!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:P}}else{if(_[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const P=_.slice(1);if(P.length!==4||P.some(k=>typeof k!="number"||k<0||k>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:P}}}if(a.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(w=h.parse(w,2,st),!w)return null;const A=[];let C=null;p==="interpolate-hcl"||p==="interpolate-lab"?C=Nr:h.expectedType&&h.expectedType.kind!=="value"&&(C=h.expectedType);for(let P=0;P<x.length;P+=2){const k=x[P],L=x[P+1],U=P+3,$=P+4;if(typeof k!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(A.length&&A[A.length-1][0]>=k)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const J=h.parse(L,$,C);if(!J)return null;C=C||J.type,A.push([k,J])}return Re(C,st)||Re(C,Nr)||Re(C,vn)||Re(C,ue)||Re(C,G(st))?new ys(C,p,_,w,A):h.error(`Type ${j(C)} is not interpolatable.`)}evaluate(a){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(a);const _=this.input.evaluate(a);if(_<=h[0])return p[0].evaluate(a);const w=h.length;if(_>=h[w-1])return p[w-1].evaluate(a);const x=qe(h,_),A=ys.interpolationFactor(this.interpolation,_,h[x],h[x+1]),C=p[x].evaluate(a),P=p[x+1].evaluate(a);switch(this.operator){case"interpolate":return _s[this.type.kind](C,P,A);case"interpolate-hcl":return _s.color(C,P,A,"hcl");case"interpolate-lab":return _s.color(C,P,A,"lab")}}eachChild(a){a(this.input);for(const h of this.outputs)a(h)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Bu(u,a,h,p){const _=p-h,w=u-h;return _===0?0:a===1?w/_:(Math.pow(a,w)-1)/(Math.pow(a,_)-1)}class Lu{constructor(a,h){this.type=a,this.args=h}static parse(a,h){if(a.length<2)return h.error("Expectected at least one argument.");let p=null;const _=h.expectedType;_&&_.kind!=="value"&&(p=_);const w=[];for(const A of a.slice(1)){const C=h.parse(A,1+w.length,p,void 0,{typeAnnotation:"omit"});if(!C)return null;p=p||C.type,w.push(C)}if(!p)throw new Error("No output type");const x=_&&w.some(A=>oe(_,A.type));return new Lu(x?Pt:p,w)}evaluate(a){let h,p=null,_=0;for(const w of this.args)if(_++,p=w.evaluate(a),p&&p instanceof Wi&&!p.available&&(h||(h=p.name),p=null,_===this.args.length&&(p=h)),p!==null)break;return p}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}function Ou(u,a){return u==="=="||u==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Gm(u,a,h,p){return p.compare(a,h)===0}function rl(u,a,h){const p=u!=="=="&&u!=="!=";return class WM{constructor(w,x,A){this.type=Mt,this.lhs=w,this.rhs=x,this.collator=A,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const A=w[0];let C=x.parse(w[1],1,Pt);if(!C)return null;if(!Ou(A,C.type))return x.concat(1).error(`"${A}" comparisons are not supported for type '${j(C.type)}'.`);let P=x.parse(w[2],2,Pt);if(!P)return null;if(!Ou(A,P.type))return x.concat(2).error(`"${A}" comparisons are not supported for type '${j(P.type)}'.`);if(C.type.kind!==P.type.kind&&C.type.kind!=="value"&&P.type.kind!=="value")return x.error(`Cannot compare types '${j(C.type)}' and '${j(P.type)}'.`);p&&(C.type.kind==="value"&&P.type.kind!=="value"?C=new ss(P.type,[C]):C.type.kind!=="value"&&P.type.kind==="value"&&(P=new ss(C.type,[P])));let k=null;if(w.length===4){if(C.type.kind!=="string"&&P.type.kind!=="string"&&C.type.kind!=="value"&&P.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(k=x.parse(w[3],3,Ks),!k)return null}return new WM(C,P,k)}evaluate(w){const x=this.lhs.evaluate(w),A=this.rhs.evaluate(w);if(p&&this.hasUntypedArgument){const C=Di(x),P=Di(A);if(C.kind!==P.kind||C.kind!=="string"&&C.kind!=="number")throw new Fi(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${C.kind}, ${P.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const C=Di(x),P=Di(A);if(C.kind!=="string"||P.kind!=="string")return a(w,x,A)}return this.collator?h(w,x,A,this.collator.evaluate(w)):a(w,x,A)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const W1=rl("==",function(u,a,h){return a===h},Gm),Vm=rl("!=",function(u,a,h){return a!==h},function(u,a,h,p){return!Gm(0,a,h,p)}),$m=rl("<",function(u,a,h){return a<h},function(u,a,h,p){return p.compare(a,h)<0}),X1=rl(">",function(u,a,h){return a>h},function(u,a,h,p){return p.compare(a,h)>0}),K1=rl("<=",function(u,a,h){return a<=h},function(u,a,h,p){return p.compare(a,h)<=0}),Hm=rl(">=",function(u,a,h){return a>=h},function(u,a,h,p){return p.compare(a,h)>=0});class Ac{constructor(a,h,p){this.type=Ks,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=h}static parse(a,h){if(a.length!==2)return h.error("Expected one argument.");const p=a[1];if(typeof p!="object"||Array.isArray(p))return h.error("Collator options argument must be an object.");const _=h.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Mt);if(!_)return null;const w=h.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Mt);if(!w)return null;let x=null;return p.locale&&(x=h.parse(p.locale,1,Nt),!x)?null:new Ac(_,w,x)}evaluate(a){return new Ur(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}class Xd{constructor(a,h,p,_,w){this.type=Nt,this.number=a,this.locale=h,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=w}static parse(a,h){if(a.length!==3)return h.error("Expected two arguments.");const p=h.parse(a[1],1,st);if(!p)return null;const _=a[2];if(typeof _!="object"||Array.isArray(_))return h.error("NumberFormat options argument must be an object.");let w=null;if(_.locale&&(w=h.parse(_.locale,1,Nt),!w))return null;let x=null;if(_.currency&&(x=h.parse(_.currency,1,Nt),!x))return null;let A=null;if(_["min-fraction-digits"]&&(A=h.parse(_["min-fraction-digits"],1,st),!A))return null;let C=null;return _["max-fraction-digits"]&&(C=h.parse(_["max-fraction-digits"],1,st),!C)?null:new Xd(p,w,x,A,C)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class Du{constructor(a){this.type=yn,this.sections=a}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");const p=a[1];if(!Array.isArray(p)&&typeof p=="object")return h.error("First argument must be an image or text section.");const _=[];let w=!1;for(let x=1;x<=a.length-1;++x){const A=a[x];if(w&&typeof A=="object"&&!Array.isArray(A)){w=!1;let C=null;if(A["font-scale"]&&(C=h.parse(A["font-scale"],1,st),!C))return null;let P=null;if(A["text-font"]&&(P=h.parse(A["text-font"],1,G(Nt)),!P))return null;let k=null;if(A["text-color"]&&(k=h.parse(A["text-color"],1,Nr),!k))return null;const L=_[_.length-1];L.scale=C,L.font=P,L.textColor=k}else{const C=h.parse(a[x],1,Pt);if(!C)return null;const P=C.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,_.push({content:C,scale:null,font:null,textColor:null})}}return new Du(_)}evaluate(a){return new Yi(this.sections.map(h=>{const p=h.content.evaluate(a);return Di(p)===Fs?new $n("",p,null,null,null):new $n(Rr(p),null,h.scale?h.scale.evaluate(a):null,h.font?h.font.evaluate(a).join(","):null,h.textColor?h.textColor.evaluate(a):null)}))}eachChild(a){for(const h of this.sections)a(h.content),h.scale&&a(h.scale),h.font&&a(h.font),h.textColor&&a(h.textColor)}outputDefined(){return!1}}class Kd{constructor(a){this.type=Fs,this.input=a}static parse(a,h){if(a.length!==2)return h.error("Expected two arguments.");const p=h.parse(a[1],1,Nt);return p?new Kd(p):h.error("No image name provided.")}evaluate(a){const h=this.input.evaluate(a),p=Wi.fromString(h);return p&&a.availableImages&&(p.available=a.availableImages.indexOf(h)>-1),p}eachChild(a){a(this.input)}outputDefined(){return!1}}class Jd{constructor(a){this.type=st,this.input=a}static parse(a,h){if(a.length!==2)return h.error(`Expected 1 argument, but found ${a.length-1} instead.`);const p=h.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${j(p.type)} instead.`):new Jd(p):null}evaluate(a){const h=this.input.evaluate(a);if(typeof h=="string")return[...h].length;if(Array.isArray(h))return h.length;throw new Fi(`Expected value to be of type string or array, but found ${j(Di(h))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const Xn=8192;function J1(u,a){const h=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,_=Math.pow(2,a.z);return[Math.round(h*_*Xn),Math.round(p*_*Xn)]}function Zd(u,a){const h=Math.pow(2,a.z);return[(_=(u[0]/Xn+a.x)/h,360*_-180),(p=(u[1]/Xn+a.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,_}function va(u,a){u[0]=Math.min(u[0],a[0]),u[1]=Math.min(u[1],a[1]),u[2]=Math.max(u[2],a[0]),u[3]=Math.max(u[3],a[1])}function qo(u,a){return!(u[0]<=a[0]||u[2]>=a[2]||u[1]<=a[1]||u[3]>=a[3])}function ui(u,a,h){const p=u[0]-a[0],_=u[1]-a[1],w=u[0]-h[0],x=u[1]-h[1];return p*x-w*_==0&&p*w<=0&&_*x<=0}function Fu(u,a,h,p){return(_=[p[0]-h[0],p[1]-h[1]])[0]*(w=[a[0]-u[0],a[1]-u[1]])[1]-_[1]*w[0]!=0&&!(!Wm(u,a,h,p)||!Wm(h,p,u,a));var _,w}function Z1(u,a,h){for(const p of h)for(let _=0;_<p.length-1;++_)if(Fu(u,a,p[_],p[_+1]))return!0;return!1}function sl(u,a,h=!1){let p=!1;for(const A of a)for(let C=0;C<A.length-1;C++){if(ui(u,A[C],A[C+1]))return h;(w=A[C])[1]>(_=u)[1]!=(x=A[C+1])[1]>_[1]&&_[0]<(x[0]-w[0])*(_[1]-w[1])/(x[1]-w[1])+w[0]&&(p=!p)}var _,w,x;return p}function Y1(u,a){for(const h of a)if(sl(u,h))return!0;return!1}function qm(u,a){for(const h of u)if(!sl(h,a))return!1;for(let h=0;h<u.length-1;++h)if(Z1(u[h],u[h+1],a))return!1;return!0}function Q1(u,a){for(const h of a)if(qm(u,h))return!0;return!1}function Wm(u,a,h,p){const _=p[0]-h[0],w=p[1]-h[1],x=(u[0]-h[0])*w-_*(u[1]-h[1]),A=(a[0]-h[0])*w-_*(a[1]-h[1]);return x>0&&A<0||x<0&&A>0}function Yd(u,a,h){const p=[];for(let _=0;_<u.length;_++){const w=[];for(let x=0;x<u[_].length;x++){const A=J1(u[_][x],h);va(a,A),w.push(A)}p.push(w)}return p}function Xm(u,a,h){const p=[];for(let _=0;_<u.length;_++){const w=Yd(u[_],a,h);p.push(w)}return p}function Km(u,a,h,p){if(u[0]<h[0]||u[0]>h[2]){const _=.5*p;let w=u[0]-h[0]>_?-p:h[0]-u[0]>_?p:0;w===0&&(w=u[0]-h[2]>_?-p:h[2]-u[0]>_?p:0),u[0]+=w}va(a,u)}function Jm(u,a,h,p){const _=Math.pow(2,p.z)*Xn,w=[p.x*Xn,p.y*Xn],x=[];for(const A of u)for(const C of A){const P=[C.x+w[0],C.y+w[1]];Km(P,a,h,_),x.push(P)}return x}function Zm(u,a,h,p){const _=Math.pow(2,p.z)*Xn,w=[p.x*Xn,p.y*Xn],x=[];for(const C of u){const P=[];for(const k of C){const L=[k.x+w[0],k.y+w[1]];va(a,L),P.push(L)}x.push(P)}if(a[2]-a[0]<=_/2){(A=a)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const C of x)for(const P of C)Km(P,a,h,_)}var A;return x}class ba{constructor(a,h){this.type=Mt,this.geojson=a,this.geometries=h}static parse(a,h){if(a.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Hn(a[1])){const p=a[1];if(p.type==="FeatureCollection"){const _=[];for(const w of p.features){const{type:x,coordinates:A}=w.geometry;x==="Polygon"&&_.push(A),x==="MultiPolygon"&&_.push(...A)}if(_.length)return new ba(p,{type:"MultiPolygon",coordinates:_})}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ba(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ba(p,p)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(h,p){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=h.canonicalID();if(p.type==="Polygon"){const A=Yd(p.coordinates,w,x),C=Jm(h.geometry(),_,w,x);if(!qo(_,w))return!1;for(const P of C)if(!sl(P,A))return!1}if(p.type==="MultiPolygon"){const A=Xm(p.coordinates,w,x),C=Jm(h.geometry(),_,w,x);if(!qo(_,w))return!1;for(const P of C)if(!Y1(P,A))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(h,p){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=h.canonicalID();if(p.type==="Polygon"){const A=Yd(p.coordinates,w,x),C=Zm(h.geometry(),_,w,x);if(!qo(_,w))return!1;for(const P of C)if(!qm(P,A))return!1}if(p.type==="MultiPolygon"){const A=Xm(p.coordinates,w,x),C=Zm(h.geometry(),_,w,x);if(!qo(_,w))return!1;for(const P of C)if(!Q1(P,A))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ym=class{constructor(u=[],a=(h,p)=>h<p?-1:h>p?1:0){if(this.data=u,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:a,compare:h}=this,p=a[u];for(;u>0;){const _=u-1>>1,w=a[_];if(h(p,w)>=0)break;a[u]=w,u=_}a[u]=p}_down(u){const{data:a,compare:h}=this,p=this.length>>1,_=a[u];for(;u<p;){let w=1+(u<<1);const x=w+1;if(x<this.length&&h(a[x],a[w])<0&&(w=x),h(a[w],_)>=0)break;a[u]=a[w],u=w}a[u]=_}};function ey(u,a,h,p,_){Qm(u,a,h,p||u.length-1,_||ty)}function Qm(u,a,h,p,_){for(;p>h;){if(p-h>600){var w=p-h+1,x=a-h+1,A=Math.log(w),C=.5*Math.exp(2*A/3),P=.5*Math.sqrt(A*C*(w-C)/w)*(x-w/2<0?-1:1);Qm(u,a,Math.max(h,Math.floor(a-x*C/w+P)),Math.min(p,Math.floor(a+(w-x)*C/w+P)),_)}var k=u[a],L=h,U=p;for(Tc(u,h,a),_(u[p],k)>0&&Tc(u,h,p);L<U;){for(Tc(u,L,U),L++,U--;_(u[L],k)<0;)L++;for(;_(u[U],k)>0;)U--}_(u[h],k)===0?Tc(u,h,U):Tc(u,++U,p),U<=a&&(h=U+1),a<=U&&(p=U-1)}}function Tc(u,a,h){var p=u[a];u[a]=u[h],u[h]=p}function ty(u,a){return u<a?-1:u>a?1:0}function Nu(u,a){if(u.length<=1)return[u];const h=[];let p,_;for(const w of u){const x=ry(w);x!==0&&(w.area=Math.abs(x),_===void 0&&(_=x<0),_===x<0?(p&&h.push(p),p=[w]):p.push(w))}if(p&&h.push(p),a>1)for(let w=0;w<h.length;w++)h[w].length<=a||(ey(h[w],a,1,h[w].length-1,iy),h[w]=h[w].slice(0,a));return h}function iy(u,a){return a.area-u.area}function ry(u){let a=0;for(let h,p,_=0,w=u.length,x=w-1;_<w;x=_++)h=u[_],p=u[x],a+=(p.x-h.x)*(h.y+p.y);return a}const eg=1/298.257223563,tg=eg*(2-eg),ig=Math.PI/180;class Qd{constructor(a){const h=6378.137*ig*1e3,p=Math.cos(a*ig),_=1/(1-tg*(1-p*p)),w=Math.sqrt(_);this.kx=h*w*p,this.ky=h*w*_*(1-tg)}distance(a,h){const p=this.wrap(a[0]-h[0])*this.kx,_=(a[1]-h[1])*this.ky;return Math.sqrt(p*p+_*_)}pointOnLine(a,h){let p,_,w,x,A=1/0;for(let C=0;C<a.length-1;C++){let P=a[C][0],k=a[C][1],L=this.wrap(a[C+1][0]-P)*this.kx,U=(a[C+1][1]-k)*this.ky,$=0;L===0&&U===0||($=(this.wrap(h[0]-P)*this.kx*L+(h[1]-k)*this.ky*U)/(L*L+U*U),$>1?(P=a[C+1][0],k=a[C+1][1]):$>0&&(P+=L/this.kx*$,k+=U/this.ky*$)),L=this.wrap(h[0]-P)*this.kx,U=(h[1]-k)*this.ky;const J=L*L+U*U;J<A&&(A=J,p=P,_=k,w=C,x=$)}return{point:[p,_],index:w,t:Math.max(0,Math.min(1,x))}}wrap(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}}function rg(u,a){return a[0]-u[0]}function Uu(u){return u[1]-u[0]+1}function mo(u,a){return u[1]>=u[0]&&u[1]<a}function ep(u,a){if(u[0]>u[1])return[null,null];const h=Uu(u);if(a){if(h===2)return[u,null];const _=Math.floor(h/2);return[[u[0],u[0]+_],[u[0]+_,u[1]]]}if(h===1)return[u,null];const p=Math.floor(h/2)-1;return[[u[0],u[0]+p],[u[0]+p+1,u[1]]]}function tp(u,a){if(!mo(a,u.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let p=a[0];p<=a[1];++p)va(h,u[p]);return h}function ip(u){const a=[1/0,1/0,-1/0,-1/0];for(const h of u)for(const p of h)va(a,p);return a}function zu(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function rp(u,a,h){if(!zu(u)||!zu(a))return NaN;let p=0,_=0;return u[2]<a[0]&&(p=a[0]-u[2]),u[0]>a[2]&&(p=u[0]-a[2]),u[1]>a[3]&&(_=u[1]-a[3]),u[3]<a[1]&&(_=a[1]-u[3]),h.distance([0,0],[p,_])}function wa(u,a,h){const p=h.pointOnLine(a,u);return h.distance(u,p.point)}function sp(u,a,h,p,_){const w=Math.min(wa(u,[h,p],_),wa(a,[h,p],_)),x=Math.min(wa(h,[u,a],_),wa(p,[u,a],_));return Math.min(w,x)}function sy(u,a,h,p,_){if(!mo(a,u.length)||!mo(p,h.length))return 1/0;let w=1/0;for(let x=a[0];x<a[1];++x){const A=u[x],C=u[x+1];for(let P=p[0];P<p[1];++P){const k=h[P],L=h[P+1];if(Fu(A,C,k,L))return 0;w=Math.min(w,sp(A,C,k,L,_))}}return w}function Qi(u,a,h,p,_){if(!mo(a,u.length)||!mo(p,h.length))return NaN;let w=1/0;for(let x=a[0];x<=a[1];++x)for(let A=p[0];A<=p[1];++A)if(w=Math.min(w,_.distance(u[x],h[A])),w===0)return w;return w}function ny(u,a,h){if(sl(u,a,!0))return 0;let p=1/0;for(const _ of a){const w=_[0],x=_[_.length-1];if(w!==x&&(p=Math.min(p,wa(u,[x,w],h)),p===0))return p;const A=h.pointOnLine(_,u);if(p=Math.min(p,h.distance(u,A.point)),p===0)return p}return p}function Vt(u,a,h,p){if(!mo(a,u.length))return NaN;for(let w=a[0];w<=a[1];++w)if(sl(u[w],h,!0))return 0;let _=1/0;for(let w=a[0];w<a[1];++w){const x=u[w],A=u[w+1];for(const C of h)for(let P=0,k=C.length,L=k-1;P<k;L=P++){const U=C[L],$=C[P];if(Fu(x,A,U,$))return 0;_=Math.min(_,sp(x,A,U,$,p))}}return _}function ju(u,a){for(const h of u)for(const p of h)if(sl(p,a,!0))return!0;return!1}function Ti(u,a,h,p=1/0){const _=ip(u),w=ip(a);if(p!==1/0&&rp(_,w,h)>=p)return p;if(qo(_,w)){if(ju(u,a))return 0}else if(ju(a,u))return 0;let x=1/0;for(const A of u)for(let C=0,P=A.length,k=P-1;C<P;k=C++){const L=A[k],U=A[C];for(const $ of a)for(let J=0,Z=$.length,ae=Z-1;J<Z;ae=J++){const he=$[ae],Me=$[J];if(Fu(L,U,he,Me))return 0;x=Math.min(x,sp(L,U,he,Me,h))}}return x}function gi(u,a,h,p,_,w){if(!w)return;const x=rp(tp(p,w),_,h);x<a&&u.push([x,w,[0,0]])}function xa(u,a,h,p,_,w,x){if(!w||!x)return;const A=rp(tp(p,w),tp(_,x),h);A<a&&u.push([A,w,x])}function Sc(u,a,h,p,_=1/0){let w=Math.min(p.distance(u[0],h[0][0]),_);if(w===0)return w;const x=new Ym([[0,[0,u.length-1],[0,0]]],rg),A=ip(h);for(;x.length>0;){const C=x.pop();if(C[0]>=w)continue;const P=C[1],k=a?50:100;if(Uu(P)<=k){if(!mo(P,u.length))return NaN;if(a){const L=Vt(u,P,h,p);if(isNaN(L)||L===0)return L;w=Math.min(w,L)}else for(let L=P[0];L<=P[1];++L){const U=ny(u[L],h,p);if(w=Math.min(w,U),w===0)return 0}}else{const L=ep(P,a);gi(x,w,p,u,A,L[0]),gi(x,w,p,u,A,L[1])}}return w}function Cc(u,a,h,p,_,w=1/0){let x=Math.min(w,_.distance(u[0],h[0]));if(x===0)return x;const A=new Ym([[0,[0,u.length-1],[0,h.length-1]]],rg);for(;A.length>0;){const C=A.pop();if(C[0]>=x)continue;const P=C[1],k=C[2],L=a?50:100,U=p?50:100;if(Uu(P)<=L&&Uu(k)<=U){if(!mo(P,u.length)&&mo(k,h.length))return NaN;let $;if(a&&p)$=sy(u,P,h,k,_),x=Math.min(x,$);else if(a&&!p){const J=u.slice(P[0],P[1]+1);for(let Z=k[0];Z<=k[1];++Z)if($=wa(h[Z],J,_),x=Math.min(x,$),x===0)return x}else if(!a&&p){const J=h.slice(k[0],k[1]+1);for(let Z=P[0];Z<=P[1];++Z)if($=wa(u[Z],J,_),x=Math.min(x,$),x===0)return x}else $=Qi(u,P,h,k,_),x=Math.min(x,$)}else{const $=ep(P,a),J=ep(k,p);xa(A,x,_,u,h,$[0],J[0]),xa(A,x,_,u,h,$[0],J[1]),xa(A,x,_,u,h,$[1],J[0]),xa(A,x,_,u,h,$[1],J[1])}}return x}function np(u){return u.type==="MultiPolygon"?u.coordinates.map(a=>({type:"Polygon",coordinates:a})):u.type==="MultiLineString"?u.coordinates.map(a=>({type:"LineString",coordinates:a})):u.type==="MultiPoint"?u.coordinates.map(a=>({type:"Point",coordinates:a})):[u]}class Ea{constructor(a,h){this.type=st,this.geojson=a,this.geometries=h}static parse(a,h){if(a.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Hn(a[1])){const p=a[1];if(p.type==="FeatureCollection")return new Ea(p,p.features.map(_=>np(_.geometry)).flat());if(p.type==="Feature")return new Ea(p,np(p.geometry));if("type"in p&&"coordinates"in p)return new Ea(p,np(p))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(h,p){const _=h.geometry(),w=_.flat().map(C=>Zd([C.x,C.y],h.canonical));if(_.length===0)return NaN;const x=new Qd(w[0][1]);let A=1/0;for(const C of p){switch(C.type){case"Point":A=Math.min(A,Cc(w,!1,[C.coordinates],!1,x,A));break;case"LineString":A=Math.min(A,Cc(w,!1,C.coordinates,!0,x,A));break;case"Polygon":A=Math.min(A,Sc(w,!1,C.coordinates,x,A))}if(A===0)return A}return A}(a,this.geometries);if(a.geometryType()==="LineString")return function(h,p){const _=h.geometry(),w=_.flat().map(C=>Zd([C.x,C.y],h.canonical));if(_.length===0)return NaN;const x=new Qd(w[0][1]);let A=1/0;for(const C of p){switch(C.type){case"Point":A=Math.min(A,Cc(w,!0,[C.coordinates],!1,x,A));break;case"LineString":A=Math.min(A,Cc(w,!0,C.coordinates,!0,x,A));break;case"Polygon":A=Math.min(A,Sc(w,!0,C.coordinates,x,A))}if(A===0)return A}return A}(a,this.geometries);if(a.geometryType()==="Polygon")return function(h,p){const _=h.geometry();if(_.length===0||_[0].length===0)return NaN;const w=Nu(_,0).map(C=>C.map(P=>P.map(k=>Zd([k.x,k.y],h.canonical)))),x=new Qd(w[0][0][0][1]);let A=1/0;for(const C of p)for(const P of w){switch(C.type){case"Point":A=Math.min(A,Sc([C.coordinates],!1,P,x,A));break;case"LineString":A=Math.min(A,Sc(C.coordinates,!0,P,x,A));break;case"Polygon":A=Math.min(A,Ti(P,C.coordinates,x,A))}if(A===0)return A}return A}(a,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const nl={"==":W1,"!=":Vm,">":X1,"<":$m,">=":Hm,"<=":K1,array:ss,at:wc,boolean:ss,case:_e,coalesce:Lu,collator:Ac,format:Du,image:Kd,in:xc,"index-of":K,interpolate:ys,"interpolate-hcl":ys,"interpolate-lab":ys,length:Jd,let:Js,literal:zr,match:ie,number:ss,"number-format":Xd,object:ss,slice:Ue,step:Ct,string:ss,"to-boolean":jr,"to-color":jr,"to-number":jr,"to-string":jr,var:ei,within:ba,distance:Ea};class Zs{constructor(a,h,p,_){this.name=a,this.type=h,this._evaluate=p,this.args=_}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,h){const p=a[0],_=Zs.definitions[p];if(!_)return h.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(_)?_[0]:_.type,x=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,A=x.filter(([P])=>!Array.isArray(P)||P.length===a.length-1);let C=null;for(const[P,k]of A){C=new Wn(h.registry,Ic,h.path,null,h.scope);const L=[];let U=!1;for(let $=1;$<a.length;$++){const J=a[$],Z=Array.isArray(P)?P[$-1]:P.type,ae=C.parse(J,1+L.length,Z);if(!ae){U=!0;break}L.push(ae)}if(!U)if(Array.isArray(P)&&P.length!==L.length)C.error(`Expected ${P.length} arguments, but found ${L.length} instead.`);else{for(let $=0;$<L.length;$++){const J=Array.isArray(P)?P[$]:P.type,Z=L[$];C.concat($+1).checkSubtype(J,Z.type)}if(C.errors.length===0)return new Zs(p,w,k,L)}}if(A.length===1)h.errors.push(...C.errors);else{const P=(A.length?A:x).map(([L])=>{return U=L,Array.isArray(U)?`(${U.map(j).join(", ")})`:`(${j(U.type)}...)`;var U}).join(" | "),k=[];for(let L=1;L<a.length;L++){const U=h.parse(a[L],1+k.length);if(!U)return null;k.push(j(U.type))}h.error(`Expected arguments of type ${P}, but found (${k.join(", ")}) instead.`)}return null}static register(a,h){Zs.definitions=h;for(const p in h)a[p]=Zs}}function op(u,[a,h,p,_]){a=a.evaluate(u),h=h.evaluate(u),p=p.evaluate(u);const w=_?_.evaluate(u):1,x=fo(a,h,p,w);if(x)throw new Fi(x);return new ti(a/255,h/255,p/255,w,!1)}function ap(u,a){return u in a}function lp(u,a){const h=a[u];return h===void 0?null:h}function Aa(u){return{type:u}}function Ic(u){if(u instanceof ei)return Ic(u.boundExpression);if(u instanceof Zs&&u.name==="error"||u instanceof Ac||u instanceof ba||u instanceof Ea)return!1;const a=u instanceof jr||u instanceof ss;let h=!0;return u.eachChild(p=>{h=a?h&&Ic(p):h&&p instanceof zr}),!!h&&Rc(u)&&Mc(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Rc(u){if(u instanceof Zs&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof ba||u instanceof Ea)return!1;let a=!0;return u.eachChild(h=>{a&&!Rc(h)&&(a=!1)}),a}function ol(u){if(u instanceof Zs&&u.name==="feature-state")return!1;let a=!0;return u.eachChild(h=>{a&&!ol(h)&&(a=!1)}),a}function Mc(u,a){if(u instanceof Zs&&a.indexOf(u.name)>=0)return!1;let h=!0;return u.eachChild(p=>{h&&!Mc(p,a)&&(h=!1)}),h}function Gu(u){return{result:"success",value:u}}function al(u){return{result:"error",value:u}}function ll(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function sg(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function cp(u){return!!u.expression&&u.expression.interpolated}function ni(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Vu(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function oy(u){return u}function ng(u,a){const h=a.type==="color",p=u.stops&&typeof u.stops[0][0]=="object",_=p||!(p||u.property!==void 0),w=u.type||(cp(a)?"exponential":"interval");if(h||a.type==="padding"){const k=h?ti.parse:Hi.parse;(u=Os({},u)).stops&&(u.stops=u.stops.map(L=>[L[0],k(L[1])])),u.default=k(u.default?u.default:a.default)}if(u.colorSpace&&(x=u.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var x;let A,C,P;if(w==="exponential")A=ag;else if(w==="interval")A=$u;else if(w==="categorical"){A=og,C=Object.create(null);for(const k of u.stops)C[k[0]]=k[1];P=typeof u.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);A=lg}if(p){const k={},L=[];for(let J=0;J<u.stops.length;J++){const Z=u.stops[J],ae=Z[0].zoom;k[ae]===void 0&&(k[ae]={zoom:ae,type:u.type,property:u.property,default:u.default,stops:[]},L.push(ae)),k[ae].stops.push([Z[0].value,Z[1]])}const U=[];for(const J of L)U.push([k[J].zoom,ng(k[J],a)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:ys.interpolationFactor.bind(void 0,$),zoomStops:U.map(J=>J[0]),evaluate:({zoom:J},Z)=>ag({stops:U,base:u.base},a,J).evaluate(J,Z)}}if(_){const k=w==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:ys.interpolationFactor.bind(void 0,k),zoomStops:u.stops.map(L=>L[0]),evaluate:({zoom:L})=>A(u,a,L,C,P)}}return{kind:"source",evaluate(k,L){const U=L&&L.properties?L.properties[u.property]:void 0;return U===void 0?cl(u.default,a.default):A(u,a,U,C,P)}}}function cl(u,a,h){return u!==void 0?u:a!==void 0?a:h!==void 0?h:void 0}function og(u,a,h,p,_){return cl(typeof h===_?p[h]:void 0,u.default,a.default)}function $u(u,a,h){if(ni(h)!=="number")return cl(u.default,a.default);const p=u.stops.length;if(p===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[p-1][0])return u.stops[p-1][1];const _=qe(u.stops.map(w=>w[0]),h);return u.stops[_][1]}function ag(u,a,h){const p=u.base!==void 0?u.base:1;if(ni(h)!=="number")return cl(u.default,a.default);const _=u.stops.length;if(_===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[_-1][0])return u.stops[_-1][1];const w=qe(u.stops.map(k=>k[0]),h),x=function(k,L,U,$){const J=$-U,Z=k-U;return J===0?0:L===1?Z/J:(Math.pow(L,Z)-1)/(Math.pow(L,J)-1)}(h,p,u.stops[w][0],u.stops[w+1][0]),A=u.stops[w][1],C=u.stops[w+1][1],P=_s[a.type]||oy;return typeof A.evaluate=="function"?{evaluate(...k){const L=A.evaluate.apply(void 0,k),U=C.evaluate.apply(void 0,k);if(L!==void 0&&U!==void 0)return P(L,U,x,u.colorSpace)}}:P(A,C,x,u.colorSpace)}function lg(u,a,h){switch(a.type){case"color":h=ti.parse(h);break;case"formatted":h=Yi.fromString(h.toString());break;case"resolvedImage":h=Wi.fromString(h.toString());break;case"padding":h=Hi.parse(h);break;default:ni(h)===a.type||a.type==="enum"&&a.values[h]||(h=void 0)}return cl(h,u.default,a.default)}Zs.register(nl,{error:[{kind:"error"},[Nt],(u,[a])=>{throw new Fi(a.evaluate(u))}],typeof:[Nt,[Pt],(u,[a])=>j(Di(a.evaluate(u)))],"to-rgba":[G(st,4),[Nr],(u,[a])=>{const[h,p,_,w]=a.evaluate(u).rgb;return[255*h,255*p,255*_,w]}],rgb:[Nr,[st,st,st],op],rgba:[Nr,[st,st,st,st],op],has:{type:Mt,overloads:[[[Nt],(u,[a])=>ap(a.evaluate(u),u.properties())],[[Nt,Ds],(u,[a,h])=>ap(a.evaluate(u),h.evaluate(u))]]},get:{type:Pt,overloads:[[[Nt],(u,[a])=>lp(a.evaluate(u),u.properties())],[[Nt,Ds],(u,[a,h])=>lp(a.evaluate(u),h.evaluate(u))]]},"feature-state":[Pt,[Nt],(u,[a])=>lp(a.evaluate(u),u.featureState||{})],properties:[Ds,[],u=>u.properties()],"geometry-type":[Nt,[],u=>u.geometryType()],id:[Pt,[],u=>u.id()],zoom:[st,[],u=>u.globals.zoom],"heatmap-density":[st,[],u=>u.globals.heatmapDensity||0],"line-progress":[st,[],u=>u.globals.lineProgress||0],accumulated:[Pt,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[st,Aa(st),(u,a)=>{let h=0;for(const p of a)h+=p.evaluate(u);return h}],"*":[st,Aa(st),(u,a)=>{let h=1;for(const p of a)h*=p.evaluate(u);return h}],"-":{type:st,overloads:[[[st,st],(u,[a,h])=>a.evaluate(u)-h.evaluate(u)],[[st],(u,[a])=>-a.evaluate(u)]]},"/":[st,[st,st],(u,[a,h])=>a.evaluate(u)/h.evaluate(u)],"%":[st,[st,st],(u,[a,h])=>a.evaluate(u)%h.evaluate(u)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(u,[a,h])=>Math.pow(a.evaluate(u),h.evaluate(u))],sqrt:[st,[st],(u,[a])=>Math.sqrt(a.evaluate(u))],log10:[st,[st],(u,[a])=>Math.log(a.evaluate(u))/Math.LN10],ln:[st,[st],(u,[a])=>Math.log(a.evaluate(u))],log2:[st,[st],(u,[a])=>Math.log(a.evaluate(u))/Math.LN2],sin:[st,[st],(u,[a])=>Math.sin(a.evaluate(u))],cos:[st,[st],(u,[a])=>Math.cos(a.evaluate(u))],tan:[st,[st],(u,[a])=>Math.tan(a.evaluate(u))],asin:[st,[st],(u,[a])=>Math.asin(a.evaluate(u))],acos:[st,[st],(u,[a])=>Math.acos(a.evaluate(u))],atan:[st,[st],(u,[a])=>Math.atan(a.evaluate(u))],min:[st,Aa(st),(u,a)=>Math.min(...a.map(h=>h.evaluate(u)))],max:[st,Aa(st),(u,a)=>Math.max(...a.map(h=>h.evaluate(u)))],abs:[st,[st],(u,[a])=>Math.abs(a.evaluate(u))],round:[st,[st],(u,[a])=>{const h=a.evaluate(u);return h<0?-Math.round(-h):Math.round(h)}],floor:[st,[st],(u,[a])=>Math.floor(a.evaluate(u))],ceil:[st,[st],(u,[a])=>Math.ceil(a.evaluate(u))],"filter-==":[Mt,[Nt,Pt],(u,[a,h])=>u.properties()[a.value]===h.value],"filter-id-==":[Mt,[Pt],(u,[a])=>u.id()===a.value],"filter-type-==":[Mt,[Nt],(u,[a])=>u.geometryType()===a.value],"filter-<":[Mt,[Nt,Pt],(u,[a,h])=>{const p=u.properties()[a.value],_=h.value;return typeof p==typeof _&&p<_}],"filter-id-<":[Mt,[Pt],(u,[a])=>{const h=u.id(),p=a.value;return typeof h==typeof p&&h<p}],"filter->":[Mt,[Nt,Pt],(u,[a,h])=>{const p=u.properties()[a.value],_=h.value;return typeof p==typeof _&&p>_}],"filter-id->":[Mt,[Pt],(u,[a])=>{const h=u.id(),p=a.value;return typeof h==typeof p&&h>p}],"filter-<=":[Mt,[Nt,Pt],(u,[a,h])=>{const p=u.properties()[a.value],_=h.value;return typeof p==typeof _&&p<=_}],"filter-id-<=":[Mt,[Pt],(u,[a])=>{const h=u.id(),p=a.value;return typeof h==typeof p&&h<=p}],"filter->=":[Mt,[Nt,Pt],(u,[a,h])=>{const p=u.properties()[a.value],_=h.value;return typeof p==typeof _&&p>=_}],"filter-id->=":[Mt,[Pt],(u,[a])=>{const h=u.id(),p=a.value;return typeof h==typeof p&&h>=p}],"filter-has":[Mt,[Pt],(u,[a])=>a.value in u.properties()],"filter-has-id":[Mt,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[Mt,[G(Nt)],(u,[a])=>a.value.indexOf(u.geometryType())>=0],"filter-id-in":[Mt,[G(Pt)],(u,[a])=>a.value.indexOf(u.id())>=0],"filter-in-small":[Mt,[Nt,G(Pt)],(u,[a,h])=>h.value.indexOf(u.properties()[a.value])>=0],"filter-in-large":[Mt,[Nt,G(Pt)],(u,[a,h])=>function(p,_,w,x){for(;w<=x;){const A=w+x>>1;if(_[A]===p)return!0;_[A]>p?x=A-1:w=A+1}return!1}(u.properties()[a.value],h.value,0,h.value.length-1)],all:{type:Mt,overloads:[[[Mt,Mt],(u,[a,h])=>a.evaluate(u)&&h.evaluate(u)],[Aa(Mt),(u,a)=>{for(const h of a)if(!h.evaluate(u))return!1;return!0}]]},any:{type:Mt,overloads:[[[Mt,Mt],(u,[a,h])=>a.evaluate(u)||h.evaluate(u)],[Aa(Mt),(u,a)=>{for(const h of a)if(h.evaluate(u))return!0;return!1}]]},"!":[Mt,[Mt],(u,[a])=>!a.evaluate(u)],"is-supported-script":[Mt,[Nt],(u,[a])=>{const h=u.globals&&u.globals.isSupportedScript;return!h||h(a.evaluate(u))}],upcase:[Nt,[Nt],(u,[a])=>a.evaluate(u).toUpperCase()],downcase:[Nt,[Nt],(u,[a])=>a.evaluate(u).toLowerCase()],concat:[Nt,Aa(Pt),(u,a)=>a.map(h=>Rr(h.evaluate(u))).join("")],"resolved-locale":[Nt,[Ks],(u,[a])=>a.evaluate(u).resolvedLocale()]});class Hu{constructor(a,h){var p;this.expression=a,this._warningHistory={},this._evaluator=new il,this._defaultValue=h?(p=h).type==="color"&&Vu(p.default)?new ti(0,0,0,0):p.type==="color"?ti.parse(p.default)||null:p.type==="padding"?Hi.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?qi.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(a,h,p,_,w,x){return this._evaluator.globals=a,this._evaluator.feature=h,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(a,h,p,_,w,x){this._evaluator.globals=a,this._evaluator.feature=h||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function qu(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in nl}function ul(u,a){const h=new Wn(nl,Ic,[],a?function(_){const w={color:Nr,string:Nt,number:st,enum:Nt,boolean:Mt,formatted:yn,padding:vn,resolvedImage:Fs,variableAnchorOffsetCollection:ue};return _.type==="array"?G(w[_.value]||Pt,_.length):w[_.type]}(a):void 0),p=h.parse(u,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Gu(new Hu(p,a)):al(h.errors)}class hl{constructor(a,h){this.kind=a,this._styleExpression=h,this.isStateDependent=a!=="constant"&&!ol(h.expression)}evaluateWithoutErrorHandling(a,h,p,_,w,x){return this._styleExpression.evaluateWithoutErrorHandling(a,h,p,_,w,x)}evaluate(a,h,p,_,w,x){return this._styleExpression.evaluate(a,h,p,_,w,x)}}class dl{constructor(a,h,p,_){this.kind=a,this.zoomStops=p,this._styleExpression=h,this.isStateDependent=a!=="camera"&&!ol(h.expression),this.interpolationType=_}evaluateWithoutErrorHandling(a,h,p,_,w,x){return this._styleExpression.evaluateWithoutErrorHandling(a,h,p,_,w,x)}evaluate(a,h,p,_,w,x){return this._styleExpression.evaluate(a,h,p,_,w,x)}interpolationFactor(a,h,p){return this.interpolationType?ys.interpolationFactor(this.interpolationType,a,h,p):0}}function up(u,a){const h=ul(u,a);if(h.result==="error")return h;const p=h.value.expression,_=Rc(p);if(!_&&!ll(a))return al([new br("","data expressions not supported")]);const w=Mc(p,["zoom"]);if(!w&&!sg(a))return al([new br("","zoom expressions not supported")]);const x=Pc(p);return x||w?x instanceof br?al([x]):x instanceof ys&&!cp(a)?al([new br("",'"interpolate" expressions cannot be used with this property')]):Gu(x?new dl(_?"camera":"composite",h.value,x.labels,x instanceof ys?x.interpolation:void 0):new hl(_?"constant":"source",h.value)):al([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pl{constructor(a,h){this._parameters=a,this._specification=h,Os(this,ng(this._parameters,this._specification))}static deserialize(a){return new pl(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function Pc(u){let a=null;if(u instanceof Js)a=Pc(u.result);else if(u instanceof Lu){for(const h of u.args)if(a=Pc(h),a)break}else(u instanceof Ct||u instanceof ys)&&u.input instanceof Zs&&u.input.name==="zoom"&&(a=u);return a instanceof br||u.eachChild(h=>{const p=Pc(h);p instanceof br?a=p:!a&&p?a=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&p&&a!==p&&(a=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function Wu(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const a of u.slice(1))if(!Wu(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Xu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function hp(u){if(u==null)return{filter:()=>!0,needGeometry:!1};Wu(u)||(u=Ku(u));const a=ul(u,Xu);if(a.result==="error")throw new Error(a.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,_)=>a.value.evaluate(h,p,{},_),needGeometry:cg(u)}}function ay(u,a){return u<a?-1:u>a?1:0}function cg(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let a=1;a<u.length;a++)if(cg(u[a]))return!0;return!1}function Ku(u){if(!u)return!0;const a=u[0];return u.length<=1?a!=="any":a==="=="?dp(u[1],u[2],"=="):a==="!="?Gr(dp(u[1],u[2],"==")):a==="<"||a===">"||a==="<="||a===">="?dp(u[1],u[2],a):a==="any"?(h=u.slice(1),["any"].concat(h.map(Ku))):a==="all"?["all"].concat(u.slice(1).map(Ku)):a==="none"?["all"].concat(u.slice(1).map(Ku).map(Gr)):a==="in"?kc(u[1],u.slice(2)):a==="!in"?Gr(kc(u[1],u.slice(2))):a==="has"?Bc(u[1]):a!=="!has"||Gr(Bc(u[1]));var h}function dp(u,a,h){switch(u){case"$type":return[`filter-type-${h}`,a];case"$id":return[`filter-id-${h}`,a];default:return[`filter-${h}`,u,a]}}function kc(u,a){if(a.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(h=>typeof h!=typeof a[0])?["filter-in-large",u,["literal",a.sort(ay)]]:["filter-in-small",u,["literal",a]]}}function Bc(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Gr(u){return["!",u]}function Ta(u){const a=typeof u;if(a==="number"||a==="boolean"||a==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let _="[";for(const w of u)_+=`${Ta(w)},`;return`${_}]`}const h=Object.keys(u).sort();let p="{";for(let _=0;_<h.length;_++)p+=`${JSON.stringify(h[_])}:${Ta(u[h[_]])},`;return`${p}}`}function ug(u){let a="";for(const h of is)a+=`/${Ta(u[h])}`;return a}function hg(u){const a=u.value;return a?[new Je(u.key,a,"constants have been deprecated as of v8")]:[]}function er(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function bn(u){if(Array.isArray(u))return u.map(bn);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const a={};for(const h in u)a[h]=bn(u[h]);return a}return er(u)}function Ns(u){const a=u.key,h=u.value,p=u.valueSpec||{},_=u.objectElementValidators||{},w=u.style,x=u.styleSpec,A=u.validateSpec;let C=[];const P=ni(h);if(P!=="object")return[new Je(a,h,`object expected, ${P} found`)];for(const k in h){const L=k.split(".")[0],U=p[L]||p["*"];let $;if(_[L])$=_[L];else if(p[L])$=A;else if(_["*"])$=_["*"];else{if(!p["*"]){C.push(new Je(a,h[k],`unknown property "${k}"`));continue}$=A}C=C.concat($({key:(a&&`${a}.`)+k,value:h[k],valueSpec:U,style:w,styleSpec:x,object:h,objectKey:k,validateSpec:A},h))}for(const k in p)_[k]||p[k].required&&p[k].default===void 0&&h[k]===void 0&&C.push(new Je(a,h,`missing required property "${k}"`));return C}function Lc(u){const a=u.value,h=u.valueSpec,p=u.style,_=u.styleSpec,w=u.key,x=u.arrayElementValidator||u.validateSpec;if(ni(a)!=="array")return[new Je(w,a,`array expected, ${ni(a)} found`)];if(h.length&&a.length!==h.length)return[new Je(w,a,`array length ${h.length} expected, length ${a.length} found`)];if(h["min-length"]&&a.length<h["min-length"])return[new Je(w,a,`array length at least ${h["min-length"]} expected, length ${a.length} found`)];let A={type:h.value,values:h.values};_.$version<7&&(A.function=h.function),ni(h.value)==="object"&&(A=h.value);let C=[];for(let P=0;P<a.length;P++)C=C.concat(x({array:a,arrayIndex:P,value:a[P],valueSpec:A,validateSpec:u.validateSpec,style:p,styleSpec:_,key:`${w}[${P}]`}));return C}function pp(u){const a=u.key,h=u.value,p=u.valueSpec;let _=ni(h);return _==="number"&&h!=h&&(_="NaN"),_!=="number"?[new Je(a,h,`number expected, ${_} found`)]:"minimum"in p&&h<p.minimum?[new Je(a,h,`${h} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&h>p.maximum?[new Je(a,h,`${h} is greater than the maximum value ${p.maximum}`)]:[]}function Ju(u){const a=u.valueSpec,h=er(u.value.type);let p,_,w,x={};const A=h!=="categorical"&&u.value.property===void 0,C=!A,P=ni(u.value.stops)==="array"&&ni(u.value.stops[0])==="array"&&ni(u.value.stops[0][0])==="object",k=Ns({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function($){if(h==="identity")return[new Je($.key,$.value,'identity function may not have a "stops" property')];let J=[];const Z=$.value;return J=J.concat(Lc({key:$.key,value:Z,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:L})),ni(Z)==="array"&&Z.length===0&&J.push(new Je($.key,Z,"array must have at least one stop")),J},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:a,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return h==="identity"&&A&&k.push(new Je(u.key,u.value,'missing required property "property"')),h==="identity"||u.value.stops||k.push(new Je(u.key,u.value,'missing required property "stops"')),h==="exponential"&&u.valueSpec.expression&&!cp(u.valueSpec)&&k.push(new Je(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(C&&!ll(u.valueSpec)?k.push(new Je(u.key,u.value,"property functions not supported")):A&&!sg(u.valueSpec)&&k.push(new Je(u.key,u.value,"zoom functions not supported"))),h!=="categorical"&&!P||u.value.property!==void 0||k.push(new Je(u.key,u.value,'"property" property is required')),k;function L($){let J=[];const Z=$.value,ae=$.key;if(ni(Z)!=="array")return[new Je(ae,Z,`array expected, ${ni(Z)} found`)];if(Z.length!==2)return[new Je(ae,Z,`array length 2 expected, length ${Z.length} found`)];if(P){if(ni(Z[0])!=="object")return[new Je(ae,Z,`object expected, ${ni(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Je(ae,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Je(ae,Z,"object stop key must have value")];if(w&&w>er(Z[0].zoom))return[new Je(ae,Z[0].zoom,"stop zoom values must appear in ascending order")];er(Z[0].zoom)!==w&&(w=er(Z[0].zoom),_=void 0,x={}),J=J.concat(Ns({key:`${ae}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:pp,value:U}}))}else J=J.concat(U({key:`${ae}[0]`,value:Z[0],valueSpec:{},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},Z));return qu(bn(Z[1]))?J.concat([new Je(`${ae}[1]`,Z[1],"expressions are not allowed in function stops.")]):J.concat($.validateSpec({key:`${ae}[1]`,value:Z[1],valueSpec:a,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function U($,J){const Z=ni($.value),ae=er($.value),he=$.value!==null?$.value:J;if(p){if(Z!==p)return[new Je($.key,he,`${Z} stop domain type must match previous stop domain type ${p}`)]}else p=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Je($.key,he,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&h!=="categorical"){let Me=`number expected, ${Z} found`;return ll(a)&&h===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je($.key,he,Me)]}return h!=="categorical"||Z!=="number"||isFinite(ae)&&Math.floor(ae)===ae?h!=="categorical"&&Z==="number"&&_!==void 0&&ae<_?[new Je($.key,he,"stop domain values must appear in ascending order")]:(_=ae,h==="categorical"&&ae in x?[new Je($.key,he,"stop domain values must be unique")]:(x[ae]=!0,[])):[new Je($.key,he,`integer expected, found ${ae}`)]}}function fl(u){const a=(u.expressionContext==="property"?up:ul)(bn(u.value),u.valueSpec);if(a.result==="error")return a.value.map(p=>new Je(`${u.key}${p.key}`,u.value,p.message));const h=a.value.expression||a.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!h.outputDefined())return[new Je(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!ol(h))return[new Je(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!ol(h))return[new Je(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Mc(h,["zoom","feature-state"]))return[new Je(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Rc(h))return[new Je(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function go(u){const a=u.key,h=u.value,p=u.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(er(h))===-1&&_.push(new Je(a,h,`expected one of [${p.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(p.values).indexOf(er(h))===-1&&_.push(new Je(a,h,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(h)} found`)),_}function fp(u){return Wu(bn(u.value))?fl(Os({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Zu(u)}function Zu(u){const a=u.value,h=u.key;if(ni(a)!=="array")return[new Je(h,a,`array expected, ${ni(a)} found`)];const p=u.styleSpec;let _,w=[];if(a.length<1)return[new Je(h,a,"filter array must have at least 1 element")];switch(w=w.concat(go({key:`${h}[0]`,value:a[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),er(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&er(a[1])==="$type"&&w.push(new Je(h,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&w.push(new Je(h,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(_=ni(a[1]),_!=="string"&&w.push(new Je(`${h}[1]`,a[1],`string expected, ${_} found`)));for(let x=2;x<a.length;x++)_=ni(a[x]),er(a[1])==="$type"?w=w.concat(go({key:`${h}[${x}]`,value:a[x],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&w.push(new Je(`${h}[${x}]`,a[x],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let x=1;x<a.length;x++)w=w.concat(Zu({key:`${h}[${x}]`,value:a[x],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":_=ni(a[1]),a.length!==2?w.push(new Je(h,a,`filter array for "${a[0]}" operator must have 2 elements`)):_!=="string"&&w.push(new Je(`${h}[1]`,a[1],`string expected, ${_} found`))}return w}function mp(u,a){const h=u.key,p=u.validateSpec,_=u.style,w=u.styleSpec,x=u.value,A=u.objectKey,C=w[`${a}_${u.layerType}`];if(!C)return[];const P=A.match(/^(.*)-transition$/);if(a==="paint"&&P&&C[P[1]]&&C[P[1]].transition)return p({key:h,value:x,valueSpec:w.transition,style:_,styleSpec:w});const k=u.valueSpec||C[A];if(!k)return[new Je(h,x,`unknown property "${A}"`)];let L;if(ni(x)==="string"&&ll(k)&&!k.tokens&&(L=/^{([^}]+)}$/.exec(x)))return[new Je(h,x,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const U=[];return u.layerType==="symbol"&&(A==="text-field"&&_&&!_.glyphs&&U.push(new Je(h,x,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Vu(bn(x))&&er(x.type)==="identity"&&U.push(new Je(h,x,'"text-font" does not support identity functions'))),U.concat(p({key:u.key,value:x,valueSpec:k,style:_,styleSpec:w,expressionContext:"property",propertyType:a,propertyKey:A}))}function Yu(u){return mp(u,"paint")}function gp(u){return mp(u,"layout")}function _p(u){let a=[];const h=u.value,p=u.key,_=u.style,w=u.styleSpec;h.type||h.ref||a.push(new Je(p,h,'either "type" or "ref" is required'));let x=er(h.type);const A=er(h.ref);if(h.id){const C=er(h.id);for(let P=0;P<u.arrayIndex;P++){const k=_.layers[P];er(k.id)===C&&a.push(new Je(p,h.id,`duplicate layer id "${h.id}", previously used at line ${k.id.__line__}`))}}if("ref"in h){let C;["type","source","source-layer","filter","layout"].forEach(P=>{P in h&&a.push(new Je(p,h[P],`"${P}" is prohibited for ref layers`))}),_.layers.forEach(P=>{er(P.id)===A&&(C=P)}),C?C.ref?a.push(new Je(p,h.ref,"ref cannot reference another ref layer")):x=er(C.type):a.push(new Je(p,h.ref,`ref layer "${A}" not found`))}else if(x!=="background")if(h.source){const C=_.sources&&_.sources[h.source],P=C&&er(C.type);C?P==="vector"&&x==="raster"?a.push(new Je(p,h.source,`layer "${h.id}" requires a raster source`)):P!=="raster-dem"&&x==="hillshade"?a.push(new Je(p,h.source,`layer "${h.id}" requires a raster-dem source`)):P==="raster"&&x!=="raster"?a.push(new Je(p,h.source,`layer "${h.id}" requires a vector source`)):P!=="vector"||h["source-layer"]?P==="raster-dem"&&x!=="hillshade"?a.push(new Je(p,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!h.paint||!h.paint["line-gradient"]||P==="geojson"&&C.lineMetrics||a.push(new Je(p,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new Je(p,h,`layer "${h.id}" must specify a "source-layer"`)):a.push(new Je(p,h.source,`source "${h.source}" not found`))}else a.push(new Je(p,h,'missing required property "source"'));return a=a.concat(Ns({key:p,value:h,valueSpec:w.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:h.type,valueSpec:w.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:h,objectKey:"type"}),filter:fp,layout:C=>Ns({layer:h,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>gp(Os({layerType:x},P))}}),paint:C=>Ns({layer:h,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>Yu(Os({layerType:x},P))}})}})),a}function Sa(u){const a=u.value,h=u.key,p=ni(a);return p!=="string"?[new Je(h,a,`string expected, ${p} found`)]:[]}const Qu={promoteId:function({key:u,value:a}){if(ni(a)==="string")return Sa({key:u,value:a});{const h=[];for(const p in a)h.push(...Sa({key:`${u}.${p}`,value:a[p]}));return h}}};function Oc(u){const a=u.value,h=u.key,p=u.styleSpec,_=u.style,w=u.validateSpec;if(!a.type)return[new Je(h,a,'"type" is required')];const x=er(a.type);let A;switch(x){case"vector":case"raster":return A=Ns({key:h,value:a,valueSpec:p[`source_${x.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:Qu,validateSpec:w}),A;case"raster-dem":return A=function(C){var P;const k=(P=C.sourceName)!==null&&P!==void 0?P:"",L=C.value,U=C.styleSpec,$=U.source_raster_dem,J=C.style;let Z=[];const ae=ni(L);if(L===void 0)return Z;if(ae!=="object")return Z.push(new Je("source_raster_dem",L,`object expected, ${ae} found`)),Z;const he=er(L.encoding)==="custom",Me=["redFactor","greenFactor","blueFactor","baseShift"],ve=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const Se in L)!he&&Me.includes(Se)?Z.push(new Je(Se,L[Se],`In "${k}": "${Se}" is only valid when "encoding" is set to "custom". ${ve} encoding found`)):$[Se]?Z=Z.concat(C.validateSpec({key:Se,value:L[Se],valueSpec:$[Se],validateSpec:C.validateSpec,style:J,styleSpec:U})):Z.push(new Je(Se,L[Se],`unknown property "${Se}"`));return Z}({sourceName:h,value:a,style:u.style,styleSpec:p,validateSpec:w}),A;case"geojson":if(A=Ns({key:h,value:a,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:w,objectElementValidators:Qu}),a.cluster)for(const C in a.clusterProperties){const[P,k]=a.clusterProperties[C],L=typeof P=="string"?[P,["accumulated"],["get",C]]:P;A.push(...fl({key:`${h}.${C}.map`,value:k,validateSpec:w,expressionContext:"cluster-map"})),A.push(...fl({key:`${h}.${C}.reduce`,value:L,validateSpec:w,expressionContext:"cluster-reduce"}))}return A;case"video":return Ns({key:h,value:a,valueSpec:p.source_video,style:_,validateSpec:w,styleSpec:p});case"image":return Ns({key:h,value:a,valueSpec:p.source_image,style:_,validateSpec:w,styleSpec:p});case"canvas":return[new Je(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return go({key:`${h}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:w,styleSpec:p})}}function yp(u){const a=u.value,h=u.styleSpec,p=h.light,_=u.style;let w=[];const x=ni(a);if(a===void 0)return w;if(x!=="object")return w=w.concat([new Je("light",a,`object expected, ${x} found`)]),w;for(const A in a){const C=A.match(/^(.*)-transition$/);w=w.concat(C&&p[C[1]]&&p[C[1]].transition?u.validateSpec({key:A,value:a[A],valueSpec:h.transition,validateSpec:u.validateSpec,style:_,styleSpec:h}):p[A]?u.validateSpec({key:A,value:a[A],valueSpec:p[A],validateSpec:u.validateSpec,style:_,styleSpec:h}):[new Je(A,a[A],`unknown property "${A}"`)])}return w}function vp(u){const a=u.value,h=u.styleSpec,p=h.sky,_=u.style,w=ni(a);if(a===void 0)return[];if(w!=="object")return[new Je("sky",a,`object expected, ${w} found`)];let x=[];for(const A in a)x=x.concat(p[A]?u.validateSpec({key:A,value:a[A],valueSpec:p[A],style:_,styleSpec:h}):[new Je(A,a[A],`unknown property "${A}"`)]);return x}function bp(u){const a=u.value,h=u.styleSpec,p=h.terrain,_=u.style;let w=[];const x=ni(a);if(a===void 0)return w;if(x!=="object")return w=w.concat([new Je("terrain",a,`object expected, ${x} found`)]),w;for(const A in a)w=w.concat(p[A]?u.validateSpec({key:A,value:a[A],valueSpec:p[A],validateSpec:u.validateSpec,style:_,styleSpec:h}):[new Je(A,a[A],`unknown property "${A}"`)]);return w}function wp(u){let a=[];const h=u.value,p=u.key;if(Array.isArray(h)){const _=[],w=[];for(const x in h)h[x].id&&_.includes(h[x].id)&&a.push(new Je(p,h,`all the sprites' ids must be unique, but ${h[x].id} is duplicated`)),_.push(h[x].id),h[x].url&&w.includes(h[x].url)&&a.push(new Je(p,h,`all the sprites' URLs must be unique, but ${h[x].url} is duplicated`)),w.push(h[x].url),a=a.concat(Ns({key:`${p}[${x}]`,value:h[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return a}return Sa({key:p,value:h})}const eh={"*":()=>[],array:Lc,boolean:function(u){const a=u.value,h=u.key,p=ni(a);return p!=="boolean"?[new Je(h,a,`boolean expected, ${p} found`)]:[]},number:pp,color:function(u){const a=u.key,h=u.value,p=ni(h);return p!=="string"?[new Je(a,h,`color expected, ${p} found`)]:ti.parse(String(h))?[]:[new Je(a,h,`color expected, "${h}" found`)]},constants:hg,enum:go,filter:fp,function:Ju,layer:_p,object:Ns,source:Oc,light:yp,sky:vp,terrain:bp,projection:function(u){const a=u.value,h=u.styleSpec,p=h.projection,_=u.style,w=ni(a);if(a===void 0)return[];if(w!=="object")return[new Je("projection",a,`object expected, ${w} found`)];let x=[];for(const A in a)x=x.concat(p[A]?u.validateSpec({key:A,value:a[A],valueSpec:p[A],style:_,styleSpec:h}):[new Je(A,a[A],`unknown property "${A}"`)]);return x},string:Sa,formatted:function(u){return Sa(u).length===0?[]:fl(u)},resolvedImage:function(u){return Sa(u).length===0?[]:fl(u)},padding:function(u){const a=u.key,h=u.value;if(ni(h)==="array"){if(h.length<1||h.length>4)return[new Je(a,h,`padding requires 1 to 4 values; ${h.length} values found`)];const p={type:"number"};let _=[];for(let w=0;w<h.length;w++)_=_.concat(u.validateSpec({key:`${a}[${w}]`,value:h[w],validateSpec:u.validateSpec,valueSpec:p}));return _}return pp({key:a,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const a=u.key,h=u.value,p=ni(h),_=u.styleSpec;if(p!=="array"||h.length<1||h.length%2!=0)return[new Je(a,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<h.length;x+=2)w=w.concat(go({key:`${a}[${x}]`,value:h[x],valueSpec:_.layout_symbol["text-anchor"]})),w=w.concat(Lc({key:`${a}[${x+1}]`,value:h[x+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:_}));return w},sprite:wp};function ml(u){const a=u.value,h=u.valueSpec,p=u.styleSpec;return u.validateSpec=ml,h.expression&&Vu(er(a))?Ju(u):h.expression&&qu(bn(a))?fl(u):h.type&&eh[h.type]?eh[h.type](u):Ns(Os({},u,{valueSpec:h.type?p[h.type]:h}))}function dg(u){const a=u.value,h=u.key,p=Sa(u);return p.length||(a.indexOf("{fontstack}")===-1&&p.push(new Je(h,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&p.push(new Je(h,a,'"glyphs" url must include a "{range}" token'))),p}function Ys(u,a=Oe){let h=[];return h=h.concat(ml({key:"",value:u,valueSpec:a.$root,styleSpec:a,style:u,validateSpec:ml,objectElementValidators:{glyphs:dg,"*":()=>[]}})),u.constants&&(h=h.concat(hg({key:"constants",value:u.constants,style:u,styleSpec:a,validateSpec:ml}))),xp(h)}function Kn(u){return function(a){return u({...a,validateSpec:ml})}}function xp(u){return[].concat(u).sort((a,h)=>a.line-h.line)}function wn(u){return function(...a){return xp(u.apply(this,a))}}Ys.source=wn(Kn(Oc)),Ys.sprite=wn(Kn(wp)),Ys.glyphs=wn(Kn(dg)),Ys.light=wn(Kn(yp)),Ys.sky=wn(Kn(vp)),Ys.terrain=wn(Kn(bp)),Ys.layer=wn(Kn(_p)),Ys.filter=wn(Kn(fp)),Ys.paintProperty=wn(Kn(Yu)),Ys.layoutProperty=wn(Kn(gp));const Ca=Ys,ly=Ca.light,cy=Ca.sky,pg=Ca.paintProperty,fg=Ca.layoutProperty;function Ep(u,a){let h=!1;if(a&&a.length)for(const p of a)u.fire(new fs(new Error(p.message))),h=!0;return h}class gl{constructor(a,h,p){const _=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const x=new Int32Array(this.arrayBuffer);a=x[0],this.d=(h=x[1])+2*(p=x[2]);for(let C=0;C<this.d*this.d;C++){const P=x[3+C],k=x[3+C+1];_.push(P===k?null:x.subarray(P,k))}const A=x[3+_.length+1];this.keys=x.subarray(x[3+_.length],A),this.bboxes=x.subarray(A),this.insert=this._insertReadonly}else{this.d=h+2*p;for(let x=0;x<this.d*this.d;x++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=p,this.scale=h/a,this.uid=0;const w=p/h*a;this.min=-w,this.max=a+w}insert(a,h,p,_,w){this._forEachCell(h,p,_,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,h,p,_,w,x){this.cells[w].push(x)}query(a,h,p,_,w){const x=this.min,A=this.max;if(a<=x&&h<=x&&A<=p&&A<=_&&!w)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(a,h,p,_,this._queryCell,C,{},w),C}}_queryCell(a,h,p,_,w,x,A,C){const P=this.cells[w];if(P!==null){const k=this.keys,L=this.bboxes;for(let U=0;U<P.length;U++){const $=P[U];if(A[$]===void 0){const J=4*$;(C?C(L[J+0],L[J+1],L[J+2],L[J+3]):a<=L[J+2]&&h<=L[J+3]&&p>=L[J+0]&&_>=L[J+1])?(A[$]=!0,x.push(k[$])):A[$]=!1}}}}_forEachCell(a,h,p,_,w,x,A,C){const P=this._convertToCellCoord(a),k=this._convertToCellCoord(h),L=this._convertToCellCoord(p),U=this._convertToCellCoord(_);for(let $=P;$<=L;$++)for(let J=k;J<=U;J++){const Z=this.d*J+$;if((!C||C(this._convertFromCellCoord($),this._convertFromCellCoord(J),this._convertFromCellCoord($+1),this._convertFromCellCoord(J+1)))&&w.call(this,a,h,p,_,Z,x,A,C))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,h=3+this.cells.length+1+1;let p=0;for(let x=0;x<this.cells.length;x++)p+=this.cells[x].length;const _=new Int32Array(h+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let w=h;for(let x=0;x<a.length;x++){const A=a[x];_[3+x]=w,_.set(A,w),w+=A.length}return _[3+a.length]=w,_.set(this.keys,w),w+=this.keys.length,_[3+a.length+1]=w,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer}static serialize(a,h){const p=a.toArrayBuffer();return h&&h.push(p),{buffer:p}}static deserialize(a){return new gl(a.buffer)}}const Qs={};function mt(u,a,h={}){if(Qs[u])throw new Error(`${u} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:u,writeable:!1}),Qs[u]={klass:a,omit:h.omit||[],shallow:h.shallow||[]}}mt("Object",Object),mt("TransferableGridIndex",gl),mt("Color",ti),mt("Error",Error),mt("AJAXError",si),mt("ResolvedImage",Wi),mt("StylePropertyFunction",pl),mt("StyleExpression",Hu,{omit:["_evaluator"]}),mt("ZoomDependentExpression",dl),mt("ZoomConstantExpression",hl),mt("CompoundExpression",Zs,{omit:["_evaluate"]});for(const u in nl)nl[u]._classRegistryKey||mt(`Expression_${u}`,nl[u]);function th(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Ap(u){return u.$name||u.constructor._classRegistryKey}function mg(u){return!function(a){if(a===null||typeof a!="object")return!1;const h=Ap(a);return!(!h||h==="Object")}(u)&&(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||th(u)||Gt(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function _l(u,a){if(mg(u))return(th(u)||Gt(u))&&a&&a.push(u),ArrayBuffer.isView(u)&&a&&a.push(u.buffer),u instanceof ImageData&&a&&a.push(u.data.buffer),u;if(Array.isArray(u)){const w=[];for(const x of u)w.push(_l(x,a));return w}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);const h=Ap(u);if(!h)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!Qs[h])throw new Error(`${h} is not registered.`);const{klass:p}=Qs[h],_=p.serialize?p.serialize(u,a):{};if(p.serialize){if(a&&_===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in u){if(!u.hasOwnProperty(w)||Qs[h].omit.indexOf(w)>=0)continue;const x=u[w];_[w]=Qs[h].shallow.indexOf(w)>=0?x:_l(x,a)}u instanceof Error&&(_.message=u.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(_.$name=h),_}function yl(u){if(mg(u))return u;if(Array.isArray(u))return u.map(yl);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);const a=Ap(u)||"Object";if(!Qs[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:h}=Qs[a];if(!h)throw new Error(`can't deserialize unregistered class ${a}`);if(h.deserialize)return h.deserialize(u);const p=Object.create(h.prototype);for(const _ of Object.keys(u)){if(_==="$name")continue;const w=u[_];p[_]=Qs[a].shallow.indexOf(_)>=0?w:yl(w)}return p}class Tp{constructor(){this.first=!0}update(a,h){const p=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=h),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=p,!0))}}const Kt={"Latin-1 Supplement":u=>u>=128&&u<=255,"Hangul Jamo":u=>u>=4352&&u<=4607,Khmer:u=>u>=6016&&u<=6143,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Katakana:u=>u>=12448&&u<=12543,Kanbun:u=>u>=12688&&u<=12703,"CJK Strokes":u=>u>=12736&&u<=12783,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"Private Use Area":u=>u>=57344&&u<=63743,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Sp(u){for(const a of u)if(Ip(a.charCodeAt(0)))return!0;return!1}function uy(u){for(const a of u)if(!vl(a.charCodeAt(0)))return!1;return!0}function Cp(u){const a=u.map(h=>{try{return new RegExp(`\\p{sc=${h}}`,"u").source}catch{return null}}).filter(h=>h);return new RegExp(a.join("|"),"u")}const hy=Cp(["Arab","Dupl","Mong","Ougr","Syrc"]);function vl(u){return!hy.test(String.fromCodePoint(u))}const gg=Cp(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ip(u){return!(u!==746&&u!==747&&(u<4352||!(Kt["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Kt["CJK Compatibility"](u)||Kt["CJK Strokes"](u)||!(!Kt["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Kt["Enclosed CJK Letters and Months"](u)||Kt["Ideographic Description Characters"](u)||Kt.Kanbun(u)||Kt.Katakana(u)&&u!==12540||!(!Kt["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Kt["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Kt["Vertical Forms"](u)||Kt["Yijing Hexagram Symbols"](u)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(u))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(u))||gg.test(String.fromCodePoint(u)))))}function _g(u){return!(Ip(u)||function(a){return!!(Kt["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Kt["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Kt["Letterlike Symbols"](a)||Kt["Number Forms"](a)||Kt["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Kt["Control Pictures"](a)&&a!==9251||Kt["Optical Character Recognition"](a)||Kt["Enclosed Alphanumerics"](a)||Kt["Geometric Shapes"](a)||Kt["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Kt["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Kt["CJK Symbols and Punctuation"](a)||Kt.Katakana(a)||Kt["Private Use Area"](a)||Kt["CJK Compatibility Forms"](a)||Kt["Small Form Variants"](a)||Kt["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(u))}const dy=Cp(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Rp(u){return dy.test(String.fromCodePoint(u))}function py(u,a){return!(!a&&Rp(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Kt.Khmer(u))}function fy(u){for(const a of u)if(Rp(a.charCodeAt(0)))return!0;return!1}const Us=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ri{constructor(a,h){this.zoom=a,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Tp,this.transition={})}isSupportedScript(a){return function(h,p){for(const _ of h)if(!py(_.charCodeAt(0),p))return!1;return!0}(a,Us.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,h=a-Math.floor(a),p=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*h}}}class bl{constructor(a,h){this.property=a,this.value=h,this.expression=function(p,_){if(Vu(p))return new pl(p,_);if(qu(p)){const w=up(p,_);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=p;return _.type==="color"&&typeof p=="string"?w=ti.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(w=qi.parse(p)):w=Hi.parse(p),{kind:"constant",evaluate:()=>w}}}(h===void 0?a.specification.default:h,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,h,p){return this.property.possiblyEvaluate(this,a,h,p)}}class ih{constructor(a){this.property=a,this.value=new bl(a,void 0)}transitioned(a,h){return new yg(this.property,this.value,h,be({},a.transition,this.transition),a.now)}untransitioned(){return new yg(this.property,this.value,null,{},0)}}class rh{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return ze(this._values[a].value.value)}setValue(a,h){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new ih(this._values[a].property)),this._values[a].value=new bl(this._values[a].property,h===null?void 0:ze(h))}getTransition(a){return ze(this._values[a].transition)}setTransition(a,h){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new ih(this._values[a].property)),this._values[a].transition=ze(h)||void 0}serialize(){const a={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(a[h]=p);const _=this.getTransition(h);_!==void 0&&(a[`${h}-transition`]=_)}return a}transitioned(a,h){const p=new Dc(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(a,h._values[_]);return p}untransitioned(){const a=new Dc(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].untransitioned();return a}}class yg{constructor(a,h,p,_,w){this.property=a,this.value=h,this.begin=w+_.delay||0,this.end=this.begin+_.duration||0,a.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(a,h,p){const _=a.now||0,w=this.value.possiblyEvaluate(a,h,p),x=this.prior;if(x){if(_>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(_<this.begin)return x.possiblyEvaluate(a,h,p);{const A=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(a,h,p),w,function(C){if(C<=0)return 0;if(C>=1)return 1;const P=C*C,k=P*C;return 4*(C<.5?k:3*(C-P)+k-.75)}(A))}}return w}}class Dc{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,h,p){const _=new Nc(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(a,h,p);return _}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Fc{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return ze(this._values[a].value)}setValue(a,h){this._values[a]=new bl(this._values[a].property,h===null?void 0:ze(h))}serialize(){const a={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(a[h]=p)}return a}possiblyEvaluate(a,h,p){const _=new Nc(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(a,h,p);return _}}class Jn{constructor(a,h,p){this.property=a,this.value=h,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,h,p,_){return this.property.evaluate(this.value,this.parameters,a,h,p,_)}}class Nc{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class _t{constructor(a){this.specification=a}possiblyEvaluate(a,h){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(h)}interpolate(a,h,p){const _=_s[this.specification.type];return _?_(a,h,p):a}}class Rt{constructor(a,h){this.specification=a,this.overrides=h}possiblyEvaluate(a,h,p,_){return new Jn(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(h,null,{},p,_)}:a.expression,h)}interpolate(a,h,p){if(a.value.kind!=="constant"||h.value.kind!=="constant")return a;if(a.value.value===void 0||h.value.value===void 0)return new Jn(this,{kind:"constant",value:void 0},a.parameters);const _=_s[this.specification.type];if(_){const w=_(a.value.value,h.value.value,p);return new Jn(this,{kind:"constant",value:w},a.parameters)}return a}evaluate(a,h,p,_,w,x){return a.kind==="constant"?a.value:a.evaluate(h,p,_,w,x)}}class sh extends Rt{possiblyEvaluate(a,h,p,_){if(a.value===void 0)return new Jn(this,{kind:"constant",value:void 0},h);if(a.expression.kind==="constant"){const w=a.expression.evaluate(h,null,{},p,_),x=a.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,A=this._calculate(x,x,x,h);return new Jn(this,{kind:"constant",value:A},h)}if(a.expression.kind==="camera"){const w=this._calculate(a.expression.evaluate({zoom:h.zoom-1}),a.expression.evaluate({zoom:h.zoom}),a.expression.evaluate({zoom:h.zoom+1}),h);return new Jn(this,{kind:"constant",value:w},h)}return new Jn(this,a.expression,h)}evaluate(a,h,p,_,w,x){if(a.kind==="source"){const A=a.evaluate(h,p,_,w,x);return this._calculate(A,A,A,h)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(h.zoom)-1},p,_),a.evaluate({zoom:Math.floor(h.zoom)},p,_),a.evaluate({zoom:Math.floor(h.zoom)+1},p,_),h):a.value}_calculate(a,h,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:a,to:h}:{from:p,to:h}}interpolate(a){return a}}class nh{constructor(a){this.specification=a}possiblyEvaluate(a,h,p,_){if(a.value!==void 0){if(a.expression.kind==="constant"){const w=a.expression.evaluate(h,null,{},p,_);return this._calculate(w,w,w,h)}return this._calculate(a.expression.evaluate(new Ri(Math.floor(h.zoom-1),h)),a.expression.evaluate(new Ri(Math.floor(h.zoom),h)),a.expression.evaluate(new Ri(Math.floor(h.zoom+1),h)),h)}}_calculate(a,h,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:a,to:h}:{from:p,to:h}}interpolate(a){return a}}class Mp{constructor(a){this.specification=a}possiblyEvaluate(a,h,p,_){return!!a.expression.evaluate(h,null,{},p,_)}interpolate(){return!1}}class b{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in a){const p=a[h];p.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new bl(p,void 0),w=this.defaultTransitionablePropertyValues[h]=new ih(p);this.defaultTransitioningPropertyValues[h]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate({})}}}mt("DataDrivenProperty",Rt),mt("DataConstantProperty",_t),mt("CrossFadedDataDrivenProperty",sh),mt("CrossFadedProperty",nh),mt("ColorRampProperty",Mp);const o="-transition";class d extends Ws{constructor(a,h){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),h.layout&&(this._unevaluatedLayout=new Fc(h.layout)),h.paint)){this._transitionablePaint=new rh(h.paint);for(const p in a.paint)this.setPaintProperty(p,a.paint[p],{validate:!1});for(const p in a.layout)this.setLayoutProperty(p,a.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nc(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,h,p={}){h!=null&&this._validate(fg,`layers.${this.id}.layout.${a}`,a,h,p)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,h):this.visibility=h)}getPaintProperty(a){return a.endsWith(o)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,h,p={}){if(h!=null&&this._validate(pg,`layers.${this.id}.paint.${a}`,a,h,p))return!1;if(a.endsWith(o))return this._transitionablePaint.setTransition(a.slice(0,-11),h||void 0),!1;{const _=this._transitionablePaint._values[a],w=_.property.specification["property-type"]==="cross-faded-data-driven",x=_.value.isDataDriven(),A=_.value;this._transitionablePaint.setValue(a,h),this._handleSpecialPaintPropertyUpdate(a);const C=this._transitionablePaint._values[a].value;return C.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(a,A,C)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,h,p){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,h){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,h)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Pe(a,(h,p)=>!(h===void 0||p==="layout"&&!Object.keys(h).length||p==="paint"&&!Object.keys(h).length))}_validate(a,h,p,_,w={}){return(!w||w.validate!==!1)&&Ep(this,a.call(Ca,{key:h,layerType:this.type,objectKey:p,value:_,styleSpec:Oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const h=this.paint.get(a);if(h instanceof Jn&&ll(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const m={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class g{constructor(a,h){this._structArray=a,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class v{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,h){return a._trim(),h&&(a.isTransferred=!0,h.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const h=Object.create(this.prototype);return h.arrayBuffer=a.arrayBuffer,h.length=a.length,h.capacity=a.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function S(u,a=1){let h=0,p=0;return{members:u.map(_=>{const w=m[_.type].BYTES_PER_ELEMENT,x=h=I(h,Math.max(a,w)),A=_.components||1;return p=Math.max(p,w),h+=w*A,{name:_.name,type:_.type,components:A,offset:x}}),size:I(h,Math.max(p,a)),alignment:a}}function I(u,a){return Math.ceil(u/a)*a}class M extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h){const p=this.length;return this.resize(p+1),this.emplace(p,a,h)}emplace(a,h,p){const _=2*a;return this.int16[_+0]=h,this.int16[_+1]=p,a}}M.prototype.bytesPerElement=4,mt("StructArrayLayout2i4",M);class B extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,h,p)}emplace(a,h,p,_){const w=3*a;return this.int16[w+0]=h,this.int16[w+1]=p,this.int16[w+2]=_,a}}B.prototype.bytesPerElement=6,mt("StructArrayLayout3i6",B);class F extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,p,_){const w=this.length;return this.resize(w+1),this.emplace(w,a,h,p,_)}emplace(a,h,p,_,w){const x=4*a;return this.int16[x+0]=h,this.int16[x+1]=p,this.int16[x+2]=_,this.int16[x+3]=w,a}}F.prototype.bytesPerElement=8,mt("StructArrayLayout4i8",F);class N extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w,x){const A=this.length;return this.resize(A+1),this.emplace(A,a,h,p,_,w,x)}emplace(a,h,p,_,w,x,A){const C=6*a;return this.int16[C+0]=h,this.int16[C+1]=p,this.int16[C+2]=_,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=A,a}}N.prototype.bytesPerElement=12,mt("StructArrayLayout2i4i12",N);class X extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w,x){const A=this.length;return this.resize(A+1),this.emplace(A,a,h,p,_,w,x)}emplace(a,h,p,_,w,x,A){const C=4*a,P=8*a;return this.int16[C+0]=h,this.int16[C+1]=p,this.uint8[P+4]=_,this.uint8[P+5]=w,this.uint8[P+6]=x,this.uint8[P+7]=A,a}}X.prototype.bytesPerElement=8,mt("StructArrayLayout2i4ub8",X);class Q extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h){const p=this.length;return this.resize(p+1),this.emplace(p,a,h)}emplace(a,h,p){const _=2*a;return this.float32[_+0]=h,this.float32[_+1]=p,a}}Q.prototype.bytesPerElement=8,mt("StructArrayLayout2f8",Q);class te extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w,x,A,C,P,k){const L=this.length;return this.resize(L+1),this.emplace(L,a,h,p,_,w,x,A,C,P,k)}emplace(a,h,p,_,w,x,A,C,P,k,L){const U=10*a;return this.uint16[U+0]=h,this.uint16[U+1]=p,this.uint16[U+2]=_,this.uint16[U+3]=w,this.uint16[U+4]=x,this.uint16[U+5]=A,this.uint16[U+6]=C,this.uint16[U+7]=P,this.uint16[U+8]=k,this.uint16[U+9]=L,a}}te.prototype.bytesPerElement=20,mt("StructArrayLayout10ui20",te);class le extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w,x,A,C,P,k,L,U){const $=this.length;return this.resize($+1),this.emplace($,a,h,p,_,w,x,A,C,P,k,L,U)}emplace(a,h,p,_,w,x,A,C,P,k,L,U,$){const J=12*a;return this.int16[J+0]=h,this.int16[J+1]=p,this.int16[J+2]=_,this.int16[J+3]=w,this.uint16[J+4]=x,this.uint16[J+5]=A,this.uint16[J+6]=C,this.uint16[J+7]=P,this.int16[J+8]=k,this.int16[J+9]=L,this.int16[J+10]=U,this.int16[J+11]=$,a}}le.prototype.bytesPerElement=24,mt("StructArrayLayout4i4ui4i24",le);class de extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,h,p)}emplace(a,h,p,_){const w=3*a;return this.float32[w+0]=h,this.float32[w+1]=p,this.float32[w+2]=_,a}}de.prototype.bytesPerElement=12,mt("StructArrayLayout3f12",de);class pe extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const h=this.length;return this.resize(h+1),this.emplace(h,a)}emplace(a,h){return this.uint32[1*a+0]=h,a}}pe.prototype.bytesPerElement=4,mt("StructArrayLayout1ul4",pe);class ge extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w,x,A,C,P){const k=this.length;return this.resize(k+1),this.emplace(k,a,h,p,_,w,x,A,C,P)}emplace(a,h,p,_,w,x,A,C,P,k){const L=10*a,U=5*a;return this.int16[L+0]=h,this.int16[L+1]=p,this.int16[L+2]=_,this.int16[L+3]=w,this.int16[L+4]=x,this.int16[L+5]=A,this.uint32[U+3]=C,this.uint16[L+8]=P,this.uint16[L+9]=k,a}}ge.prototype.bytesPerElement=20,mt("StructArrayLayout6i1ul2ui20",ge);class ne extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w,x){const A=this.length;return this.resize(A+1),this.emplace(A,a,h,p,_,w,x)}emplace(a,h,p,_,w,x,A){const C=6*a;return this.int16[C+0]=h,this.int16[C+1]=p,this.int16[C+2]=_,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=A,a}}ne.prototype.bytesPerElement=12,mt("StructArrayLayout2i2i2i12",ne);class xe extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w){const x=this.length;return this.resize(x+1),this.emplace(x,a,h,p,_,w)}emplace(a,h,p,_,w,x){const A=4*a,C=8*a;return this.float32[A+0]=h,this.float32[A+1]=p,this.float32[A+2]=_,this.int16[C+6]=w,this.int16[C+7]=x,a}}xe.prototype.bytesPerElement=16,mt("StructArrayLayout2f1f2i16",xe);class Ae extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w,x){const A=this.length;return this.resize(A+1),this.emplace(A,a,h,p,_,w,x)}emplace(a,h,p,_,w,x,A){const C=16*a,P=4*a,k=8*a;return this.uint8[C+0]=h,this.uint8[C+1]=p,this.float32[P+1]=_,this.float32[P+2]=w,this.int16[k+6]=x,this.int16[k+7]=A,a}}Ae.prototype.bytesPerElement=16,mt("StructArrayLayout2ub2f2i16",Ae);class ke extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,h,p)}emplace(a,h,p,_){const w=3*a;return this.uint16[w+0]=h,this.uint16[w+1]=p,this.uint16[w+2]=_,a}}ke.prototype.bytesPerElement=6,mt("StructArrayLayout3ui6",ke);class Ge extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w,x,A,C,P,k,L,U,$,J,Z,ae,he){const Me=this.length;return this.resize(Me+1),this.emplace(Me,a,h,p,_,w,x,A,C,P,k,L,U,$,J,Z,ae,he)}emplace(a,h,p,_,w,x,A,C,P,k,L,U,$,J,Z,ae,he,Me){const ve=24*a,Se=12*a,Fe=48*a;return this.int16[ve+0]=h,this.int16[ve+1]=p,this.uint16[ve+2]=_,this.uint16[ve+3]=w,this.uint32[Se+2]=x,this.uint32[Se+3]=A,this.uint32[Se+4]=C,this.uint16[ve+10]=P,this.uint16[ve+11]=k,this.uint16[ve+12]=L,this.float32[Se+7]=U,this.float32[Se+8]=$,this.uint8[Fe+36]=J,this.uint8[Fe+37]=Z,this.uint8[Fe+38]=ae,this.uint32[Se+10]=he,this.int16[ve+22]=Me,a}}Ge.prototype.bytesPerElement=48,mt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ge);class Xe extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,p,_,w,x,A,C,P,k,L,U,$,J,Z,ae,he,Me,ve,Se,Fe,He,ht,It,ct,at,bt,gt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,a,h,p,_,w,x,A,C,P,k,L,U,$,J,Z,ae,he,Me,ve,Se,Fe,He,ht,It,ct,at,bt,gt)}emplace(a,h,p,_,w,x,A,C,P,k,L,U,$,J,Z,ae,he,Me,ve,Se,Fe,He,ht,It,ct,at,bt,gt,ft){const je=32*a,Et=16*a;return this.int16[je+0]=h,this.int16[je+1]=p,this.int16[je+2]=_,this.int16[je+3]=w,this.int16[je+4]=x,this.int16[je+5]=A,this.int16[je+6]=C,this.int16[je+7]=P,this.uint16[je+8]=k,this.uint16[je+9]=L,this.uint16[je+10]=U,this.uint16[je+11]=$,this.uint16[je+12]=J,this.uint16[je+13]=Z,this.uint16[je+14]=ae,this.uint16[je+15]=he,this.uint16[je+16]=Me,this.uint16[je+17]=ve,this.uint16[je+18]=Se,this.uint16[je+19]=Fe,this.uint16[je+20]=He,this.uint16[je+21]=ht,this.uint16[je+22]=It,this.uint32[Et+12]=ct,this.float32[Et+13]=at,this.float32[Et+14]=bt,this.uint16[je+30]=gt,this.uint16[je+31]=ft,a}}Xe.prototype.bytesPerElement=64,mt("StructArrayLayout8i15ui1ul2f2ui64",Xe);class lt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const h=this.length;return this.resize(h+1),this.emplace(h,a)}emplace(a,h){return this.float32[1*a+0]=h,a}}lt.prototype.bytesPerElement=4,mt("StructArrayLayout1f4",lt);class pt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,h,p)}emplace(a,h,p,_){const w=3*a;return this.uint16[6*a+0]=h,this.float32[w+1]=p,this.float32[w+2]=_,a}}pt.prototype.bytesPerElement=12,mt("StructArrayLayout1ui2f12",pt);class nt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,h,p)}emplace(a,h,p,_){const w=4*a;return this.uint32[2*a+0]=h,this.uint16[w+2]=p,this.uint16[w+3]=_,a}}nt.prototype.bytesPerElement=8,mt("StructArrayLayout1ul2ui8",nt);class it extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h){const p=this.length;return this.resize(p+1),this.emplace(p,a,h)}emplace(a,h,p){const _=2*a;return this.uint16[_+0]=h,this.uint16[_+1]=p,a}}it.prototype.bytesPerElement=4,mt("StructArrayLayout2ui4",it);class yt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const h=this.length;return this.resize(h+1),this.emplace(h,a)}emplace(a,h){return this.uint16[1*a+0]=h,a}}yt.prototype.bytesPerElement=2,mt("StructArrayLayout1ui2",yt);class Lt extends v{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,p,_){const w=this.length;return this.resize(w+1),this.emplace(w,a,h,p,_)}emplace(a,h,p,_,w){const x=4*a;return this.float32[x+0]=h,this.float32[x+1]=p,this.float32[x+2]=_,this.float32[x+3]=w,a}}Lt.prototype.bytesPerElement=16,mt("StructArrayLayout4f16",Lt);class ot extends g{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new T(this.anchorPointX,this.anchorPointY)}}ot.prototype.size=20;class ut extends ge{get(a){return new ot(this,a)}}mt("CollisionBoxArray",ut);class kt extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}kt.prototype.size=48;class Mi extends Ge{get(a){return new kt(this,a)}}mt("PlacedSymbolArray",Mi);class Ut extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ut.prototype.size=64;class Wt extends Xe{get(a){return new Ut(this,a)}}mt("SymbolInstanceArray",Wt);class Pi extends lt{getoffsetX(a){return this.float32[1*a+0]}}mt("GlyphOffsetArray",Pi);class Vr extends B{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}mt("SymbolLineVertexArray",Vr);class xn extends g{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}xn.prototype.size=12;class ki extends pt{get(a){return new xn(this,a)}}mt("TextAnchorOffsetArray",ki);class vs extends g{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}vs.prototype.size=8;class os extends nt{get(a){return new vs(this,a)}}mt("FeatureIndexArray",os);class $r extends M{}class as extends M{}class Zn extends M{}class wl extends N{}class oh extends X{}class xl extends Q{}class en extends te{}class ah extends le{}class Pp extends de{}class tn extends pe{}class rn extends ne{}class Wo extends Ae{}class En extends ke{}class Mr extends it{}const Hr=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:zs}=Hr;class Jt{constructor(a=[]){this.segments=a}prepareSegment(a,h,p,_){let w=this.segments[this.segments.length-1];return a>Jt.MAX_VERTEX_ARRAY_LENGTH&&We(`Max vertices per segment is ${Jt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!w||w.vertexLength+a>Jt.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==_)&&(w={vertexOffset:h.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},_!==void 0&&(w.sortKey=_),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const a of this.segments)for(const h in a.vaos)a.vaos[h].destroy()}static simpleSegment(a,h,p,_){return new Jt([{vertexOffset:a,primitiveOffset:h,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function Ia(u,a){return 256*(u=we(Math.floor(u),0,255))+we(Math.floor(a),0,255)}Jt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt("SegmentVector",Jt);const El=S([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Al={exports:{}},vg={exports:{}};vg.exports=function(u,a){var h,p,_,w,x,A,C,P;for(p=u.length-(h=3&u.length),_=a,x=3432918353,A=461845907,P=0;P<p;)C=255&u.charCodeAt(P)|(255&u.charCodeAt(++P))<<8|(255&u.charCodeAt(++P))<<16|(255&u.charCodeAt(++P))<<24,++P,_=27492+(65535&(w=5*(65535&(_=(_^=C=(65535&(C=(C=(65535&C)*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*A+(((C>>>16)*A&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(C=0,h){case 3:C^=(255&u.charCodeAt(P+2))<<16;case 2:C^=(255&u.charCodeAt(P+1))<<8;case 1:_^=C=(65535&(C=(C=(65535&(C^=255&u.charCodeAt(P)))*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*A+(((C>>>16)*A&65535)<<16)&4294967295}return _^=u.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var my=vg.exports,bg={exports:{}};bg.exports=function(u,a){for(var h,p=u.length,_=a^p,w=0;p>=4;)h=1540483477*(65535&(h=255&u.charCodeAt(w)|(255&u.charCodeAt(++w))<<8|(255&u.charCodeAt(++w))<<16|(255&u.charCodeAt(++w))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++w;switch(p){case 3:_^=(255&u.charCodeAt(w+2))<<16;case 2:_^=(255&u.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&u.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var Xo=my,wg=bg.exports;Al.exports=Xo,Al.exports.murmur3=Xo,Al.exports.murmur2=wg;var lh=f(Al.exports);class Uc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,h,p,_){this.ids.push(ch(a)),this.positions.push(h,p,_)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=ch(a);let p=0,_=this.ids.length-1;for(;p<_;){const x=p+_>>1;this.ids[x]>=h?_=x:p=x+1}const w=[];for(;this.ids[p]===h;)w.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return w}static serialize(a,h){const p=new Float64Array(a.ids),_=new Uint32Array(a.positions);return uh(p,_,0,p.length-1),h&&h.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(a){const h=new Uc;return h.ids=a.ids,h.positions=a.positions,h.indexed=!0,h}}function ch(u){const a=+u;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:lh(String(u))}function uh(u,a,h,p){for(;h<p;){const _=u[h+p>>1];let w=h-1,x=p+1;for(;;){do w++;while(u[w]<_);do x--;while(u[x]>_);if(w>=x)break;Tl(u,w,x),Tl(a,3*w,3*x),Tl(a,3*w+1,3*x+1),Tl(a,3*w+2,3*x+2)}x-h<p-x?(uh(u,a,h,x),h=x+1):(uh(u,a,x+1,p),p=x)}}function Tl(u,a,h){const p=u[a];u[a]=u[h],u[h]=p}mt("FeaturePositionMap",Uc);class zc{constructor(a,h){this.gl=a.gl,this.location=h}}class xg extends zc{constructor(a,h){super(a,h),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class $E extends zc{constructor(a,h){super(a,h),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class HE extends zc{constructor(a,h){super(a,h),this.current=ti.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const T6=new Float32Array(16);function gy(u){return[Ia(255*u.r,255*u.g),Ia(255*u.b,255*u.a)]}class kp{constructor(a,h,p){this.value=a,this.uniformNames=h.map(_=>`u_${_}`),this.type=p}setUniform(a,h,p){a.set(p.constantOr(this.value))}getBinding(a,h,p){return this.type==="color"?new HE(a,h):new xg(a,h)}}class hh{constructor(a,h){this.uniformNames=h.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=a.tlbr}setUniform(a,h,p,_){const w=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&a.set(w)}getBinding(a,h,p){return p.substr(0,9)==="u_pattern"?new $E(a,h):new xg(a,h)}}class Ra{constructor(a,h,p,_){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=h.map(w=>({name:`a_${w}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(a,h,p,_,w){const x=this.paintVertexArray.length,A=this.expression.evaluate(new Ri(0),h,{},_,[],w);this.paintVertexArray.resize(a),this._setPaintValue(x,a,A)}updatePaintArray(a,h,p,_){const w=this.expression.evaluate({zoom:0},p,_);this._setPaintValue(a,h,w)}_setPaintValue(a,h,p){if(this.type==="color"){const _=gy(p);for(let w=a;w<h;w++)this.paintVertexArray.emplace(w,_[0],_[1])}else{for(let _=a;_<h;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _o{constructor(a,h,p,_,w,x){this.expression=a,this.uniformNames=h.map(A=>`u_${A}_t`),this.type=p,this.useIntegerZoom=_,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=h.map(A=>({name:`a_${A}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(a,h,p,_,w){const x=this.expression.evaluate(new Ri(this.zoom),h,{},_,[],w),A=this.expression.evaluate(new Ri(this.zoom+1),h,{},_,[],w),C=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(C,a,x,A)}updatePaintArray(a,h,p,_){const w=this.expression.evaluate({zoom:this.zoom},p,_),x=this.expression.evaluate({zoom:this.zoom+1},p,_);this._setPaintValue(a,h,w,x)}_setPaintValue(a,h,p,_){if(this.type==="color"){const w=gy(p),x=gy(_);for(let A=a;A<h;A++)this.paintVertexArray.emplace(A,w[0],w[1],x[0],x[1])}else{for(let w=a;w<h;w++)this.paintVertexArray.emplace(w,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,h){const p=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,_=we(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);a.set(_)}getBinding(a,h,p){return new xg(a,h)}}class Sl{constructor(a,h,p,_,w,x){this.expression=a,this.type=h,this.useIntegerZoom=p,this.zoom=_,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(a,h,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(_,a,h.patterns&&h.patterns[this.layerId],p)}updatePaintArray(a,h,p,_,w){this._setPaintValues(a,h,p.patterns&&p.patterns[this.layerId],w)}_setPaintValues(a,h,p,_){if(!_||!p)return;const{min:w,mid:x,max:A}=p,C=_[w],P=_[x],k=_[A];if(C&&P&&k)for(let L=a;L<h;L++)this.zoomInPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],P.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],P.pixelRatio,k.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,El.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,El.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qE{constructor(a,h,p){this.binders={},this._buffers=[];const _=[];for(const w in a.paint._values){if(!p(w))continue;const x=a.paint.get(w);if(!(x instanceof Jn&&ll(x.property.specification)))continue;const A=S6(w,a.type),C=x.value,P=x.property.specification.type,k=x.property.useIntegerZoom,L=x.property.specification["property-type"],U=L==="cross-faded"||L==="cross-faded-data-driven";if(C.kind==="constant")this.binders[w]=U?new hh(C.value,A):new kp(C.value,A,P),_.push(`/u_${w}`);else if(C.kind==="source"||U){const $=WE(w,P,"source");this.binders[w]=U?new Sl(C,P,k,h,$,a.id):new Ra(C,A,P,$),_.push(`/a_${w}`)}else{const $=WE(w,P,"composite");this.binders[w]=new _o(C,A,P,k,h,$),_.push(`/z_${w}`)}}this.cacheKey=_.sort().join("")}getMaxValue(a){const h=this.binders[a];return h instanceof Ra||h instanceof _o?h.maxValue:0}populatePaintArrays(a,h,p,_,w){for(const x in this.binders){const A=this.binders[x];(A instanceof Ra||A instanceof _o||A instanceof Sl)&&A.populatePaintArray(a,h,p,_,w)}}setConstantPatternPositions(a,h){for(const p in this.binders){const _=this.binders[p];_ instanceof hh&&_.setConstantPatternPositions(a,h)}}updatePaintArrays(a,h,p,_,w){let x=!1;for(const A in a){const C=h.getPositions(A);for(const P of C){const k=p.feature(P.index);for(const L in this.binders){const U=this.binders[L];if((U instanceof Ra||U instanceof _o||U instanceof Sl)&&U.expression.isStateDependent===!0){const $=_.paint.get(L);U.expression=$.value,U.updatePaintArray(P.start,P.end,k,a[A],w),x=!0}}}}return x}defines(){const a=[];for(const h in this.binders){const p=this.binders[h];(p instanceof kp||p instanceof hh)&&a.push(...p.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return a}getBinderAttributes(){const a=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Ra||p instanceof _o)for(let _=0;_<p.paintVertexAttributes.length;_++)a.push(p.paintVertexAttributes[_].name);else if(p instanceof Sl)for(let _=0;_<El.members.length;_++)a.push(El.members[_].name)}return a}getBinderUniforms(){const a=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof kp||p instanceof hh||p instanceof _o)for(const _ of p.uniformNames)a.push(_)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,h){const p=[];for(const _ in this.binders){const w=this.binders[_];if(w instanceof kp||w instanceof hh||w instanceof _o){for(const x of w.uniformNames)if(h[x]){const A=w.getBinding(a,h[x],x);p.push({name:x,property:_,binding:A})}}}return p}setUniforms(a,h,p,_){for(const{name:w,property:x,binding:A}of h)this.binders[x].setUniform(A,_,p.get(x),w)}updatePaintBuffers(a){this._buffers=[];for(const h in this.binders){const p=this.binders[h];if(a&&p instanceof Sl){const _=a.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof Ra||p instanceof _o)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(a){for(const h in this.binders){const p=this.binders[h];(p instanceof Ra||p instanceof _o||p instanceof Sl)&&p.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const h=this.binders[a];(h instanceof Ra||h instanceof _o||h instanceof Sl)&&h.destroy()}}}class jc{constructor(a,h,p=()=>!0){this.programConfigurations={};for(const _ of a)this.programConfigurations[_.id]=new qE(_,h,p);this.needsUpload=!1,this._featureMap=new Uc,this._bufferOffset=0}populatePaintArrays(a,h,p,_,w,x){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(a,h,_,w,x);h.id!==void 0&&this._featureMap.add(h.id,p,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,h,p,_){for(const w of p)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(a,this._featureMap,h,w,_)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function S6(u,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${a}-`,"").replace(/-/g,"_")]}function WE(u,a,h){const p={color:{source:Q,composite:Lt},number:{source:lt,composite:Q}},_=function(w){return{"line-pattern":{source:en,composite:en},"fill-pattern":{source:en,composite:en},"fill-extrusion-pattern":{source:en,composite:en}}[w]}(u);return _&&_[h]||p[a][h]}mt("ConstantBinder",kp),mt("CrossFadedConstantBinder",hh),mt("SourceExpressionBinder",Ra),mt("CrossFadedCompositeBinder",Sl),mt("CompositeExpressionBinder",_o),mt("ProgramConfiguration",qE,{omit:["_buffers"]}),mt("ProgramConfigurationSet",jc);const ur=8192,_y=Math.pow(2,14)-1,XE=-_y-1;function Gc(u){const a=ur/u.extent,h=u.loadGeometry();for(let p=0;p<h.length;p++){const _=h[p];for(let w=0;w<_.length;w++){const x=_[w],A=Math.round(x.x*a),C=Math.round(x.y*a);x.x=we(A,XE,_y),x.y=we(C,XE,_y),(A<x.x||A>x.x+1||C<x.y||C>x.y+1)&&We("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Vc(u,a){return{type:u.type,id:u.id,properties:u.properties,geometry:a?Gc(u):[]}}function Eg(u,a,h,p,_){u.emplaceBack(2*a+(p+1)/2,2*h+(_+1)/2)}class yy{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(h=>h.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new as,this.indexArray=new En,this.segments=new Jt,this.programConfigurations=new jc(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(a,h,p){const _=this.layers[0],w=[];let x=null,A=!1;_.type==="circle"&&(x=_.layout.get("circle-sort-key"),A=!x.isConstant());for(const{feature:C,id:P,index:k,sourceLayerIndex:L}of a){const U=this.layers[0]._featureFilter.needGeometry,$=Vc(C,U);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom),$,p))continue;const J=A?x.evaluate($,{},p):void 0,Z={id:P,properties:C.properties,type:C.type,sourceLayerIndex:L,index:k,geometry:U?$.geometry:Gc(C),patterns:{},sortKey:J};w.push(Z)}A&&w.sort((C,P)=>C.sortKey-P.sortKey);for(const C of w){const{geometry:P,index:k,sourceLayerIndex:L}=C,U=a[k].feature;this.addFeature(C,P,k,p),h.featureIndex.insert(U,P,k,L,this.index)}}update(a,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,zs),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,h,p,_){for(const w of h)for(const x of w){const A=x.x,C=x.y;if(A<0||A>=ur||C<0||C>=ur)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),k=P.vertexLength;Eg(this.layoutVertexArray,A,C,-1,-1),Eg(this.layoutVertexArray,A,C,1,-1),Eg(this.layoutVertexArray,A,C,1,1),Eg(this.layoutVertexArray,A,C,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},_)}}function KE(u,a){for(let h=0;h<u.length;h++)if(dh(a,u[h]))return!0;for(let h=0;h<a.length;h++)if(dh(u,a[h]))return!0;return!!vy(u,a)}function C6(u,a,h){return!!dh(u,a)||!!by(a,u,h)}function JE(u,a){if(u.length===1)return YE(a,u[0]);for(let h=0;h<a.length;h++){const p=a[h];for(let _=0;_<p.length;_++)if(dh(u,p[_]))return!0}for(let h=0;h<u.length;h++)if(YE(a,u[h]))return!0;for(let h=0;h<a.length;h++)if(vy(u,a[h]))return!0;return!1}function I6(u,a,h){if(u.length>1){if(vy(u,a))return!0;for(let p=0;p<a.length;p++)if(by(a[p],u,h))return!0}for(let p=0;p<u.length;p++)if(by(u[p],a,h))return!0;return!1}function vy(u,a){if(u.length===0||a.length===0)return!1;for(let h=0;h<u.length-1;h++){const p=u[h],_=u[h+1];for(let w=0;w<a.length-1;w++)if(R6(p,_,a[w],a[w+1]))return!0}return!1}function R6(u,a,h,p){return Ze(u,h,p)!==Ze(a,h,p)&&Ze(u,a,h)!==Ze(u,a,p)}function by(u,a,h){const p=h*h;if(a.length===1)return u.distSqr(a[0])<p;for(let _=1;_<a.length;_++)if(ZE(u,a[_-1],a[_])<p)return!0;return!1}function ZE(u,a,h){const p=a.distSqr(h);if(p===0)return u.distSqr(a);const _=((u.x-a.x)*(h.x-a.x)+(u.y-a.y)*(h.y-a.y))/p;return u.distSqr(_<0?a:_>1?h:h.sub(a)._mult(_)._add(a))}function YE(u,a){let h,p,_,w=!1;for(let x=0;x<u.length;x++){h=u[x];for(let A=0,C=h.length-1;A<h.length;C=A++)p=h[A],_=h[C],p.y>a.y!=_.y>a.y&&a.x<(_.x-p.x)*(a.y-p.y)/(_.y-p.y)+p.x&&(w=!w)}return w}function dh(u,a){let h=!1;for(let p=0,_=u.length-1;p<u.length;_=p++){const w=u[p],x=u[_];w.y>a.y!=x.y>a.y&&a.x<(x.x-w.x)*(a.y-w.y)/(x.y-w.y)+w.x&&(h=!h)}return h}function M6(u,a,h){const p=h[0],_=h[2];if(u.x<p.x&&a.x<p.x||u.x>_.x&&a.x>_.x||u.y<p.y&&a.y<p.y||u.y>_.y&&a.y>_.y)return!1;const w=Ze(u,a,h[0]);return w!==Ze(u,a,h[1])||w!==Ze(u,a,h[2])||w!==Ze(u,a,h[3])}function Bp(u,a,h){const p=a.paint.get(u).value;return p.kind==="constant"?p.value:h.programConfigurations.get(a.id).getMaxValue(u)}function Ag(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Tg(u,a,h,p,_){if(!a[0]&&!a[1])return u;const w=T.convert(a)._mult(_);h==="viewport"&&w._rotate(-p);const x=[];for(let A=0;A<u.length;A++)x.push(u[A].sub(w));return x}let QE,eA;mt("CircleBucket",yy,{omit:["layers"]});var P6={get paint(){return eA=eA||new b({"circle-radius":new Rt(Oe.paint_circle["circle-radius"]),"circle-color":new Rt(Oe.paint_circle["circle-color"]),"circle-blur":new Rt(Oe.paint_circle["circle-blur"]),"circle-opacity":new Rt(Oe.paint_circle["circle-opacity"]),"circle-translate":new _t(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new _t(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _t(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _t(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Rt(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Rt(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Rt(Oe.paint_circle["circle-stroke-opacity"])})},get layout(){return QE=QE||new b({"circle-sort-key":new Rt(Oe.layout_circle["circle-sort-key"])})}},bs=1e-6,ph=typeof Float32Array<"u"?Float32Array:Array;function wy(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function tA(u,a,h){var p=a[0],_=a[1],w=a[2],x=a[3],A=a[4],C=a[5],P=a[6],k=a[7],L=a[8],U=a[9],$=a[10],J=a[11],Z=a[12],ae=a[13],he=a[14],Me=a[15],ve=h[0],Se=h[1],Fe=h[2],He=h[3];return u[0]=ve*p+Se*A+Fe*L+He*Z,u[1]=ve*_+Se*C+Fe*U+He*ae,u[2]=ve*w+Se*P+Fe*$+He*he,u[3]=ve*x+Se*k+Fe*J+He*Me,u[4]=(ve=h[4])*p+(Se=h[5])*A+(Fe=h[6])*L+(He=h[7])*Z,u[5]=ve*_+Se*C+Fe*U+He*ae,u[6]=ve*w+Se*P+Fe*$+He*he,u[7]=ve*x+Se*k+Fe*J+He*Me,u[8]=(ve=h[8])*p+(Se=h[9])*A+(Fe=h[10])*L+(He=h[11])*Z,u[9]=ve*_+Se*C+Fe*U+He*ae,u[10]=ve*w+Se*P+Fe*$+He*he,u[11]=ve*x+Se*k+Fe*J+He*Me,u[12]=(ve=h[12])*p+(Se=h[13])*A+(Fe=h[14])*L+(He=h[15])*Z,u[13]=ve*_+Se*C+Fe*U+He*ae,u[14]=ve*w+Se*P+Fe*$+He*he,u[15]=ve*x+Se*k+Fe*J+He*Me,u}Math.hypot||(Math.hypot=function(){for(var u=0,a=arguments.length;a--;)u+=arguments[a]*arguments[a];return Math.sqrt(u)});var Lp,k6=tA;function Sg(u,a,h){var p=a[0],_=a[1],w=a[2],x=a[3];return u[0]=h[0]*p+h[4]*_+h[8]*w+h[12]*x,u[1]=h[1]*p+h[5]*_+h[9]*w+h[13]*x,u[2]=h[2]*p+h[6]*_+h[10]*w+h[14]*x,u[3]=h[3]*p+h[7]*_+h[11]*w+h[15]*x,u}Lp=new ph(4),ph!=Float32Array&&(Lp[0]=0,Lp[1]=0,Lp[2]=0,Lp[3]=0);class B6 extends d{constructor(a){super(a,P6)}createBucket(a){return new yy(a)}queryRadius(a){const h=a;return Bp("circle-radius",this,h)+Bp("circle-stroke-width",this,h)+Ag(this.paint.get("circle-translate"))}queryIntersectsFeature(a,h,p,_,w,x,A,C){const P=Tg(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,A),k=this.paint.get("circle-radius").evaluate(h,p)+this.paint.get("circle-stroke-width").evaluate(h,p),L=this.paint.get("circle-pitch-alignment")==="map",U=L?P:function(J,Z){return J.map(ae=>iA(ae,Z))}(P,C),$=L?k*A:k;for(const J of _)for(const Z of J){const ae=L?Z:iA(Z,C);let he=$;const Me=Sg([],[Z.x,Z.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?he*=Me[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(he*=x.cameraToCenterDistance/Me[3]),C6(U,ae,he))return!0}return!1}}function iA(u,a){const h=Sg([],[u.x,u.y,0,1],a);return new T(h[0]/h[3],h[1]/h[3])}class rA extends yy{}let sA;mt("HeatmapBucket",rA,{omit:["layers"]});var L6={get paint(){return sA=sA||new b({"heatmap-radius":new Rt(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Rt(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _t(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mp(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _t(Oe.paint_heatmap["heatmap-opacity"])})}};function xy(u,{width:a,height:h},p,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==a*h*p)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${a*h*p}`)}else _=new Uint8Array(a*h*p);return u.width=a,u.height=h,u.data=_,u}function nA(u,{width:a,height:h},p){if(a===u.width&&h===u.height)return;const _=xy({},{width:a,height:h},p);Ey(u,_,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,a),height:Math.min(u.height,h)},p),u.width=a,u.height=h,u.data=_.data}function Ey(u,a,h,p,_,w){if(_.width===0||_.height===0)return a;if(_.width>u.width||_.height>u.height||h.x>u.width-_.width||h.y>u.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>a.width||_.height>a.height||p.x>a.width-_.width||p.y>a.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const x=u.data,A=a.data;if(x===A)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<_.height;C++){const P=((h.y+C)*u.width+h.x)*w,k=((p.y+C)*a.width+p.x)*w;for(let L=0;L<_.width*w;L++)A[k+L]=x[P+L]}return a}class Op{constructor(a,h){xy(this,a,1,h)}resize(a){nA(this,a,1)}clone(){return new Op({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,h,p,_,w){Ey(a,h,p,_,w,1)}}class An{constructor(a,h){xy(this,a,4,h)}resize(a){nA(this,a,4)}replace(a,h){h?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new An({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,h,p,_,w){Ey(a,h,p,_,w,4)}}function oA(u){const a={},h=u.resolution||256,p=u.clips?u.clips.length:1,_=u.image||new An({width:h,height:p});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const w=(x,A,C)=>{a[u.evaluationKey]=C;const P=u.expression.evaluate(a);_.data[x+A+0]=Math.floor(255*P.r/P.a),_.data[x+A+1]=Math.floor(255*P.g/P.a),_.data[x+A+2]=Math.floor(255*P.b/P.a),_.data[x+A+3]=Math.floor(255*P.a)};if(u.clips)for(let x=0,A=0;x<p;++x,A+=4*h)for(let C=0,P=0;C<h;C++,P+=4){const k=C/(h-1),{start:L,end:U}=u.clips[x];w(A,P,L*(1-k)+U*k)}else for(let x=0,A=0;x<h;x++,A+=4)w(0,A,x/(h-1));return _}mt("AlphaImage",Op),mt("RGBAImage",An);const Ay="big-fb";class O6 extends d{createBucket(a){return new rA(a)}constructor(a){super(a,L6),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=oA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Ay)&&this.heatmapFbos.delete(Ay)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let aA;var D6={get paint(){return aA=aA||new b({"hillshade-illumination-direction":new _t(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _t(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _t(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _t(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _t(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _t(Oe.paint_hillshade["hillshade-accent-color"])})}};class F6 extends d{constructor(a){super(a,D6)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const N6=S([{name:"a_pos",components:2,type:"Int16"}],4),{members:U6}=N6;function lA(u,a,h=2){const p=a&&a.length,_=p?a[0]*h:u.length;let w=cA(u,0,_,h,!0);const x=[];if(!w||w.next===w.prev)return x;let A,C,P;if(p&&(w=function(k,L,U,$){const J=[];for(let Z=0,ae=L.length;Z<ae;Z++){const he=cA(k,L[Z]*$,Z<ae-1?L[Z+1]*$:k.length,$,!1);he===he.next&&(he.steiner=!0),J.push(W6(he))}J.sort($6);for(let Z=0;Z<J.length;Z++)U=H6(J[Z],U);return U}(u,a,w,h)),u.length>80*h){A=1/0,C=1/0;let k=-1/0,L=-1/0;for(let U=h;U<_;U+=h){const $=u[U],J=u[U+1];$<A&&(A=$),J<C&&(C=J),$>k&&(k=$),J>L&&(L=J)}P=Math.max(k-A,L-C),P=P!==0?32767/P:0}return Dp(w,x,h,A,C,P,0),x}function cA(u,a,h,p,_){let w;if(_===function(x,A,C,P){let k=0;for(let L=A,U=C-P;L<C;L+=P)k+=(x[U]-x[L])*(x[L+1]+x[U+1]),U=L;return k}(u,a,h,p)>0)for(let x=a;x<h;x+=p)w=dA(x/p|0,u[x],u[x+1],w);else for(let x=h-p;x>=a;x-=p)w=dA(x/p|0,u[x],u[x+1],w);return w&&Cg(w,w.next)&&(Np(w),w=w.next),w}function $c(u,a){if(!u)return u;a||(a=u);let h,p=u;do if(h=!1,p.steiner||!Cg(p,p.next)&&nr(p.prev,p,p.next)!==0)p=p.next;else{if(Np(p),p=a=p.prev,p===p.next)break;h=!0}while(h||p!==a);return a}function Dp(u,a,h,p,_,w,x){if(!u)return;!x&&w&&function(C,P,k,L){let U=C;do U.z===0&&(U.z=Ty(U.x,U.y,P,k,L)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==C);U.prevZ.nextZ=null,U.prevZ=null,function($){let J,Z=1;do{let ae,he=$;$=null;let Me=null;for(J=0;he;){J++;let ve=he,Se=0;for(let He=0;He<Z&&(Se++,ve=ve.nextZ,ve);He++);let Fe=Z;for(;Se>0||Fe>0&&ve;)Se!==0&&(Fe===0||!ve||he.z<=ve.z)?(ae=he,he=he.nextZ,Se--):(ae=ve,ve=ve.nextZ,Fe--),Me?Me.nextZ=ae:$=ae,ae.prevZ=Me,Me=ae;he=ve}Me.nextZ=null,Z*=2}while(J>1)}(U)}(u,p,_,w);let A=u;for(;u.prev!==u.next;){const C=u.prev,P=u.next;if(w?j6(u,p,_,w):z6(u))a.push(C.i,u.i,P.i),Np(u),u=P.next,A=P.next;else if((u=P)===A){x?x===1?Dp(u=G6($c(u),a),a,h,p,_,w,2):x===2&&V6(u,a,h,p,_,w):Dp($c(u),a,h,p,_,w,1);break}}}function z6(u){const a=u.prev,h=u,p=u.next;if(nr(a,h,p)>=0)return!1;const _=a.x,w=h.x,x=p.x,A=a.y,C=h.y,P=p.y,k=_<w?_<x?_:x:w<x?w:x,L=A<C?A<P?A:P:C<P?C:P,U=_>w?_>x?_:x:w>x?w:x,$=A>C?A>P?A:P:C>P?C:P;let J=p.next;for(;J!==a;){if(J.x>=k&&J.x<=U&&J.y>=L&&J.y<=$&&fh(_,A,w,C,x,P,J.x,J.y)&&nr(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function j6(u,a,h,p){const _=u.prev,w=u,x=u.next;if(nr(_,w,x)>=0)return!1;const A=_.x,C=w.x,P=x.x,k=_.y,L=w.y,U=x.y,$=A<C?A<P?A:P:C<P?C:P,J=k<L?k<U?k:U:L<U?L:U,Z=A>C?A>P?A:P:C>P?C:P,ae=k>L?k>U?k:U:L>U?L:U,he=Ty($,J,a,h,p),Me=Ty(Z,ae,a,h,p);let ve=u.prevZ,Se=u.nextZ;for(;ve&&ve.z>=he&&Se&&Se.z<=Me;){if(ve.x>=$&&ve.x<=Z&&ve.y>=J&&ve.y<=ae&&ve!==_&&ve!==x&&fh(A,k,C,L,P,U,ve.x,ve.y)&&nr(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,Se.x>=$&&Se.x<=Z&&Se.y>=J&&Se.y<=ae&&Se!==_&&Se!==x&&fh(A,k,C,L,P,U,Se.x,Se.y)&&nr(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;ve&&ve.z>=he;){if(ve.x>=$&&ve.x<=Z&&ve.y>=J&&ve.y<=ae&&ve!==_&&ve!==x&&fh(A,k,C,L,P,U,ve.x,ve.y)&&nr(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;Se&&Se.z<=Me;){if(Se.x>=$&&Se.x<=Z&&Se.y>=J&&Se.y<=ae&&Se!==_&&Se!==x&&fh(A,k,C,L,P,U,Se.x,Se.y)&&nr(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function G6(u,a){let h=u;do{const p=h.prev,_=h.next.next;!Cg(p,_)&&uA(p,h,h.next,_)&&Fp(p,_)&&Fp(_,p)&&(a.push(p.i,h.i,_.i),Np(h),Np(h.next),h=u=_),h=h.next}while(h!==u);return $c(h)}function V6(u,a,h,p,_,w){let x=u;do{let A=x.next.next;for(;A!==x.prev;){if(x.i!==A.i&&X6(x,A)){let C=hA(x,A);return x=$c(x,x.next),C=$c(C,C.next),Dp(x,a,h,p,_,w,0),void Dp(C,a,h,p,_,w,0)}A=A.next}x=x.next}while(x!==u)}function $6(u,a){return u.x-a.x}function H6(u,a){const h=function(_,w){let x=w;const A=_.x,C=_.y;let P,k=-1/0;do{if(C<=x.y&&C>=x.next.y&&x.next.y!==x.y){const Z=x.x+(C-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(Z<=A&&Z>k&&(k=Z,P=x.x<x.next.x?x:x.next,Z===A))return P}x=x.next}while(x!==w);if(!P)return null;const L=P,U=P.x,$=P.y;let J=1/0;x=P;do{if(A>=x.x&&x.x>=U&&A!==x.x&&fh(C<$?A:k,C,U,$,C<$?k:A,C,x.x,x.y)){const Z=Math.abs(C-x.y)/(A-x.x);Fp(x,_)&&(Z<J||Z===J&&(x.x>P.x||x.x===P.x&&q6(P,x)))&&(P=x,J=Z)}x=x.next}while(x!==L);return P}(u,a);if(!h)return a;const p=hA(h,u);return $c(p,p.next),$c(h,h.next)}function q6(u,a){return nr(u.prev,u,a.prev)<0&&nr(a.next,u,u.next)<0}function Ty(u,a,h,p,_){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-h)*_|0)|u<<8))|u<<4))|u<<2))|u<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-p)*_|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function W6(u){let a=u,h=u;do(a.x<h.x||a.x===h.x&&a.y<h.y)&&(h=a),a=a.next;while(a!==u);return h}function fh(u,a,h,p,_,w,x,A){return(_-x)*(a-A)>=(u-x)*(w-A)&&(u-x)*(p-A)>=(h-x)*(a-A)&&(h-x)*(w-A)>=(_-x)*(p-A)}function X6(u,a){return u.next.i!==a.i&&u.prev.i!==a.i&&!function(h,p){let _=h;do{if(_.i!==h.i&&_.next.i!==h.i&&_.i!==p.i&&_.next.i!==p.i&&uA(_,_.next,h,p))return!0;_=_.next}while(_!==h);return!1}(u,a)&&(Fp(u,a)&&Fp(a,u)&&function(h,p){let _=h,w=!1;const x=(h.x+p.x)/2,A=(h.y+p.y)/2;do _.y>A!=_.next.y>A&&_.next.y!==_.y&&x<(_.next.x-_.x)*(A-_.y)/(_.next.y-_.y)+_.x&&(w=!w),_=_.next;while(_!==h);return w}(u,a)&&(nr(u.prev,u,a.prev)||nr(u,a.prev,a))||Cg(u,a)&&nr(u.prev,u,u.next)>0&&nr(a.prev,a,a.next)>0)}function nr(u,a,h){return(a.y-u.y)*(h.x-a.x)-(a.x-u.x)*(h.y-a.y)}function Cg(u,a){return u.x===a.x&&u.y===a.y}function uA(u,a,h,p){const _=Rg(nr(u,a,h)),w=Rg(nr(u,a,p)),x=Rg(nr(h,p,u)),A=Rg(nr(h,p,a));return _!==w&&x!==A||!(_!==0||!Ig(u,h,a))||!(w!==0||!Ig(u,p,a))||!(x!==0||!Ig(h,u,p))||!(A!==0||!Ig(h,a,p))}function Ig(u,a,h){return a.x<=Math.max(u.x,h.x)&&a.x>=Math.min(u.x,h.x)&&a.y<=Math.max(u.y,h.y)&&a.y>=Math.min(u.y,h.y)}function Rg(u){return u>0?1:u<0?-1:0}function Fp(u,a){return nr(u.prev,u,u.next)<0?nr(u,a,u.next)>=0&&nr(u,u.prev,a)>=0:nr(u,a,u.prev)<0||nr(u,u.next,a)<0}function hA(u,a){const h=Sy(u.i,u.x,u.y),p=Sy(a.i,a.x,a.y),_=u.next,w=a.prev;return u.next=a,a.prev=u,h.next=_,_.prev=h,p.next=h,h.prev=p,w.next=p,p.prev=w,p}function dA(u,a,h,p){const _=Sy(u,a,h);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function Np(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Sy(u,a,h){return{i:u,x:a,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Cy(u,a,h){const p=h.patternDependencies;let _=!1;for(const w of a){const x=w.paint.get(`${u}-pattern`);x.isConstant()||(_=!0);const A=x.constantOr(null);A&&(_=!0,p[A.to]=!0,p[A.from]=!0)}return _}function Iy(u,a,h,p,_){const w=_.patternDependencies;for(const x of a){const A=x.paint.get(`${u}-pattern`).value;if(A.kind!=="constant"){let C=A.evaluate({zoom:p-1},h,{},_.availableImages),P=A.evaluate({zoom:p},h,{},_.availableImages),k=A.evaluate({zoom:p+1},h,{},_.availableImages);C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,k=k&&k.name?k.name:k,w[C]=!0,w[P]=!0,w[k]=!0,h.patterns[x.id]={min:C,mid:P,max:k}}}return h}class Ry{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(h=>h.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Zn,this.indexArray=new En,this.indexArray2=new Mr,this.programConfigurations=new jc(a.layers,a.zoom),this.segments=new Jt,this.segments2=new Jt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(a,h,p){this.hasPattern=Cy("fill",this.layers,h);const _=this.layers[0].layout.get("fill-sort-key"),w=!_.isConstant(),x=[];for(const{feature:A,id:C,index:P,sourceLayerIndex:k}of a){const L=this.layers[0]._featureFilter.needGeometry,U=Vc(A,L);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom),U,p))continue;const $=w?_.evaluate(U,{},p,h.availableImages):void 0,J={id:C,properties:A.properties,type:A.type,sourceLayerIndex:k,index:P,geometry:L?U.geometry:Gc(A),patterns:{},sortKey:$};x.push(J)}w&&x.sort((A,C)=>A.sortKey-C.sortKey);for(const A of x){const{geometry:C,index:P,sourceLayerIndex:k}=A;if(this.hasPattern){const L=Iy("fill",this.layers,A,this.zoom,h);this.patternFeatures.push(L)}else this.addFeature(A,C,P,p,{});h.featureIndex.insert(a[P].feature,C,P,k,this.index)}}update(a,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,p)}addFeatures(a,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,U6),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,h,p,_,w){for(const x of Nu(h,500)){let A=0;for(const $ of x)A+=$.length;const C=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),P=C.vertexLength,k=[],L=[];for(const $ of x){if($.length===0)continue;$!==x[0]&&L.push(k.length/2);const J=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),Z=J.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(Z+$.length-1,Z),k.push($[0].x),k.push($[0].y);for(let ae=1;ae<$.length;ae++)this.layoutVertexArray.emplaceBack($[ae].x,$[ae].y),this.indexArray2.emplaceBack(Z+ae-1,Z+ae),k.push($[ae].x),k.push($[ae].y);J.vertexLength+=$.length,J.primitiveLength+=$.length}const U=lA(k,L);for(let $=0;$<U.length;$+=3)this.indexArray.emplaceBack(P+U[$],P+U[$+1],P+U[$+2]);C.vertexLength+=A,C.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,w,_)}}let pA,fA;mt("FillBucket",Ry,{omit:["layers","patternFeatures"]});var K6={get paint(){return fA=fA||new b({"fill-antialias":new _t(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Rt(Oe.paint_fill["fill-opacity"]),"fill-color":new Rt(Oe.paint_fill["fill-color"]),"fill-outline-color":new Rt(Oe.paint_fill["fill-outline-color"]),"fill-translate":new _t(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new _t(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new sh(Oe.paint_fill["fill-pattern"])})},get layout(){return pA=pA||new b({"fill-sort-key":new Rt(Oe.layout_fill["fill-sort-key"])})}};class J6 extends d{constructor(a){super(a,K6)}recalculate(a,h){super.recalculate(a,h);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Ry(a)}queryRadius(){return Ag(this.paint.get("fill-translate"))}queryIntersectsFeature(a,h,p,_,w,x,A){return JE(Tg(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,A),_)}isTileClipped(){return!0}}const Z6=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Y6=S([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Q6}=Z6;var Cl={},eL=y,mA=mh;function mh(u,a,h,p,_){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=p,this._values=_,u.readFields(tL,this,a)}function tL(u,a,h){u==1?a.id=h.readVarint():u==2?function(p,_){for(var w=p.readVarint()+p.pos;p.pos<w;){var x=_._keys[p.readVarint()],A=_._values[p.readVarint()];_.properties[x]=A}}(h,a):u==3?a.type=h.readVarint():u==4&&(a._geometry=h.pos)}function iL(u){for(var a,h,p=0,_=0,w=u.length,x=w-1;_<w;x=_++)p+=((h=u[x]).x-(a=u[_]).x)*(a.y+h.y);return p}mh.types=["Unknown","Point","LineString","Polygon"],mh.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var a,h=u.readVarint()+u.pos,p=1,_=0,w=0,x=0,A=[];u.pos<h;){if(_<=0){var C=u.readVarint();p=7&C,_=C>>3}if(_--,p===1||p===2)w+=u.readSVarint(),x+=u.readSVarint(),p===1&&(a&&A.push(a),a=[]),a.push(new eL(w,x));else{if(p!==7)throw new Error("unknown command "+p);a&&a.push(a[0].clone())}}return a&&A.push(a),A},mh.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var a=u.readVarint()+u.pos,h=1,p=0,_=0,w=0,x=1/0,A=-1/0,C=1/0,P=-1/0;u.pos<a;){if(p<=0){var k=u.readVarint();h=7&k,p=k>>3}if(p--,h===1||h===2)(_+=u.readSVarint())<x&&(x=_),_>A&&(A=_),(w+=u.readSVarint())<C&&(C=w),w>P&&(P=w);else if(h!==7)throw new Error("unknown command "+h)}return[x,C,A,P]},mh.prototype.toGeoJSON=function(u,a,h){var p,_,w=this.extent*Math.pow(2,h),x=this.extent*u,A=this.extent*a,C=this.loadGeometry(),P=mh.types[this.type];function k($){for(var J=0;J<$.length;J++){var Z=$[J];$[J]=[360*(Z.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+A)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(p=0;p<C.length;p++)L[p]=C[p][0];k(C=L);break;case 2:for(p=0;p<C.length;p++)k(C[p]);break;case 3:for(C=function($){var J=$.length;if(J<=1)return[$];for(var Z,ae,he=[],Me=0;Me<J;Me++){var ve=iL($[Me]);ve!==0&&(ae===void 0&&(ae=ve<0),ae===ve<0?(Z&&he.push(Z),Z=[$[Me]]):Z.push($[Me]))}return Z&&he.push(Z),he}(C),p=0;p<C.length;p++)for(_=0;_<C[p].length;_++)k(C[p][_])}C.length===1?C=C[0]:P="Multi"+P;var U={type:"Feature",geometry:{type:P,coordinates:C},properties:this.properties};return"id"in this&&(U.id=this.id),U};var rL=mA,gA=_A;function _A(u,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(sL,this,a),this.length=this._features.length}function sL(u,a,h){u===15?a.version=h.readVarint():u===1?a.name=h.readString():u===5?a.extent=h.readVarint():u===2?a._features.push(h.pos):u===3?a._keys.push(h.readString()):u===4&&a._values.push(function(p){for(var _=null,w=p.readVarint()+p.pos;p.pos<w;){var x=p.readVarint()>>3;_=x===1?p.readString():x===2?p.readFloat():x===3?p.readDouble():x===4?p.readVarint64():x===5?p.readVarint():x===6?p.readSVarint():x===7?p.readBoolean():null}return _}(h))}_A.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var a=this._pbf.readVarint()+this._pbf.pos;return new rL(this._pbf,a,this.extent,this._keys,this._values)};var nL=gA;function oL(u,a,h){if(u===3){var p=new nL(h,h.readVarint()+h.pos);p.length&&(a[p.name]=p)}}Cl.VectorTile=function(u,a){this.layers=u.readFields(oL,{},a)},Cl.VectorTileFeature=mA,Cl.VectorTileLayer=gA;const aL=Cl.VectorTileFeature.types,My=Math.pow(2,13);function Up(u,a,h,p,_,w,x,A){u.emplaceBack(a,h,2*Math.floor(p*My)+x,_*My*2,w*My*2,Math.round(A))}class Py{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(h=>h.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new wl,this.centroidVertexArray=new $r,this.indexArray=new En,this.programConfigurations=new jc(a.layers,a.zoom),this.segments=new Jt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(a,h,p){this.features=[],this.hasPattern=Cy("fill-extrusion",this.layers,h);for(const{feature:_,id:w,index:x,sourceLayerIndex:A}of a){const C=this.layers[0]._featureFilter.needGeometry,P=Vc(_,C);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom),P,p))continue;const k={id:w,sourceLayerIndex:A,index:x,geometry:C?P.geometry:Gc(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Iy("fill-extrusion",this.layers,k,this.zoom,h)):this.addFeature(k,k.geometry,x,p,{}),h.featureIndex.insert(_,k.geometry,x,A,this.index,!0)}}addFeatures(a,h,p){for(const _ of this.features){const{geometry:w}=_;this.addFeature(_,w,_.index,h,p)}}update(a,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Q6),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Y6.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,h,p,_,w){for(const x of Nu(h,500)){const A={x:0,y:0,vertexCount:0};let C=0;for(const J of x)C+=J.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const J of x){if(J.length===0||cL(J))continue;let Z=0;for(let ae=0;ae<J.length;ae++){const he=J[ae];if(ae>=1){const Me=J[ae-1];if(!lL(he,Me)){P.vertexLength+4>Jt.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ve=he.sub(Me)._perp()._unit(),Se=Me.dist(he);Z+Se>32768&&(Z=0),Up(this.layoutVertexArray,he.x,he.y,ve.x,ve.y,0,0,Z),Up(this.layoutVertexArray,he.x,he.y,ve.x,ve.y,0,1,Z),A.x+=2*he.x,A.y+=2*he.y,A.vertexCount+=2,Z+=Se,Up(this.layoutVertexArray,Me.x,Me.y,ve.x,ve.y,0,0,Z),Up(this.layoutVertexArray,Me.x,Me.y,ve.x,ve.y,0,1,Z),A.x+=2*Me.x,A.y+=2*Me.y,A.vertexCount+=2;const Fe=P.vertexLength;this.indexArray.emplaceBack(Fe,Fe+2,Fe+1),this.indexArray.emplaceBack(Fe+1,Fe+2,Fe+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+C>Jt.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),aL[a.type]!=="Polygon")continue;const k=[],L=[],U=P.vertexLength;for(const J of x)if(J.length!==0){J!==x[0]&&L.push(k.length/2);for(let Z=0;Z<J.length;Z++){const ae=J[Z];Up(this.layoutVertexArray,ae.x,ae.y,0,0,1,1,0),A.x+=ae.x,A.y+=ae.y,A.vertexCount+=1,k.push(ae.x),k.push(ae.y)}}const $=lA(k,L);for(let J=0;J<$.length;J+=3)this.indexArray.emplaceBack(U+$[J],U+$[J+2],U+$[J+1]);P.primitiveLength+=$.length/3,P.vertexLength+=C;for(let J=0;J<A.vertexCount;J++){const Z=Math.floor(A.x/A.vertexCount),ae=Math.floor(A.y/A.vertexCount);this.centroidVertexArray.emplaceBack(Z,ae)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,w,_)}}function lL(u,a){return u.x===a.x&&(u.x<0||u.x>ur)||u.y===a.y&&(u.y<0||u.y>ur)}function cL(u){return u.every(a=>a.x<0)||u.every(a=>a.x>ur)||u.every(a=>a.y<0)||u.every(a=>a.y>ur)}let yA;mt("FillExtrusionBucket",Py,{omit:["layers","features"]});var uL={get paint(){return yA=yA||new b({"fill-extrusion-opacity":new _t(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Rt(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _t(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _t(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sh(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Rt(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Rt(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _t(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class hL extends d{constructor(a){super(a,uL)}createBucket(a){return new Py(a)}queryRadius(){return Ag(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,h,p,_,w,x,A,C){const P=Tg(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,A),k=this.paint.get("fill-extrusion-height").evaluate(h,p),L=this.paint.get("fill-extrusion-base").evaluate(h,p),U=function(J,Z,ae,he){const Me=[];for(const ve of J){const Se=[ve.x,ve.y,0,1];Sg(Se,Se,Z),Me.push(new T(Se[0]/Se[3],Se[1]/Se[3]))}return Me}(P,C),$=function(J,Z,ae,he){const Me=[],ve=[],Se=he[8]*Z,Fe=he[9]*Z,He=he[10]*Z,ht=he[11]*Z,It=he[8]*ae,ct=he[9]*ae,at=he[10]*ae,bt=he[11]*ae;for(const gt of J){const ft=[],je=[];for(const Et of gt){const vt=Et.x,Bt=Et.y,Ei=he[0]*vt+he[4]*Bt+he[12],yi=he[1]*vt+he[5]*Bt+he[13],xr=he[2]*vt+he[6]*Bt+he[14],Yn=he[3]*vt+he[7]*Bt+he[15],Wr=xr+He,Er=Yn+ht,ws=Ei+It,xs=yi+ct,Es=xr+at,tr=Yn+bt,Ar=new T((Ei+Se)/Er,(yi+Fe)/Er);Ar.z=Wr/Er,ft.push(Ar);const ls=new T(ws/tr,xs/tr);ls.z=Es/tr,je.push(ls)}Me.push(ft),ve.push(je)}return[Me,ve]}(_,L,k,C);return function(J,Z,ae){let he=1/0;JE(ae,Z)&&(he=vA(ae,Z[0]));for(let Me=0;Me<Z.length;Me++){const ve=Z[Me],Se=J[Me];for(let Fe=0;Fe<ve.length-1;Fe++){const He=ve[Fe],ht=[He,ve[Fe+1],Se[Fe+1],Se[Fe],He];KE(ae,ht)&&(he=Math.min(he,vA(ae,ht)))}}return he!==1/0&&he}($[0],$[1],U)}}function zp(u,a){return u.x*a.x+u.y*a.y}function vA(u,a){if(u.length===1){let h=0;const p=a[h++];let _;for(;!_||p.equals(_);)if(_=a[h++],!_)return 1/0;for(;h<a.length;h++){const w=a[h],x=u[0],A=_.sub(p),C=w.sub(p),P=x.sub(p),k=zp(A,A),L=zp(A,C),U=zp(C,C),$=zp(P,A),J=zp(P,C),Z=k*U-L*L,ae=(U*$-L*J)/Z,he=(k*J-L*$)/Z,Me=p.z*(1-ae-he)+_.z*ae+w.z*he;if(isFinite(Me))return Me}return 1/0}{let h=1/0;for(const p of a)h=Math.min(h,p.z);return h}}const dL=S([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:pL}=dL,fL=S([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:mL}=fL,gL=Cl.VectorTileFeature.types,_L=Math.cos(Math.PI/180*37.5),bA=Math.pow(2,14)/.5;class ky{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(h=>h.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new oh,this.layoutVertexArray2=new xl,this.indexArray=new En,this.programConfigurations=new jc(a.layers,a.zoom),this.segments=new Jt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(a,h,p){this.hasPattern=Cy("line",this.layers,h);const _=this.layers[0].layout.get("line-sort-key"),w=!_.isConstant(),x=[];for(const{feature:A,id:C,index:P,sourceLayerIndex:k}of a){const L=this.layers[0]._featureFilter.needGeometry,U=Vc(A,L);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom),U,p))continue;const $=w?_.evaluate(U,{},p):void 0,J={id:C,properties:A.properties,type:A.type,sourceLayerIndex:k,index:P,geometry:L?U.geometry:Gc(A),patterns:{},sortKey:$};x.push(J)}w&&x.sort((A,C)=>A.sortKey-C.sortKey);for(const A of x){const{geometry:C,index:P,sourceLayerIndex:k}=A;if(this.hasPattern){const L=Iy("line",this.layers,A,this.zoom,h);this.patternFeatures.push(L)}else this.addFeature(A,C,P,p,{});h.featureIndex.insert(a[P].feature,C,P,k,this.index)}}update(a,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,p)}addFeatures(a,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,mL)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,pL),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,h,p,_,w){const x=this.layers[0].layout,A=x.get("line-join").evaluate(a,{}),C=x.get("line-cap"),P=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const L of h)this.addLine(L,a,A,C,P,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,w,_)}addLine(a,h,p,_,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let he=0;he<a.length-1;he++)this.totalDistance+=a[he].dist(a[he+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=gL[h.type]==="Polygon";let C=a.length;for(;C>=2&&a[C-1].equals(a[C-2]);)C--;let P=0;for(;P<C-1&&a[P].equals(a[P+1]);)P++;if(C<(A?3:2))return;p==="bevel"&&(w=1.05);const k=this.overscaling<=16?15*ur/(512*this.overscaling):0,L=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let U,$,J,Z,ae;this.e1=this.e2=-1,A&&(U=a[C-2],ae=a[P].sub(U)._unit()._perp());for(let he=P;he<C;he++){if(J=he===C-1?A?a[P+1]:void 0:a[he+1],J&&a[he].equals(J))continue;ae&&(Z=ae),U&&($=U),U=a[he],ae=J?J.sub(U)._unit()._perp():Z,Z=Z||ae;let Me=Z.add(ae);Me.x===0&&Me.y===0||Me._unit();const ve=Z.x*ae.x+Z.y*ae.y,Se=Me.x*ae.x+Me.y*ae.y,Fe=Se!==0?1/Se:1/0,He=2*Math.sqrt(2-2*Se),ht=Se<_L&&$&&J,It=Z.x*ae.y-Z.y*ae.x>0;if(ht&&he>P){const bt=U.dist($);if(bt>2*k){const gt=U.sub(U.sub($)._mult(k/bt)._round());this.updateDistance($,gt),this.addCurrentVertex(gt,Z,0,0,L),$=gt}}const ct=$&&J;let at=ct?p:A?"butt":_;if(ct&&at==="round"&&(Fe<x?at="miter":Fe<=2&&(at="fakeround")),at==="miter"&&Fe>w&&(at="bevel"),at==="bevel"&&(Fe>2&&(at="flipbevel"),Fe<w&&(at="miter")),$&&this.updateDistance($,U),at==="miter")Me._mult(Fe),this.addCurrentVertex(U,Me,0,0,L);else if(at==="flipbevel"){if(Fe>100)Me=ae.mult(-1);else{const bt=Fe*Z.add(ae).mag()/Z.sub(ae).mag();Me._perp()._mult(bt*(It?-1:1))}this.addCurrentVertex(U,Me,0,0,L),this.addCurrentVertex(U,Me.mult(-1),0,0,L)}else if(at==="bevel"||at==="fakeround"){const bt=-Math.sqrt(Fe*Fe-1),gt=It?bt:0,ft=It?0:bt;if($&&this.addCurrentVertex(U,Z,gt,ft,L),at==="fakeround"){const je=Math.round(180*He/Math.PI/20);for(let Et=1;Et<je;Et++){let vt=Et/je;if(vt!==.5){const Ei=vt-.5;vt+=vt*Ei*(vt-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*Ei*Ei+(.848013+ve*(.215638*ve-1.06021)))}const Bt=ae.sub(Z)._mult(vt)._add(Z)._unit()._mult(It?-1:1);this.addHalfVertex(U,Bt.x,Bt.y,!1,It,0,L)}}J&&this.addCurrentVertex(U,ae,-gt,-ft,L)}else if(at==="butt")this.addCurrentVertex(U,Me,0,0,L);else if(at==="square"){const bt=$?1:-1;this.addCurrentVertex(U,Me,bt,bt,L)}else at==="round"&&($&&(this.addCurrentVertex(U,Z,0,0,L),this.addCurrentVertex(U,Z,1,1,L,!0)),J&&(this.addCurrentVertex(U,ae,-1,-1,L,!0),this.addCurrentVertex(U,ae,0,0,L)));if(ht&&he<C-1){const bt=U.dist(J);if(bt>2*k){const gt=U.add(J.sub(U)._mult(k/bt)._round());this.updateDistance(U,gt),this.addCurrentVertex(gt,ae,0,0,L),U=gt}}}}addCurrentVertex(a,h,p,_,w,x=!1){const A=h.y*_-h.x,C=-h.y-h.x*_;this.addHalfVertex(a,h.x+h.y*p,h.y-h.x*p,x,!1,p,w),this.addHalfVertex(a,A,C,x,!0,-_,w),this.distance>bA/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,h,p,_,w,x))}addHalfVertex({x:a,y:h},p,_,w,x,A,C){const P=.5*(this.lineClips?this.scaledDistance*(bA-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(w?1:0),(h<<1)+(x?1:0),Math.round(63*p)+128,Math.round(63*_)+128,1+(A===0?0:A<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),C.primitiveLength++),x?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,h){this.distance+=a.dist(h),this.updateScaledDistance()}}let wA,xA;mt("LineBucket",ky,{omit:["layers","patternFeatures"]});var EA={get paint(){return xA=xA||new b({"line-opacity":new Rt(Oe.paint_line["line-opacity"]),"line-color":new Rt(Oe.paint_line["line-color"]),"line-translate":new _t(Oe.paint_line["line-translate"]),"line-translate-anchor":new _t(Oe.paint_line["line-translate-anchor"]),"line-width":new Rt(Oe.paint_line["line-width"]),"line-gap-width":new Rt(Oe.paint_line["line-gap-width"]),"line-offset":new Rt(Oe.paint_line["line-offset"]),"line-blur":new Rt(Oe.paint_line["line-blur"]),"line-dasharray":new nh(Oe.paint_line["line-dasharray"]),"line-pattern":new sh(Oe.paint_line["line-pattern"]),"line-gradient":new Mp(Oe.paint_line["line-gradient"])})},get layout(){return wA=wA||new b({"line-cap":new _t(Oe.layout_line["line-cap"]),"line-join":new Rt(Oe.layout_line["line-join"]),"line-miter-limit":new _t(Oe.layout_line["line-miter-limit"]),"line-round-limit":new _t(Oe.layout_line["line-round-limit"]),"line-sort-key":new Rt(Oe.layout_line["line-sort-key"])})}};class yL extends Rt{possiblyEvaluate(a,h){return h=new Ri(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(a,h)}evaluate(a,h,p,_){return h=be({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(a,h,p,_)}}let Mg;class vL extends d{constructor(a){super(a,EA),this.gradientVersion=0,Mg||(Mg=new yL(EA.paint.properties["line-width"].specification),Mg.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Ct,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,h){super.recalculate(a,h),this.paint._values["line-floorwidth"]=Mg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new ky(a)}queryRadius(a){const h=a,p=AA(Bp("line-width",this,h),Bp("line-gap-width",this,h)),_=Bp("line-offset",this,h);return p/2+Math.abs(_)+Ag(this.paint.get("line-translate"))}queryIntersectsFeature(a,h,p,_,w,x,A){const C=Tg(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,A),P=A/2*AA(this.paint.get("line-width").evaluate(h,p),this.paint.get("line-gap-width").evaluate(h,p)),k=this.paint.get("line-offset").evaluate(h,p);return k&&(_=function(L,U){const $=[];for(let J=0;J<L.length;J++){const Z=L[J],ae=[];for(let he=0;he<Z.length;he++){const Me=Z[he-1],ve=Z[he],Se=Z[he+1],Fe=he===0?new T(0,0):ve.sub(Me)._unit()._perp(),He=he===Z.length-1?new T(0,0):Se.sub(ve)._unit()._perp(),ht=Fe._add(He)._unit(),It=ht.x*He.x+ht.y*He.y;It!==0&&ht._mult(1/It),ae.push(ht._mult(U)._add(ve))}$.push(ae)}return $}(_,k*A)),function(L,U,$){for(let J=0;J<U.length;J++){const Z=U[J];if(L.length>=3){for(let ae=0;ae<Z.length;ae++)if(dh(L,Z[ae]))return!0}if(I6(L,Z,$))return!0}return!1}(C,_,P)}isTileClipped(){return!0}}function AA(u,a){return a>0?a+2*u:u}const bL=S([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),wL=S([{name:"a_projected_pos",components:3,type:"Float32"}],4);S([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xL=S([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);S([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const TA=S([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),EL=S([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function AL(u,a,h){return u.sections.forEach(p=>{p.text=function(_,w,x){const A=w.layout.get("text-transform").evaluate(x,{});return A==="uppercase"?_=_.toLocaleUpperCase():A==="lowercase"&&(_=_.toLocaleLowerCase()),Us.applyArabicShaping&&(_=Us.applyArabicShaping(_)),_}(p.text,a,h)}),u}S([{name:"triangle",components:3,type:"Uint16"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),S([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),S([{type:"Float32",name:"offsetX"}]),S([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),S([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const jp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var mr=24,SA=_i,CA=function(u,a,h,p,_){var w,x,A=8*_-p-1,C=(1<<A)-1,P=C>>1,k=-7,L=_-1,U=-1,$=u[a+L];for(L+=U,w=$&(1<<-k)-1,$>>=-k,k+=A;k>0;w=256*w+u[a+L],L+=U,k-=8);for(x=w&(1<<-k)-1,w>>=-k,k+=p;k>0;x=256*x+u[a+L],L+=U,k-=8);if(w===0)w=1-P;else{if(w===C)return x?NaN:1/0*($?-1:1);x+=Math.pow(2,p),w-=P}return($?-1:1)*x*Math.pow(2,w-p)},IA=function(u,a,h,p,_,w){var x,A,C,P=8*w-_-1,k=(1<<P)-1,L=k>>1,U=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=0,J=1,Z=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(A=isNaN(a)?1:0,x=k):(x=Math.floor(Math.log(a)/Math.LN2),a*(C=Math.pow(2,-x))<1&&(x--,C*=2),(a+=x+L>=1?U/C:U*Math.pow(2,1-L))*C>=2&&(x++,C/=2),x+L>=k?(A=0,x=k):x+L>=1?(A=(a*C-1)*Math.pow(2,_),x+=L):(A=a*Math.pow(2,L-1)*Math.pow(2,_),x=0));_>=8;u[h+$]=255&A,$+=J,A/=256,_-=8);for(x=x<<_|A,P+=_;P>0;u[h+$]=255&x,$+=J,x/=256,P-=8);u[h+$-J]|=128*Z};function _i(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}_i.Varint=0,_i.Fixed64=1,_i.Bytes=2,_i.Fixed32=5;var By=4294967296,RA=1/By,MA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ma(u){return u.type===_i.Bytes?u.readVarint()+u.pos:u.pos+1}function TL(u,a,h){return h?4294967296*a+(u>>>0):4294967296*(a>>>0)+(u>>>0)}function PA(u,a,h){var p=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));h.realloc(p);for(var _=h.pos-1;_>=u;_--)h.buf[_+p]=h.buf[_]}function SL(u,a){for(var h=0;h<u.length;h++)a.writeVarint(u[h])}function CL(u,a){for(var h=0;h<u.length;h++)a.writeSVarint(u[h])}function IL(u,a){for(var h=0;h<u.length;h++)a.writeFloat(u[h])}function RL(u,a){for(var h=0;h<u.length;h++)a.writeDouble(u[h])}function ML(u,a){for(var h=0;h<u.length;h++)a.writeBoolean(u[h])}function PL(u,a){for(var h=0;h<u.length;h++)a.writeFixed32(u[h])}function kL(u,a){for(var h=0;h<u.length;h++)a.writeSFixed32(u[h])}function BL(u,a){for(var h=0;h<u.length;h++)a.writeFixed64(u[h])}function LL(u,a){for(var h=0;h<u.length;h++)a.writeSFixed64(u[h])}function Pg(u,a){return(u[a]|u[a+1]<<8|u[a+2]<<16)+16777216*u[a+3]}function gh(u,a,h){u[h]=a,u[h+1]=a>>>8,u[h+2]=a>>>16,u[h+3]=a>>>24}function kA(u,a){return(u[a]|u[a+1]<<8|u[a+2]<<16)+(u[a+3]<<24)}_i.prototype={destroy:function(){this.buf=null},readFields:function(u,a,h){for(h=h||this.length;this.pos<h;){var p=this.readVarint(),_=p>>3,w=this.pos;this.type=7&p,u(_,a,this),this.pos===w&&this.skip(p)}return a},readMessage:function(u,a){return this.readFields(u,a,this.readVarint()+this.pos)},readFixed32:function(){var u=Pg(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=kA(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=Pg(this.buf,this.pos)+Pg(this.buf,this.pos+4)*By;return this.pos+=8,u},readSFixed64:function(){var u=Pg(this.buf,this.pos)+kA(this.buf,this.pos+4)*By;return this.pos+=8,u},readFloat:function(){var u=CA(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=CA(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var a,h,p=this.buf;return a=127&(h=p[this.pos++]),h<128?a:(a|=(127&(h=p[this.pos++]))<<7,h<128?a:(a|=(127&(h=p[this.pos++]))<<14,h<128?a:(a|=(127&(h=p[this.pos++]))<<21,h<128?a:function(_,w,x){var A,C,P=x.buf;if(A=(112&(C=P[x.pos++]))>>4,C<128||(A|=(127&(C=P[x.pos++]))<<3,C<128)||(A|=(127&(C=P[x.pos++]))<<10,C<128)||(A|=(127&(C=P[x.pos++]))<<17,C<128)||(A|=(127&(C=P[x.pos++]))<<24,C<128)||(A|=(1&(C=P[x.pos++]))<<31,C<128))return TL(_,A,w);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(h=p[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,a=this.pos;return this.pos=u,u-a>=12&&MA?function(h,p,_){return MA.decode(h.subarray(p,_))}(this.buf,a,u):function(h,p,_){for(var w="",x=p;x<_;){var A,C,P,k=h[x],L=null,U=k>239?4:k>223?3:k>191?2:1;if(x+U>_)break;U===1?k<128&&(L=k):U===2?(192&(A=h[x+1]))==128&&(L=(31&k)<<6|63&A)<=127&&(L=null):U===3?(C=h[x+2],(192&(A=h[x+1]))==128&&(192&C)==128&&((L=(15&k)<<12|(63&A)<<6|63&C)<=2047||L>=55296&&L<=57343)&&(L=null)):U===4&&(C=h[x+2],P=h[x+3],(192&(A=h[x+1]))==128&&(192&C)==128&&(192&P)==128&&((L=(15&k)<<18|(63&A)<<12|(63&C)<<6|63&P)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,U=1):L>65535&&(L-=65536,w+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),w+=String.fromCharCode(L),x+=U}return w}(this.buf,a,u)},readBytes:function(){var u=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,u);return this.pos=u,a},readPackedVarint:function(u,a){if(this.type!==_i.Bytes)return u.push(this.readVarint(a));var h=Ma(this);for(u=u||[];this.pos<h;)u.push(this.readVarint(a));return u},readPackedSVarint:function(u){if(this.type!==_i.Bytes)return u.push(this.readSVarint());var a=Ma(this);for(u=u||[];this.pos<a;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==_i.Bytes)return u.push(this.readBoolean());var a=Ma(this);for(u=u||[];this.pos<a;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==_i.Bytes)return u.push(this.readFloat());var a=Ma(this);for(u=u||[];this.pos<a;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==_i.Bytes)return u.push(this.readDouble());var a=Ma(this);for(u=u||[];this.pos<a;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==_i.Bytes)return u.push(this.readFixed32());var a=Ma(this);for(u=u||[];this.pos<a;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==_i.Bytes)return u.push(this.readSFixed32());var a=Ma(this);for(u=u||[];this.pos<a;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==_i.Bytes)return u.push(this.readFixed64());var a=Ma(this);for(u=u||[];this.pos<a;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==_i.Bytes)return u.push(this.readSFixed64());var a=Ma(this);for(u=u||[];this.pos<a;)u.push(this.readSFixed64());return u},skip:function(u){var a=7&u;if(a===_i.Varint)for(;this.buf[this.pos++]>127;);else if(a===_i.Bytes)this.pos=this.readVarint()+this.pos;else if(a===_i.Fixed32)this.pos+=4;else{if(a!==_i.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(u,a){this.writeVarint(u<<3|a)},realloc:function(u){for(var a=this.length||16;a<this.pos+u;)a*=2;if(a!==this.length){var h=new Uint8Array(a);h.set(this.buf),this.buf=h,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),gh(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),gh(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),gh(this.buf,-1&u,this.pos),gh(this.buf,Math.floor(u*RA),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),gh(this.buf,-1&u,this.pos),gh(this.buf,Math.floor(u*RA),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(a,h){var p,_;if(a>=0?(p=a%4294967296|0,_=a/4294967296|0):(_=~(-a/4294967296),4294967295^(p=~(-a%4294967296))?p=p+1|0:(p=0,_=_+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(w,x,A){A.buf[A.pos++]=127&w|128,w>>>=7,A.buf[A.pos++]=127&w|128,w>>>=7,A.buf[A.pos++]=127&w|128,w>>>=7,A.buf[A.pos++]=127&w|128,A.buf[A.pos]=127&(w>>>=7)}(p,0,h),function(w,x){var A=(7&w)<<4;x.buf[x.pos++]|=A|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(_,h)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var a=this.pos;this.pos=function(p,_,w){for(var x,A,C=0;C<_.length;C++){if((x=_.charCodeAt(C))>55295&&x<57344){if(!A){x>56319||C+1===_.length?(p[w++]=239,p[w++]=191,p[w++]=189):A=x;continue}if(x<56320){p[w++]=239,p[w++]=191,p[w++]=189,A=x;continue}x=A-55296<<10|x-56320|65536,A=null}else A&&(p[w++]=239,p[w++]=191,p[w++]=189,A=null);x<128?p[w++]=x:(x<2048?p[w++]=x>>6|192:(x<65536?p[w++]=x>>12|224:(p[w++]=x>>18|240,p[w++]=x>>12&63|128),p[w++]=x>>6&63|128),p[w++]=63&x|128)}return w}(this.buf,u,this.pos);var h=this.pos-a;h>=128&&PA(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h},writeFloat:function(u){this.realloc(4),IA(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),IA(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var a=u.length;this.writeVarint(a),this.realloc(a);for(var h=0;h<a;h++)this.buf[this.pos++]=u[h]},writeRawMessage:function(u,a){this.pos++;var h=this.pos;u(a,this);var p=this.pos-h;p>=128&&PA(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p},writeMessage:function(u,a,h){this.writeTag(u,_i.Bytes),this.writeRawMessage(a,h)},writePackedVarint:function(u,a){a.length&&this.writeMessage(u,SL,a)},writePackedSVarint:function(u,a){a.length&&this.writeMessage(u,CL,a)},writePackedBoolean:function(u,a){a.length&&this.writeMessage(u,ML,a)},writePackedFloat:function(u,a){a.length&&this.writeMessage(u,IL,a)},writePackedDouble:function(u,a){a.length&&this.writeMessage(u,RL,a)},writePackedFixed32:function(u,a){a.length&&this.writeMessage(u,PL,a)},writePackedSFixed32:function(u,a){a.length&&this.writeMessage(u,kL,a)},writePackedFixed64:function(u,a){a.length&&this.writeMessage(u,BL,a)},writePackedSFixed64:function(u,a){a.length&&this.writeMessage(u,LL,a)},writeBytesField:function(u,a){this.writeTag(u,_i.Bytes),this.writeBytes(a)},writeFixed32Field:function(u,a){this.writeTag(u,_i.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(u,a){this.writeTag(u,_i.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(u,a){this.writeTag(u,_i.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(u,a){this.writeTag(u,_i.Fixed64),this.writeSFixed64(a)},writeVarintField:function(u,a){this.writeTag(u,_i.Varint),this.writeVarint(a)},writeSVarintField:function(u,a){this.writeTag(u,_i.Varint),this.writeSVarint(a)},writeStringField:function(u,a){this.writeTag(u,_i.Bytes),this.writeString(a)},writeFloatField:function(u,a){this.writeTag(u,_i.Fixed32),this.writeFloat(a)},writeDoubleField:function(u,a){this.writeTag(u,_i.Fixed64),this.writeDouble(a)},writeBooleanField:function(u,a){this.writeVarintField(u,!!a)}};var Ly=f(SA);const Oy=3;function OL(u,a,h){u===1&&h.readMessage(DL,a)}function DL(u,a,h){if(u===3){const{id:p,bitmap:_,width:w,height:x,left:A,top:C,advance:P}=h.readMessage(FL,{});a.push({id:p,bitmap:new Op({width:w+2*Oy,height:x+2*Oy},_),metrics:{width:w,height:x,left:A,top:C,advance:P}})}}function FL(u,a,h){u===1?a.id=h.readVarint():u===2?a.bitmap=h.readBytes():u===3?a.width=h.readVarint():u===4?a.height=h.readVarint():u===5?a.left=h.readSVarint():u===6?a.top=h.readSVarint():u===7&&(a.advance=h.readVarint())}const BA=Oy;function LA(u){let a=0,h=0;for(const x of u)a+=x.w*x.h,h=Math.max(h,x.w);u.sort((x,A)=>A.h-x.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),h),h:1/0}];let _=0,w=0;for(const x of u)for(let A=p.length-1;A>=0;A--){const C=p[A];if(!(x.w>C.w||x.h>C.h)){if(x.x=C.x,x.y=C.y,w=Math.max(w,x.y+x.h),_=Math.max(_,x.x+x.w),x.w===C.w&&x.h===C.h){const P=p.pop();A<p.length&&(p[A]=P)}else x.h===C.h?(C.x+=x.w,C.w-=x.w):x.w===C.w?(C.y+=x.h,C.h-=x.h):(p.push({x:C.x+x.w,y:C.y,w:C.w-x.w,h:x.h}),C.y+=x.h,C.h-=x.h);break}}return{w:_,h:w,fill:a/(_*w)||0}}const js=1;class Dy{constructor(a,{pixelRatio:h,version:p,stretchX:_,stretchY:w,content:x,textFitWidth:A,textFitHeight:C}){this.paddedRect=a,this.pixelRatio=h,this.stretchX=_,this.stretchY=w,this.content=x,this.version=p,this.textFitWidth=A,this.textFitHeight=C}get tl(){return[this.paddedRect.x+js,this.paddedRect.y+js]}get br(){return[this.paddedRect.x+this.paddedRect.w-js,this.paddedRect.y+this.paddedRect.h-js]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*js)/this.pixelRatio,(this.paddedRect.h-2*js)/this.pixelRatio]}}class OA{constructor(a,h){const p={},_={};this.haveRenderCallbacks=[];const w=[];this.addImages(a,p,w),this.addImages(h,_,w);const{w:x,h:A}=LA(w),C=new An({width:x||1,height:A||1});for(const P in a){const k=a[P],L=p[P].paddedRect;An.copy(k.data,C,{x:0,y:0},{x:L.x+js,y:L.y+js},k.data)}for(const P in h){const k=h[P],L=_[P].paddedRect,U=L.x+js,$=L.y+js,J=k.data.width,Z=k.data.height;An.copy(k.data,C,{x:0,y:0},{x:U,y:$},k.data),An.copy(k.data,C,{x:0,y:Z-1},{x:U,y:$-1},{width:J,height:1}),An.copy(k.data,C,{x:0,y:0},{x:U,y:$+Z},{width:J,height:1}),An.copy(k.data,C,{x:J-1,y:0},{x:U-1,y:$},{width:1,height:Z}),An.copy(k.data,C,{x:0,y:0},{x:U+J,y:$},{width:1,height:Z})}this.image=C,this.iconPositions=p,this.patternPositions=_}addImages(a,h,p){for(const _ in a){const w=a[_],x={x:0,y:0,w:w.data.width+2*js,h:w.data.height+2*js};p.push(x),h[_]=new Dy(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(a,h){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in a.updatedImages)this.patchUpdatedImage(this.iconPositions[p],a.getImage(p),h),this.patchUpdatedImage(this.patternPositions[p],a.getImage(p),h)}patchUpdatedImage(a,h,p){if(!a||!h||a.version===h.version)return;a.version=h.version;const[_,w]=a.tl;p.update(h.data,void 0,{x:_,y:w})}}var Il;mt("ImagePosition",Dy),mt("ImageAtlas",OA),c.ah=void 0,(Il=c.ah||(c.ah={}))[Il.none=0]="none",Il[Il.horizontal=1]="horizontal",Il[Il.vertical=2]="vertical",Il[Il.horizontalOnly=3]="horizontalOnly";const Gp=-17;class Vp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,h){const p=new Vp;return p.scale=a||1,p.fontStack=h,p}static forImage(a){const h=new Vp;return h.imageName=a,h}}class _h{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,h){const p=new _h;for(let _=0;_<a.sections.length;_++){const w=a.sections[_];w.image?p.addImageSection(w):p.addTextSection(w,h)}return p}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let h="";for(let p=0;p<a.length;p++){const _=a.charCodeAt(p+1)||null,w=a.charCodeAt(p-1)||null;h+=_&&_g(_)&&!jp[a[p+1]]||w&&_g(w)&&!jp[a[p-1]]||!jp[a[p]]?a[p]:jp[a[p]]}return h}(this.text)}trim(){let a=0;for(let p=0;p<this.text.length&&Bg[this.text.charCodeAt(p)];p++)a++;let h=this.text.length;for(let p=this.text.length-1;p>=0&&p>=a&&Bg[this.text.charCodeAt(p)];p--)h--;this.text=this.text.substring(a,h),this.sectionIndex=this.sectionIndex.slice(a,h)}substring(a,h){const p=new _h;return p.text=this.text.substring(a,h),p.sectionIndex=this.sectionIndex.slice(a,h),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,h)=>Math.max(a,this.sections[h].scale),0)}addTextSection(a,h){this.text+=a.text,this.sections.push(Vp.forText(a.scale,a.fontStack||h));const p=this.sections.length-1;for(let _=0;_<a.text.length;++_)this.sectionIndex.push(p)}addImageSection(a){const h=a.image?a.image.name:"";if(h.length===0)return void We("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Vp.forImage(h)),this.sectionIndex.push(this.sections.length-1)):We("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kg(u,a,h,p,_,w,x,A,C,P,k,L,U,$,J){const Z=_h.fromFeature(u,_);let ae;L===c.ah.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:he,processStyledBidirectionalText:Me}=Us;if(he&&Z.sections.length===1){ae=[];const Fe=he(Z.toString(),Fy(Z,P,w,a,p,$));for(const He of Fe){const ht=new _h;ht.text=He,ht.sections=Z.sections;for(let It=0;It<He.length;It++)ht.sectionIndex.push(0);ae.push(ht)}}else if(Me){ae=[];const Fe=Me(Z.text,Z.sectionIndex,Fy(Z,P,w,a,p,$));for(const He of Fe){const ht=new _h;ht.text=He[0],ht.sectionIndex=He[1],ht.sections=Z.sections,ae.push(ht)}}else ae=function(Fe,He){const ht=[],It=Fe.text;let ct=0;for(const at of He)ht.push(Fe.substring(ct,at)),ct=at;return ct<It.length&&ht.push(Fe.substring(ct,It.length)),ht}(Z,Fy(Z,P,w,a,p,$));const ve=[],Se={positionedLines:ve,text:Z.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(Fe,He,ht,It,ct,at,bt,gt,ft,je,Et,vt){let Bt=0,Ei=Gp,yi=0,xr=0;const Yn=gt==="right"?1:gt==="left"?0:.5;let Wr=0;for(const tr of ct){tr.trim();const Ar=tr.getMaxScale(),ls=(Ar-1)*mr,Xr={positionedGlyphs:[],lineOffset:0};Fe.positionedLines[Wr]=Xr;const As=Xr.positionedGlyphs;let Kr=0;if(!tr.length()){Ei+=at,++Wr;continue}for(let Gs=0;Gs<tr.length();Gs++){const oi=tr.getSection(Gs),Si=tr.getSectionIndex(Gs),Bi=tr.getCharCode(Gs);let sn=0,Xi=null,wh=null,Jo=null,Zo=mr;const Qn=!(ft===c.ah.horizontal||!Et&&!Ip(Bi)||Et&&(Bg[Bi]||(Er=Bi,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Er)))));if(oi.imageName){const Cn=It[oi.imageName];if(!Cn)continue;Jo=oi.imageName,Fe.iconsInText=Fe.iconsInText||!0,wh=Cn.paddedRect;const Pr=Cn.displaySize;oi.scale=oi.scale*mr/vt,Xi={width:Pr[0],height:Pr[1],left:js,top:-BA,advance:Qn?Pr[1]:Pr[0]},sn=ls+(mr-Pr[1]*oi.scale),Zo=Xi.advance;const Pa=Qn?Pr[0]*oi.scale-mr*Ar:Pr[1]*oi.scale-mr*Ar;Pa>0&&Pa>Kr&&(Kr=Pa)}else{const Cn=ht[oi.fontStack],Pr=Cn&&Cn[Bi];if(Pr&&Pr.rect)wh=Pr.rect,Xi=Pr.metrics;else{const Pa=He[oi.fontStack],Kp=Pa&&Pa[Bi];if(!Kp)continue;Xi=Kp.metrics}sn=(Ar-oi.scale)*mr}Qn?(Fe.verticalizable=!0,As.push({glyph:Bi,imageName:Jo,x:Bt,y:Ei+sn,vertical:Qn,scale:oi.scale,fontStack:oi.fontStack,sectionIndex:Si,metrics:Xi,rect:wh}),Bt+=Zo*oi.scale+je):(As.push({glyph:Bi,imageName:Jo,x:Bt,y:Ei+sn,vertical:Qn,scale:oi.scale,fontStack:oi.fontStack,sectionIndex:Si,metrics:Xi,rect:wh}),Bt+=Xi.advance*oi.scale+je)}As.length!==0&&(yi=Math.max(Bt-je,yi),jL(As,0,As.length-1,Yn,Kr)),Bt=0;const Sn=at*Ar+Kr;Xr.lineOffset=Math.max(Kr,ls),Ei+=Sn,xr=Math.max(Sn,xr),++Wr}var Er;const ws=Ei-Gp,{horizontalAlign:xs,verticalAlign:Es}=Ny(bt);(function(tr,Ar,ls,Xr,As,Kr,Sn,Gs,oi){const Si=(Ar-ls)*As;let Bi=0;Bi=Kr!==Sn?-Gs*Xr-Gp:(-Xr*oi+.5)*Sn;for(const sn of tr)for(const Xi of sn.positionedGlyphs)Xi.x+=Si,Xi.y+=Bi})(Fe.positionedLines,Yn,xs,Es,yi,xr,at,ws,ct.length),Fe.top+=-Es*ws,Fe.bottom=Fe.top+ws,Fe.left+=-xs*yi,Fe.right=Fe.left+yi}(Se,a,h,p,ae,x,A,C,L,P,U,J),!function(Fe){for(const He of Fe)if(He.positionedGlyphs.length!==0)return!1;return!0}(ve)&&Se}const Bg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},NL={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},UL={40:!0};function DA(u,a,h,p,_,w){if(a.imageName){const x=p[a.imageName];return x?x.displaySize[0]*a.scale*mr/w+_:0}{const x=h[a.fontStack],A=x&&x[u];return A?A.metrics.advance*a.scale+_:0}}function FA(u,a,h,p){const _=Math.pow(u-a,2);return p?u<a?_/2:2*_:_+Math.abs(h)*h}function zL(u,a,h){let p=0;return u===10&&(p-=1e4),h&&(p+=150),u!==40&&u!==65288||(p+=50),a!==41&&a!==65289||(p+=50),p}function NA(u,a,h,p,_,w){let x=null,A=FA(a,h,_,w);for(const C of p){const P=FA(a-C.x,h,_,w)+C.badness;P<=A&&(x=C,A=P)}return{index:u,x:a,priorBreak:x,badness:A}}function UA(u){return u?UA(u.priorBreak).concat(u.index):[]}function Fy(u,a,h,p,_,w){if(!u)return[];const x=[],A=function(L,U,$,J,Z,ae){let he=0;for(let Me=0;Me<L.length();Me++){const ve=L.getSection(Me);he+=DA(L.getCharCode(Me),ve,J,Z,U,ae)}return he/Math.max(1,Math.ceil(he/$))}(u,a,h,p,_,w),C=u.text.indexOf("​")>=0;let P=0;for(let L=0;L<u.length();L++){const U=u.getSection(L),$=u.getCharCode(L);if(Bg[$]||(P+=DA($,U,p,_,a,w)),L<u.length()-1){const J=!((k=$)<11904)&&(!!Kt["CJK Compatibility Forms"](k)||!!Kt["CJK Compatibility"](k)||!!Kt["CJK Strokes"](k)||!!Kt["CJK Symbols and Punctuation"](k)||!!Kt["Enclosed CJK Letters and Months"](k)||!!Kt["Halfwidth and Fullwidth Forms"](k)||!!Kt["Ideographic Description Characters"](k)||!!Kt["Vertical Forms"](k)||gg.test(String.fromCodePoint(k)));(NL[$]||J||U.imageName||L!==u.length()-2&&UL[u.getCharCode(L+1)])&&x.push(NA(L+1,P,A,x,zL($,u.getCharCode(L+1),J&&C),!1))}}var k;return UA(NA(u.length(),P,A,x,0,!0))}function Ny(u){let a=.5,h=.5;switch(u){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:a,verticalAlign:h}}function jL(u,a,h,p,_){if(!p&&!_)return;const w=u[h],x=(u[h].x+w.metrics.advance*w.scale)*p;for(let A=a;A<=h;A++)u[A].x-=x,u[A].y+=_}function VL(u,a,h){const{horizontalAlign:p,verticalAlign:_}=Ny(h),w=a[0]-u.displaySize[0]*p,x=a[1]-u.displaySize[1]*_;return{image:u,top:x,bottom:x+u.displaySize[1],left:w,right:w+u.displaySize[0]}}function zA(u){var a,h;let p=u.left,_=u.top,w=u.right-p,x=u.bottom-_;const A=(a=u.image.textFitWidth)!==null&&a!==void 0?a:"stretchOrShrink",C=(h=u.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",P=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(C==="proportional"){if(A==="stretchOnly"&&w/x<P||A==="proportional"){const k=Math.ceil(x*P);p*=k/w,w=k}}else if(A==="proportional"&&C==="stretchOnly"&&P!==0&&w/x>P){const k=Math.ceil(w/P);_*=k/x,x=k}return{x1:p,y1:_,x2:p+w,y2:_+x}}function jA(u,a,h,p,_,w){const x=u.image;let A;if(x.content){const ae=x.content,he=x.pixelRatio||1;A=[ae[0]/he,ae[1]/he,x.displaySize[0]-ae[2]/he,x.displaySize[1]-ae[3]/he]}const C=a.left*w,P=a.right*w;let k,L,U,$;h==="width"||h==="both"?($=_[0]+C-p[3],L=_[0]+P+p[1]):($=_[0]+(C+P-x.displaySize[0])/2,L=$+x.displaySize[0]);const J=a.top*w,Z=a.bottom*w;return h==="height"||h==="both"?(k=_[1]+J-p[0],U=_[1]+Z+p[2]):(k=_[1]+(J+Z-x.displaySize[1])/2,U=k+x.displaySize[1]),{image:x,top:k,right:L,bottom:U,left:$,collisionPadding:A}}const $p=255,Ko=128,Rl=$p*Ko;function GA(u,a){const{expression:h}=a;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Ri(u+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=h;let w=0;for(;w<p.length&&p[w]<=u;)w++;w=Math.max(0,w-1);let x=w;for(;x<p.length&&p[x]<u+1;)x++;x=Math.min(p.length-1,x);const A=p[w],C=p[x];return h.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:C,interpolationType:_}:{kind:"camera",minZoom:A,maxZoom:C,minSize:h.evaluate(new Ri(A)),maxSize:h.evaluate(new Ri(C)),interpolationType:_}}}function Uy(u,a,h){let p="never";const _=u.get(a);return _?p=_:u.get(h)&&(p="always"),p}const $L=Cl.VectorTileFeature.types,HL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lg(u,a,h,p,_,w,x,A,C,P,k,L,U){const $=A?Math.min(Rl,Math.round(A[0])):0,J=A?Math.min(Rl,Math.round(A[1])):0;u.emplaceBack(a,h,Math.round(32*p),Math.round(32*_),w,x,($<<1)+(C?1:0),J,16*P,16*k,256*L,256*U)}function zy(u,a,h){u.emplaceBack(a.x,a.y,h),u.emplaceBack(a.x,a.y,h),u.emplaceBack(a.x,a.y,h),u.emplaceBack(a.x,a.y,h)}function qL(u){for(const a of u.sections)if(fy(a.text))return!0;return!1}class jy{constructor(a){this.layoutVertexArray=new ah,this.indexArray=new En,this.programConfigurations=a,this.segments=new Jt,this.dynamicLayoutVertexArray=new Pp,this.opacityVertexArray=new tn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Mi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,h,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,bL.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,wL.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,HL,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}mt("SymbolBuffers",jy);class Gy{constructor(a,h,p){this.layoutVertexArray=new a,this.layoutAttributes=h,this.indexArray=new p,this.segments=new Jt,this.collisionVertexArray=new Wo}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,xL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}mt("CollisionBuffers",Gy);class yh{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(x=>x.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=wy([]),this.placementViewportMatrix=wy([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=GA(this.zoom,h["text-size"]),this.iconSizeData=GA(this.zoom,h["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),w=p.get("symbol-z-order");this.canOverlap=Uy(p,"text-overlap","text-allow-overlap")!=="never"||Uy(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(x=>c.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=a.sourceID}createArrays(){this.text=new jy(new jc(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new jy(new jc(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new Pi,this.lineVertexArray=new Vr,this.symbolInstances=new Wt,this.textAnchorOffsets=new ki}calculateGlyphDependencies(a,h,p,_,w){for(let x=0;x<a.length;x++)if(h[a.charCodeAt(x)]=!0,(p||_)&&w){const A=jp[a.charAt(x)];A&&(h[A.charCodeAt(0)]=!0)}}populate(a,h,p){const _=this.layers[0],w=_.layout,x=w.get("text-font"),A=w.get("text-field"),C=w.get("icon-image"),P=(A.value.kind!=="constant"||A.value.value instanceof Yi&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),k=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,L=w.get("symbol-sort-key");if(this.features=[],!P&&!k)return;const U=h.iconDependencies,$=h.glyphDependencies,J=h.availableImages,Z=new Ri(this.zoom);for(const{feature:ae,id:he,index:Me,sourceLayerIndex:ve}of a){const Se=_._featureFilter.needGeometry,Fe=Vc(ae,Se);if(!_._featureFilter.filter(Z,Fe,p))continue;let He,ht;if(Se||(Fe.geometry=Gc(ae)),P){const ct=_.getValueAndResolveTokens("text-field",Fe,p,J),at=Yi.factory(ct),bt=this.hasRTLText=this.hasRTLText||qL(at);(!bt||Us.getRTLTextPluginStatus()==="unavailable"||bt&&Us.isParsed())&&(He=AL(at,_,Fe))}if(k){const ct=_.getValueAndResolveTokens("icon-image",Fe,p,J);ht=ct instanceof Wi?ct:Wi.fromString(ct)}if(!He&&!ht)continue;const It=this.sortFeaturesByKey?L.evaluate(Fe,{},p):void 0;if(this.features.push({id:he,text:He,icon:ht,index:Me,sourceLayerIndex:ve,geometry:Fe.geometry,properties:ae.properties,type:$L[ae.type],sortKey:It}),ht&&(U[ht.name]=!0),He){const ct=x.evaluate(Fe,{},p).join(","),at=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const bt of He.sections)if(bt.image)U[bt.image.name]=!0;else{const gt=Sp(He.toString()),ft=bt.fontStack||ct,je=$[ft]=$[ft]||{};this.calculateGlyphDependencies(bt.text,je,at,this.allowVerticalPlacement,gt)}}}w.get("symbol-placement")==="line"&&(this.features=function(ae){const he={},Me={},ve=[];let Se=0;function Fe(ct){ve.push(ae[ct]),Se++}function He(ct,at,bt){const gt=Me[ct];return delete Me[ct],Me[at]=gt,ve[gt].geometry[0].pop(),ve[gt].geometry[0]=ve[gt].geometry[0].concat(bt[0]),gt}function ht(ct,at,bt){const gt=he[at];return delete he[at],he[ct]=gt,ve[gt].geometry[0].shift(),ve[gt].geometry[0]=bt[0].concat(ve[gt].geometry[0]),gt}function It(ct,at,bt){const gt=bt?at[0][at[0].length-1]:at[0][0];return`${ct}:${gt.x}:${gt.y}`}for(let ct=0;ct<ae.length;ct++){const at=ae[ct],bt=at.geometry,gt=at.text?at.text.toString():null;if(!gt){Fe(ct);continue}const ft=It(gt,bt),je=It(gt,bt,!0);if(ft in Me&&je in he&&Me[ft]!==he[je]){const Et=ht(ft,je,bt),vt=He(ft,je,ve[Et].geometry);delete he[ft],delete Me[je],Me[It(gt,ve[vt].geometry,!0)]=vt,ve[Et].geometry=null}else ft in Me?He(ft,je,bt):je in he?ht(ft,je,bt):(Fe(ct),he[ft]=Se-1,Me[je]=Se-1)}return ve.filter(ct=>ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,he)=>ae.sortKey-he.sortKey)}update(a,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,h,this.layers,p),this.icon.programConfigurations.updatePaintArrays(a,h,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,h){const p=this.lineVertexArray.length;if(a.segment!==void 0){let _=a.dist(h[a.segment+1]),w=a.dist(h[a.segment]);const x={};for(let A=a.segment+1;A<h.length;A++)x[A]={x:h[A].x,y:h[A].y,tileUnitDistanceFromAnchor:_},A<h.length-1&&(_+=h[A+1].dist(h[A]));for(let A=a.segment||0;A>=0;A--)x[A]={x:h[A].x,y:h[A].y,tileUnitDistanceFromAnchor:w},A>0&&(w+=h[A-1].dist(h[A]));for(let A=0;A<h.length;A++){const C=x[A];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(a,h,p,_,w,x,A,C,P,k,L,U){const $=a.indexArray,J=a.layoutVertexArray,Z=a.segments.prepareSegment(4*h.length,J,$,this.canOverlap?x.sortKey:void 0),ae=this.glyphOffsetArray.length,he=Z.vertexLength,Me=this.allowVerticalPlacement&&A===c.ah.vertical?Math.PI/2:0,ve=x.text&&x.text.sections;for(let Se=0;Se<h.length;Se++){const{tl:Fe,tr:He,bl:ht,br:It,tex:ct,pixelOffsetTL:at,pixelOffsetBR:bt,minFontScaleX:gt,minFontScaleY:ft,glyphOffset:je,isSDF:Et,sectionIndex:vt}=h[Se],Bt=Z.vertexLength,Ei=je[1];Lg(J,C.x,C.y,Fe.x,Ei+Fe.y,ct.x,ct.y,p,Et,at.x,at.y,gt,ft),Lg(J,C.x,C.y,He.x,Ei+He.y,ct.x+ct.w,ct.y,p,Et,bt.x,at.y,gt,ft),Lg(J,C.x,C.y,ht.x,Ei+ht.y,ct.x,ct.y+ct.h,p,Et,at.x,bt.y,gt,ft),Lg(J,C.x,C.y,It.x,Ei+It.y,ct.x+ct.w,ct.y+ct.h,p,Et,bt.x,bt.y,gt,ft),zy(a.dynamicLayoutVertexArray,C,Me),$.emplaceBack(Bt,Bt+1,Bt+2),$.emplaceBack(Bt+1,Bt+2,Bt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(je[0]),Se!==h.length-1&&vt===h[Se+1].sectionIndex||a.programConfigurations.populatePaintArrays(J.length,x,x.index,{},U,ve&&ve[vt])}a.placedSymbolArray.emplaceBack(C.x,C.y,ae,this.glyphOffsetArray.length-ae,he,P,k,C.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],A,0,!1,0,L)}_addCollisionDebugVertex(a,h,p,_,w,x){return h.emplaceBack(0,0),a.emplaceBack(p.x,p.y,_,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(a,h,p,_,w,x,A){const C=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),P=C.vertexLength,k=w.layoutVertexArray,L=w.collisionVertexArray,U=A.anchorX,$=A.anchorY;this._addCollisionDebugVertex(k,L,x,U,$,new T(a,h)),this._addCollisionDebugVertex(k,L,x,U,$,new T(p,h)),this._addCollisionDebugVertex(k,L,x,U,$,new T(p,_)),this._addCollisionDebugVertex(k,L,x,U,$,new T(a,_)),C.vertexLength+=4;const J=w.indexArray;J.emplaceBack(P,P+1),J.emplaceBack(P+1,P+2),J.emplaceBack(P+2,P+3),J.emplaceBack(P+3,P),C.primitiveLength+=4}addDebugCollisionBoxes(a,h,p,_){for(let w=a;w<h;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,_?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gy(rn,TA.members,Mr),this.iconCollisionBox=new Gy(rn,TA.members,Mr);for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(a,h,p,_,w,x,A,C,P){const k={};for(let L=h;L<p;L++){const U=a.get(L);k.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.textFeatureIndex=U.featureIndex;break}for(let L=_;L<w;L++){const U=a.get(L);k.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.verticalTextFeatureIndex=U.featureIndex;break}for(let L=x;L<A;L++){const U=a.get(L);k.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.iconFeatureIndex=U.featureIndex;break}for(let L=C;L<P;L++){const U=a.get(L);k.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},k.verticalIconFeatureIndex=U.featureIndex;break}return k}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,h){const p=a.placedSymbolArray.get(h),_=p.vertexStartIndex+4*p.numGlyphs;for(let w=p.vertexStartIndex;w<_;w+=4)a.indexArray.emplaceBack(w,w+1,w+2),a.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(a),p=Math.cos(a),_=[],w=[],x=[];for(let A=0;A<this.symbolInstances.length;++A){x.push(A);const C=this.symbolInstances.get(A);_.push(0|Math.round(h*C.anchorX+p*C.anchorY)),w.push(C.featureIndex)}return x.sort((A,C)=>_[A]-_[C]||w[C]-w[A]),x}addToSortKeyRanges(a,h){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===h?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const p=this.symbolInstances.get(h);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((_,w,x)=>{_>=0&&x.indexOf(_)===w&&this.addIndicesForPlacedSymbol(this.text,_)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let VA,$A;mt("SymbolBucket",yh,{omit:["layers","collisionBoxArray","features","compareText"]}),yh.MAX_GLYPHS=65535,yh.addDynamicAttributes=zy;var Vy={get paint(){return $A=$A||new b({"icon-opacity":new Rt(Oe.paint_symbol["icon-opacity"]),"icon-color":new Rt(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Rt(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Rt(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Rt(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new _t(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new _t(Oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Rt(Oe.paint_symbol["text-opacity"]),"text-color":new Rt(Oe.paint_symbol["text-color"],{runtimeType:Nr,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Rt(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Rt(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Rt(Oe.paint_symbol["text-halo-blur"]),"text-translate":new _t(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new _t(Oe.paint_symbol["text-translate-anchor"])})},get layout(){return VA=VA||new b({"symbol-placement":new _t(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new _t(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _t(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Rt(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _t(Oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _t(Oe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new _t(Oe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new _t(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new _t(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _t(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Rt(Oe.layout_symbol["icon-size"]),"icon-text-fit":new _t(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Rt(Oe.layout_symbol["icon-image"]),"icon-rotate":new Rt(Oe.layout_symbol["icon-rotate"]),"icon-padding":new Rt(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new _t(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Rt(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Rt(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _t(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _t(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _t(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Rt(Oe.layout_symbol["text-field"]),"text-font":new Rt(Oe.layout_symbol["text-font"]),"text-size":new Rt(Oe.layout_symbol["text-size"]),"text-max-width":new Rt(Oe.layout_symbol["text-max-width"]),"text-line-height":new _t(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Rt(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Rt(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Rt(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _t(Oe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Rt(Oe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Rt(Oe.layout_symbol["text-anchor"]),"text-max-angle":new _t(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new _t(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Rt(Oe.layout_symbol["text-rotate"]),"text-padding":new _t(Oe.layout_symbol["text-padding"]),"text-keep-upright":new _t(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Rt(Oe.layout_symbol["text-transform"]),"text-offset":new Rt(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new _t(Oe.layout_symbol["text-allow-overlap"]),"text-overlap":new _t(Oe.layout_symbol["text-overlap"]),"text-ignore-placement":new _t(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new _t(Oe.layout_symbol["text-optional"])})}};class HA{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:Xs,this.defaultValue=a}evaluate(a){if(a.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(a.formattedSection))return h.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt("FormatSectionOverride",HA,{omit:["defaultValue"]});class Og extends d{constructor(a){super(a,Vy)}recalculate(a,h){if(super.recalculate(a,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const w of p)_.indexOf(w)<0&&_.push(w);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,h,p,_){const w=this.layout.get(a).evaluate(h,{},p,_),x=this._unevaluatedLayout._values[a];return x.isDataDriven()||qu(x.value)||!w?w:function(A,C){return C.replace(/{([^{}]+)}/g,(P,k)=>A&&k in A?String(A[k]):"")}(h.properties,w)}createBucket(a){return new yh(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of Vy.paint.overridableProperties){if(!Og.hasPaintOverride(this.layout,a))continue;const h=this.paint.get(a),p=new HA(h),_=new Hu(p,h.property.specification);let w=null;w=h.value.kind==="constant"||h.value.kind==="source"?new hl("source",_):new dl("composite",_,h.value.zoomStops),this.paint._values[a]=new Jn(h.property,w,h.parameters)}}_handleOverridablePaintPropertyUpdate(a,h,p){return!(!this.layout||h.isDataDriven()||p.isDataDriven())&&Og.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,h){const p=a.get("text-field"),_=Vy.paint.properties[h];let w=!1;const x=A=>{for(const C of A)if(_.overrides&&_.overrides.hasOverride(C))return void(w=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Yi)x(p.value.value.sections);else if(p.value.kind==="source"){const A=P=>{w||(P instanceof zr&&Di(P.value)===yn?x(P.value.sections):P instanceof Du?x(P.sections):P.eachChild(A))},C=p.value;C._styleExpression&&A(C._styleExpression.expression)}return w}}let qA;var WL={get paint(){return qA=qA||new b({"background-color":new _t(Oe.paint_background["background-color"]),"background-pattern":new nh(Oe.paint_background["background-pattern"]),"background-opacity":new _t(Oe.paint_background["background-opacity"])})}};class XL extends d{constructor(a){super(a,WL)}}let WA;var KL={get paint(){return WA=WA||new b({"raster-opacity":new _t(Oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new _t(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _t(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _t(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new _t(Oe.paint_raster["raster-saturation"]),"raster-contrast":new _t(Oe.paint_raster["raster-contrast"]),"raster-resampling":new _t(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new _t(Oe.paint_raster["raster-fade-duration"])})}};class JL extends d{constructor(a){super(a,KL)}}class ZL extends d{constructor(a){super(a,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class YL{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const $y=63710088e-1;class Ml{constructor(a,h){if(isNaN(a)||isNaN(h))throw new Error(`Invalid LngLat object: (${a}, ${h})`);if(this.lng=+a,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ml(re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const h=Math.PI/180,p=this.lat*h,_=a.lat*h,w=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((a.lng-this.lng)*h);return $y*Math.acos(Math.min(w,1))}static convert(a){if(a instanceof Ml)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Ml(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Ml(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const XA=2*Math.PI*$y;function KA(u){return XA*Math.cos(u*Math.PI/180)}function JA(u){return(180+u)/360}function ZA(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function YA(u,a){return u/KA(a)}function Hy(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class Hp{constructor(a,h,p=0){this.x=+a,this.y=+h,this.z=+p}static fromLngLat(a,h=0){const p=Ml.convert(a);return new Hp(JA(p.lng),ZA(p.lat),YA(h,p.lat))}toLngLat(){return new Ml(360*this.x-180,Hy(this.y))}toAltitude(){return this.z*KA(Hy(this.y))}meterInMercatorCoordinateUnits(){return 1/XA*(a=Hy(this.y),1/Math.cos(a*Math.PI/180));var a}}function QA(u,a,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[u*p-2*Math.PI*6378137/2,a*p-2*Math.PI*6378137/2]}class qy{constructor(a,h,p){if(!function(_,w,x){return!(_<0||_>25||x<0||x>=Math.pow(2,_)||w<0||w>=Math.pow(2,_))}(a,h,p))throw new Error(`x=${h}, y=${p}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=h,this.y=p,this.key=qp(0,a,a,h,p)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,h,p){const _=(x=this.y,A=this.z,C=QA(256*(w=this.x),256*(x=Math.pow(2,A)-x-1),A),P=QA(256*(w+1),256*(x+1),A),C[0]+","+C[1]+","+P[0]+","+P[1]);var w,x,A,C,P;const k=function(L,U,$){let J,Z="";for(let ae=L;ae>0;ae--)J=1<<ae-1,Z+=(U&J?1:0)+($&J?2:0);return Z}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,_)}isChildOf(a){const h=this.z-a.z;return h>0&&a.x===this.x>>h&&a.y===this.y>>h}getTilePoint(a){const h=Math.pow(2,this.z);return new T((a.x*h-this.x)*ur,(a.y*h-this.y)*ur)}toString(){return`${this.z}/${this.x}/${this.y}`}}class e3{constructor(a,h){this.wrap=a,this.canonical=h,this.key=qp(a,h.z,h.z,h.x,h.y)}}class Tn{constructor(a,h,p,_,w){if(a<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${p}`);this.overscaledZ=a,this.wrap=h,this.canonical=new qy(p,+_,+w),this.key=qp(h,a,p,_,w)}clone(){return new Tn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-a;return a>this.canonical.z?new Tn(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Tn(a,this.wrap,a,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(a,h){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-a;return a>this.canonical.z?qp(this.wrap*+h,a,this.canonical.z,this.canonical.x,this.canonical.y):qp(this.wrap*+h,a,a,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const h=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>h&&a.canonical.y===this.canonical.y>>h}children(a){if(this.overscaledZ>=a)return[new Tn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new Tn(h,this.wrap,h,p,_),new Tn(h,this.wrap,h,p+1,_),new Tn(h,this.wrap,h,p,_+1),new Tn(h,this.wrap,h,p+1,_+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Tn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Tn(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new e3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new Hp(a.x-this.wrap,a.y))}}function qp(u,a,h,p,_){(u*=2)<0&&(u=-1*u-1);const w=1<<h;return(w*w*u+w*_+p).toString(36)+h.toString(36)+a.toString(36)}mt("CanonicalTileID",qy),mt("OverscaledTileID",Tn,{omit:["posMatrix"]});class t3{constructor(a,h,p,_=1,w=1,x=1,A=0){if(this.uid=a,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void We(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const C=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=w,this.blueFactor=x,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<C;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(C,P)]=this.data[this._idx(C-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,C)]=this.data[this._idx(P,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<C;P++)for(let k=0;k<C;k++){const L=this.get(P,k);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(a,h){const p=new Uint8Array(this.data.buffer),_=4*this._idx(a,h);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,h){if(a<-1||a>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(a+1)}unpack(a,h,p){return a*this.redFactor+h*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new An({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,h,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let _=h*this.dim,w=h*this.dim+this.dim,x=p*this.dim,A=p*this.dim+this.dim;switch(h){case-1:_=w-1;break;case 1:w=_+1}switch(p){case-1:x=A-1;break;case 1:A=x+1}const C=-h*this.dim,P=-p*this.dim;for(let k=x;k<A;k++)for(let L=_;L<w;L++)this.data[this._idx(L,k)]=a.data[this._idx(L+C,k+P)]}}mt("DEMData",t3);class i3{constructor(a){this._stringToNumber={},this._numberToString=[];for(let h=0;h<a.length;h++){const p=a[h];this._stringToNumber[p]=h,this._numberToString[h]=p}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class r3{constructor(a,h,p,_,w){this.type="Feature",this._vectorTileFeature=a,a._z=h,a._x=p,a._y=_,this.properties=a.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(a[h]=this[h]);return a}}class s3{constructor(a,h){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new gl(ur,16,0),this.grid3D=new gl(ur,16,0),this.featureIndexArray=new os,this.promoteId=h}insert(a,h,p,_,w,x){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,w);const C=x?this.grid3D:this.grid;for(let P=0;P<h.length;P++){const k=h[P],L=[1/0,1/0,-1/0,-1/0];for(let U=0;U<k.length;U++){const $=k[U];L[0]=Math.min(L[0],$.x),L[1]=Math.min(L[1],$.y),L[2]=Math.max(L[2],$.x),L[3]=Math.max(L[3],$.y)}L[0]<ur&&L[1]<ur&&L[2]>=0&&L[3]>=0&&C.insert(A,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Cl.VectorTile(new Ly(this.rawTileData)).layers,this.sourceLayerCoder=new i3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,h,p,_){this.loadVTLayers();const w=a.params||{},x=ur/a.tileSize/a.scale,A=hp(w.filter),C=a.queryGeometry,P=a.queryPadding*x,k=o3(C),L=this.grid.query(k.minX-P,k.minY-P,k.maxX+P,k.maxY+P),U=o3(a.cameraQueryGeometry),$=this.grid3D.query(U.minX-P,U.minY-P,U.maxX+P,U.maxY+P,(ae,he,Me,ve)=>function(Se,Fe,He,ht,It){for(const at of Se)if(Fe<=at.x&&He<=at.y&&ht>=at.x&&It>=at.y)return!0;const ct=[new T(Fe,He),new T(Fe,It),new T(ht,It),new T(ht,He)];if(Se.length>2){for(const at of ct)if(dh(Se,at))return!0}for(let at=0;at<Se.length-1;at++)if(M6(Se[at],Se[at+1],ct))return!0;return!1}(a.cameraQueryGeometry,ae-P,he-P,Me+P,ve+P));for(const ae of $)L.push(ae);L.sort(QL);const J={};let Z;for(let ae=0;ae<L.length;ae++){const he=L[ae];if(he===Z)continue;Z=he;const Me=this.featureIndexArray.get(he);let ve=null;this.loadMatchingFeature(J,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,A,w.layers,w.availableImages,h,p,_,(Se,Fe,He)=>(ve||(ve=Gc(Se)),Fe.queryIntersectsFeature(C,Se,He,ve,this.z,a.transform,x,a.pixelPosMatrix)))}return J}loadMatchingFeature(a,h,p,_,w,x,A,C,P,k,L){const U=this.bucketLayerIDs[h];if(x&&!function(ae,he){for(let Me=0;Me<ae.length;Me++)if(he.indexOf(ae[Me])>=0)return!0;return!1}(x,U))return;const $=this.sourceLayerCoder.decode(p),J=this.vtLayers[$].feature(_);if(w.needGeometry){const ae=Vc(J,!0);if(!w.filter(new Ri(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!w.filter(new Ri(this.tileID.overscaledZ),J))return;const Z=this.getId(J,$);for(let ae=0;ae<U.length;ae++){const he=U[ae];if(x&&x.indexOf(he)<0)continue;const Me=C[he];if(!Me)continue;let ve={};Z&&k&&(ve=k.getState(Me.sourceLayer||"_geojsonTileLayer",Z));const Se=be({},P[he]);Se.paint=n3(Se.paint,Me.paint,J,ve,A),Se.layout=n3(Se.layout,Me.layout,J,ve,A);const Fe=!L||L(J,Me,ve);if(!Fe)continue;const He=new r3(J,this.z,this.x,this.y,Z);He.layer=Se;let ht=a[he];ht===void 0&&(ht=a[he]=[]),ht.push({featureIndex:_,feature:He,intersectionZ:Fe})}}lookupSymbolFeatures(a,h,p,_,w,x,A,C){const P={};this.loadVTLayers();const k=hp(w);for(const L of a)this.loadMatchingFeature(P,p,_,L,k,x,A,C,h);return P}hasLayer(a){for(const h of this.bucketLayerIDs)for(const p of h)if(a===p)return!0;return!1}getId(a,h){let p=a.id;return this.promoteId&&(p=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof p=="boolean"&&(p=Number(p))),p}}function n3(u,a,h,p,_){return Te(u,(w,x)=>{const A=a instanceof Nc?a.get(x):null;return A&&A.evaluate?A.evaluate(h,p,_):A})}function o3(u){let a=1/0,h=1/0,p=-1/0,_=-1/0;for(const w of u)a=Math.min(a,w.x),h=Math.min(h,w.y),p=Math.max(p,w.x),_=Math.max(_,w.y);return{minX:a,minY:h,maxX:p,maxY:_}}function QL(u,a){return a-u}function a3(u,a,h,p,_){const w=[];for(let x=0;x<u.length;x++){const A=u[x];let C;for(let P=0;P<A.length-1;P++){let k=A[P],L=A[P+1];k.x<a&&L.x<a||(k.x<a?k=new T(a,k.y+(a-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x<a&&(L=new T(a,k.y+(a-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y<h&&L.y<h||(k.y<h?k=new T(k.x+(h-k.y)/(L.y-k.y)*(L.x-k.x),h)._round():L.y<h&&(L=new T(k.x+(h-k.y)/(L.y-k.y)*(L.x-k.x),h)._round()),k.x>=p&&L.x>=p||(k.x>=p?k=new T(p,k.y+(p-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x>=p&&(L=new T(p,k.y+(p-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y>=_&&L.y>=_||(k.y>=_?k=new T(k.x+(_-k.y)/(L.y-k.y)*(L.x-k.x),_)._round():L.y>=_&&(L=new T(k.x+(_-k.y)/(L.y-k.y)*(L.x-k.x),_)._round()),C&&k.equals(C[C.length-1])||(C=[k],w.push(C)),C.push(L)))))}}return w}mt("FeatureIndex",s3,{omit:["rawTileData","sourceLayerCoder"]});class Pl extends T{constructor(a,h,p,_){super(a,h),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new Pl(this.x,this.y,this.angle,this.segment)}}function l3(u,a,h,p,_){if(a.segment===void 0||h===0)return!0;let w=a,x=a.segment+1,A=0;for(;A>-h/2;){if(x--,x<0)return!1;A-=u[x].dist(w),w=u[x]}A+=u[x].dist(u[x+1]),x++;const C=[];let P=0;for(;A<h/2;){const k=u[x],L=u[x+1];if(!L)return!1;let U=u[x-1].angleTo(k)-k.angleTo(L);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:A,angleDelta:U}),P+=U;A-C[0].distance>p;)P-=C.shift().angleDelta;if(P>_)return!1;x++,A+=k.dist(L)}return!0}function c3(u){let a=0;for(let h=0;h<u.length-1;h++)a+=u[h].dist(u[h+1]);return a}function u3(u,a,h){return u?.6*a*h:0}function h3(u,a){return Math.max(u?u.right-u.left:0,a?a.right-a.left:0)}function eO(u,a,h,p,_,w){const x=u3(h,_,w),A=h3(h,p)*w;let C=0;const P=c3(u)/2;for(let k=0;k<u.length-1;k++){const L=u[k],U=u[k+1],$=L.dist(U);if(C+$>P){const J=(P-C)/$,Z=_s.number(L.x,U.x,J),ae=_s.number(L.y,U.y,J),he=new Pl(Z,ae,U.angleTo(L),k);return he._round(),!x||l3(u,he,A,x,a)?he:void 0}C+=$}}function tO(u,a,h,p,_,w,x,A,C){const P=u3(p,w,x),k=h3(p,_),L=k*x,U=u[0].x===0||u[0].x===C||u[0].y===0||u[0].y===C;return a-L<a/4&&(a=L+a/4),d3(u,U?a/2*A%a:(k/2+2*w)*x*A%a,a,P,h,L,U,!1,C)}function d3(u,a,h,p,_,w,x,A,C){const P=w/2,k=c3(u);let L=0,U=a-h,$=[];for(let J=0;J<u.length-1;J++){const Z=u[J],ae=u[J+1],he=Z.dist(ae),Me=ae.angleTo(Z);for(;U+h<L+he;){U+=h;const ve=(U-L)/he,Se=_s.number(Z.x,ae.x,ve),Fe=_s.number(Z.y,ae.y,ve);if(Se>=0&&Se<C&&Fe>=0&&Fe<C&&U-P>=0&&U+P<=k){const He=new Pl(Se,Fe,Me,J);He._round(),p&&!l3(u,He,w,p,_)||$.push(He)}}L+=he}return A||$.length||x||($=d3(u,L/2,h,p,_,w,x,!0,C)),$}mt("Anchor",Pl);const vh=js;function p3(u,a,h,p){const _=[],w=u.image,x=w.pixelRatio,A=w.paddedRect.w-2*vh,C=w.paddedRect.h-2*vh;let P={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const k=w.stretchX||[[0,A]],L=w.stretchY||[[0,C]],U=(je,Et)=>je+Et[1]-Et[0],$=k.reduce(U,0),J=L.reduce(U,0),Z=A-$,ae=C-J;let he=0,Me=$,ve=0,Se=J,Fe=0,He=Z,ht=0,It=ae;if(w.content&&p){const je=w.content,Et=je[2]-je[0],vt=je[3]-je[1];(w.textFitWidth||w.textFitHeight)&&(P=zA(u)),he=Dg(k,0,je[0]),ve=Dg(L,0,je[1]),Me=Dg(k,je[0],je[2]),Se=Dg(L,je[1],je[3]),Fe=je[0]-he,ht=je[1]-ve,He=Et-Me,It=vt-Se}const ct=P.x1,at=P.y1,bt=P.x2-ct,gt=P.y2-at,ft=(je,Et,vt,Bt)=>{const Ei=Fg(je.stretch-he,Me,bt,ct),yi=Ng(je.fixed-Fe,He,je.stretch,$),xr=Fg(Et.stretch-ve,Se,gt,at),Yn=Ng(Et.fixed-ht,It,Et.stretch,J),Wr=Fg(vt.stretch-he,Me,bt,ct),Er=Ng(vt.fixed-Fe,He,vt.stretch,$),ws=Fg(Bt.stretch-ve,Se,gt,at),xs=Ng(Bt.fixed-ht,It,Bt.stretch,J),Es=new T(Ei,xr),tr=new T(Wr,xr),Ar=new T(Wr,ws),ls=new T(Ei,ws),Xr=new T(yi/x,Yn/x),As=new T(Er/x,xs/x),Kr=a*Math.PI/180;if(Kr){const oi=Math.sin(Kr),Si=Math.cos(Kr),Bi=[Si,-oi,oi,Si];Es._matMult(Bi),tr._matMult(Bi),ls._matMult(Bi),Ar._matMult(Bi)}const Sn=je.stretch+je.fixed,Gs=Et.stretch+Et.fixed;return{tl:Es,tr,bl:ls,br:Ar,tex:{x:w.paddedRect.x+vh+Sn,y:w.paddedRect.y+vh+Gs,w:vt.stretch+vt.fixed-Sn,h:Bt.stretch+Bt.fixed-Gs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xr,pixelOffsetBR:As,minFontScaleX:He/x/bt,minFontScaleY:It/x/gt,isSDF:h}};if(p&&(w.stretchX||w.stretchY)){const je=f3(k,Z,$),Et=f3(L,ae,J);for(let vt=0;vt<je.length-1;vt++){const Bt=je[vt],Ei=je[vt+1];for(let yi=0;yi<Et.length-1;yi++)_.push(ft(Bt,Et[yi],Ei,Et[yi+1]))}}else _.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:C+1}));return _}function Dg(u,a,h){let p=0;for(const _ of u)p+=Math.max(a,Math.min(h,_[1]))-Math.max(a,Math.min(h,_[0]));return p}function f3(u,a,h){const p=[{fixed:-vh,stretch:0}];for(const[_,w]of u){const x=p[p.length-1];p.push({fixed:_-x.stretch,stretch:x.stretch}),p.push({fixed:_-x.stretch,stretch:x.stretch+(w-_)})}return p.push({fixed:a+vh,stretch:h}),p}function Fg(u,a,h,p){return u/a*h+p}function Ng(u,a,h,p){return u-a*h/p}class Ug{constructor(a,h,p,_,w,x,A,C,P,k){var L;if(this.boxStartIndex=a.length,P){let U=x.top,$=x.bottom;const J=x.collisionPadding;J&&(U-=J[1],$+=J[3]);let Z=$-U;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const U=!((L=x.image)===null||L===void 0)&&L.content&&(x.image.textFitWidth||x.image.textFitHeight)?zA(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};U.y1=U.y1*A-C[0],U.y2=U.y2*A+C[2],U.x1=U.x1*A-C[3],U.x2=U.x2*A+C[1];const $=x.collisionPadding;if($&&(U.x1-=$[0]*A,U.y1-=$[1]*A,U.x2+=$[2]*A,U.y2+=$[3]*A),k){const J=new T(U.x1,U.y1),Z=new T(U.x2,U.y1),ae=new T(U.x1,U.y2),he=new T(U.x2,U.y2),Me=k*Math.PI/180;J._rotate(Me),Z._rotate(Me),ae._rotate(Me),he._rotate(Me),U.x1=Math.min(J.x,Z.x,ae.x,he.x),U.x2=Math.max(J.x,Z.x,ae.x,he.x),U.y1=Math.min(J.y,Z.y,ae.y,he.y),U.y2=Math.max(J.y,Z.y,ae.y,he.y)}a.emplaceBack(h.x,h.y,U.x1,U.y1,U.x2,U.y2,p,_,w)}this.boxEndIndex=a.length}}class iO{constructor(a=[],h=(p,_)=>p<_?-1:p>_?1:0){if(this.data=a,this.length=this.data.length,this.compare=h,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:h,compare:p}=this,_=h[a];for(;a>0;){const w=a-1>>1,x=h[w];if(p(_,x)>=0)break;h[a]=x,a=w}h[a]=_}_down(a){const{data:h,compare:p}=this,_=this.length>>1,w=h[a];for(;a<_;){let x=1+(a<<1);const A=x+1;if(A<this.length&&p(h[A],h[x])<0&&(x=A),p(h[x],w)>=0)break;h[a]=h[x],a=x}h[a]=w}}function rO(u,a=1,h=!1){let p=1/0,_=1/0,w=-1/0,x=-1/0;const A=u[0];for(let $=0;$<A.length;$++){const J=A[$];(!$||J.x<p)&&(p=J.x),(!$||J.y<_)&&(_=J.y),(!$||J.x>w)&&(w=J.x),(!$||J.y>x)&&(x=J.y)}const C=Math.min(w-p,x-_);let P=C/2;const k=new iO([],sO);if(C===0)return new T(p,_);for(let $=p;$<w;$+=C)for(let J=_;J<x;J+=C)k.push(new bh($+P,J+P,P,u));let L=function($){let J=0,Z=0,ae=0;const he=$[0];for(let Me=0,ve=he.length,Se=ve-1;Me<ve;Se=Me++){const Fe=he[Me],He=he[Se],ht=Fe.x*He.y-He.x*Fe.y;Z+=(Fe.x+He.x)*ht,ae+=(Fe.y+He.y)*ht,J+=3*ht}return new bh(Z/J,ae/J,0,$)}(u),U=k.length;for(;k.length;){const $=k.pop();($.d>L.d||!L.d)&&(L=$,h&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,U)),$.max-L.d<=a||(P=$.h/2,k.push(new bh($.p.x-P,$.p.y-P,P,u)),k.push(new bh($.p.x+P,$.p.y-P,P,u)),k.push(new bh($.p.x-P,$.p.y+P,P,u)),k.push(new bh($.p.x+P,$.p.y+P,P,u)),U+=4)}return h&&(console.log(`num probes: ${U}`),console.log(`best distance: ${L.d}`)),L.p}function sO(u,a){return a.max-u.max}function bh(u,a,h,p){this.p=new T(u,a),this.h=h,this.d=function(_,w){let x=!1,A=1/0;for(let C=0;C<w.length;C++){const P=w[C];for(let k=0,L=P.length,U=L-1;k<L;U=k++){const $=P[k],J=P[U];$.y>_.y!=J.y>_.y&&_.x<(J.x-$.x)*(_.y-$.y)/(J.y-$.y)+$.x&&(x=!x),A=Math.min(A,ZE(_,$,J))}}return(x?1:-1)*Math.sqrt(A)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var qr;c.aq=void 0,(qr=c.aq||(c.aq={}))[qr.center=1]="center",qr[qr.left=2]="left",qr[qr.right=3]="right",qr[qr.top=4]="top",qr[qr.bottom=5]="bottom",qr[qr["top-left"]=6]="top-left",qr[qr["top-right"]=7]="top-right",qr[qr["bottom-left"]=8]="bottom-left",qr[qr["bottom-right"]=9]="bottom-right";const kl=7,Wy=Number.POSITIVE_INFINITY;function m3(u,a){return a[1]!==Wy?function(h,p,_){let w=0,x=0;switch(p=Math.abs(p),_=Math.abs(_),h){case"top-right":case"top-left":case"top":x=_-kl;break;case"bottom-right":case"bottom-left":case"bottom":x=-_+kl}switch(h){case"top-right":case"bottom-right":case"right":w=-p;break;case"top-left":case"bottom-left":case"left":w=p}return[w,x]}(u,a[0],a[1]):function(h,p){let _=0,w=0;p<0&&(p=0);const x=p/Math.SQRT2;switch(h){case"top-right":case"top-left":w=x-kl;break;case"bottom-right":case"bottom-left":w=-x+kl;break;case"bottom":w=-p+kl;break;case"top":w=p-kl}switch(h){case"top-right":case"bottom-right":_=-x;break;case"top-left":case"bottom-left":_=x;break;case"left":_=p;break;case"right":_=-p}return[_,w]}(u,a[0])}function g3(u,a,h){var p;const _=u.layout,w=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(a,{},h);if(w){const A=w.values,C=[];for(let P=0;P<A.length;P+=2){const k=C[P]=A[P],L=A[P+1].map(U=>U*mr);k.startsWith("top")?L[1]-=kl:k.startsWith("bottom")&&(L[1]+=kl),C[P+1]=L}return new qi(C)}const x=_.get("text-variable-anchor");if(x){let A;A=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(a,{},h)*mr,Wy]:_.get("text-offset").evaluate(a,{},h).map(P=>P*mr);const C=[];for(const P of x)C.push(P,m3(P,A));return new qi(C)}return null}function Xy(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nO(u,a,h,p,_,w,x,A,C,P,k){let L=w.textMaxSize.evaluate(a,{});L===void 0&&(L=x);const U=u.layers[0].layout,$=U.get("icon-offset").evaluate(a,{},k),J=y3(h.horizontal),Z=x/24,ae=u.tilePixelRatio*Z,he=u.tilePixelRatio*L/24,Me=u.tilePixelRatio*A,ve=u.tilePixelRatio*U.get("symbol-spacing"),Se=U.get("text-padding")*u.tilePixelRatio,Fe=function(je,Et,vt,Bt=1){const Ei=je.get("icon-padding").evaluate(Et,{},vt),yi=Ei&&Ei.values;return[yi[0]*Bt,yi[1]*Bt,yi[2]*Bt,yi[3]*Bt]}(U,a,k,u.tilePixelRatio),He=U.get("text-max-angle")/180*Math.PI,ht=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",It=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",ct=U.get("symbol-placement"),at=ve/2,bt=U.get("icon-text-fit");let gt;p&&bt!=="none"&&(u.allowVerticalPlacement&&h.vertical&&(gt=jA(p,h.vertical,bt,U.get("icon-text-fit-padding"),$,Z)),J&&(p=jA(p,J,bt,U.get("icon-text-fit-padding"),$,Z)));const ft=(je,Et)=>{Et.x<0||Et.x>=ur||Et.y<0||Et.y>=ur||function(vt,Bt,Ei,yi,xr,Yn,Wr,Er,ws,xs,Es,tr,Ar,ls,Xr,As,Kr,Sn,Gs,oi,Si,Bi,sn,Xi,wh){const Jo=vt.addToLineVertexArray(Bt,Ei);let Zo,Qn,Cn,Pr,Pa=0,Kp=0,x3=0,E3=0,iv=-1,rv=-1;const ka={};let A3=lh("");if(vt.allowVerticalPlacement&&yi.vertical){const cs=Er.layout.get("text-rotate").evaluate(Si,{},Xi)+90;Cn=new Ug(ws,Bt,xs,Es,tr,yi.vertical,Ar,ls,Xr,cs),Wr&&(Pr=new Ug(ws,Bt,xs,Es,tr,Wr,Kr,Sn,Xr,cs))}if(xr){const cs=Er.layout.get("icon-rotate").evaluate(Si,{}),In=Er.layout.get("icon-text-fit")!=="none",Hc=p3(xr,cs,sn,In),vo=Wr?p3(Wr,cs,sn,In):void 0;Qn=new Ug(ws,Bt,xs,Es,tr,xr,Kr,Sn,!1,cs),Pa=4*Hc.length;const qc=vt.iconSizeData;let Yo=null;qc.kind==="source"?(Yo=[Ko*Er.layout.get("icon-size").evaluate(Si,{})],Yo[0]>Rl&&We(`${vt.layerIds[0]}: Value for "icon-size" is >= ${$p}. Reduce your "icon-size".`)):qc.kind==="composite"&&(Yo=[Ko*Bi.compositeIconSizes[0].evaluate(Si,{},Xi),Ko*Bi.compositeIconSizes[1].evaluate(Si,{},Xi)],(Yo[0]>Rl||Yo[1]>Rl)&&We(`${vt.layerIds[0]}: Value for "icon-size" is >= ${$p}. Reduce your "icon-size".`)),vt.addSymbols(vt.icon,Hc,Yo,oi,Gs,Si,c.ah.none,Bt,Jo.lineStartIndex,Jo.lineLength,-1,Xi),iv=vt.icon.placedSymbolArray.length-1,vo&&(Kp=4*vo.length,vt.addSymbols(vt.icon,vo,Yo,oi,Gs,Si,c.ah.vertical,Bt,Jo.lineStartIndex,Jo.lineLength,-1,Xi),rv=vt.icon.placedSymbolArray.length-1)}const T3=Object.keys(yi.horizontal);for(const cs of T3){const In=yi.horizontal[cs];if(!Zo){A3=lh(In.text);const vo=Er.layout.get("text-rotate").evaluate(Si,{},Xi);Zo=new Ug(ws,Bt,xs,Es,tr,In,Ar,ls,Xr,vo)}const Hc=In.positionedLines.length===1;if(x3+=_3(vt,Bt,In,Yn,Er,Xr,Si,As,Jo,yi.vertical?c.ah.horizontal:c.ah.horizontalOnly,Hc?T3:[cs],ka,iv,Bi,Xi),Hc)break}yi.vertical&&(E3+=_3(vt,Bt,yi.vertical,Yn,Er,Xr,Si,As,Jo,c.ah.vertical,["vertical"],ka,rv,Bi,Xi));const lO=Zo?Zo.boxStartIndex:vt.collisionBoxArray.length,cO=Zo?Zo.boxEndIndex:vt.collisionBoxArray.length,uO=Cn?Cn.boxStartIndex:vt.collisionBoxArray.length,hO=Cn?Cn.boxEndIndex:vt.collisionBoxArray.length,dO=Qn?Qn.boxStartIndex:vt.collisionBoxArray.length,pO=Qn?Qn.boxEndIndex:vt.collisionBoxArray.length,fO=Pr?Pr.boxStartIndex:vt.collisionBoxArray.length,mO=Pr?Pr.boxEndIndex:vt.collisionBoxArray.length;let yo=-1;const jg=(cs,In)=>cs&&cs.circleDiameter?Math.max(cs.circleDiameter,In):In;yo=jg(Zo,yo),yo=jg(Cn,yo),yo=jg(Qn,yo),yo=jg(Pr,yo);const S3=yo>-1?1:0;S3&&(yo*=wh/mr),vt.glyphOffsetArray.length>=yh.MAX_GLYPHS&&We("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Si.sortKey!==void 0&&vt.addToSortKeyRanges(vt.symbolInstances.length,Si.sortKey);const gO=g3(Er,Si,Xi),[_O,yO]=function(cs,In){const Hc=cs.length,vo=In==null?void 0:In.values;if((vo==null?void 0:vo.length)>0)for(let qc=0;qc<vo.length;qc+=2){const Yo=vo[qc+1];cs.emplaceBack(c.aq[vo[qc]],Yo[0],Yo[1])}return[Hc,cs.length]}(vt.textAnchorOffsets,gO);vt.symbolInstances.emplaceBack(Bt.x,Bt.y,ka.right>=0?ka.right:-1,ka.center>=0?ka.center:-1,ka.left>=0?ka.left:-1,ka.vertical||-1,iv,rv,A3,lO,cO,uO,hO,dO,pO,fO,mO,xs,x3,E3,Pa,Kp,S3,0,Ar,yo,_O,yO)}(u,Et,je,h,p,_,gt,u.layers[0],u.collisionBoxArray,a.index,a.sourceLayerIndex,u.index,ae,[Se,Se,Se,Se],ht,C,Me,Fe,It,$,a,w,P,k,x)};if(ct==="line")for(const je of a3(a.geometry,0,0,ur,ur)){const Et=tO(je,ve,He,h.vertical||J,p,24,he,u.overscaling,ur);for(const vt of Et)J&&oO(u,J.text,at,vt)||ft(je,vt)}else if(ct==="line-center"){for(const je of a.geometry)if(je.length>1){const Et=eO(je,He,h.vertical||J,p,24,he);Et&&ft(je,Et)}}else if(a.type==="Polygon")for(const je of Nu(a.geometry,0)){const Et=rO(je,16);ft(je[0],new Pl(Et.x,Et.y,0))}else if(a.type==="LineString")for(const je of a.geometry)ft(je,new Pl(je[0].x,je[0].y,0));else if(a.type==="Point")for(const je of a.geometry)for(const Et of je)ft([Et],new Pl(Et.x,Et.y,0))}function _3(u,a,h,p,_,w,x,A,C,P,k,L,U,$,J){const Z=function(Me,ve,Se,Fe,He,ht,It,ct){const at=Fe.layout.get("text-rotate").evaluate(ht,{})*Math.PI/180,bt=[];for(const gt of ve.positionedLines)for(const ft of gt.positionedGlyphs){if(!ft.rect)continue;const je=ft.rect||{};let Et=BA+1,vt=!0,Bt=1,Ei=0;const yi=(He||ct)&&ft.vertical,xr=ft.metrics.advance*ft.scale/2;if(ct&&ve.verticalizable&&(Ei=gt.lineOffset/2-(ft.imageName?-(mr-ft.metrics.width*ft.scale)/2:(ft.scale-1)*mr)),ft.imageName){const oi=It[ft.imageName];vt=oi.sdf,Bt=oi.pixelRatio,Et=js/Bt}const Yn=He?[ft.x+xr,ft.y]:[0,0];let Wr=He?[0,0]:[ft.x+xr+Se[0],ft.y+Se[1]-Ei],Er=[0,0];yi&&(Er=Wr,Wr=[0,0]);const ws=ft.metrics.isDoubleResolution?2:1,xs=(ft.metrics.left-Et)*ft.scale-xr+Wr[0],Es=(-ft.metrics.top-Et)*ft.scale+Wr[1],tr=xs+je.w/ws*ft.scale/Bt,Ar=Es+je.h/ws*ft.scale/Bt,ls=new T(xs,Es),Xr=new T(tr,Es),As=new T(xs,Ar),Kr=new T(tr,Ar);if(yi){const oi=new T(-xr,xr-Gp),Si=-Math.PI/2,Bi=mr/2-xr,sn=new T(5-Gp-Bi,-(ft.imageName?Bi:0)),Xi=new T(...Er);ls._rotateAround(Si,oi)._add(sn)._add(Xi),Xr._rotateAround(Si,oi)._add(sn)._add(Xi),As._rotateAround(Si,oi)._add(sn)._add(Xi),Kr._rotateAround(Si,oi)._add(sn)._add(Xi)}if(at){const oi=Math.sin(at),Si=Math.cos(at),Bi=[Si,-oi,oi,Si];ls._matMult(Bi),Xr._matMult(Bi),As._matMult(Bi),Kr._matMult(Bi)}const Sn=new T(0,0),Gs=new T(0,0);bt.push({tl:ls,tr:Xr,bl:As,br:Kr,tex:je,writingMode:ve.writingMode,glyphOffset:Yn,sectionIndex:ft.sectionIndex,isSDF:vt,pixelOffsetTL:Sn,pixelOffsetBR:Gs,minFontScaleX:0,minFontScaleY:0})}return bt}(0,h,A,_,w,x,p,u.allowVerticalPlacement),ae=u.textSizeData;let he=null;ae.kind==="source"?(he=[Ko*_.layout.get("text-size").evaluate(x,{})],he[0]>Rl&&We(`${u.layerIds[0]}: Value for "text-size" is >= ${$p}. Reduce your "text-size".`)):ae.kind==="composite"&&(he=[Ko*$.compositeTextSizes[0].evaluate(x,{},J),Ko*$.compositeTextSizes[1].evaluate(x,{},J)],(he[0]>Rl||he[1]>Rl)&&We(`${u.layerIds[0]}: Value for "text-size" is >= ${$p}. Reduce your "text-size".`)),u.addSymbols(u.text,Z,he,A,w,x,P,a,C.lineStartIndex,C.lineLength,U,J);for(const Me of k)L[Me]=u.text.placedSymbolArray.length-1;return 4*Z.length}function y3(u){for(const a in u)return u[a];return null}function oO(u,a,h,p){const _=u.compareText;if(a in _){const w=_[a];for(let x=w.length-1;x>=0;x--)if(p.dist(w[x])<h)return!0}else _[a]=[];return _[a].push(p),!1}const v3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ky{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,p]=new Uint8Array(a,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const w=v3[15&p];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(a,2,1),[A]=new Uint32Array(a,4,1);return new Ky(A,x,w,a)}constructor(a,h=64,p=Float64Array,_){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=p,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const w=v3.indexOf(this.ArrayType),x=2*a*this.ArrayType.BYTES_PER_ELEMENT,A=a*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-A%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+A+C,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+x+A+C),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+A+C,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=a)}add(a,h){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=a,this.coords[this._pos++]=h,p}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return Jy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,h,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:A}=this,C=[0,w.length-1,0],P=[];for(;C.length;){const k=C.pop()||0,L=C.pop()||0,U=C.pop()||0;if(L-U<=A){for(let ae=U;ae<=L;ae++){const he=x[2*ae],Me=x[2*ae+1];he>=a&&he<=p&&Me>=h&&Me<=_&&P.push(w[ae])}continue}const $=U+L>>1,J=x[2*$],Z=x[2*$+1];J>=a&&J<=p&&Z>=h&&Z<=_&&P.push(w[$]),(k===0?a<=J:h<=Z)&&(C.push(U),C.push($-1),C.push(1-k)),(k===0?p>=J:_>=Z)&&(C.push($+1),C.push(L),C.push(1-k))}return P}within(a,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:w,nodeSize:x}=this,A=[0,_.length-1,0],C=[],P=p*p;for(;A.length;){const k=A.pop()||0,L=A.pop()||0,U=A.pop()||0;if(L-U<=x){for(let ae=U;ae<=L;ae++)w3(w[2*ae],w[2*ae+1],a,h)<=P&&C.push(_[ae]);continue}const $=U+L>>1,J=w[2*$],Z=w[2*$+1];w3(J,Z,a,h)<=P&&C.push(_[$]),(k===0?a-p<=J:h-p<=Z)&&(A.push(U),A.push($-1),A.push(1-k)),(k===0?a+p>=J:h+p>=Z)&&(A.push($+1),A.push(L),A.push(1-k))}return C}}function Jy(u,a,h,p,_,w){if(_-p<=h)return;const x=p+_>>1;b3(u,a,x,p,_,w),Jy(u,a,h,p,x-1,1-w),Jy(u,a,h,x+1,_,1-w)}function b3(u,a,h,p,_,w){for(;_>p;){if(_-p>600){const P=_-p+1,k=h-p+1,L=Math.log(P),U=.5*Math.exp(2*L/3),$=.5*Math.sqrt(L*U*(P-U)/P)*(k-P/2<0?-1:1);b3(u,a,h,Math.max(p,Math.floor(h-k*U/P+$)),Math.min(_,Math.floor(h+(P-k)*U/P+$)),w)}const x=a[2*h+w];let A=p,C=_;for(Wp(u,a,p,h),a[2*_+w]>x&&Wp(u,a,p,_);A<C;){for(Wp(u,a,A,C),A++,C--;a[2*A+w]<x;)A++;for(;a[2*C+w]>x;)C--}a[2*p+w]===x?Wp(u,a,p,C):(C++,Wp(u,a,C,_)),C<=h&&(p=C+1),h<=C&&(_=C-1)}}function Wp(u,a,h,p){Zy(u,h,p),Zy(a,2*h,2*p),Zy(a,2*h+1,2*p+1)}function Zy(u,a,h){const p=u[a];u[a]=u[h],u[h]=p}function w3(u,a,h,p){const _=u-h,w=a-p;return _*_+w*w}var Yy;c.bg=void 0,(Yy=c.bg||(c.bg={})).create="create",Yy.load="load",Yy.fullLoad="fullLoad";let zg=null,Xp=[];const Qy=1e3/60,ev="loadTime",tv="fullLoadTime",aO={mark(u){performance.mark(u)},frame(u){const a=u;zg!=null&&Xp.push(a-zg),zg=a},clearMetrics(){zg=null,Xp=[],performance.clearMeasures(ev),performance.clearMeasures(tv);for(const u in c.bg)performance.clearMarks(c.bg[u])},getPerformanceMetrics(){performance.measure(ev,c.bg.create,c.bg.load),performance.measure(tv,c.bg.create,c.bg.fullLoad);const u=performance.getEntriesByName(ev)[0].duration,a=performance.getEntriesByName(tv)[0].duration,h=Xp.length,p=1/(Xp.reduce((w,x)=>w+x,0)/h/1e3),_=Xp.filter(w=>w>Qy).reduce((w,x)=>w+(x-Qy)/Qy,0);return{loadTime:u,fullLoadTime:a,fps:p,percentDroppedFrames:_/(h+_)*100,totalFrames:h}}};c.$=class extends F{},c.A=ph,c.B=cy,c.C=function(u){if(ci==null){const a=u.navigator?u.navigator.userAgent:null;ci=!!u.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return ci},c.D=_t,c.E=Ws,c.F=class{constructor(u,a){this.target=u,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new YL(()=>this.process()),this.subscription=function(h,p,_,w){return h.addEventListener(p,_,!1),{unsubscribe:()=>{h.removeEventListener(p,_,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=Ft(self)?u:window}registerMessageHandler(u,a){this.messageHandlers[u]=a}sendAsync(u,a){return new Promise((h,p)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:h,reject:p},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const A={id:_,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)},{once:!0});const w=[],x=Object.assign(Object.assign({},u),{id:_,sourceMapId:this.mapId,origin:location.origin,data:_l(u.data,w)});this.target.postMessage(x,{transfer:w})})}receive(u){const a=u.data,h=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!=="resource://android"&&location.origin!=="resource://android"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[h];const p=this.abortControllers[h];return delete this.abortControllers[h],void(p&&p.abort())}if(Ft(self)||a.mustQueue)return this.tasks[h]=a,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,a)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),a=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(u,a)}processTask(u,a){return l(this,void 0,void 0,function*(){if(a.type==="<response>"){const _=this.resolveRejects[u];return delete this.resolveRejects[u],_?void(a.error?_.reject(yl(a.error)):_.resolve(yl(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=yl(a.data),p=new AbortController;this.abortControllers[u]=p;try{const _=yield this.messageHandlers[a.type](a.sourceMapId,h,p);this.completeTask(u,null,_)}catch(_){this.completeTask(u,_)}})}completeTask(u,a,h){const p=[];delete this.abortControllers[u];const _={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?_l(a):null,data:_l(h,p)};this.target.postMessage(_,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.G=Fr,c.H=function(){var u=new ph(16);return ph!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},c.I=Dy,c.J=function(u,a,h){var p,_,w,x,A,C,P,k,L,U,$,J,Z=h[0],ae=h[1],he=h[2];return a===u?(u[12]=a[0]*Z+a[4]*ae+a[8]*he+a[12],u[13]=a[1]*Z+a[5]*ae+a[9]*he+a[13],u[14]=a[2]*Z+a[6]*ae+a[10]*he+a[14],u[15]=a[3]*Z+a[7]*ae+a[11]*he+a[15]):(_=a[1],w=a[2],x=a[3],A=a[4],C=a[5],P=a[6],k=a[7],L=a[8],U=a[9],$=a[10],J=a[11],u[0]=p=a[0],u[1]=_,u[2]=w,u[3]=x,u[4]=A,u[5]=C,u[6]=P,u[7]=k,u[8]=L,u[9]=U,u[10]=$,u[11]=J,u[12]=p*Z+A*ae+L*he+a[12],u[13]=_*Z+C*ae+U*he+a[13],u[14]=w*Z+P*ae+$*he+a[14],u[15]=x*Z+k*ae+J*he+a[15]),u},c.K=function(u,a,h){var p=h[0],_=h[1],w=h[2];return u[0]=a[0]*p,u[1]=a[1]*p,u[2]=a[2]*p,u[3]=a[3]*p,u[4]=a[4]*_,u[5]=a[5]*_,u[6]=a[6]*_,u[7]=a[7]*_,u[8]=a[8]*w,u[9]=a[9]*w,u[10]=a[10]*w,u[11]=a[11]*w,u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u},c.L=tA,c.M=function(u,a){const h={};for(let p=0;p<a.length;p++){const _=a[p];_ in u&&(h[_]=u[_])}return h},c.N=Ml,c.O=JA,c.P=T,c.Q=ZA,c.R=An,c.S=Tn,c.T=rh,c.U=z,c.V=W,c.W=xt,c.X=ur,c.Y=S,c.Z=Hp,c._=l,c.a=cr,c.a$=function(u,a){var h=u[0],p=u[1],_=u[2],w=u[3],x=u[4],A=u[5],C=u[6],P=u[7],k=u[8],L=u[9],U=u[10],$=u[11],J=u[12],Z=u[13],ae=u[14],he=u[15],Me=a[0],ve=a[1],Se=a[2],Fe=a[3],He=a[4],ht=a[5],It=a[6],ct=a[7],at=a[8],bt=a[9],gt=a[10],ft=a[11],je=a[12],Et=a[13],vt=a[14],Bt=a[15];return Math.abs(h-Me)<=bs*Math.max(1,Math.abs(h),Math.abs(Me))&&Math.abs(p-ve)<=bs*Math.max(1,Math.abs(p),Math.abs(ve))&&Math.abs(_-Se)<=bs*Math.max(1,Math.abs(_),Math.abs(Se))&&Math.abs(w-Fe)<=bs*Math.max(1,Math.abs(w),Math.abs(Fe))&&Math.abs(x-He)<=bs*Math.max(1,Math.abs(x),Math.abs(He))&&Math.abs(A-ht)<=bs*Math.max(1,Math.abs(A),Math.abs(ht))&&Math.abs(C-It)<=bs*Math.max(1,Math.abs(C),Math.abs(It))&&Math.abs(P-ct)<=bs*Math.max(1,Math.abs(P),Math.abs(ct))&&Math.abs(k-at)<=bs*Math.max(1,Math.abs(k),Math.abs(at))&&Math.abs(L-bt)<=bs*Math.max(1,Math.abs(L),Math.abs(bt))&&Math.abs(U-gt)<=bs*Math.max(1,Math.abs(U),Math.abs(gt))&&Math.abs($-ft)<=bs*Math.max(1,Math.abs($),Math.abs(ft))&&Math.abs(J-je)<=bs*Math.max(1,Math.abs(J),Math.abs(je))&&Math.abs(Z-Et)<=bs*Math.max(1,Math.abs(Z),Math.abs(Et))&&Math.abs(ae-vt)<=bs*Math.max(1,Math.abs(ae),Math.abs(vt))&&Math.abs(he-Bt)<=bs*Math.max(1,Math.abs(he),Math.abs(Bt))},c.a0=Jt,c.a1=qy,c.a2=Je,c.a3=u=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(h=>{a.onloadstart=()=>{h(a)};for(const p of u){const _=window.document.createElement("source");Zi(p)||(a.crossOrigin="Anonymous"),_.src=p,a.appendChild(_)}})},c.a4=function(){return me++},c.a5=ut,c.a6=yh,c.a7=hp,c.a8=Vc,c.a9=r3,c.aA=function(u){if(u.type==="custom")return new ZL(u);switch(u.type){case"background":return new XL(u);case"circle":return new B6(u);case"fill":return new J6(u);case"fill-extrusion":return new hL(u);case"heatmap":return new O6(u);case"hillshade":return new F6(u);case"line":return new vL(u);case"raster":return new JL(u);case"symbol":return new Og(u)}},c.aB=ze,c.aC=function(u,a){if(!u)return[{command:"setStyle",args:[a]}];let h=[];try{if(!Yt(u.version,a.version))return[{command:"setStyle",args:[a]}];Yt(u.center,a.center)||h.push({command:"setCenter",args:[a.center]}),Yt(u.zoom,a.zoom)||h.push({command:"setZoom",args:[a.zoom]}),Yt(u.bearing,a.bearing)||h.push({command:"setBearing",args:[a.bearing]}),Yt(u.pitch,a.pitch)||h.push({command:"setPitch",args:[a.pitch]}),Yt(u.sprite,a.sprite)||h.push({command:"setSprite",args:[a.sprite]}),Yt(u.glyphs,a.glyphs)||h.push({command:"setGlyphs",args:[a.glyphs]}),Yt(u.transition,a.transition)||h.push({command:"setTransition",args:[a.transition]}),Yt(u.light,a.light)||h.push({command:"setLight",args:[a.light]}),Yt(u.terrain,a.terrain)||h.push({command:"setTerrain",args:[a.terrain]}),Yt(u.sky,a.sky)||h.push({command:"setSky",args:[a.sky]}),Yt(u.projection,a.projection)||h.push({command:"setProjection",args:[a.projection]});const p={},_=[];(function(x,A,C,P){let k;for(k in A=A||{},x=x||{})Object.prototype.hasOwnProperty.call(x,k)&&(Object.prototype.hasOwnProperty.call(A,k)||Vn(k,C,P));for(k in A)Object.prototype.hasOwnProperty.call(A,k)&&(Object.prototype.hasOwnProperty.call(x,k)?Yt(x[k],A[k])||(x[k].type==="geojson"&&A[k].type==="geojson"&&Go(x,A,k)?xi(C,{command:"setGeoJSONSourceData",args:[k,A[k].data]}):_n(k,A,C,P)):vr(k,A,C))})(u.sources,a.sources,_,p);const w=[];u.layers&&u.layers.forEach(x=>{"source"in x&&p[x.source]?h.push({command:"removeLayer",args:[x.id]}):w.push(x)}),h=h.concat(_),function(x,A,C){A=A||[];const P=(x=x||[]).map(ga),k=A.map(ga),L=x.reduce(Vo,{}),U=A.reduce(Vo,{}),$=P.slice(),J=Object.create(null);let Z,ae,he,Me,ve;for(let Se=0,Fe=0;Se<P.length;Se++)Z=P[Se],Object.prototype.hasOwnProperty.call(U,Z)?Fe++:(xi(C,{command:"removeLayer",args:[Z]}),$.splice($.indexOf(Z,Fe),1));for(let Se=0,Fe=0;Se<k.length;Se++)Z=k[k.length-1-Se],$[$.length-1-Se]!==Z&&(Object.prototype.hasOwnProperty.call(L,Z)?(xi(C,{command:"removeLayer",args:[Z]}),$.splice($.lastIndexOf(Z,$.length-Fe),1)):Fe++,Me=$[$.length-Se],xi(C,{command:"addLayer",args:[U[Z],Me]}),$.splice($.length-Se,0,Z),J[Z]=!0);for(let Se=0;Se<k.length;Se++)if(Z=k[Se],ae=L[Z],he=U[Z],!J[Z]&&!Yt(ae,he))if(Yt(ae.source,he.source)&&Yt(ae["source-layer"],he["source-layer"])&&Yt(ae.type,he.type)){for(ve in ms(ae.layout,he.layout,C,Z,null,"setLayoutProperty"),ms(ae.paint,he.paint,C,Z,null,"setPaintProperty"),Yt(ae.filter,he.filter)||xi(C,{command:"setFilter",args:[Z,he.filter]}),Yt(ae.minzoom,he.minzoom)&&Yt(ae.maxzoom,he.maxzoom)||xi(C,{command:"setLayerZoomRange",args:[Z,he.minzoom,he.maxzoom]}),ae)Object.prototype.hasOwnProperty.call(ae,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?ms(ae[ve],he[ve],C,Z,ve.slice(6),"setPaintProperty"):Yt(ae[ve],he[ve])||xi(C,{command:"setLayerProperty",args:[Z,ve,he[ve]]}));for(ve in he)Object.prototype.hasOwnProperty.call(he,ve)&&!Object.prototype.hasOwnProperty.call(ae,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?ms(ae[ve],he[ve],C,Z,ve.slice(6),"setPaintProperty"):Yt(ae[ve],he[ve])||xi(C,{command:"setLayerProperty",args:[Z,ve,he[ve]]}))}else xi(C,{command:"removeLayer",args:[Z]}),Me=$[$.lastIndexOf(Z)+1],xi(C,{command:"addLayer",args:[he,Me]})}(w,a.layers,h)}catch(p){console.warn("Unable to compute style diff:",p),h=[{command:"setStyle",args:[a]}]}return h},c.aD=function(u){const a=[],h=u.id;return h===void 0&&a.push({message:`layers.${h}: missing required property "id"`}),u.render===void 0&&a.push({message:`layers.${h}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&a.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),a},c.aE=function u(a,h){if(Array.isArray(a)){if(!Array.isArray(h)||a.length!==h.length)return!1;for(let p=0;p<a.length;p++)if(!u(a[p],h[p]))return!1;return!0}if(typeof a=="object"&&a!==null&&h!==null){if(typeof h!="object"||Object.keys(a).length!==Object.keys(h).length)return!1;for(const p in a)if(!u(a[p],h[p]))return!1;return!0}return a===h},c.aF=Te,c.aG=Pe,c.aH=class extends zc{constructor(u,a){super(u,a),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},c.aI=xg,c.aJ=class extends zc{constructor(u,a){super(u,a),this.current=T6}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let a=1;a<16;a++)if(u[a]!==this.current[a]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},c.aK=$E,c.aL=HE,c.aM=ti,c.aN=class extends zc{constructor(u,a){super(u,a),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},c.aO=class extends zc{constructor(u,a){super(u,a),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},c.aP=function(u,a,h,p,_,w,x){var A=1/(a-h),C=1/(p-_),P=1/(w-x);return u[0]=-2*A,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*C,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*P,u[11]=0,u[12]=(a+h)*A,u[13]=(_+p)*C,u[14]=(x+w)*P,u[15]=1,u},c.aQ=k6,c.aR=class extends xe{},c.aS=EL,c.aT=class extends ke{},c.aU=Ay,c.aV=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},c.aW=oA,c.aX=$r,c.aY=En,c.aZ=class extends yt{},c.a_=function(u,a){return u[0]===a[0]&&u[1]===a[1]&&u[2]===a[2]&&u[3]===a[3]&&u[4]===a[4]&&u[5]===a[5]&&u[6]===a[6]&&u[7]===a[7]&&u[8]===a[8]&&u[9]===a[9]&&u[10]===a[10]&&u[11]===a[11]&&u[12]===a[12]&&u[13]===a[13]&&u[14]===a[14]&&u[15]===a[15]},c.aa=function(u){const a={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,p,_,w)=>{const x=_||w;return a[p]=!x||x.toLowerCase(),""}),a["max-age"]){const h=parseInt(a["max-age"],10);isNaN(h)?delete a["max-age"]:a["max-age"]=h}return a},c.ab=function(u,a){const h=[];for(const p in u)p in a||h.push(p);return h},c.ac=we,c.ad=function(u,a,h){var p=Math.sin(h),_=Math.cos(h),w=a[0],x=a[1],A=a[2],C=a[3],P=a[4],k=a[5],L=a[6],U=a[7];return a!==u&&(u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[0]=w*_+P*p,u[1]=x*_+k*p,u[2]=A*_+L*p,u[3]=C*_+U*p,u[4]=P*_-w*p,u[5]=k*_-x*p,u[6]=L*_-A*p,u[7]=U*_-C*p,u},c.ae=function(u){var a=new ph(16);return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[4]=u[4],a[5]=u[5],a[6]=u[6],a[7]=u[7],a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a},c.af=Sg,c.ag=function(u,a){let h=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:_,minZoom:w,maxZoom:x}=u,A=_?we(ys.interpolationFactor(_,a,w,x),0,1):0;u.kind==="camera"?p=_s.number(u.minSize,u.maxSize,A):h=A}return{uSizeT:h,uSize:p}},c.ai=function(u,{uSize:a,uSizeT:h},{lowerSize:p,upperSize:_}){return u.kind==="source"?p/Ko:u.kind==="composite"?_s.number(p/Ko,_/Ko,h):a},c.aj=zy,c.ak=function(u,a,h,p){const _=a.y-u.y,w=a.x-u.x,x=p.y-h.y,A=p.x-h.x,C=x*w-A*_;if(C===0)return null;const P=(A*(u.y-h.y)-x*(u.x-h.x))/C;return new T(u.x+P*w,u.y+P*_)},c.al=a3,c.am=KE,c.an=wy,c.ao=function(u){let a=1/0,h=1/0,p=-1/0,_=-1/0;for(const w of u)a=Math.min(a,w.x),h=Math.min(h,w.y),p=Math.max(p,w.x),_=Math.max(_,w.y);return[a,h,p,_]},c.ap=mr,c.ar=Uy,c.as=function(u,a){var h=a[0],p=a[1],_=a[2],w=a[3],x=a[4],A=a[5],C=a[6],P=a[7],k=a[8],L=a[9],U=a[10],$=a[11],J=a[12],Z=a[13],ae=a[14],he=a[15],Me=h*A-p*x,ve=h*C-_*x,Se=h*P-w*x,Fe=p*C-_*A,He=p*P-w*A,ht=_*P-w*C,It=k*Z-L*J,ct=k*ae-U*J,at=k*he-$*J,bt=L*ae-U*Z,gt=L*he-$*Z,ft=U*he-$*ae,je=Me*ft-ve*gt+Se*bt+Fe*at-He*ct+ht*It;return je?(u[0]=(A*ft-C*gt+P*bt)*(je=1/je),u[1]=(_*gt-p*ft-w*bt)*je,u[2]=(Z*ht-ae*He+he*Fe)*je,u[3]=(U*He-L*ht-$*Fe)*je,u[4]=(C*at-x*ft-P*ct)*je,u[5]=(h*ft-_*at+w*ct)*je,u[6]=(ae*Se-J*ht-he*ve)*je,u[7]=(k*ht-U*Se+$*ve)*je,u[8]=(x*gt-A*at+P*It)*je,u[9]=(p*at-h*gt-w*It)*je,u[10]=(J*He-Z*Se+he*Me)*je,u[11]=(L*Se-k*He-$*Me)*je,u[12]=(A*ct-x*bt-C*It)*je,u[13]=(h*bt-p*ct+_*It)*je,u[14]=(Z*ve-J*Fe-ae*Me)*je,u[15]=(k*Fe-L*ve+U*Me)*je,u):null},c.at=Xy,c.au=Ny,c.av=Ky,c.aw=function(){const u={},a=Oe.$version;for(const h in Oe.$root){const p=Oe.$root[h];if(p.required){let _=null;_=h==="version"?a:p.type==="array"?[]:{},_!=null&&(u[h]=_)}}return u},c.ax=Tp,c.ay=fr,c.az=function(u){u=u.slice();const a=Object.create(null);for(let h=0;h<u.length;h++)a[u[h].id]=u[h];for(let h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=jo(u[h],a[u[h].ref]));return u},c.b=Gt,c.b0=function(u,a){return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u},c.b1=function(u,a,h){return u[0]=a[0]*h[0],u[1]=a[1]*h[1],u[2]=a[2]*h[2],u[3]=a[3]*h[3],u},c.b2=function(u,a){return u[0]*a[0]+u[1]*a[1]+u[2]*a[2]+u[3]*a[3]},c.b3=re,c.b4=e3,c.b5=YA,c.b6=function(u,a,h,p,_){var w,x=1/Math.tan(a/2);return u[0]=x/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=x,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,_!=null&&_!==1/0?(u[10]=(_+p)*(w=1/(p-_)),u[14]=2*_*p*w):(u[10]=-1,u[14]=-2*p),u},c.b7=function(u,a,h){var p=Math.sin(h),_=Math.cos(h),w=a[4],x=a[5],A=a[6],C=a[7],P=a[8],k=a[9],L=a[10],U=a[11];return a!==u&&(u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[4]=w*_+P*p,u[5]=x*_+k*p,u[6]=A*_+L*p,u[7]=C*_+U*p,u[8]=P*_-w*p,u[9]=k*_-x*p,u[10]=L*_-A*p,u[11]=U*_-C*p,u},c.b8=q,c.b9=ce,c.bA=SA,c.bB=function(u){return u.message===$t},c.bC=ul,c.bD=Us,c.ba=function(u){return u*Math.PI/180},c.bb=function(u,a){const{x:h,y:p}=Hp.fromLngLat(a);return!(u<0||u>25||p<0||p>=1||h<0||h>=1)},c.bc=function(u,a){return u[0]=a[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=a[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=a[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},c.bd=class extends B{},c.be=$y,c.bf=aO,c.bh=si,c.bi=function(u,a){cr.REGISTERED_PROTOCOLS[u]=a},c.bj=function(u){delete cr.REGISTERED_PROTOCOLS[u]},c.bk=function(u,a){const h={};for(let _=0;_<u.length;_++){const w=a&&a[u[_].id]||ug(u[_]);a&&(a[u[_].id]=w);let x=h[w];x||(x=h[w]=[]),x.push(u[_])}const p=[];for(const _ in h)p.push(h[_]);return p},c.bl=mt,c.bm=i3,c.bn=s3,c.bo=OA,c.bp=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=ur/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const a=u.bucket.layers[0],h=a.layout,p=a._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new Ri(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Ri(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Ri(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:k}=u.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Ri(P),u.canonical),p["text-size"].possiblyEvaluate(new Ri(k),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:k}=u.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Ri(P),u.canonical),p["icon-size"].possiblyEvaluate(new Ri(k),u.canonical)]}const w=h.get("text-line-height")*mr,x=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",A=h.get("text-keep-upright"),C=h.get("text-size");for(const P of u.bucket.features){const k=h.get("text-font").evaluate(P,{},u.canonical).join(","),L=C.evaluate(P,{},u.canonical),U=_.layoutTextSize.evaluate(P,{},u.canonical),$=_.layoutIconSize.evaluate(P,{},u.canonical),J={horizontal:{},vertical:void 0},Z=P.text;let ae,he=[0,0];if(Z){const Se=Z.toString(),Fe=h.get("text-letter-spacing").evaluate(P,{},u.canonical)*mr,He=uy(Se)?Fe:0,ht=h.get("text-anchor").evaluate(P,{},u.canonical),It=g3(a,P,u.canonical);if(!It){const gt=h.get("text-radial-offset").evaluate(P,{},u.canonical);he=gt?m3(ht,[gt*mr,Wy]):h.get("text-offset").evaluate(P,{},u.canonical).map(ft=>ft*mr)}let ct=x?"center":h.get("text-justify").evaluate(P,{},u.canonical);const at=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(P,{},u.canonical)*mr:1/0,bt=()=>{u.bucket.allowVerticalPlacement&&Sp(Se)&&(J.vertical=kg(Z,u.glyphMap,u.glyphPositions,u.imagePositions,k,at,w,ht,"left",He,he,c.ah.vertical,!0,U,L))};if(!x&&It){const gt=new Set;if(ct==="auto")for(let je=0;je<It.values.length;je+=2)gt.add(Xy(It.values[je]));else gt.add(ct);let ft=!1;for(const je of gt)if(!J.horizontal[je])if(ft)J.horizontal[je]=J.horizontal[0];else{const Et=kg(Z,u.glyphMap,u.glyphPositions,u.imagePositions,k,at,w,"center",je,He,he,c.ah.horizontal,!1,U,L);Et&&(J.horizontal[je]=Et,ft=Et.positionedLines.length===1)}bt()}else{ct==="auto"&&(ct=Xy(ht));const gt=kg(Z,u.glyphMap,u.glyphPositions,u.imagePositions,k,at,w,ht,ct,He,he,c.ah.horizontal,!1,U,L);gt&&(J.horizontal[ct]=gt),bt(),Sp(Se)&&x&&A&&(J.vertical=kg(Z,u.glyphMap,u.glyphPositions,u.imagePositions,k,at,w,ht,ct,He,he,c.ah.vertical,!1,U,L))}}let Me=!1;if(P.icon&&P.icon.name){const Se=u.imageMap[P.icon.name];Se&&(ae=VL(u.imagePositions[P.icon.name],h.get("icon-offset").evaluate(P,{},u.canonical),h.get("icon-anchor").evaluate(P,{},u.canonical)),Me=!!Se.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Me:u.bucket.sdfIcons!==Me&&We("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Se.pixelRatio!==u.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const ve=y3(J.horizontal)||J.vertical;u.bucket.iconsInText=!!ve&&ve.iconsInText,(ve||ae)&&nO(u.bucket,P,J,ae,u.imageMap,_,U,$,he,Me,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},c.bq=ky,c.br=Ry,c.bs=Py,c.bt=Cl,c.bu=Ly,c.bv=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},c.bw=function(u,a,h,p,_){return l(this,void 0,void 0,function*(){if(W())try{return yield xt(u,a,h,p,_)}catch{}return function(w,x,A,C,P){const k=w.width,L=w.height;Tt&&zt||(Tt=new OffscreenCanvas(k,L),zt=Tt.getContext("2d",{willReadFrequently:!0})),Tt.width=k,Tt.height=L,zt.drawImage(w,0,0,k,L);const U=zt.getImageData(x,A,C,P);return zt.clearRect(0,0,k,L),U.data}(u,a,h,p,_)})},c.bx=t3,c.by=f,c.bz=y,c.c=Ls,c.d=u=>l(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(a)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=be,c.f=u=>new Promise((a,h)=>{const p=new Image;p.onload=()=>{a(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=et})},p.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(u)],{type:"image/png"});p.src=u.byteLength?URL.createObjectURL(_):et}),c.g=Dr,c.h=(u,a)=>wi(be(u,{type:"json"}),a),c.i=Ft,c.j=fs,c.k=ps,c.l=(u,a)=>wi(be(u,{type:"arrayBuffer"}),a),c.m=wi,c.n=function(u){return new Ly(u).readFields(OL,[])},c.o=Op,c.p=LA,c.q=b,c.r=ly,c.s=Zi,c.t=Ep,c.u=Ca,c.v=Oe,c.w=We,c.x=function([u,a,h]){return a+=90,a*=Math.PI/180,h*=Math.PI/180,{x:u*Math.cos(a)*Math.sin(h),y:u*Math.sin(a)*Math.sin(h),z:u*Math.cos(h)}},c.y=_s,c.z=Ri}),s("worker",["./shared"],function(c){class l{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,j){for(const oe of G){this._layerConfigs[oe.id]=oe;const ye=this._layers[oe.id]=c.aA(oe);ye._featureFilter=c.a7(ye.filter),this.keyCache[oe.id]&&delete this.keyCache[oe.id]}for(const oe of j)delete this.keyCache[oe],delete this._layerConfigs[oe],delete this._layers[oe];this.familiesBySource={};const Y=c.bk(Object.values(this._layerConfigs),this.keyCache);for(const oe of Y){const ye=oe.map(De=>this._layers[De.id]),Ee=ye[0];if(Ee.visibility==="none")continue;const Re=Ee.source||"";let fe=this.familiesBySource[Re];fe||(fe=this.familiesBySource[Re]={});const Ne=Ee.sourceLayer||"_geojsonTileLayer";let Ve=fe[Ne];Ve||(Ve=fe[Ne]=[]),Ve.push(ye)}}}class f{constructor(G){const j={},Y=[];for(const Re in G){const fe=G[Re],Ne=j[Re]={};for(const Ve in fe){const De=fe[+Ve];if(!De||De.bitmap.width===0||De.bitmap.height===0)continue;const Ye={x:0,y:0,w:De.bitmap.width+2,h:De.bitmap.height+2};Y.push(Ye),Ne[Ve]={rect:Ye,metrics:De.metrics}}}const{w:oe,h:ye}=c.p(Y),Ee=new c.o({width:oe||1,height:ye||1});for(const Re in G){const fe=G[Re];for(const Ne in fe){const Ve=fe[+Ne];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const De=j[Re][Ne].rect;c.o.copy(Ve.bitmap,Ee,{x:0,y:0},{x:De.x+1,y:De.y+1},Ve.bitmap)}}this.image=Ee,this.positions=j}}c.bl("GlyphAtlas",f);class y{constructor(G){this.tileID=new c.S(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId,this.inFlightDependencies=[]}parse(G,j,Y,oe){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=G,this.collisionBoxArray=new c.a5;const ye=new c.bm(Object.keys(G.layers).sort()),Ee=new c.bn(this.tileID,this.promoteId);Ee.bucketLayerIDs=[];const Re={},fe={featureIndex:Ee,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y},Ne=j.familiesBySource[this.source];for(const Dt in Ne){const Qt=G.layers[Dt];if(!Qt)continue;Qt.version===1&&c.w(`Vector tile source "${this.source}" layer "${Dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const hi=ye.encode(Dt),$i=[];for(let sr=0;sr<Qt.length;sr++){const Ir=Qt.feature(sr),$o=Ee.getId(Ir,Dt);$i.push({feature:Ir,id:$o,index:sr,sourceLayerIndex:hi})}for(const sr of Ne[Dt]){const Ir=sr[0];Ir.source!==this.source&&c.w(`layer.source = ${Ir.source} does not equal this.source = ${this.source}`),Ir.minzoom&&this.zoom<Math.floor(Ir.minzoom)||Ir.maxzoom&&this.zoom>=Ir.maxzoom||Ir.visibility!=="none"&&(E(sr,this.zoom,Y),(Re[Ir.id]=Ir.createBucket({index:Ee.bucketLayerIDs.length,layers:sr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:hi,sourceID:this.source})).populate($i,fe,this.tileID.canonical),Ee.bucketLayerIDs.push(sr.map($o=>$o.id)))}}const Ve=c.aF(fe.glyphDependencies,Dt=>Object.keys(Dt).map(Number));this.inFlightDependencies.forEach(Dt=>Dt==null?void 0:Dt.abort()),this.inFlightDependencies=[];let De=Promise.resolve({});if(Object.keys(Ve).length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),De=oe.sendAsync({type:"GG",data:{stacks:Ve,source:this.source,tileID:this.tileID,type:"glyphs"}},Dt)}const Ye=Object.keys(fe.iconDependencies);let wt=Promise.resolve({});if(Ye.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),wt=oe.sendAsync({type:"GI",data:{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"}},Dt)}const St=Object.keys(fe.patternDependencies);let Zt=Promise.resolve({});if(St.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),Zt=oe.sendAsync({type:"GI",data:{icons:St,source:this.source,tileID:this.tileID,type:"patterns"}},Dt)}const[Ot,Xt,jt]=yield Promise.all([De,wt,Zt]),Vi=new f(Ot),Ai=new c.bo(Xt,jt);for(const Dt in Re){const Qt=Re[Dt];Qt instanceof c.a6?(E(Qt.layers,this.zoom,Y),c.bp({bucket:Qt,glyphMap:Ot,glyphPositions:Vi.positions,imageMap:Xt,imagePositions:Ai.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Qt.hasPattern&&(Qt instanceof c.bq||Qt instanceof c.br||Qt instanceof c.bs)&&(E(Qt.layers,this.zoom,Y),Qt.addFeatures(fe,this.tileID.canonical,Ai.patternPositions))}return this.status="done",{buckets:Object.values(Re).filter(Dt=>!Dt.isEmpty()),featureIndex:Ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vi.image,imageAtlas:Ai,glyphMap:this.returnDependencies?Ot:null,iconMap:this.returnDependencies?Xt:null,glyphPositions:this.returnDependencies?Vi.positions:null}})}}function E(ue,G,j){const Y=new c.z(G);for(const oe of ue)oe.recalculate(Y,j)}class T{constructor(G,j,Y){this.actor=G,this.layerIndex=j,this.availableImages=Y,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(G,j){return c._(this,void 0,void 0,function*(){const Y=yield c.l(G.request,j);try{return{vectorTile:new c.bt.VectorTile(new c.bu(Y.data)),rawData:Y.data,cacheControl:Y.cacheControl,expires:Y.expires}}catch(oe){const ye=new Uint8Array(Y.data);let Ee=`Unable to parse the tile at ${G.request.url}, `;throw Ee+=ye[0]===31&&ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${oe.message}`,new Error(Ee)}})}loadTile(G){return c._(this,void 0,void 0,function*(){const j=G.uid,Y=!!(G&&G.request&&G.request.collectResourceTiming)&&new c.bv(G.request),oe=new y(G);this.loading[j]=oe;const ye=new AbortController;oe.abort=ye;try{const Ee=yield this.loadVectorTile(G,ye);if(delete this.loading[j],!Ee)return null;const Re=Ee.rawData,fe={};Ee.expires&&(fe.expires=Ee.expires),Ee.cacheControl&&(fe.cacheControl=Ee.cacheControl);const Ne={};if(Y){const De=Y.finish();De&&(Ne.resourceTiming=JSON.parse(JSON.stringify(De)))}oe.vectorTile=Ee.vectorTile;const Ve=oe.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[j]=oe,this.fetching[j]={rawTileData:Re,cacheControl:fe,resourceTiming:Ne};try{const De=yield Ve;return c.e({rawTileData:Re.slice(0)},De,fe,Ne)}finally{delete this.fetching[j]}}catch(Ee){throw delete this.loading[j],oe.status="done",this.loaded[j]=oe,Ee}})}reloadTile(G){return c._(this,void 0,void 0,function*(){const j=G.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Y=this.loaded[j];if(Y.showCollisionBoxes=G.showCollisionBoxes,Y.status==="parsing"){const oe=yield Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor);let ye;if(this.fetching[j]){const{rawTileData:Ee,cacheControl:Re,resourceTiming:fe}=this.fetching[j];delete this.fetching[j],ye=c.e({rawTileData:Ee.slice(0)},oe,Re,fe)}else ye=oe;return ye}if(Y.status==="done"&&Y.vectorTile)return Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(G){return c._(this,void 0,void 0,function*(){const j=this.loading,Y=G.uid;j&&j[Y]&&j[Y].abort&&(j[Y].abort.abort(),delete j[Y])})}removeTile(G){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[G.uid]&&delete this.loaded[G.uid]})}}class R{constructor(){this.loaded={}}loadTile(G){return c._(this,void 0,void 0,function*(){const{uid:j,encoding:Y,rawImageData:oe,redFactor:ye,greenFactor:Ee,blueFactor:Re,baseShift:fe}=G,Ne=oe.width+2,Ve=oe.height+2,De=c.b(oe)?new c.R({width:Ne,height:Ve},yield c.bw(oe,-1,-1,Ne,Ve)):oe,Ye=new c.bx(j,De,Y,ye,Ee,Re,fe);return this.loaded=this.loaded||{},this.loaded[j]=Ye,Ye})}removeTile(G){const j=this.loaded,Y=G.uid;j&&j[Y]&&delete j[Y]}}function D(ue,G){if(ue.length!==0){V(ue[0],G);for(var j=1;j<ue.length;j++)V(ue[j],!G)}}function V(ue,G){for(var j=0,Y=0,oe=0,ye=ue.length,Ee=ye-1;oe<ye;Ee=oe++){var Re=(ue[oe][0]-ue[Ee][0])*(ue[Ee][1]+ue[oe][1]),fe=j+Re;Y+=Math.abs(j)>=Math.abs(Re)?j-fe+Re:Re-fe+j,j=fe}j+Y>=0!=!!G&&ue.reverse()}var H=c.by(function ue(G,j){var Y,oe=G&&G.type;if(oe==="FeatureCollection")for(Y=0;Y<G.features.length;Y++)ue(G.features[Y],j);else if(oe==="GeometryCollection")for(Y=0;Y<G.geometries.length;Y++)ue(G.geometries[Y],j);else if(oe==="Feature")ue(G.geometry,j);else if(oe==="Polygon")D(G.coordinates,j);else if(oe==="MultiPolygon")for(Y=0;Y<G.coordinates.length;Y++)D(G.coordinates[Y],j);return G});const ee=c.bt.VectorTileFeature.prototype.toGeoJSON;var z={exports:{}},W=c.bz,q=c.bt.VectorTileFeature,ce=we;function we(ue,G){this.options=G||{},this.features=ue,this.length=ue.length}function re(ue,G){this.id=typeof ue.id=="number"?ue.id:void 0,this.type=ue.type,this.rawGeometry=ue.type===1?[ue.geometry]:ue.geometry,this.properties=ue.tags,this.extent=G||4096}we.prototype.feature=function(ue){return new re(this.features[ue],this.options.extent)},re.prototype.loadGeometry=function(){var ue=this.rawGeometry;this.geometry=[];for(var G=0;G<ue.length;G++){for(var j=ue[G],Y=[],oe=0;oe<j.length;oe++)Y.push(new W(j[oe][0],j[oe][1]));this.geometry.push(Y)}return this.geometry},re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ue=this.geometry,G=1/0,j=-1/0,Y=1/0,oe=-1/0,ye=0;ye<ue.length;ye++)for(var Ee=ue[ye],Re=0;Re<Ee.length;Re++){var fe=Ee[Re];G=Math.min(G,fe.x),j=Math.max(j,fe.x),Y=Math.min(Y,fe.y),oe=Math.max(oe,fe.y)}return[G,Y,j,oe]},re.prototype.toGeoJSON=q.prototype.toGeoJSON;var be=c.bA,me=ce;function Te(ue){var G=new be;return function(j,Y){for(var oe in j.layers)Y.writeMessage(3,Pe,j.layers[oe])}(ue,G),G.finish()}function Pe(ue,G){var j;G.writeVarintField(15,ue.version||1),G.writeStringField(1,ue.name||""),G.writeVarintField(5,ue.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<ue.length;j++)Y.feature=ue.feature(j),G.writeMessage(2,ze,Y);var oe=Y.keys;for(j=0;j<oe.length;j++)G.writeStringField(3,oe[j]);var ye=Y.values;for(j=0;j<ye.length;j++)G.writeMessage(4,ci,ye[j])}function ze(ue,G){var j=ue.feature;j.id!==void 0&&G.writeVarintField(1,j.id),G.writeMessage(2,Ke,ue),G.writeVarintField(3,j.type),G.writeMessage(4,Ft,j)}function Ke(ue,G){var j=ue.feature,Y=ue.keys,oe=ue.values,ye=ue.keycache,Ee=ue.valuecache;for(var Re in j.properties){var fe=j.properties[Re],Ne=ye[Re];if(fe!==null){Ne===void 0&&(Y.push(Re),ye[Re]=Ne=Y.length-1),G.writeVarint(Ne);var Ve=typeof fe;Ve!=="string"&&Ve!=="boolean"&&Ve!=="number"&&(fe=JSON.stringify(fe));var De=Ve+":"+fe,Ye=Ee[De];Ye===void 0&&(oe.push(fe),Ee[De]=Ye=oe.length-1),G.writeVarint(Ye)}}}function We(ue,G){return(G<<3)+(7&ue)}function Ze(ue){return ue<<1^ue>>31}function Ft(ue,G){for(var j=ue.loadGeometry(),Y=ue.type,oe=0,ye=0,Ee=j.length,Re=0;Re<Ee;Re++){var fe=j[Re],Ne=1;Y===1&&(Ne=fe.length),G.writeVarint(We(1,Ne));for(var Ve=Y===3?fe.length-1:fe.length,De=0;De<Ve;De++){De===1&&Y!==1&&G.writeVarint(We(2,Ve-1));var Ye=fe[De].x-oe,wt=fe[De].y-ye;G.writeVarint(Ze(Ye)),G.writeVarint(Ze(wt)),oe+=Ye,ye+=wt}Y===3&&G.writeVarint(We(7,1))}}function ci(ue,G){var j=typeof ue;j==="string"?G.writeStringField(1,ue):j==="boolean"?G.writeBooleanField(7,ue):j==="number"&&(ue%1!=0?G.writeDoubleField(3,ue):ue<0?G.writeSVarintField(6,ue):G.writeVarintField(5,ue))}z.exports=Te,z.exports.fromVectorTileJs=Te,z.exports.fromGeojsonVt=function(ue,G){G=G||{};var j={};for(var Y in ue)j[Y]=new me(ue[Y].features,G),j[Y].name=Y,j[Y].version=G.version,j[Y].extent=G.extent;return Te({layers:j})},z.exports.GeoJSONWrapper=me;var Gt=c.by(z.exports);const et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},xt=Math.fround||(Tt=new Float32Array(1),ue=>(Tt[0]=+ue,Tt[0]));var Tt;const zt=3,$t=5,Ls=6;class cr{constructor(G){this.options=Object.assign(Object.create(et),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:j,minZoom:Y,maxZoom:oe}=this.options;j&&console.time("total time");const ye=`prepare ${G.length} points`;j&&console.time(ye),this.points=G;const Ee=[];for(let fe=0;fe<G.length;fe++){const Ne=G[fe];if(!Ne.geometry)continue;const[Ve,De]=Ne.geometry.coordinates,Ye=xt(si(Ve)),wt=xt(fr(De));Ee.push(Ye,wt,1/0,fe,-1,1),this.options.reduce&&Ee.push(0)}let Re=this.trees[oe+1]=this._createTree(Ee);j&&console.timeEnd(ye);for(let fe=oe;fe>=Y;fe--){const Ne=+Date.now();Re=this.trees[fe]=this._createTree(this._cluster(Re,fe)),j&&console.log("z%d: %d clusters in %dms",fe,Re.numItems,+Date.now()-Ne)}return j&&console.timeEnd("total time"),this}getClusters(G,j){let Y=((G[0]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,G[1]));let ye=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)Y=-180,ye=180;else if(Y>ye){const De=this.getClusters([Y,oe,180,Ee],j),Ye=this.getClusters([-180,oe,ye,Ee],j);return De.concat(Ye)}const Re=this.trees[this._limitZoom(j)],fe=Re.range(si(Y),fr(Ee),si(ye),fr(oe)),Ne=Re.data,Ve=[];for(const De of fe){const Ye=this.stride*De;Ve.push(Ne[Ye+$t]>1?Dr(Ne,Ye,this.clusterProps):this.points[Ne[Ye+zt]])}return Ve}getChildren(G){const j=this._getOriginId(G),Y=this._getOriginZoom(G),oe="No cluster with the specified id.",ye=this.trees[Y];if(!ye)throw new Error(oe);const Ee=ye.data;if(j*this.stride>=Ee.length)throw new Error(oe);const Re=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),fe=ye.within(Ee[j*this.stride],Ee[j*this.stride+1],Re),Ne=[];for(const Ve of fe){const De=Ve*this.stride;Ee[De+4]===G&&Ne.push(Ee[De+$t]>1?Dr(Ee,De,this.clusterProps):this.points[Ee[De+zt]])}if(Ne.length===0)throw new Error(oe);return Ne}getLeaves(G,j,Y){const oe=[];return this._appendLeaves(oe,G,j=j||10,Y=Y||0,0),oe}getTile(G,j,Y){const oe=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:Ee,radius:Re}=this.options,fe=Re/Ee,Ne=(Y-fe)/ye,Ve=(Y+1+fe)/ye,De={features:[]};return this._addTileFeatures(oe.range((j-fe)/ye,Ne,(j+1+fe)/ye,Ve),oe.data,j,Y,ye,De),j===0&&this._addTileFeatures(oe.range(1-fe/ye,Ne,1,Ve),oe.data,ye,Y,ye,De),j===ye-1&&this._addTileFeatures(oe.range(0,Ne,fe/ye,Ve),oe.data,-1,Y,ye,De),De.features.length?De:null}getClusterExpansionZoom(G){let j=this._getOriginZoom(G)-1;for(;j<=this.options.maxZoom;){const Y=this.getChildren(G);if(j++,Y.length!==1)break;G=Y[0].properties.cluster_id}return j}_appendLeaves(G,j,Y,oe,ye){const Ee=this.getChildren(j);for(const Re of Ee){const fe=Re.properties;if(fe&&fe.cluster?ye+fe.point_count<=oe?ye+=fe.point_count:ye=this._appendLeaves(G,fe.cluster_id,Y,oe,ye):ye<oe?ye++:G.push(Re),G.length===Y)break}return ye}_createTree(G){const j=new c.av(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<G.length;Y+=this.stride)j.add(G[Y],G[Y+1]);return j.finish(),j.data=G,j}_addTileFeatures(G,j,Y,oe,ye,Ee){for(const Re of G){const fe=Re*this.stride,Ne=j[fe+$t]>1;let Ve,De,Ye;if(Ne)Ve=Fr(j,fe,this.clusterProps),De=j[fe],Ye=j[fe+1];else{const Zt=this.points[j[fe+zt]];Ve=Zt.properties;const[Ot,Xt]=Zt.geometry.coordinates;De=si(Ot),Ye=fr(Xt)}const wt={type:1,geometry:[[Math.round(this.options.extent*(De*ye-Y)),Math.round(this.options.extent*(Ye*ye-oe))]],tags:Ve};let St;St=Ne||this.options.generateId?j[fe+zt]:this.points[j[fe+zt]].id,St!==void 0&&(wt.id=St),Ee.features.push(wt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,j){const{radius:Y,extent:oe,reduce:ye,minPoints:Ee}=this.options,Re=Y/(oe*Math.pow(2,j)),fe=G.data,Ne=[],Ve=this.stride;for(let De=0;De<fe.length;De+=Ve){if(fe[De+2]<=j)continue;fe[De+2]=j;const Ye=fe[De],wt=fe[De+1],St=G.within(fe[De],fe[De+1],Re),Zt=fe[De+$t];let Ot=Zt;for(const Xt of St){const jt=Xt*Ve;fe[jt+2]>j&&(Ot+=fe[jt+$t])}if(Ot>Zt&&Ot>=Ee){let Xt,jt=Ye*Zt,Vi=wt*Zt,Ai=-1;const Dt=((De/Ve|0)<<5)+(j+1)+this.points.length;for(const Qt of St){const hi=Qt*Ve;if(fe[hi+2]<=j)continue;fe[hi+2]=j;const $i=fe[hi+$t];jt+=fe[hi]*$i,Vi+=fe[hi+1]*$i,fe[hi+4]=Dt,ye&&(Xt||(Xt=this._map(fe,De,!0),Ai=this.clusterProps.length,this.clusterProps.push(Xt)),ye(Xt,this._map(fe,hi)))}fe[De+4]=Dt,Ne.push(jt/Ot,Vi/Ot,1/0,Dt,-1,Ot),ye&&Ne.push(Ai)}else{for(let Xt=0;Xt<Ve;Xt++)Ne.push(fe[De+Xt]);if(Ot>1)for(const Xt of St){const jt=Xt*Ve;if(!(fe[jt+2]<=j)){fe[jt+2]=j;for(let Vi=0;Vi<Ve;Vi++)Ne.push(fe[jt+Vi])}}}}return Ne}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,j,Y){if(G[j+$t]>1){const Ee=this.clusterProps[G[j+Ls]];return Y?Object.assign({},Ee):Ee}const oe=this.points[G[j+zt]].properties,ye=this.options.map(oe);return Y&&ye===oe?Object.assign({},ye):ye}}function Dr(ue,G,j){return{type:"Feature",id:ue[G+zt],properties:Fr(ue,G,j),geometry:{type:"Point",coordinates:[(Y=ue[G],360*(Y-.5)),wi(ue[G+1])]}};var Y}function Fr(ue,G,j){const Y=ue[G+$t],oe=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,ye=ue[G+Ls],Ee=ye===-1?{}:Object.assign({},j[ye]);return Object.assign(Ee,{cluster:!0,cluster_id:ue[G+zt],point_count:Y,point_count_abbreviated:oe})}function si(ue){return ue/360+.5}function fr(ue){const G=Math.sin(ue*Math.PI/180),j=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return j<0?0:j>1?1:j}function wi(ue){const G=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Zi(ue,G,j,Y){let oe=Y;const ye=G+(j-G>>1);let Ee,Re=j-G;const fe=ue[G],Ne=ue[G+1],Ve=ue[j],De=ue[j+1];for(let Ye=G+3;Ye<j;Ye+=3){const wt=Gn(ue[Ye],ue[Ye+1],fe,Ne,Ve,De);if(wt>oe)Ee=Ye,oe=wt;else if(wt===oe){const St=Math.abs(Ye-ye);St<Re&&(Ee=Ye,Re=St)}}oe>Y&&(Ee-G>3&&Zi(ue,G,Ee,Y),ue[Ee+2]=oe,j-Ee>3&&Zi(ue,Ee,j,Y))}function Gn(ue,G,j,Y,oe,ye){let Ee=oe-j,Re=ye-Y;if(Ee!==0||Re!==0){const fe=((ue-j)*Ee+(G-Y)*Re)/(Ee*Ee+Re*Re);fe>1?(j=oe,Y=ye):fe>0&&(j+=Ee*fe,Y+=Re*fe)}return Ee=ue-j,Re=G-Y,Ee*Ee+Re*Re}function ts(ue,G,j,Y){const oe={id:ue??null,type:G,geometry:j,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")ps(oe,j);else if(G==="Polygon")ps(oe,j[0]);else if(G==="MultiLineString")for(const ye of j)ps(oe,ye);else if(G==="MultiPolygon")for(const ye of j)ps(oe,ye[0]);return oe}function ps(ue,G){for(let j=0;j<G.length;j+=3)ue.minX=Math.min(ue.minX,G[j]),ue.minY=Math.min(ue.minY,G[j+1]),ue.maxX=Math.max(ue.maxX,G[j]),ue.maxY=Math.max(ue.maxY,G[j+1])}function fs(ue,G,j,Y){if(!G.geometry)return;const oe=G.geometry.coordinates;if(oe&&oe.length===0)return;const ye=G.geometry.type,Ee=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2);let Re=[],fe=G.id;if(j.promoteId?fe=G.properties[j.promoteId]:j.generateId&&(fe=Y||0),ye==="Point")Ws(oe,Re);else if(ye==="MultiPoint")for(const Ne of oe)Ws(Ne,Re);else if(ye==="LineString")Oe(oe,Re,Ee,!1);else if(ye==="MultiLineString"){if(j.lineMetrics){for(const Ne of oe)Re=[],Oe(Ne,Re,Ee,!1),ue.push(ts(fe,"LineString",Re,G.properties));return}is(oe,Re,Ee,!1)}else if(ye==="Polygon")is(oe,Re,Ee,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const Ne of G.geometry.geometries)fs(ue,{id:fe,geometry:Ne,properties:G.properties},j,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ne of oe){const Ve=[];is(Ne,Ve,Ee,!0),Re.push(Ve)}}ue.push(ts(fe,ye,Re,G.properties))}function Ws(ue,G){G.push(jo(ue[0]),Yt(ue[1]),0)}function Oe(ue,G,j,Y){let oe,ye,Ee=0;for(let fe=0;fe<ue.length;fe++){const Ne=jo(ue[fe][0]),Ve=Yt(ue[fe][1]);G.push(Ne,Ve,0),fe>0&&(Ee+=Y?(oe*Ve-Ne*ye)/2:Math.sqrt(Math.pow(Ne-oe,2)+Math.pow(Ve-ye,2))),oe=Ne,ye=Ve}const Re=G.length-3;G[2]=1,Zi(G,0,Re,j),G[Re+2]=1,G.size=Math.abs(Ee),G.start=0,G.end=G.size}function is(ue,G,j,Y){for(let oe=0;oe<ue.length;oe++){const ye=[];Oe(ue[oe],ye,j,Y),G.push(ye)}}function jo(ue){return ue/360+.5}function Yt(ue){const G=Math.sin(ue*Math.PI/180),j=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return j<0?0:j>1?1:j}function xi(ue,G,j,Y,oe,ye,Ee,Re){if(Y/=G,ye>=(j/=G)&&Ee<Y)return ue;if(Ee<j||ye>=Y)return null;const fe=[];for(const Ne of ue){const Ve=Ne.geometry;let De=Ne.type;const Ye=oe===0?Ne.minX:Ne.minY,wt=oe===0?Ne.maxX:Ne.maxY;if(Ye>=j&&wt<Y){fe.push(Ne);continue}if(wt<j||Ye>=Y)continue;let St=[];if(De==="Point"||De==="MultiPoint")vr(Ve,St,j,Y,oe);else if(De==="LineString")Vn(Ve,St,j,Y,oe,!1,Re.lineMetrics);else if(De==="MultiLineString")Go(Ve,St,j,Y,oe,!1);else if(De==="Polygon")Go(Ve,St,j,Y,oe,!0);else if(De==="MultiPolygon")for(const Zt of Ve){const Ot=[];Go(Zt,Ot,j,Y,oe,!0),Ot.length&&St.push(Ot)}if(St.length){if(Re.lineMetrics&&De==="LineString"){for(const Zt of St)fe.push(ts(Ne.id,De,Zt,Ne.tags));continue}De!=="LineString"&&De!=="MultiLineString"||(St.length===1?(De="LineString",St=St[0]):De="MultiLineString"),De!=="Point"&&De!=="MultiPoint"||(De=St.length===3?"Point":"MultiPoint"),fe.push(ts(Ne.id,De,St,Ne.tags))}}return fe.length?fe:null}function vr(ue,G,j,Y,oe){for(let ye=0;ye<ue.length;ye+=3){const Ee=ue[ye+oe];Ee>=j&&Ee<=Y&&ms(G,ue[ye],ue[ye+1],ue[ye+2])}}function Vn(ue,G,j,Y,oe,ye,Ee){let Re=_n(ue);const fe=oe===0?ga:Vo;let Ne,Ve,De=ue.start;for(let Ot=0;Ot<ue.length-3;Ot+=3){const Xt=ue[Ot],jt=ue[Ot+1],Vi=ue[Ot+2],Ai=ue[Ot+3],Dt=ue[Ot+4],Qt=oe===0?Xt:jt,hi=oe===0?Ai:Dt;let $i=!1;Ee&&(Ne=Math.sqrt(Math.pow(Xt-Ai,2)+Math.pow(jt-Dt,2))),Qt<j?hi>j&&(Ve=fe(Re,Xt,jt,Ai,Dt,j),Ee&&(Re.start=De+Ne*Ve)):Qt>Y?hi<Y&&(Ve=fe(Re,Xt,jt,Ai,Dt,Y),Ee&&(Re.start=De+Ne*Ve)):ms(Re,Xt,jt,Vi),hi<j&&Qt>=j&&(Ve=fe(Re,Xt,jt,Ai,Dt,j),$i=!0),hi>Y&&Qt<=Y&&(Ve=fe(Re,Xt,jt,Ai,Dt,Y),$i=!0),!ye&&$i&&(Ee&&(Re.end=De+Ne*Ve),G.push(Re),Re=_n(ue)),Ee&&(De+=Ne)}let Ye=ue.length-3;const wt=ue[Ye],St=ue[Ye+1],Zt=oe===0?wt:St;Zt>=j&&Zt<=Y&&ms(Re,wt,St,ue[Ye+2]),Ye=Re.length-3,ye&&Ye>=3&&(Re[Ye]!==Re[0]||Re[Ye+1]!==Re[1])&&ms(Re,Re[0],Re[1],Re[2]),Re.length&&G.push(Re)}function _n(ue){const G=[];return G.size=ue.size,G.start=ue.start,G.end=ue.end,G}function Go(ue,G,j,Y,oe,ye){for(const Ee of ue)Vn(Ee,G,j,Y,oe,ye,!1)}function ms(ue,G,j,Y){ue.push(G,j,Y)}function ga(ue,G,j,Y,oe,ye){const Ee=(ye-G)/(Y-G);return ms(ue,ye,j+(oe-j)*Ee,1),Ee}function Vo(ue,G,j,Y,oe,ye){const Ee=(ye-j)/(oe-j);return ms(ue,G+(Y-G)*Ee,ye,1),Ee}function Je(ue,G){const j=[];for(let Y=0;Y<ue.length;Y++){const oe=ue[Y],ye=oe.type;let Ee;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ee=Os(oe.geometry,G);else if(ye==="MultiLineString"||ye==="Polygon"){Ee=[];for(const Re of oe.geometry)Ee.push(Os(Re,G))}else if(ye==="MultiPolygon"){Ee=[];for(const Re of oe.geometry){const fe=[];for(const Ne of Re)fe.push(Os(Ne,G));Ee.push(fe)}}j.push(ts(oe.id,ye,Ee,oe.tags))}return j}function Os(ue,G){const j=[];j.size=ue.size,ue.start!==void 0&&(j.start=ue.start,j.end=ue.end);for(let Y=0;Y<ue.length;Y+=3)j.push(ue[Y]+G,ue[Y+1],ue[Y+2]);return j}function br(ue,G){if(ue.transformed)return ue;const j=1<<ue.z,Y=ue.x,oe=ue.y;for(const ye of ue.features){const Ee=ye.geometry,Re=ye.type;if(ye.geometry=[],Re===1)for(let fe=0;fe<Ee.length;fe+=2)ye.geometry.push(rs(Ee[fe],Ee[fe+1],G,j,Y,oe));else for(let fe=0;fe<Ee.length;fe++){const Ne=[];for(let Ve=0;Ve<Ee[fe].length;Ve+=2)Ne.push(rs(Ee[fe][Ve],Ee[fe][Ve+1],G,j,Y,oe));ye.geometry.push(Ne)}}return ue.transformed=!0,ue}function rs(ue,G,j,Y,oe,ye){return[Math.round(j*(ue*Y-oe)),Math.round(j*(G*Y-ye))]}function Xs(ue,G,j,Y,oe){const ye=G===oe.maxZoom?0:oe.tolerance/((1<<G)*oe.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:ue.length,source:null,x:j,y:Y,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Re of ue)st(Ee,Re,ye,oe);return Ee}function st(ue,G,j,Y){const oe=G.geometry,ye=G.type,Ee=[];if(ue.minX=Math.min(ue.minX,G.minX),ue.minY=Math.min(ue.minY,G.minY),ue.maxX=Math.max(ue.maxX,G.maxX),ue.maxY=Math.max(ue.maxY,G.maxY),ye==="Point"||ye==="MultiPoint")for(let Re=0;Re<oe.length;Re+=3)Ee.push(oe[Re],oe[Re+1]),ue.numPoints++,ue.numSimplified++;else if(ye==="LineString")Nt(Ee,oe,ue,j,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Re=0;Re<oe.length;Re++)Nt(Ee,oe[Re],ue,j,ye==="Polygon",Re===0);else if(ye==="MultiPolygon")for(let Re=0;Re<oe.length;Re++){const fe=oe[Re];for(let Ne=0;Ne<fe.length;Ne++)Nt(Ee,fe[Ne],ue,j,!0,Ne===0)}if(Ee.length){let Re=G.tags||null;if(ye==="LineString"&&Y.lineMetrics){Re={};for(const Ne in G.tags)Re[Ne]=G.tags[Ne];Re.mapbox_clip_start=oe.start/oe.size,Re.mapbox_clip_end=oe.end/oe.size}const fe={geometry:Ee,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Re};G.id!==null&&(fe.id=G.id),ue.features.push(fe)}}function Nt(ue,G,j,Y,oe,ye){const Ee=Y*Y;if(Y>0&&G.size<(oe?Ee:Y))return void(j.numPoints+=G.length/3);const Re=[];for(let fe=0;fe<G.length;fe+=3)(Y===0||G[fe+2]>Ee)&&(j.numSimplified++,Re.push(G[fe],G[fe+1])),j.numPoints++;oe&&function(fe,Ne){let Ve=0;for(let De=0,Ye=fe.length,wt=Ye-2;De<Ye;wt=De,De+=2)Ve+=(fe[De]-fe[wt])*(fe[De+1]+fe[wt+1]);if(Ve>0===Ne)for(let De=0,Ye=fe.length;De<Ye/2;De+=2){const wt=fe[De],St=fe[De+1];fe[De]=fe[Ye-2-De],fe[De+1]=fe[Ye-1-De],fe[Ye-2-De]=wt,fe[Ye-1-De]=St}}(Re,ye),ue.push(Re)}const Mt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Nr{constructor(G,j){const Y=(j=this.options=function(ye,Ee){for(const Re in Ee)ye[Re]=Ee[Re];return ye}(Object.create(Mt),j)).debug;if(Y&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");let oe=function(ye,Ee){const Re=[];if(ye.type==="FeatureCollection")for(let fe=0;fe<ye.features.length;fe++)fs(Re,ye.features[fe],Ee,fe);else fs(Re,ye.type==="Feature"?ye:{geometry:ye},Ee);return Re}(G,j);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),oe=function(ye,Ee){const Re=Ee.buffer/Ee.extent;let fe=ye;const Ne=xi(ye,1,-1-Re,Re,0,-1,2,Ee),Ve=xi(ye,1,1-Re,2+Re,0,-1,2,Ee);return(Ne||Ve)&&(fe=xi(ye,1,-Re,1+Re,0,-1,2,Ee)||[],Ne&&(fe=Je(Ne,1).concat(fe)),Ve&&(fe=fe.concat(Je(Ve,-1)))),fe}(oe,j),oe.length&&this.splitTile(oe,0,0,0),Y&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,j,Y,oe,ye,Ee,Re){const fe=[G,j,Y,oe],Ne=this.options,Ve=Ne.debug;for(;fe.length;){oe=fe.pop(),Y=fe.pop(),j=fe.pop(),G=fe.pop();const De=1<<j,Ye=Ds(j,Y,oe);let wt=this.tiles[Ye];if(!wt&&(Ve>1&&console.time("creation"),wt=this.tiles[Ye]=Xs(G,j,Y,oe,Ne),this.tileCoords.push({z:j,x:Y,y:oe}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,Y,oe,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));const $i=`z${j}`;this.stats[$i]=(this.stats[$i]||0)+1,this.total++}if(wt.source=G,ye==null){if(j===Ne.indexMaxZoom||wt.numPoints<=Ne.indexMaxPoints)continue}else{if(j===Ne.maxZoom||j===ye)continue;if(ye!=null){const $i=ye-j;if(Y!==Ee>>$i||oe!==Re>>$i)continue}}if(wt.source=null,G.length===0)continue;Ve>1&&console.time("clipping");const St=.5*Ne.buffer/Ne.extent,Zt=.5-St,Ot=.5+St,Xt=1+St;let jt=null,Vi=null,Ai=null,Dt=null,Qt=xi(G,De,Y-St,Y+Ot,0,wt.minX,wt.maxX,Ne),hi=xi(G,De,Y+Zt,Y+Xt,0,wt.minX,wt.maxX,Ne);G=null,Qt&&(jt=xi(Qt,De,oe-St,oe+Ot,1,wt.minY,wt.maxY,Ne),Vi=xi(Qt,De,oe+Zt,oe+Xt,1,wt.minY,wt.maxY,Ne),Qt=null),hi&&(Ai=xi(hi,De,oe-St,oe+Ot,1,wt.minY,wt.maxY,Ne),Dt=xi(hi,De,oe+Zt,oe+Xt,1,wt.minY,wt.maxY,Ne),hi=null),Ve>1&&console.timeEnd("clipping"),fe.push(jt||[],j+1,2*Y,2*oe),fe.push(Vi||[],j+1,2*Y,2*oe+1),fe.push(Ai||[],j+1,2*Y+1,2*oe),fe.push(Dt||[],j+1,2*Y+1,2*oe+1)}}getTile(G,j,Y){G=+G,j=+j,Y=+Y;const oe=this.options,{extent:ye,debug:Ee}=oe;if(G<0||G>24)return null;const Re=1<<G,fe=Ds(G,j=j+Re&Re-1,Y);if(this.tiles[fe])return br(this.tiles[fe],ye);Ee>1&&console.log("drilling down to z%d-%d-%d",G,j,Y);let Ne,Ve=G,De=j,Ye=Y;for(;!Ne&&Ve>0;)Ve--,De>>=1,Ye>>=1,Ne=this.tiles[Ds(Ve,De,Ye)];return Ne&&Ne.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",Ve,De,Ye),console.time("drilling down")),this.splitTile(Ne.source,Ve,De,Ye,G,j,Y),Ee>1&&console.timeEnd("drilling down"),this.tiles[fe]?br(this.tiles[fe],ye):null):null}}function Ds(ue,G,j){return 32*((1<<ue)*j+G)+ue}function Pt(ue,G){return G?ue.properties[G]:ue.id}function Ks(ue,G){if(ue==null)return!0;if(ue.type==="Feature")return Pt(ue,G)!=null;if(ue.type==="FeatureCollection"){const j=new Set;for(const Y of ue.features){const oe=Pt(Y,G);if(oe==null||j.has(oe))return!1;j.add(oe)}return!0}return!1}function yn(ue,G){const j=new Map;if(ue!=null)if(ue.type==="Feature")j.set(Pt(ue,G),ue);else for(const Y of ue.features)j.set(Pt(Y,G),Y);return j}class vn extends T{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(G,j){return c._(this,void 0,void 0,function*(){const Y=G.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const oe=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!oe)return null;const ye=new class{constructor(Re){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.X,this.length=Re.length,this._features=Re}feature(Re){return new class{constructor(fe){this._feature=fe,this.extent=c.X,this.type=fe.type,this.properties=fe.tags,"id"in fe&&!isNaN(fe.id)&&(this.id=parseInt(fe.id,10))}loadGeometry(){if(this._feature.type===1){const fe=[];for(const Ne of this._feature.geometry)fe.push([new c.P(Ne[0],Ne[1])]);return fe}{const fe=[];for(const Ne of this._feature.geometry){const Ve=[];for(const De of Ne)Ve.push(new c.P(De[0],De[1]));fe.push(Ve)}return fe}}toGeoJSON(fe,Ne,Ve){return ee.call(this,fe,Ne,Ve)}}(this._features[Re])}}(oe.features);let Ee=Gt(ye);return Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),{vectorTile:ye,rawData:Ee.buffer}})}loadData(G){return c._(this,void 0,void 0,function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const Y=!!(G&&G.request&&G.request.collectResourceTiming)&&new c.bv(G.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(G,this._pendingRequest),this._geoJSONIndex=G.cluster?new cr(function({superclusterOptions:Ee,clusterProperties:Re}){if(!Re||!Ee)return Ee;const fe={},Ne={},Ve={accumulated:null,zoom:0},De={properties:null},Ye=Object.keys(Re);for(const wt of Ye){const[St,Zt]=Re[wt],Ot=c.bC(Zt),Xt=c.bC(typeof St=="string"?[St,["accumulated"],["get",wt]]:St);fe[wt]=Ot.value,Ne[wt]=Xt.value}return Ee.map=wt=>{De.properties=wt;const St={};for(const Zt of Ye)St[Zt]=fe[Zt].evaluate(Ve,De);return St},Ee.reduce=(wt,St)=>{De.properties=St;for(const Zt of Ye)Ve.accumulated=wt[Zt],wt[Zt]=Ne[Zt].evaluate(Ve,De)},Ee}(G)).load((yield this._pendingData).features):(oe=yield this._pendingData,new Nr(oe,G.geojsonVtOptions)),this.loaded={};const ye={};if(Y){const Ee=Y.finish();Ee&&(ye.resourceTiming={},ye.resourceTiming[G.source]=JSON.parse(JSON.stringify(Ee)))}return ye}catch(ye){if(delete this._pendingRequest,c.bB(ye))return{abandoned:!0};throw ye}var oe})}getData(){return c._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(G){const j=this.loaded;return j&&j[G.uid]?super.reloadTile(G):this.loadTile(G)}loadAndProcessGeoJSON(G,j){return c._(this,void 0,void 0,function*(){let Y=yield this.loadGeoJSON(G,j);if(delete this._pendingRequest,typeof Y!="object")throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);if(H(Y,!0),G.filter){const oe=c.bC(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(oe.result==="error")throw new Error(oe.value.map(ye=>`${ye.key}: ${ye.message}`).join(", "));Y={type:"FeatureCollection",features:Y.features.filter(ye=>oe.value.evaluate({zoom:0},ye))}}return Y})}loadGeoJSON(G,j){return c._(this,void 0,void 0,function*(){const{promoteId:Y}=G;if(G.request){const oe=yield c.h(G.request,j);return this._dataUpdateable=Ks(oe.data,Y)?yn(oe.data,Y):void 0,oe.data}if(typeof G.data=="string")try{const oe=JSON.parse(G.data);return this._dataUpdateable=Ks(oe,Y)?yn(oe,Y):void 0,oe}catch{throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`)}if(!G.dataDiff)throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${G.source}`);return function(oe,ye,Ee){var Re,fe,Ne,Ve;if(ye.removeAll&&oe.clear(),ye.remove)for(const De of ye.remove)oe.delete(De);if(ye.add)for(const De of ye.add){const Ye=Pt(De,Ee);Ye!=null&&oe.set(Ye,De)}if(ye.update)for(const De of ye.update){let Ye=oe.get(De.id);if(Ye==null)continue;const wt=!De.removeAllProperties&&(((Re=De.removeProperties)===null||Re===void 0?void 0:Re.length)>0||((fe=De.addOrUpdateProperties)===null||fe===void 0?void 0:fe.length)>0);if((De.newGeometry||De.removeAllProperties||wt)&&(Ye=Object.assign({},Ye),oe.set(De.id,Ye),wt&&(Ye.properties=Object.assign({},Ye.properties))),De.newGeometry&&(Ye.geometry=De.newGeometry),De.removeAllProperties)Ye.properties={};else if(((Ne=De.removeProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const St of De.removeProperties)Object.prototype.hasOwnProperty.call(Ye.properties,St)&&delete Ye.properties[St];if(((Ve=De.addOrUpdateProperties)===null||Ve===void 0?void 0:Ve.length)>0)for(const{key:St,value:Zt}of De.addOrUpdateProperties)Ye.properties[St]=Zt}}(this._dataUpdateable,G.dataDiff,Y),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(G){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(G){return this._geoJSONIndex.getClusterExpansionZoom(G.clusterId)}getClusterChildren(G){return this._geoJSONIndex.getChildren(G.clusterId)}getClusterLeaves(G){return this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset)}}class Fs{constructor(G){this.self=G,this.actor=new c.F(G),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(j,Y)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=Y},this.self.addProtocol=c.bi,this.self.removeProtocol=c.bj,this.self.registerRTLTextPlugin=j=>{if(c.bD.isParsed())throw new Error("RTL text plugin already registered.");c.bD.setMethods(j)},this.actor.registerMessageHandler("LDT",(j,Y)=>this._getDEMWorkerSource(j,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RDT",(j,Y)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(j,Y.source).removeTile(Y)})),this.actor.registerMessageHandler("GCEZ",(j,Y)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(j,Y.type,Y.source).getClusterExpansionZoom(Y)})),this.actor.registerMessageHandler("GCC",(j,Y)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(j,Y.type,Y.source).getClusterChildren(Y)})),this.actor.registerMessageHandler("GCL",(j,Y)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(j,Y.type,Y.source).getClusterLeaves(Y)})),this.actor.registerMessageHandler("LD",(j,Y)=>this._getWorkerSource(j,Y.type,Y.source).loadData(Y)),this.actor.registerMessageHandler("GD",(j,Y)=>this._getWorkerSource(j,Y.type,Y.source).getData()),this.actor.registerMessageHandler("LT",(j,Y)=>this._getWorkerSource(j,Y.type,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RT",(j,Y)=>this._getWorkerSource(j,Y.type,Y.source).reloadTile(Y)),this.actor.registerMessageHandler("AT",(j,Y)=>this._getWorkerSource(j,Y.type,Y.source).abortTile(Y)),this.actor.registerMessageHandler("RMT",(j,Y)=>this._getWorkerSource(j,Y.type,Y.source).removeTile(Y)),this.actor.registerMessageHandler("RS",(j,Y)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[j]||!this.workerSources[j][Y.type]||!this.workerSources[j][Y.type][Y.source])return;const oe=this.workerSources[j][Y.type][Y.source];delete this.workerSources[j][Y.type][Y.source],oe.removeSource!==void 0&&oe.removeSource(Y)})),this.actor.registerMessageHandler("RM",j=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j]})),this.actor.registerMessageHandler("SR",(j,Y)=>c._(this,void 0,void 0,function*(){this.referrer=Y})),this.actor.registerMessageHandler("SRPS",(j,Y)=>this._syncRTLPluginState(j,Y)),this.actor.registerMessageHandler("IS",(j,Y)=>c._(this,void 0,void 0,function*(){this.self.importScripts(Y)})),this.actor.registerMessageHandler("SI",(j,Y)=>this._setImages(j,Y)),this.actor.registerMessageHandler("UL",(j,Y)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(j).update(Y.layers,Y.removedIds)})),this.actor.registerMessageHandler("SL",(j,Y)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(j).replace(Y)}))}_setImages(G,j){return c._(this,void 0,void 0,function*(){this.availableImages[G]=j;for(const Y in this.workerSources[G]){const oe=this.workerSources[G][Y];for(const ye in oe)oe[ye].availableImages=j}})}_syncRTLPluginState(G,j){return c._(this,void 0,void 0,function*(){if(c.bD.isParsed())return c.bD.getState();if(j.pluginStatus!=="loading")return c.bD.setState(j),j;const Y=j.pluginURL;if(this.self.importScripts(Y),c.bD.isParsed()){const oe={pluginStatus:"loaded",pluginURL:Y};return c.bD.setState(oe),oe}throw c.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${Y}`)})}_getAvailableImages(G){let j=this.availableImages[G];return j||(j=[]),j}_getLayerIndex(G){let j=this.layerIndexes[G];return j||(j=this.layerIndexes[G]=new l),j}_getWorkerSource(G,j,Y){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][j]||(this.workerSources[G][j]={}),!this.workerSources[G][j][Y]){const oe={sendAsync:(ye,Ee)=>(ye.targetMapId=G,this.actor.sendAsync(ye,Ee))};switch(j){case"vector":this.workerSources[G][j][Y]=new T(oe,this._getLayerIndex(G),this._getAvailableImages(G));break;case"geojson":this.workerSources[G][j][Y]=new vn(oe,this._getLayerIndex(G),this._getAvailableImages(G));break;default:this.workerSources[G][j][Y]=new this.externalWorkerSourceTypes[j](oe,this._getLayerIndex(G),this._getAvailableImages(G))}}return this.workerSources[G][j][Y]}_getDEMWorkerSource(G,j){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][j]||(this.demWorkerSources[G][j]=new R),this.demWorkerSources[G][j]}}return c.i(self)&&(self.worker=new Fs(self)),Fs}),s("index",["exports","./shared"],function(c,l){var f="4.7.1";let y,E;const T={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:b=>new Promise((o,d)=>{const m=requestAnimationFrame(o);b.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),d(l.c())})}),getImageData(b,o=0){return this.getImageCanvasContext(b).getImageData(-o,-o,b.width+2*o,b.height+2*o)},getImageCanvasContext(b){const o=window.document.createElement("canvas"),d=o.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return o.width=b.width,o.height=b.height,d.drawImage(b,0,0,b.width,b.height),d},resolveURL:b=>(y||(y=document.createElement("a")),y.href=b,y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(E==null&&(E=matchMedia("(prefers-reduced-motion: reduce)")),E.matches)}};class R{static testProp(o){if(!R.docStyle)return o[0];for(let d=0;d<o.length;d++)if(o[d]in R.docStyle)return o[d];return o[0]}static create(o,d,m){const g=window.document.createElement(o);return d!==void 0&&(g.className=d),m&&m.appendChild(g),g}static createNS(o,d){return window.document.createElementNS(o,d)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(o,d){o.style[R.transformProp]=d}static addEventListener(o,d,m,g={}){o.addEventListener(d,m,"passive"in g?g:g.capture)}static removeEventListener(o,d,m,g={}){o.removeEventListener(d,m,"passive"in g?g:g.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static getScale(o){const d=o.getBoundingClientRect();return{x:d.width/o.offsetWidth||1,y:d.height/o.offsetHeight||1,boundingClientRect:d}}static getPoint(o,d,m){const g=d.boundingClientRect;return new l.P((m.clientX-g.left)/d.x-o.clientLeft,(m.clientY-g.top)/d.y-o.clientTop)}static mousePos(o,d){const m=R.getScale(o);return R.getPoint(o,m,d)}static touchPos(o,d){const m=[],g=R.getScale(o);for(let v=0;v<d.length;v++)m.push(R.getPoint(o,g,d[v]));return m}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const D={supported:!1,testSupport:function(b){!ee&&H&&(z?W(b):V=b)}};let V,H,ee=!1,z=!1;function W(b){const o=b.createTexture();b.bindTexture(b.TEXTURE_2D,o);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,H),b.isContextLost())return;D.supported=!0}catch{}b.deleteTexture(o),ee=!0}var q;typeof document<"u"&&(H=document.createElement("img"),H.onload=()=>{V&&W(V),V=null,z=!0},H.onerror=()=>{ee=!0,V=null},H.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(b){let o,d,m,g;b.resetRequestQueue=()=>{o=[],d=0,m=0,g={}},b.addThrottleControl=M=>{const B=m++;return g[B]=M,B},b.removeThrottleControl=M=>{delete g[M],S()},b.getImage=(M,B,F=!0)=>new Promise((N,X)=>{D.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),l.e(M,{type:"image"}),o.push({abortController:B,requestParameters:M,supportImageRefresh:F,state:"queued",onError:Q=>{X(Q)},onSuccess:Q=>{N(Q)}}),S()});const v=M=>l._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:B,supportImageRefresh:F,onError:N,onSuccess:X,abortController:Q}=M,te=F===!1&&!l.i(self)&&!l.g(B.url)&&(!B.headers||Object.keys(B.headers).reduce((pe,ge)=>pe&&ge==="accept",!0));d++;const le=te?I(B,Q):l.m(B,Q);try{const pe=yield le;delete M.abortController,M.state="completed",pe.data instanceof HTMLImageElement||l.b(pe.data)?X(pe):pe.data&&X({data:yield(de=pe.data,typeof createImageBitmap=="function"?l.d(de):l.f(de)),cacheControl:pe.cacheControl,expires:pe.expires})}catch(pe){delete M.abortController,N(pe)}finally{d--,S()}var de}),S=()=>{const M=(()=>{for(const B of Object.keys(g))if(g[B]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let B=d;B<M&&o.length>0;B++){const F=o.shift();F.abortController.signal.aborted?B--:v(F)}},I=(M,B)=>new Promise((F,N)=>{const X=new Image,Q=M.url,te=M.credentials;te&&te==="include"?X.crossOrigin="use-credentials":(te&&te==="same-origin"||!l.s(Q))&&(X.crossOrigin="anonymous"),B.signal.addEventListener("abort",()=>{X.src="",N(l.c())}),X.fetchPriority="high",X.onload=()=>{X.onerror=X.onload=null,F({data:X})},X.onerror=()=>{X.onerror=X.onload=null,B.signal.aborted||N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},X.src=Q})}(q||(q={})),q.resetRequestQueue();class ce{constructor(o){this._transformRequestFn=o}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function we(b){var o=new l.A(3);return o[0]=b[0],o[1]=b[1],o[2]=b[2],o}var re,be=function(b,o,d){return b[0]=o[0]-d[0],b[1]=o[1]-d[1],b[2]=o[2]-d[2],b};re=new l.A(3),l.A!=Float32Array&&(re[0]=0,re[1]=0,re[2]=0);var me=function(b){var o=b[0],d=b[1];return o*o+d*d};function Te(b){const o=[];if(typeof b=="string")o.push({id:"default",url:b});else if(b&&b.length>0){const d=[];for(const{id:m,url:g}of b){const v=`${m}${g}`;d.indexOf(v)===-1&&(d.push(v),o.push({id:m,url:g}))}}return o}function Pe(b,o,d){const m=b.split("?");return m[0]+=`${o}${d}`,m.join("?")}(function(){var b=new l.A(2);l.A!=Float32Array&&(b[0]=0,b[1]=0)})();class ze{constructor(o,d,m,g){this.context=o,this.format=m,this.texture=o.gl.createTexture(),this.update(d,g)}update(o,d,m){const{width:g,height:v}=o,S=!(this.size&&this.size[0]===g&&this.size[1]===v||m),{context:I}=this,{gl:M}=I;if(this.useMipmap=!!(d&&d.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!d||d.premultiply!==!1)),S)this.size=[g,v],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.b(o)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,g,v,0,this.format,M.UNSIGNED_BYTE,o.data);else{const{x:B,y:F}=m||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.b(o)?M.texSubImage2D(M.TEXTURE_2D,0,B,F,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,B,F,g,v,M.RGBA,M.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(o,d,m){const{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),m!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=v.LINEAR),o!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,o),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,m||o),this.filter=o),d!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,d),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function Ke(b){const{userImage:o}=b;return!!(o&&o.render&&o.render())&&(b.data.replace(new Uint8Array(o.data.buffer)),!0)}class We extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,promiseResolve:m}of this.requestors)m(this._getImagesForIds(d));this.requestors=[]}}getImage(o){const d=this.images[o];if(d&&!d.data&&d.spriteData){const m=d.spriteData;d.data=new l.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),d.spriteData=null}return d}addImage(o,d){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let m=!0;const g=d.data||d.spriteData;return this._validateStretch(d.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${o}" has invalid "stretchX" value`))),m=!1),this._validateStretch(d.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${o}" has invalid "stretchY" value`))),m=!1),this._validateContent(d.content,d)||(this.fire(new l.j(new Error(`Image "${o}" has invalid "content" value`))),m=!1),m}_validateStretch(o,d){if(!o)return!0;let m=0;for(const g of o){if(g[0]<m||g[1]<g[0]||d<g[1])return!1;m=g[1]}return!0}_validateContent(o,d){if(!o)return!0;if(o.length!==4)return!1;const m=d.spriteData,g=m&&m.width||d.data.width,v=m&&m.height||d.data.height;return!(o[0]<0||g<o[0]||o[1]<0||v<o[1]||o[2]<0||g<o[2]||o[3]<0||v<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,d,m=!0){const g=this.getImage(o);if(m&&(g.data.width!==d.data.width||g.data.height!==d.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=g.version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((d,m)=>{let g=!0;if(!this.isLoaded())for(const v of o)this.images[v]||(g=!1);this.isLoaded()||g?d(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:d})})}_getImagesForIds(o){const d={};for(const m of o){let g=this.getImage(m);g||(this.fire(new l.k("styleimagemissing",{id:m})),g=this.getImage(m)),g?d[m]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:l.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],m=this.getImage(o);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const g={w:m.data.width+2,h:m.data.height+2,x:0,y:0},v=new l.I(g,m);this.patterns[o]={bin:g,position:v}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ze(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const v in this.patterns)o.push(this.patterns[v].bin);const{w:d,h:m}=l.p(o),g=this.atlasImage;g.resize({width:d||1,height:m||1});for(const v in this.patterns){const{bin:S}=this.patterns[v],I=S.x+1,M=S.y+1,B=this.getImage(v).data,F=B.width,N=B.height;l.R.copy(B,g,{x:0,y:0},{x:I,y:M},{width:F,height:N}),l.R.copy(B,g,{x:0,y:N-1},{x:I,y:M-1},{width:F,height:1}),l.R.copy(B,g,{x:0,y:0},{x:I,y:M+N},{width:F,height:1}),l.R.copy(B,g,{x:F-1,y:0},{x:I-1,y:M},{width:1,height:N}),l.R.copy(B,g,{x:0,y:0},{x:I+F,y:M},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const m=this.getImage(d);m||l.w(`Image with ID: "${d}" was not found`),Ke(m)&&this.updateImage(d,m)}}}const Ze=1e20;function Ft(b,o,d,m,g,v,S,I,M){for(let B=o;B<o+m;B++)ci(b,d*v+B,v,g,S,I,M);for(let B=d;B<d+g;B++)ci(b,B*v+o,1,m,S,I,M)}function ci(b,o,d,m,g,v,S){v[0]=0,S[0]=-Ze,S[1]=Ze,g[0]=b[o];for(let I=1,M=0,B=0;I<m;I++){g[I]=b[o+I*d];const F=I*I;do{const N=v[M];B=(g[I]-g[N]+F-N*N)/(I-N)/2}while(B<=S[M]&&--M>-1);M++,v[M]=I,S[M]=B,S[M+1]=Ze}for(let I=0,M=0;I<m;I++){for(;S[M+1]<I;)M++;const B=v[M],F=I-B;b[o+I*d]=g[B]+F*F}}class Gt{constructor(o,d){this.requestManager=o,this.localIdeographFontFamily=d,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return l._(this,void 0,void 0,function*(){const d=[];for(const v in o)for(const S of o[v])d.push(this._getAndCacheGlyphsPromise(v,S));const m=yield Promise.all(d),g={};for(const{stack:v,id:S,glyph:I}of m)g[v]||(g[v]={}),g[v][S]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return g})}_getAndCacheGlyphsPromise(o,d){return l._(this,void 0,void 0,function*(){let m=this.entries[o];m||(m=this.entries[o]={glyphs:{},requests:{},ranges:{}});let g=m.glyphs[d];if(g!==void 0)return{stack:o,id:d,glyph:g};if(g=this._tinySDF(m,o,d),g)return m.glyphs[d]=g,{stack:o,id:d,glyph:g};const v=Math.floor(d/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[v])return{stack:o,id:d,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[v]){const I=Gt.loadGlyphRange(o,v,this.url,this.requestManager);m.requests[v]=I}const S=yield m.requests[v];for(const I in S)this._doesCharSupportLocalGlyph(+I)||(m.glyphs[+I]=S[+I]);return m.ranges[v]=!0,{stack:o,id:d,glyph:S[d]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(o))}_tinySDF(o,d,m){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(m))return;let v=o.tinySDF;if(!v){let I="400";/bold/i.test(d)?I="900":/medium/i.test(d)?I="500":/light/i.test(d)&&(I="200"),v=o.tinySDF=new Gt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:I})}const S=v.draw(String.fromCharCode(m));return{id:m,bitmap:new l.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}Gt.loadGlyphRange=function(b,o,d,m){return l._(this,void 0,void 0,function*(){const g=256*o,v=g+255,S=m.transformRequest(d.replace("{fontstack}",b).replace("{range}",`${g}-${v}`),"Glyphs"),I=yield l.l(S,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${o}, ${g}-${v}`);const M={};for(const B of l.n(I.data))M[B.id]=B;return M})},Gt.TinySDF=class{constructor({fontSize:b=24,buffer:o=3,radius:d=8,cutoff:m=.25,fontFamily:g="sans-serif",fontWeight:v="normal",fontStyle:S="normal"}={}){this.buffer=o,this.cutoff=m,this.radius=d;const I=this.size=b+4*o,M=this._createCanvas(I),B=this.ctx=M.getContext("2d",{willReadFrequently:!0});B.font=`${S} ${v} ${b}px ${g}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(b){const o=document.createElement("canvas");return o.width=o.height=b,o}draw(b){const{width:o,actualBoundingBoxAscent:d,actualBoundingBoxDescent:m,actualBoundingBoxLeft:g,actualBoundingBoxRight:v}=this.ctx.measureText(b),S=Math.ceil(d),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-g))),M=Math.min(this.size-this.buffer,S+Math.ceil(m)),B=I+2*this.buffer,F=M+2*this.buffer,N=Math.max(B*F,0),X=new Uint8ClampedArray(N),Q={data:X,width:B,height:F,glyphWidth:I,glyphHeight:M,glyphTop:S,glyphLeft:0,glyphAdvance:o};if(I===0||M===0)return Q;const{ctx:te,buffer:le,gridInner:de,gridOuter:pe}=this;te.clearRect(le,le,I,M),te.fillText(b,le,le+S);const ge=te.getImageData(le,le,I,M);pe.fill(Ze,0,N),de.fill(0,0,N);for(let ne=0;ne<M;ne++)for(let xe=0;xe<I;xe++){const Ae=ge.data[4*(ne*I+xe)+3]/255;if(Ae===0)continue;const ke=(ne+le)*B+xe+le;if(Ae===1)pe[ke]=0,de[ke]=Ze;else{const Ge=.5-Ae;pe[ke]=Ge>0?Ge*Ge:0,de[ke]=Ge<0?Ge*Ge:0}}Ft(pe,0,0,B,F,B,this.f,this.v,this.z),Ft(de,le,le,I,M,B,this.f,this.v,this.z);for(let ne=0;ne<N;ne++){const xe=Math.sqrt(pe[ne])-Math.sqrt(de[ne]);X[ne]=Math.round(255-255*(xe/this.radius+this.cutoff))}return Q}};class et{constructor(){this.specification=l.v.light.position}possiblyEvaluate(o,d){return l.x(o.expression.evaluate(d))}interpolate(o,d,m){return{x:l.y.number(o.x,d.x,m),y:l.y.number(o.y,d.y,m),z:l.y.number(o.z,d.z,m)}}}let xt;class Tt extends l.E{constructor(o){super(),xt=xt||new l.q({anchor:new l.D(l.v.light.anchor),position:new et,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(xt),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(l.r,o,d))for(const m in o){const g=o[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,m){return(!m||m.validate!==!1)&&l.t(this,o.call(l.u,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const zt=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class $t extends l.E{constructor(o){super(),this._transitionable=new l.T(zt),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(o,d={}){if(!this._validate(l.B,o,d)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in o){const g=o[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,m={}){return(m==null?void 0:m.validate)!==!1&&l.t(this,o.call(l.u,l.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class Ls{constructor(o,d){this.width=o,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,d){const m=o.join(",")+String(d);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(o,d)),this.dashEntry[m]}getDashRanges(o,d,m){const g=[];let v=o.length%2==1?-o[o.length-1]*m:0,S=o[0]*m,I=!0;g.push({left:v,right:S,isDash:I,zeroLength:o[0]===0});let M=o[0];for(let B=1;B<o.length;B++){I=!I;const F=o[B];v=M*m,M+=F,S=M*m,g.push({left:v,right:S,isDash:I,zeroLength:F===0})}return g}addRoundDash(o,d,m){const g=d/2;for(let v=-m;v<=m;v++){const S=this.width*(this.nextRow+m+v);let I=0,M=o[I];for(let B=0;B<this.width;B++){B/M.right>1&&(M=o[++I]);const F=Math.abs(B-M.left),N=Math.abs(B-M.right),X=Math.min(F,N);let Q;const te=v/m*(g+1);if(M.isDash){const le=g-Math.abs(te);Q=Math.sqrt(X*X+le*le)}else Q=g-Math.sqrt(X*X+te*te);this.data[S+B]=Math.max(0,Math.min(255,Q+128))}}}addRegularDash(o){for(let I=o.length-1;I>=0;--I){const M=o[I],B=o[I+1];M.zeroLength?o.splice(I,1):B&&B.isDash===M.isDash&&(B.left=M.left,o.splice(I,1))}const d=o[0],m=o[o.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const g=this.width*this.nextRow;let v=0,S=o[v];for(let I=0;I<this.width;I++){I/S.right>1&&(S=o[++v]);const M=Math.abs(I-S.left),B=Math.abs(I-S.right),F=Math.min(M,B);this.data[g+I]=Math.max(0,Math.min(255,(S.isDash?F:-F)+128))}}addDash(o,d){const m=d?7:0,g=2*m+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let v=0;for(let I=0;I<o.length;I++)v+=o[I];if(v!==0){const I=this.width/v,M=this.getDashRanges(o,this.width,I);d?this.addRoundDash(M,I,m):this.addRegularDash(M)}const S={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:v};return this.nextRow+=g,this.dirty=!0,S}bind(o){const d=o.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const cr="maplibre_preloaded_worker_pool";class Dr{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Dr.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[cr]}numActive(){return Object.keys(this.active).length}}const Fr=Math.floor(T.hardwareConcurrency/2);let si,fr;function wi(){return si||(si=new Dr),si}Dr.workerCount=l.C(globalThis)?Math.max(Math.min(Fr,3),1):1;class Zi{constructor(o,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d;const m=this.workerPool.acquire(d);for(let g=0;g<m.length;g++){const v=new l.F(m[g],d);v.name=`Worker ${g}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,d){const m=[];for(const g of this.actors)m.push(g.sendAsync({type:o,data:d}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,d){for(const m of this.actors)m.registerMessageHandler(o,d)}}function Gn(){return fr||(fr=new Zi(wi(),l.G),fr.registerMessageHandler("GR",(b,o,d)=>l.m(o,d))),fr}function ts(b,o){const d=l.H();return l.J(d,d,[1,1,0]),l.K(d,d,[.5*b.width,.5*b.height,1]),l.L(d,d,b.calculatePosMatrix(o.toUnwrapped()))}function ps(b,o,d,m,g,v){const S=function(N,X,Q){if(N)for(const te of N){const le=X[te];if(le&&le.source===Q&&le.type==="fill-extrusion")return!0}else for(const te in X){const le=X[te];if(le.source===Q&&le.type==="fill-extrusion")return!0}return!1}(g&&g.layers,o,b.id),I=v.maxPitchScaleFactor(),M=b.tilesIn(m,I,S);M.sort(fs);const B=[];for(const N of M)B.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(o,d,b._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,g,v,I,ts(b.transform,N.tileID))});const F=function(N){const X={},Q={};for(const te of N){const le=te.queryResults,de=te.wrappedTileID,pe=Q[de]=Q[de]||{};for(const ge in le){const ne=le[ge],xe=pe[ge]=pe[ge]||{},Ae=X[ge]=X[ge]||[];for(const ke of ne)xe[ke.featureIndex]||(xe[ke.featureIndex]=!0,Ae.push(ke))}}return X}(B);for(const N in F)F[N].forEach(X=>{const Q=X.feature,te=b.getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=te});return F}function fs(b,o){const d=b.tileID,m=o.tileID;return d.overscaledZ-m.overscaledZ||d.canonical.y-m.canonical.y||d.wrap-m.wrap||d.canonical.x-m.canonical.x}function Ws(b,o,d){return l._(this,void 0,void 0,function*(){let m=b;if(b.url?m=(yield l.h(o.transformRequest(b.url,"Source"),d)).data:yield T.frameAsync(d),!m)return null;const g=l.M(l.e(m,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(g.vectorLayerIds=m.vector_layers.map(v=>v.id)),g})}class Oe{constructor(o,d){o&&(d?this.setSouthWest(o).setNorthEast(d):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof l.N?new l.N(o.lng,o.lat):l.N.convert(o),this}setSouthWest(o){return this._sw=o instanceof l.N?new l.N(o.lng,o.lat):l.N.convert(o),this}extend(o){const d=this._sw,m=this._ne;let g,v;if(o instanceof l.N)g=o,v=o;else{if(!(o instanceof Oe))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Oe.convert(o)):this.extend(l.N.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(l.N.convert(o)):this;if(g=o._sw,v=o._ne,!g||!v)return this}return d||m?(d.lng=Math.min(g.lng,d.lng),d.lat=Math.min(g.lat,d.lat),m.lng=Math.max(v.lng,m.lng),m.lat=Math.max(v.lat,m.lat)):(this._sw=new l.N(g.lng,g.lat),this._ne=new l.N(v.lng,v.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:d,lat:m}=l.N.convert(o);let g=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&g}static convert(o){return o instanceof Oe?o:o&&new Oe(o)}static fromLngLat(o,d=0){const m=360*d/40075017,g=m/Math.cos(Math.PI/180*o.lat);return new Oe(new l.N(o.lng-g,o.lat-m),new l.N(o.lng+g,o.lat+m))}adjustAntiMeridian(){const o=new l.N(this._sw.lng,this._sw.lat),d=new l.N(this._ne.lng,this._ne.lat);return new Oe(o,o.lng>d.lng?new l.N(d.lng+360,d.lat):d)}}class is{constructor(o,d,m){this.bounds=Oe.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=m||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),m=Math.floor(l.O(this.bounds.getWest())*d),g=Math.floor(l.Q(this.bounds.getNorth())*d),v=Math.ceil(l.O(this.bounds.getEast())*d),S=Math.ceil(l.Q(this.bounds.getSouth())*d);return o.x>=m&&o.x<v&&o.y>=g&&o.y<S}}class jo extends l.E{constructor(o,d,m,g){if(super(),this.id=o,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(d,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Ws(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(l.e(this,o),o.bounds&&(this.tileBounds=new is(o.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new l.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(o){return l._(this,void 0,void 0,function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};m.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((v,S)=>{o.reloadPromise={resolve:v,reject:S}})}else o.actor=this.dispatcher.getActor(),g="LT";o.abortController=new AbortController;try{const v=yield o.actor.sendAsync({type:g,data:m},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,v)}catch(v){if(delete o.abortController,o.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,d){if(d&&d.resourceTiming&&(o.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&o.setExpiryData(d),o.loadVectorData(d,this.map.painter),o.reloadPromise){const m=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(m.resolve).catch(m.reject)}}abortTile(o){return l._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return l._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Yt extends l.E{constructor(o,d,m,g){super(),this.id=o,this.dispatcher=m,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},d),l.e(this,l.M(d,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Ws(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(l.e(this,o),o.bounds&&(this.tileBounds=new is(o.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new l.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return l.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return l._(this,void 0,void 0,function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const m=yield q.getImage(this.map._requestManager.transformRequest(d,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&o.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const g=this.map.painter.context,v=g.gl,S=m.data;o.texture=this.map.painter.getTileTexture(S.width),o.texture?o.texture.update(S,{useMipmap:!0}):(o.texture=new ze(g,S,v.RGBA,{useMipmap:!0}),o.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(m){if(delete o.abortController,o.aborted)o.state="unloaded";else if(m)throw o.state="errored",m}})}abortTile(o){return l._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return l._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class xi extends Yt{constructor(o,d,m,g){super(o,d,m,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(o){return l._(this,void 0,void 0,function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(d,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const g=yield q.getImage(m,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(g&&g.data){const v=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&o.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const S=l.b(v)&&l.U()?v:yield this.readImageNow(v),I={type:this.type,uid:o.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const M=yield o.actor.sendAsync({type:"LDT",data:I});o.dem=M,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(g){if(delete o.abortController,o.aborted)o.state="unloaded";else if(g)throw o.state="errored",g}})}readImageNow(o){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const d=o.width+2,m=o.height+2;try{return new l.R({width:d,height:m},yield l.W(o,-1,-1,d,m))}catch{}}return T.getImageData(o,1)})}_getNeighboringTiles(o){const d=o.canonical,m=Math.pow(2,d.z),g=(d.x-1+m)%m,v=d.x===0?o.wrap-1:o.wrap,S=(d.x+1+m)%m,I=d.x+1===m?o.wrap+1:o.wrap,M={};return M[new l.S(o.overscaledZ,v,d.z,g,d.y).key]={backfilled:!1},M[new l.S(o.overscaledZ,I,d.z,S,d.y).key]={backfilled:!1},d.y>0&&(M[new l.S(o.overscaledZ,v,d.z,g,d.y-1).key]={backfilled:!1},M[new l.S(o.overscaledZ,o.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},M[new l.S(o.overscaledZ,I,d.z,S,d.y-1).key]={backfilled:!1}),d.y+1<m&&(M[new l.S(o.overscaledZ,v,d.z,g,d.y+1).key]={backfilled:!1},M[new l.S(o.overscaledZ,o.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},M[new l.S(o.overscaledZ,I,d.z,S,d.y+1).key]={backfilled:!1}),M}unloadTile(o){return l._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class vr extends l.E{constructor(o,d,m,g){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(g),this._data=d.data,this._options=l.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const v=l.X/this.tileSize;d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*v,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*v,extent:l.X,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.X,radius:(d.clusterRadius||50)*v,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}getData(){return l._(this,void 0,void 0,function*(){const o=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})})}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,d,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:d,offset:m}})}_updateWorkerData(o){return l._(this,void 0,void 0,function*(){const d=l.e({type:this.type},this.workerOptions);o?d.dataDiff=o:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(T.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let g=null;m.resourceTiming&&m.resourceTiming[this.id]&&(g=m.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&l.e(v,{resourceTiming:g}),this.fire(new l.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(o){return l._(this,void 0,void 0,function*(){const d=o.actor?"RT":"LT";o.actor=this.actor;const m={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const g=yield this.actor.sendAsync({type:d,data:m},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(g,this.map.painter,d==="RT")})}abortTile(o){return l._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return l._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Vn=l.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class _n extends l.E{constructor(o,d,m,g){super(),this.id=o,this.dispatcher=m,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=d}load(o){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield q.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,o&&(this.coordinates=o),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new l.j(d))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const d=o.map(l.Z.fromLngLat);this.tileID=function(g){let v=1/0,S=1/0,I=-1/0,M=-1/0;for(const X of g)v=Math.min(v,X.x),S=Math.min(S,X.y),I=Math.max(I,X.x),M=Math.max(M,X.y);const B=Math.max(I-v,M-S),F=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),N=Math.pow(2,F);return new l.a1(F,Math.floor((v+I)/2*N),Math.floor((S+M)/2*N))}(d),this.minzoom=this.maxzoom=this.tileID.z;const m=d.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.$,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,l.X,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,l.X),this._boundsArray.emplaceBack(m[2].x,m[2].y,l.X,l.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Vn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ze(o,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Go extends _n{constructor(o,d,m,g){super(o,d,m,g),this.roundZoom=!0,this.type="video",this.options=d}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const d of o.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield l.a3(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new l.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const d=this.video.seekable;o<d.start(0)||o>d.end(0)?this.fire(new l.j(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Vn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new ze(o,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ms extends _n{constructor(o,d,m,g){super(o,d,m,g),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(S=>typeof S!="number"))||this.fire(new l.j(new l.a2(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a2(`sources.${o}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.j(new l.a2(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a2(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a2(`sources.${o}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Vn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ze(d,this.canvas,m.RGBA,{premultiply:!0});let g=!1;for(const v in this.tiles){const S=this.tiles[v];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,g=!0)}g&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const ga={},Vo=b=>{switch(b){case"geojson":return vr;case"image":return _n;case"raster":return Yt;case"raster-dem":return xi;case"vector":return jo;case"video":return Go;case"canvas":return ms}return ga[b]},Je="RTLPluginLoaded";class Os extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Gn()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return l._(this,arguments,void 0,function*(d,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=T.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Je))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let br=null;function rs(){return br||(br=new Os),br}class Xs{constructor(o,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=l.a4(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const d=o+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,d,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(g,v){const S={};if(!v)return S;for(const I of g){const M=I.layerIds.map(B=>v.getLayer(B)).filter(Boolean);if(M.length!==0){I.layers=M,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(B=>M.filter(F=>F.id===B)[0]));for(const B of M)S[B.id]=I}}return S}(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const v=this.buckets[g];if(v instanceof l.a6){if(this.hasSymbolBuckets=!0,!m)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const v=this.buckets[g];if(v instanceof l.a6&&v.hasRTLText){this.hasRTLText=!0,rs().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const v=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(g).queryRadius(v))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new l.a5}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(o)}const d=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ze(o,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ze(o,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,d,m,g,v,S,I,M,B,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:v,scale:S,tileSize:this.tileSize,pixelPosMatrix:F,transform:M,params:I,queryPadding:this.queryPadding*B},o,d,m):{}}querySourceFeatures(o,d){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const g=m.loadVTLayers(),v=d&&d.sourceLayer?d.sourceLayer:"",S=g._geojsonTileLayer||g[v];if(!S)return;const I=l.a7(d&&d.filter),{z:M,x:B,y:F}=this.tileID.canonical,N={z:M,x:B,y:F};for(let X=0;X<S.length;X++){const Q=S.feature(X);if(I.needGeometry){const de=l.a8(Q,!0);if(!I.filter(new l.z(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!I.filter(new l.z(this.tileID.overscaledZ),Q))continue;const te=m.getId(Q,v),le=new l.a9(Q,M,B,F,te);le.tile=N,o.push(le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const m=l.aa(o.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const m=Date.now();let g=!1;if(this.expirationTime>m)g=!1;else if(d)if(this.expirationTime<d)g=!0;else{const v=this.expirationTime-d;v?this.expirationTime=m+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!d.style.hasLayer(g))continue;const v=this.buckets[g],S=v.layers[0].sourceLayer||"_geojsonTileLayer",I=m[S],M=o[S];if(!I||!M||Object.keys(M).length===0)continue;v.update(M,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const B=d&&d.style&&d.style.getLayer(g);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<T.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=T.now()+o}setDependencies(o,d){const m={};for(const g of d)m[g]=!0;this.dependencies[o]=m}hasDependency(o,d){for(const m of o){const g=this.dependencies[m];if(g){for(const v of d)if(g[v])return!0}}return!1}}class st{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,m){const g=o.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const v={value:d,timeout:void 0};if(m!==void 0&&(v.timeout=setTimeout(()=>{this.remove(o,v)},m)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const m=o.wrapped().key,g=d===void 0?0:this.data[m].indexOf(d),v=this.data[m][g];return this.data[m].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(v.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const m in this.data)for(const g of this.data[m])o(g.value)||d.push(g);for(const m of d)this.remove(m.value.tileID,m)}}class Nt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,m){const g=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][g]=this.stateChanges[o][g]||{},l.e(this.stateChanges[o][g],m),this.deletedStates[o]===null){this.deletedStates[o]={};for(const v in this.state[o])v!==g&&(this.deletedStates[o][v]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][g]===null){this.deletedStates[o][g]={};for(const v in this.state[o][g])m[v]||(this.deletedStates[o][g][v]=null)}else for(const v in m)this.deletedStates[o]&&this.deletedStates[o][g]&&this.deletedStates[o][g][v]===null&&delete this.deletedStates[o][g][v]}removeFeatureState(o,d,m){if(this.deletedStates[o]===null)return;const g=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},m&&d!==void 0)this.deletedStates[o][g]!==null&&(this.deletedStates[o][g]=this.deletedStates[o][g]||{},this.deletedStates[o][g][m]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][g])for(m in this.deletedStates[o][g]={},this.stateChanges[o][g])this.deletedStates[o][g][m]=null;else this.deletedStates[o][g]=null;else this.deletedStates[o]=null}getState(o,d){const m=String(d),g=l.e({},(this.state[o]||{})[m],(this.stateChanges[o]||{})[m]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const v=this.deletedStates[o][d];if(v===null)return{};for(const S in v)delete g[S]}return g}initializeTileState(o,d){o.setFeatureState(this.state,d)}coalesceChanges(o,d){const m={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const v={};for(const S in this.stateChanges[g])this.state[g][S]||(this.state[g][S]={}),l.e(this.state[g][S],this.stateChanges[g][S]),v[S]=this.state[g][S];m[g]=v}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const v={};if(this.deletedStates[g]===null)for(const S in this.state[g])v[S]={},this.state[g][S]={};else for(const S in this.deletedStates[g]){if(this.deletedStates[g][S]===null)this.state[g][S]={};else for(const I of Object.keys(this.deletedStates[g][S]))delete this.state[g][S][I];v[S]=this.state[g][S]}m[g]=m[g]||{},l.e(m[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const g in o)o[g].setFeatureState(m,d)}}class Mt extends l.E{constructor(o,d,m){super(),this.id=o,this.dispatcher=m,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,v,S,I)=>{const M=new(Vo(v.type))(g,v,S,I);if(M.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${M.id}`);return M})(o,d,m,this),this._tiles={},this._cache=new st(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Nt,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const d=this._tiles[o];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,d,m){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,d,m)}catch(g){o.state="errored",g.status!==404?this._source.fire(new l.j(g,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new l.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const m=this._tiles[d];m.upload(o),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Nr).map(o=>o.key)}getRenderableIds(o){const d=[];for(const m in this._tiles)this._isIdRenderable(m,o)&&d.push(this._tiles[m]);return o?d.sort((m,g)=>{const v=m.tileID,S=g.tileID,I=new l.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),M=new l.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-S.overscaledZ||M.y-I.y||M.x-I.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(Nr).map(m=>m.key)}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,d){return l._(this,void 0,void 0,function*(){const m=this._tiles[o];m&&(m.state!=="loading"&&(m.state=d),yield this._loadTile(m,o,d))})}_tileLoaded(o,d,m){o.timeAdded=T.now(),m==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const d=this.getRenderableIds();for(let g=0;g<d.length;g++){const v=d[g];if(o.neighboringTiles&&o.neighboringTiles[v]){const S=this.getTileByID(v);m(o,S),m(S,o)}}function m(g,v){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let S=v.tileID.canonical.x-g.tileID.canonical.x;const I=v.tileID.canonical.y-g.tileID.canonical.y,M=Math.pow(2,g.tileID.canonical.z),B=v.tileID.key;S===0&&I===0||Math.abs(I)>1||(Math.abs(S)>1&&(Math.abs(S+M)===1?S+=M:Math.abs(S-M)===1&&(S-=M)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,S,I),g.neighboringTiles&&g.neighboringTiles[B]&&(g.neighboringTiles[B].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,m,g){for(const v in this._tiles){let S=this._tiles[v];if(g[v]||!S.hasData()||S.tileID.overscaledZ<=d||S.tileID.overscaledZ>m)continue;let I=S.tileID;for(;S&&S.tileID.overscaledZ>d+1;){const B=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[B.key],S&&S.hasData()&&(I=B)}let M=I;for(;M.overscaledZ>d;)if(M=M.scaledTo(M.overscaledZ-1),o[M.key]){g[I.key]=I;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const m=this._loadedParentTiles[o.key];return m&&m.tileID.overscaledZ>=d?m:null}for(let m=o.overscaledZ-1;m>=d;m--){const g=o.scaledTo(m),v=this._getLoadedTile(g);if(v)return v}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const d=Math.ceil(o.width/this._source.tileSize)+1,m=Math.ceil(o.height/this._source.tileSize)+1,g=Math.floor(d*m*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const m={};for(const g in this._tiles){const v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+d),m[v.tileID.key]=v}this._tiles=m;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}_updateCoveredAndRetainedTiles(o,d,m,g,v,S){const I={},M={},B=Object.keys(o),F=T.now();for(const N of B){const X=o[N],Q=this._tiles[N];if(!Q||Q.fadeEndTime!==0&&Q.fadeEndTime<=F)continue;const te=this.findLoadedParent(X,d),le=this.findLoadedSibling(X),de=te||le||null;de&&(this._addTile(de.tileID),I[de.tileID.key]=de.tileID),M[N]=X}this._retainLoadedChildren(M,g,m,o);for(const N in I)o[N]||(this._coveredTiles[N]=!0,o[N]=I[N]);if(S){const N={},X={};for(const Q of v)this._tiles[Q.key].hasData()?N[Q.key]=Q:X[Q.key]=Q;for(const Q in X){const te=X[Q].children(this._source.maxzoom);this._tiles[te[0].key]&&this._tiles[te[1].key]&&this._tiles[te[2].key]&&this._tiles[te[3].key]&&(N[te[0].key]=o[te[0].key]=te[0],N[te[1].key]=o[te[1].key]=te[1],N[te[2].key]=o[te[2].key]=te[2],N[te[3].key]=o[te[3].key]=te[3],delete X[Q])}for(const Q in X){const te=X[Q],le=this.findLoadedParent(te,this._source.minzoom),de=this.findLoadedSibling(te),pe=le||de||null;if(pe){N[pe.tileID.key]=o[pe.tileID.key]=pe.tileID;for(const ge in N)N[ge].isChildOf(pe.tileID)&&delete N[ge]}}for(const Q in this._tiles)N[Q]||(this._coveredTiles[Q]=!0)}}update(o,d){if(!this._sourceLoaded||this._paused)return;let m;this.transform=o,this.terrain=d,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new l.S(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(m=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(m=m.filter(F=>this._source.hasTile(F)))):m=[];const g=o.coveringZoomLevel(this._source),v=Math.max(g-Mt.maxOverzooming,this._source.minzoom),S=Math.max(g+Mt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const N of m)if(N.canonical.z>this._source.minzoom){const X=N.scaledTo(N.canonical.z-1);F[X.key]=X;const Q=N.scaledTo(Math.max(this._source.minzoom,Math.min(N.canonical.z,5)));F[Q.key]=Q}m=m.concat(Object.values(F))}const I=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(m,g);Ds(this._source.type)&&this._updateCoveredAndRetainedTiles(M,v,S,g,m,d);for(const F in M)this._tiles[F].clearFadeHold();const B=l.ab(this._tiles,M);for(const F of B){const N=this._tiles[F];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,d){var m;const g={},v={},S=Math.max(d-Mt.maxOverzooming,this._source.minzoom),I=Math.max(d+Mt.maxUnderzooming,this._source.minzoom),M={};for(const B of o){const F=this._addTile(B);g[B.key]=B,F.hasData()||d<this._source.maxzoom&&(M[B.key]=B)}this._retainLoadedChildren(M,d,I,g);for(const B of o){let F=this._tiles[B.key];if(F.hasData())continue;if(d+1>this._source.maxzoom){const X=B.children(this._source.maxzoom)[0],Q=this.getTile(X);if(Q&&Q.hasData()){g[X.key]=X;continue}}else{const X=B.children(this._source.maxzoom);if(g[X[0].key]&&g[X[1].key]&&g[X[2].key]&&g[X[3].key])continue}let N=F.wasRequested();for(let X=B.overscaledZ-1;X>=S;--X){const Q=B.scaledTo(X);if(v[Q.key])break;if(v[Q.key]=!0,F=this.getTile(Q),!F&&N&&(F=this._addTile(Q)),F){const te=F.hasData();if((te||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||N)&&(g[Q.key]=Q),N=F.wasRequested(),te)break}}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let m,g=this._tiles[o].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){m=this._loadedParentTiles[g.key];break}d.push(g.key);const v=g.scaledTo(g.overscaledZ-1);if(m=this._getLoadedTile(v),m)break;g=v}for(const v of d)this._loadedParentTiles[v]=m}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const o in this._tiles){const d=this._tiles[o].tileID,m=this._getLoadedTile(d);this._loadedSiblingTiles[d.key]=m}}_addTile(o){let d=this._tiles[o.key];if(d)return d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const m=d;return d||(d=new Xs(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(d,o.key,d.state)),d.uses++,this._tiles[o.key]=d,m||this._source.fire(new l.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const m=d.getExpiryTimeout();m&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},m))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(o){const d=o.sourceDataType;o.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,d,m){const g=[],v=this.transform;if(!v)return g;const S=m?v.getCameraQueryGeometry(o):o,I=o.map(te=>v.pointCoordinate(te,this.terrain)),M=S.map(te=>v.pointCoordinate(te,this.terrain)),B=this.getIds();let F=1/0,N=1/0,X=-1/0,Q=-1/0;for(const te of M)F=Math.min(F,te.x),N=Math.min(N,te.y),X=Math.max(X,te.x),Q=Math.max(Q,te.y);for(let te=0;te<B.length;te++){const le=this._tiles[B[te]];if(le.holdingForFade())continue;const de=le.tileID,pe=Math.pow(2,v.zoom-le.tileID.overscaledZ),ge=d*le.queryPadding*l.X/le.tileSize/pe,ne=[de.getTilePoint(new l.Z(F,N)),de.getTilePoint(new l.Z(X,Q))];if(ne[0].x-ge<l.X&&ne[0].y-ge<l.X&&ne[1].x+ge>=0&&ne[1].y+ge>=0){const xe=I.map(ke=>de.getTilePoint(ke)),Ae=M.map(ke=>de.getTilePoint(ke));g.push({tile:le,tileID:de,queryGeometry:xe,cameraQueryGeometry:Ae,scale:pe})}}return g}getVisibleCoordinates(o){const d=this.getRenderableIds(o).map(m=>this._tiles[m].tileID);for(const m of d)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Ds(this._source.type)){const o=T.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=o)return!0}return!1}setFeatureState(o,d,m){this._state.updateState(o=o||"_geojsonTileLayer",d,m)}removeFeatureState(o,d,m){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,m)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,m){const g=this._tiles[o];g&&g.setDependencies(d,m)}reloadTilesForDependencies(o,d){for(const m in this._tiles)this._tiles[m].hasDependency(o,d)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(o,d))}}function Nr(b,o){const d=Math.abs(2*b.wrap)-+(b.wrap<0),m=Math.abs(2*o.wrap)-+(o.wrap<0);return b.overscaledZ-o.overscaledZ||m-d||o.canonical.y-b.canonical.y||o.canonical.x-b.canonical.x}function Ds(b){return b==="raster"||b==="image"||b==="video"}Mt.maxOverzooming=10,Mt.maxUnderzooming=3;class Pt{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=l.ac(o,0,1);let d=1,m=this._distances[d];const g=o*this.paddedLength+this.padding;for(;m<g&&d<this._distances.length;)m=this._distances[++d];const v=d-1,S=this._distances[v],I=m-S,M=I>0?(g-S)/I:0;return this.points[v].mult(1-M).add(this.points[d].mult(M))}}function Ks(b,o){let d=!0;return b==="always"||b!=="never"&&o!=="never"||(d=!1),d}class yn{constructor(o,d,m){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(o/m),this.yCellCount=Math.ceil(d/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,m,g,v){this._forEachCell(d,m,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(o,d,m,g){this._forEachCell(d-g,m-g,d+g,m+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(m),this.circles.push(g)}_insertBoxCell(o,d,m,g,v,S){this.boxCells[v].push(S)}_insertCircleCell(o,d,m,g,v,S){this.circleCells[v].push(S)}_query(o,d,m,g,v,S,I){if(m<0||o>this.width||g<0||d>this.height)return[];const M=[];if(o<=0&&d<=0&&this.width<=m&&this.height<=g){if(v)return[{key:null,x1:o,y1:d,x2:m,y2:g}];for(let B=0;B<this.boxKeys.length;B++)M.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const F=this.circles[3*B],N=this.circles[3*B+1],X=this.circles[3*B+2];M.push({key:this.circleKeys[B],x1:F-X,y1:N-X,x2:F+X,y2:N+X})}}else this._forEachCell(o,d,m,g,this._queryCell,M,{hitTest:v,overlapMode:S,seenUids:{box:{},circle:{}}},I);return M}query(o,d,m,g){return this._query(o,d,m,g,!1,null)}hitTest(o,d,m,g,v,S){return this._query(o,d,m,g,!0,v,S).length>0}hitTestCircle(o,d,m,g,v){const S=o-m,I=o+m,M=d-m,B=d+m;if(I<0||S>this.width||B<0||M>this.height)return!1;const F=[];return this._forEachCell(S,M,I,B,this._queryCellCircle,F,{hitTest:!0,overlapMode:g,circle:{x:o,y:d,radius:m},seenUids:{box:{},circle:{}}},v),F.length>0}_queryCell(o,d,m,g,v,S,I,M){const{seenUids:B,hitTest:F,overlapMode:N}=I,X=this.boxCells[v];if(X!==null){const te=this.bboxes;for(const le of X)if(!B.box[le]){B.box[le]=!0;const de=4*le,pe=this.boxKeys[le];if(o<=te[de+2]&&d<=te[de+3]&&m>=te[de+0]&&g>=te[de+1]&&(!M||M(pe))&&(!F||!Ks(N,pe.overlapMode))&&(S.push({key:pe,x1:te[de],y1:te[de+1],x2:te[de+2],y2:te[de+3]}),F))return!0}}const Q=this.circleCells[v];if(Q!==null){const te=this.circles;for(const le of Q)if(!B.circle[le]){B.circle[le]=!0;const de=3*le,pe=this.circleKeys[le];if(this._circleAndRectCollide(te[de],te[de+1],te[de+2],o,d,m,g)&&(!M||M(pe))&&(!F||!Ks(N,pe.overlapMode))){const ge=te[de],ne=te[de+1],xe=te[de+2];if(S.push({key:pe,x1:ge-xe,y1:ne-xe,x2:ge+xe,y2:ne+xe}),F)return!0}}}return!1}_queryCellCircle(o,d,m,g,v,S,I,M){const{circle:B,seenUids:F,overlapMode:N}=I,X=this.boxCells[v];if(X!==null){const te=this.bboxes;for(const le of X)if(!F.box[le]){F.box[le]=!0;const de=4*le,pe=this.boxKeys[le];if(this._circleAndRectCollide(B.x,B.y,B.radius,te[de+0],te[de+1],te[de+2],te[de+3])&&(!M||M(pe))&&!Ks(N,pe.overlapMode))return S.push(!0),!0}}const Q=this.circleCells[v];if(Q!==null){const te=this.circles;for(const le of Q)if(!F.circle[le]){F.circle[le]=!0;const de=3*le,pe=this.circleKeys[le];if(this._circlesCollide(te[de],te[de+1],te[de+2],B.x,B.y,B.radius)&&(!M||M(pe))&&!Ks(N,pe.overlapMode))return S.push(!0),!0}}}_forEachCell(o,d,m,g,v,S,I,M){const B=this._convertToXCellCoord(o),F=this._convertToYCellCoord(d),N=this._convertToXCellCoord(m),X=this._convertToYCellCoord(g);for(let Q=B;Q<=N;Q++)for(let te=F;te<=X;te++)if(v.call(this,o,d,m,g,this.xCellCount*te+Q,S,I,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,m,g,v,S){const I=g-o,M=v-d,B=m+S;return B*B>I*I+M*M}_circleAndRectCollide(o,d,m,g,v,S,I){const M=(S-g)/2,B=Math.abs(o-(g+M));if(B>M+m)return!1;const F=(I-v)/2,N=Math.abs(d-(v+F));if(N>F+m)return!1;if(B<=M||N<=F)return!0;const X=B-M,Q=N-F;return X*X+Q*Q<=m*m}}function vn(b,o,d,m,g){const v=l.H();return o?(l.K(v,v,[1/g,1/g,1]),d||l.ad(v,v,m.angle)):l.L(v,m.labelPlaneMatrix,b),v}function Fs(b,o,d,m,g){if(o){const v=l.ae(b);return l.K(v,v,[g,g,1]),d||l.ad(v,v,-m.angle),v}return m.glCoordMatrix}function ue(b,o,d,m){let g;m?(g=[b,o,m(b,o),1],l.af(g,g,d)):(g=[b,o,0,1],Zt(g,g,d));const v=g[3];return{point:new l.P(g[0]/v,g[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}function G(b,o){return .5+b/o*.5}function j(b,o){return b.x>=-o[0]&&b.x<=o[0]&&b.y>=-o[1]&&b.y<=o[1]}function Y(b,o,d,m,g,v,S,I,M,B,F,N,X,Q,te){const le=m?b.textSizeData:b.iconSizeData,de=l.ag(le,d.transform.zoom),pe=[256/d.width*2+1,256/d.height*2+1],ge=m?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;ge.clear();const ne=b.lineVertexArray,xe=m?b.text.placedSymbolArray:b.icon.placedSymbolArray,Ae=d.transform.width/d.transform.height;let ke=!1;for(let Ge=0;Ge<xe.length;Ge++){const Xe=xe.get(Ge);if(Xe.hidden||Xe.writingMode===l.ah.vertical&&!ke){St(Xe.numGlyphs,ge);continue}ke=!1;const lt=ue(Xe.anchorX,Xe.anchorY,o,te);if(!j(lt.point,pe)){St(Xe.numGlyphs,ge);continue}const pt=G(d.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),nt=l.ai(le,de,Xe),it=S?nt/pt:nt*pt,yt={getElevation:te,labelPlaneMatrix:g,lineVertexArray:ne,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:B,tileAnchorPoint:new l.P(Xe.anchorX,Xe.anchorY),unwrappedTileID:F,width:N,height:X,translation:Q},Lt=Ee(yt,Xe,it,!1,I,o,v,b.glyphOffsetArray,ge,Ae,M);ke=Lt.useVertical,(Lt.notEnoughRoom||ke||Lt.needsFlipping&&Ee(yt,Xe,it,!0,I,o,v,b.glyphOffsetArray,ge,Ae,M).notEnoughRoom)&&St(Xe.numGlyphs,ge)}m?b.text.dynamicLayoutVertexBuffer.updateData(ge):b.icon.dynamicLayoutVertexBuffer.updateData(ge)}function oe(b,o,d,m,g,v,S,I){const M=v.glyphStartIndex+v.numGlyphs,B=v.lineStartIndex,F=v.lineStartIndex+v.lineLength,N=o.getoffsetX(v.glyphStartIndex),X=o.getoffsetX(M-1),Q=Ye(b*N,d,m,g,v.segment,B,F,I,S);if(!Q)return null;const te=Ye(b*X,d,m,g,v.segment,B,F,I,S);return te?I.projectionCache.anyProjectionOccluded?null:{first:Q,last:te}:null}function ye(b,o,d,m){return b===l.ah.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*m?{useVertical:!0}:(b===l.ah.vertical?o.y<d.y:o.x>d.x)?{needsFlipping:!0}:null}function Ee(b,o,d,m,g,v,S,I,M,B,F){const N=d/24,X=o.lineOffsetX*N,Q=o.lineOffsetY*N;let te;if(o.numGlyphs>1){const le=o.glyphStartIndex+o.numGlyphs,de=o.lineStartIndex,pe=o.lineStartIndex+o.lineLength,ge=oe(N,I,X,Q,m,o,F,b);if(!ge)return{notEnoughRoom:!0};const ne=ue(ge.first.point.x,ge.first.point.y,S,b.getElevation).point,xe=ue(ge.last.point.x,ge.last.point.y,S,b.getElevation).point;if(g&&!m){const Ae=ye(o.writingMode,ne,xe,B);if(Ae)return Ae}te=[ge.first];for(let Ae=o.glyphStartIndex+1;Ae<le-1;Ae++)te.push(Ye(N*I.getoffsetX(Ae),X,Q,m,o.segment,de,pe,b,F));te.push(ge.last)}else{if(g&&!m){const de=ue(b.tileAnchorPoint.x,b.tileAnchorPoint.y,v,b.getElevation).point,pe=o.lineStartIndex+o.segment+1,ge=new l.P(b.lineVertexArray.getx(pe),b.lineVertexArray.gety(pe)),ne=ue(ge.x,ge.y,v,b.getElevation),xe=ne.signedDistanceFromCamera>0?ne.point:function(ke,Ge,Xe,lt,pt,nt){return Re(ke,Ge,Xe,1,pt,nt)}(b.tileAnchorPoint,ge,de,0,v,b),Ae=ye(o.writingMode,de,xe,B);if(Ae)return Ae}const le=Ye(N*I.getoffsetX(o.glyphStartIndex),X,Q,m,o.segment,o.lineStartIndex,o.lineStartIndex+o.lineLength,b,F);if(!le||b.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};te=[le]}for(const le of te)l.aj(M,le.point,le.angle);return{}}function Re(b,o,d,m,g,v){const S=b.add(b.sub(o)._unit()),I=g!==void 0?ue(S.x,S.y,g,v.getElevation).point:Ne(S.x,S.y,v).point,M=d.sub(I);return d.add(M._mult(m/M.mag()))}function fe(b,o,d){const m=o.projectionCache;if(m.projections[b])return m.projections[b];const g=new l.P(o.lineVertexArray.getx(b),o.lineVertexArray.gety(b)),v=Ne(g.x,g.y,o);if(v.signedDistanceFromCamera>0)return m.projections[b]=v.point,m.anyProjectionOccluded=m.anyProjectionOccluded||v.isOccluded,v.point;const S=b-d.direction;return function(I,M,B,F,N){return Re(I,M,B,F,void 0,N)}(d.distanceFromAnchor===0?o.tileAnchorPoint:new l.P(o.lineVertexArray.getx(S),o.lineVertexArray.gety(S)),g,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,o)}function Ne(b,o,d){const m=b+d.translation[0],g=o+d.translation[1];let v;return!d.pitchWithMap&&d.projection.useSpecialProjectionForSymbols?(v=d.projection.projectTileCoordinates(m,g,d.unwrappedTileID,d.getElevation),v.point.x=(.5*v.point.x+.5)*d.width,v.point.y=(.5*-v.point.y+.5)*d.height):(v=ue(m,g,d.labelPlaneMatrix,d.getElevation),v.isOccluded=!1),v}function Ve(b,o,d){return b._unit()._perp()._mult(o*d)}function De(b,o,d,m,g,v,S,I,M){if(I.projectionCache.offsets[b])return I.projectionCache.offsets[b];const B=d.add(o);if(b+M.direction<m||b+M.direction>=g)return I.projectionCache.offsets[b]=B,B;const F=fe(b+M.direction,I,M),N=Ve(F.sub(d),S,M.direction),X=d.add(N),Q=F.add(N);return I.projectionCache.offsets[b]=l.ak(v,B,X,Q)||B,I.projectionCache.offsets[b]}function Ye(b,o,d,m,g,v,S,I,M){const B=m?b-o:b+o;let F=B>0?1:-1,N=0;m&&(F*=-1,N=Math.PI),F<0&&(N+=Math.PI);let X,Q=F>0?v+g:v+g+1;I.projectionCache.cachedAnchorPoint?X=I.projectionCache.cachedAnchorPoint:(X=Ne(I.tileAnchorPoint.x,I.tileAnchorPoint.y,I).point,I.projectionCache.cachedAnchorPoint=X);let te,le,de=X,pe=X,ge=0,ne=0;const xe=Math.abs(B),Ae=[];let ke;for(;ge+ne<=xe;){if(Q+=F,Q<v||Q>=S)return null;ge+=ne,pe=de,le=te;const lt={absOffsetX:xe,direction:F,distanceFromAnchor:ge,previousVertex:pe};if(de=fe(Q,I,lt),d===0)Ae.push(pe),ke=de.sub(pe);else{let pt;const nt=de.sub(pe);pt=nt.mag()===0?Ve(fe(Q+F,I,lt).sub(de),d,F):Ve(nt,d,F),le||(le=pe.add(pt)),te=De(Q,pt,de,v,S,le,d,I,lt),Ae.push(le),ke=te.sub(le)}ne=ke.mag()}const Ge=ke._mult((xe-ge)/ne)._add(le||pe),Xe=N+Math.atan2(de.y-pe.y,de.x-pe.x);return Ae.push(Ge),{point:Ge,angle:M?Xe:0,path:Ae}}const wt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function St(b,o){for(let d=0;d<b;d++){const m=o.length;o.resize(m+4),o.float32.set(wt,3*m)}}function Zt(b,o,d){const m=o[0],g=o[1];return b[0]=d[0]*m+d[4]*g+d[12],b[1]=d[1]*m+d[5]*g+d[13],b[3]=d[3]*m+d[7]*g+d[15],b}const Ot=100;class Xt{constructor(o,d,m=new yn(o.width+200,o.height+200,25),g=new yn(o.width+200,o.height+200,25)){this.transform=o,this.mapProjection=d,this.grid=m,this.ignoredGrid=g,this.pitchFactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Ot,this.screenBottomBoundary=o.height+Ot,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,d,m,g,v,S,I,M,B,F,N){const X=o.anchorPointX+M[0],Q=o.anchorPointY+M[1],te=this.projectAndGetPerspectiveRatio(g,X,Q,v,F),le=m*te.perspectiveRatio;let de;if(S||I)de=this._projectCollisionBox(o,le,g,v,S,I,M,te,F,N);else{const Ae=te.point.x+(N?N.x*le:0),ke=te.point.y+(N?N.y*le:0);de={allPointsOccluded:!1,box:[Ae+o.x1*le,ke+o.y1*le,Ae+o.x2*le,ke+o.y2*le]}}const[pe,ge,ne,xe]=de.box;return this.mapProjection.useSpecialProjectionForSymbols&&(S?de.allPointsOccluded:this.mapProjection.isOccluded(X,Q,v))||te.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(pe,ge,ne,xe)||d!=="always"&&this.grid.hitTest(pe,ge,ne,xe,d,B)?{box:[pe,ge,ne,xe],placeable:!1,offscreen:!1}:{box:[pe,ge,ne,xe],placeable:!0,offscreen:this.isOffscreen(pe,ge,ne,xe)}}placeCollisionCircles(o,d,m,g,v,S,I,M,B,F,N,X,Q,te,le,de){const pe=[],ge=new l.P(d.anchorX,d.anchorY),ne=this.getPerspectiveRatio(S,ge.x,ge.y,I,de),xe=(N?v/ne:v*ne)/l.ap,Ae={getElevation:de,labelPlaneMatrix:M,lineVertexArray:m,pitchWithMap:N,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ge,unwrappedTileID:I,width:this.transform.width,height:this.transform.height,translation:le},ke=oe(xe,g,d.lineOffsetX*xe,d.lineOffsetY*xe,!1,d,!1,Ae);let Ge=!1,Xe=!1,lt=!0;if(ke){const pt=.5*Q*ne+te,nt=new l.P(-100,-100),it=new l.P(this.screenRightBoundary,this.screenBottomBoundary),yt=new Pt,Lt=ke.first,ot=ke.last;let ut=[];for(let Ut=Lt.path.length-1;Ut>=1;Ut--)ut.push(Lt.path[Ut]);for(let Ut=1;Ut<ot.path.length;Ut++)ut.push(ot.path[Ut]);const kt=2.5*pt;if(B){const Ut=this.projectPathToScreenSpace(ut,Ae,B);ut=Ut.some(Wt=>Wt.signedDistanceFromCamera<=0)?[]:Ut.map(Wt=>Wt.point)}let Mi=[];if(ut.length>0){const Ut=ut[0].clone(),Wt=ut[0].clone();for(let Pi=1;Pi<ut.length;Pi++)Ut.x=Math.min(Ut.x,ut[Pi].x),Ut.y=Math.min(Ut.y,ut[Pi].y),Wt.x=Math.max(Wt.x,ut[Pi].x),Wt.y=Math.max(Wt.y,ut[Pi].y);Mi=Ut.x>=nt.x&&Wt.x<=it.x&&Ut.y>=nt.y&&Wt.y<=it.y?[ut]:Wt.x<nt.x||Ut.x>it.x||Wt.y<nt.y||Ut.y>it.y?[]:l.al([ut],nt.x,nt.y,it.x,it.y)}for(const Ut of Mi){yt.reset(Ut,.25*pt);let Wt=0;Wt=yt.length<=.5*pt?1:Math.ceil(yt.paddedLength/kt)+1;for(let Pi=0;Pi<Wt;Pi++){const Vr=Pi/Math.max(Wt-1,1),xn=yt.lerp(Vr),ki=xn.x+Ot,vs=xn.y+Ot;pe.push(ki,vs,pt,0);const os=ki-pt,$r=vs-pt,as=ki+pt,Zn=vs+pt;if(lt=lt&&this.isOffscreen(os,$r,as,Zn),Xe=Xe||this.isInsideGrid(os,$r,as,Zn),o!=="always"&&this.grid.hitTestCircle(ki,vs,pt,o,X)&&(Ge=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Ge}}}}return{circles:!F&&Ge||!Xe||ne<this.perspectiveRatioCutoff?[]:pe,offscreen:lt,collisionDetected:Ge}}projectPathToScreenSpace(o,d,m){return o.map(g=>ue(g.x,g.y,m,d.getElevation))}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let m=1/0,g=1/0,v=-1/0,S=-1/0;for(const F of o){const N=new l.P(F.x+Ot,F.y+Ot);m=Math.min(m,N.x),g=Math.min(g,N.y),v=Math.max(v,N.x),S=Math.max(S,N.y),d.push(N)}const I=this.grid.query(m,g,v,S).concat(this.ignoredGrid.query(m,g,v,S)),M={},B={};for(const F of I){const N=F.key;if(M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]={}),M[N.bucketInstanceId][N.featureIndex])continue;const X=[new l.P(F.x1,F.y1),new l.P(F.x2,F.y1),new l.P(F.x2,F.y2),new l.P(F.x1,F.y2)];l.am(d,X)&&(M[N.bucketInstanceId][N.featureIndex]=!0,B[N.bucketInstanceId]===void 0&&(B[N.bucketInstanceId]=[]),B[N.bucketInstanceId].push(N.featureIndex))}return B}insertCollisionBox(o,d,m,g,v,S){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:S,overlapMode:d},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,m,g,v,S){const I=m?this.ignoredGrid:this.grid,M={bucketInstanceId:g,featureIndex:v,collisionGroupID:S,overlapMode:d};for(let B=0;B<o.length;B+=4)I.insertCircle(M,o[B],o[B+1],o[B+2])}projectAndGetPerspectiveRatio(o,d,m,g,v){let S;v?(S=[d,m,v(d,m),1],l.af(S,S,o)):(S=[d,m,0,1],Zt(S,S,o));const I=S[3];return{point:new l.P((S[0]/I+1)/2*this.transform.width+Ot,(-S[1]/I+1)/2*this.transform.height+Ot),perspectiveRatio:.5+this.transform.cameraToCenterDistance/I*.5,isOccluded:!1,signedDistanceFromCamera:I}}getPerspectiveRatio(o,d,m,g,v){const S=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(d,m,g,v):ue(d,m,o,v);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(o,d,m,g){return m<Ot||o>=this.screenRightBoundary||g<Ot||d>this.screenBottomBoundary}isInsideGrid(o,d,m,g){return m>=0&&o<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=l.an([]);return l.J(o,o,[-100,-100,0]),o}_projectCollisionBox(o,d,m,g,v,S,I,M,B,F){let N=new l.P(1,0),X=new l.P(0,1);const Q=new l.P(o.anchorPointX+I[0],o.anchorPointY+I[1]);if(S&&!v){const lt=this.projectAndGetPerspectiveRatio(m,Q.x+1,Q.y,g,B).point.sub(M.point).unit(),pt=Math.atan(lt.y/lt.x)+(lt.x<0?Math.PI:0),nt=Math.sin(pt),it=Math.cos(pt);N=new l.P(it,nt),X=new l.P(-nt,it)}else if(!S&&v){const lt=-this.transform.angle,pt=Math.sin(lt),nt=Math.cos(lt);N=new l.P(nt,pt),X=new l.P(-pt,nt)}let te=M.point,le=d;if(v){te=Q;const lt=this.transform.zoom-Math.floor(this.transform.zoom);le=Math.pow(2,-lt),le*=this.mapProjection.getPitchedTextCorrection(this.transform,Q,g),F||(le*=l.ac(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}F&&(te=te.add(N.mult(F.x*le)).add(X.mult(F.y*le)));const de=o.x1*le,pe=o.x2*le,ge=(de+pe)/2,ne=o.y1*le,xe=o.y2*le,Ae=(ne+xe)/2,ke=[{offsetX:de,offsetY:ne},{offsetX:ge,offsetY:ne},{offsetX:pe,offsetY:ne},{offsetX:pe,offsetY:Ae},{offsetX:pe,offsetY:xe},{offsetX:ge,offsetY:xe},{offsetX:de,offsetY:xe},{offsetX:de,offsetY:Ae}];let Ge=[];for(const{offsetX:lt,offsetY:pt}of ke)Ge.push(new l.P(te.x+N.x*lt+X.x*pt,te.y+N.y*lt+X.y*pt));let Xe=!1;if(v){const lt=Ge.map(pt=>this.projectAndGetPerspectiveRatio(m,pt.x,pt.y,g,B));Xe=lt.some(pt=>!pt.isOccluded),Ge=lt.map(pt=>pt.point)}else Xe=!0;return{box:l.ao(Ge),allPointsOccluded:!Xe}}}function jt(b,o,d){return o*(l.X/(b.tileSize*Math.pow(2,d-b.tileID.overscaledZ)))}class Vi{constructor(o,d,m,g){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):g&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Ai{constructor(o,d,m,g,v){this.text=new Vi(o?o.text:null,d,m,v),this.icon=new Vi(o?o.icon:null,d,g,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Dt{constructor(o,d,m){this.text=o,this.icon=d,this.skipFade=m}}class Qt{constructor(){this.invProjMatrix=l.H(),this.viewportMatrix=l.H(),this.circles=[]}}class hi{constructor(o,d,m,g,v){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=m,this.bucketIndex=g,this.tileID=v}}class $i{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:m=>m.collisionGroupID===d}}return this.collisionGroups[o]}}function sr(b,o,d,m,g){const{horizontalAlign:v,verticalAlign:S}=l.au(b);return new l.P(-(v-.5)*o+m[0]*g,-(S-.5)*d+m[1]*g)}class Ir{constructor(o,d,m,g,v,S){this.transform=o.clone(),this.terrain=m,this.collisionIndex=new Xt(this.transform,d),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new $i(v),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const d=this.terrain;return d?(m,g)=>d.getElevation(o,m,g):null}getBucketParts(o,d,m,g){const v=m.getBucket(d),S=m.latestFeatureIndex;if(!v||!S||d.id!==v.layerIds[0])return;const I=m.collisionBoxArray,M=v.layers[0].layout,B=v.layers[0].paint,F=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),N=m.tileSize/l.X,X=m.tileID.toUnwrapped(),Q=this.transform.calculatePosMatrix(X),te=M.get("text-pitch-alignment")==="map",le=M.get("text-rotation-alignment")==="map",de=jt(m,1,this.transform.zoom),pe=this.collisionIndex.mapProjection.translatePosition(this.transform,m,B.get("text-translate"),B.get("text-translate-anchor")),ge=this.collisionIndex.mapProjection.translatePosition(this.transform,m,B.get("icon-translate"),B.get("icon-translate-anchor")),ne=vn(Q,te,le,this.transform,de);let xe=null;if(te){const ke=Fs(Q,te,le,this.transform,de);xe=l.L([],this.transform.labelPlaneMatrix,ke)}this.retainedQueryData[v.bucketInstanceId]=new hi(v.bucketInstanceId,S,v.sourceLayerIndex,v.index,m.tileID);const Ae={bucket:v,layout:M,translationText:pe,translationIcon:ge,posMatrix:Q,unwrappedTileID:X,textLabelPlaneMatrix:ne,labelToScreenMatrix:xe,scale:F,textPixelRatio:N,holdingForFade:m.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:l.ag(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(const ke of v.sortKeyRanges){const{sortKey:Ge,symbolInstanceStart:Xe,symbolInstanceEnd:lt}=ke;o.push({sortKey:Ge,symbolInstanceStart:Xe,symbolInstanceEnd:lt,parameters:Ae})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(o,d,m,g,v,S,I,M,B,F,N,X,Q,te,le,de,pe,ge,ne){const xe=l.aq[o.textAnchor],Ae=[o.textOffset0,o.textOffset1],ke=sr(xe,m,g,Ae,v),Ge=this.collisionIndex.placeCollisionBox(d,X,M,B,F,I,S,de,N.predicate,ne,ke);if((!ge||this.collisionIndex.placeCollisionBox(ge,X,M,B,F,I,S,pe,N.predicate,ne,ke).placeable)&&Ge.placeable){let Xe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID].text&&(Xe=this.prevPlacement.variableOffsets[Q.crossTileID].anchor),Q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Q.crossTileID]={textOffset:Ae,width:m,height:g,anchor:xe,textBoxScale:v,prevAnchor:Xe},this.markUsedJustification(te,xe,Q,le),te.allowVerticalPlacement&&(this.markUsedOrientation(te,le,Q),this.placedOrientations[Q.crossTileID]=le),{shift:ke,placedGlyphBoxes:Ge}}}placeLayerBucketPart(o,d,m){const{bucket:g,layout:v,translationText:S,translationIcon:I,posMatrix:M,unwrappedTileID:B,textLabelPlaneMatrix:F,labelToScreenMatrix:N,textPixelRatio:X,holdingForFade:Q,collisionBoxArray:te,partiallyEvaluatedTextSize:le,collisionGroup:de}=o.parameters,pe=v.get("text-optional"),ge=v.get("icon-optional"),ne=l.ar(v,"text-overlap","text-allow-overlap"),xe=ne==="always",Ae=l.ar(v,"icon-overlap","icon-allow-overlap"),ke=Ae==="always",Ge=v.get("text-rotation-alignment")==="map",Xe=v.get("text-pitch-alignment")==="map",lt=v.get("icon-text-fit")!=="none",pt=v.get("symbol-z-order")==="viewport-y",nt=xe&&(ke||!g.hasIconData()||ge),it=ke&&(xe||!g.hasTextData()||pe);!g.collisionArrays&&te&&g.deserializeCollisionBoxes(te);const yt=this._getTerrainElevationFunc(this.retainedQueryData[g.bucketInstanceId].tileID),Lt=(ot,ut,kt)=>{var Mi,Ut;if(d[ot.crossTileID])return;if(Q)return void(this.placements[ot.crossTileID]=new Dt(!1,!1,!1));let Wt=!1,Pi=!1,Vr=!0,xn=null,ki={box:null,placeable:!1,offscreen:null},vs={box:null,placeable:!1,offscreen:null},os=null,$r=null,as=null,Zn=0,wl=0,oh=0;ut.textFeatureIndex?Zn=ut.textFeatureIndex:ot.useRuntimeCollisionCircles&&(Zn=ot.featureIndex),ut.verticalTextFeatureIndex&&(wl=ut.verticalTextFeatureIndex);const xl=ut.textBox;if(xl){const tn=Mr=>{let Hr=l.ah.horizontal;if(g.allowVerticalPlacement&&!Mr&&this.prevPlacement){const zs=this.prevPlacement.placedOrientations[ot.crossTileID];zs&&(this.placedOrientations[ot.crossTileID]=zs,Hr=zs,this.markUsedOrientation(g,Hr,ot))}return Hr},rn=(Mr,Hr)=>{if(g.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const zs of g.writingModes)if(zs===l.ah.vertical?(ki=Hr(),vs=ki):ki=Mr(),ki&&ki.placeable)break}else ki=Mr()},Wo=ot.textAnchorOffsetStartIndex,En=ot.textAnchorOffsetEndIndex;if(En===Wo){const Mr=(Hr,zs)=>{const Jt=this.collisionIndex.placeCollisionBox(Hr,ne,X,M,B,Xe,Ge,S,de.predicate,yt);return Jt&&Jt.placeable&&(this.markUsedOrientation(g,zs,ot),this.placedOrientations[ot.crossTileID]=zs),Jt};rn(()=>Mr(xl,l.ah.horizontal),()=>{const Hr=ut.verticalTextBox;return g.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&Hr?Mr(Hr,l.ah.vertical):{box:null,offscreen:null}}),tn(ki&&ki.placeable)}else{let Mr=l.aq[(Ut=(Mi=this.prevPlacement)===null||Mi===void 0?void 0:Mi.variableOffsets[ot.crossTileID])===null||Ut===void 0?void 0:Ut.anchor];const Hr=(Jt,Ia,El)=>{const Al=Jt.x2-Jt.x1,vg=Jt.y2-Jt.y1,my=ot.textBoxScale,bg=lt&&Ae==="never"?Ia:null;let Xo=null,wg=ne==="never"?1:2,lh="never";Mr&&wg++;for(let Uc=0;Uc<wg;Uc++){for(let ch=Wo;ch<En;ch++){const uh=g.textAnchorOffsets.get(ch);if(Mr&&uh.textAnchor!==Mr)continue;const Tl=this.attemptAnchorPlacement(uh,Jt,Al,vg,my,Ge,Xe,X,M,B,de,lh,ot,g,El,S,I,bg,yt);if(Tl&&(Xo=Tl.placedGlyphBoxes,Xo&&Xo.placeable))return Wt=!0,xn=Tl.shift,Xo}Mr?Mr=null:lh=ne}return m&&!Xo&&(Xo={box:this.collisionIndex.placeCollisionBox(xl,"always",X,M,B,Xe,Ge,S,de.predicate,yt,new l.P(0,0)).box,offscreen:!1,placeable:!1}),Xo};rn(()=>Hr(xl,ut.iconBox,l.ah.horizontal),()=>{const Jt=ut.verticalTextBox;return g.allowVerticalPlacement&&(!ki||!ki.placeable)&&ot.numVerticalGlyphVertices>0&&Jt?Hr(Jt,ut.verticalIconBox,l.ah.vertical):{box:null,occluded:!0,offscreen:null}}),ki&&(Wt=ki.placeable,Vr=ki.offscreen);const zs=tn(ki&&ki.placeable);if(!Wt&&this.prevPlacement){const Jt=this.prevPlacement.variableOffsets[ot.crossTileID];Jt&&(this.variableOffsets[ot.crossTileID]=Jt,this.markUsedJustification(g,Jt.anchor,ot,zs))}}}if(os=ki,Wt=os&&os.placeable,Vr=os&&os.offscreen,ot.useRuntimeCollisionCircles){const tn=g.text.placedSymbolArray.get(ot.centerJustifiedTextSymbolIndex),rn=l.ai(g.textSizeData,le,tn),Wo=v.get("text-padding");$r=this.collisionIndex.placeCollisionCircles(ne,tn,g.lineVertexArray,g.glyphOffsetArray,rn,M,B,F,N,m,Xe,de.predicate,ot.collisionCircleDiameter,Wo,S,yt),$r.circles.length&&$r.collisionDetected&&!m&&l.w("Collisions detected, but collision boxes are not shown"),Wt=xe||$r.circles.length>0&&!$r.collisionDetected,Vr=Vr&&$r.offscreen}if(ut.iconFeatureIndex&&(oh=ut.iconFeatureIndex),ut.iconBox){const tn=rn=>this.collisionIndex.placeCollisionBox(rn,Ae,X,M,B,Xe,Ge,I,de.predicate,yt,lt&&xn?xn:void 0);vs&&vs.placeable&&ut.verticalIconBox?(as=tn(ut.verticalIconBox),Pi=as.placeable):(as=tn(ut.iconBox),Pi=as.placeable),Vr=Vr&&as.offscreen}const en=pe||ot.numHorizontalGlyphVertices===0&&ot.numVerticalGlyphVertices===0,ah=ge||ot.numIconVertices===0;en||ah?ah?en||(Pi=Pi&&Wt):Wt=Pi&&Wt:Pi=Wt=Pi&&Wt;const Pp=Pi&&as.placeable;if(Wt&&os.placeable&&this.collisionIndex.insertCollisionBox(os.box,ne,v.get("text-ignore-placement"),g.bucketInstanceId,vs&&vs.placeable&&wl?wl:Zn,de.ID),Pp&&this.collisionIndex.insertCollisionBox(as.box,Ae,v.get("icon-ignore-placement"),g.bucketInstanceId,oh,de.ID),$r&&Wt&&this.collisionIndex.insertCollisionCircles($r.circles,ne,v.get("text-ignore-placement"),g.bucketInstanceId,Zn,de.ID),m&&this.storeCollisionData(g.bucketInstanceId,kt,ut,os,as,$r),ot.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ot.crossTileID]=new Dt(Wt||nt,Pi||it,Vr||g.justReloaded),d[ot.crossTileID]=!0};if(pt){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ot=g.getSortedSymbolIndexes(this.transform.angle);for(let ut=ot.length-1;ut>=0;--ut){const kt=ot[ut];Lt(g.symbolInstances.get(kt),g.collisionArrays[kt],kt)}}else for(let ot=o.symbolInstanceStart;ot<o.symbolInstanceEnd;ot++)Lt(g.symbolInstances.get(ot),g.collisionArrays[ot],ot);if(m&&g.bucketInstanceId in this.collisionCircleArrays){const ot=this.collisionCircleArrays[g.bucketInstanceId];l.as(ot.invProjMatrix,M),ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}storeCollisionData(o,d,m,g,v,S){if(m.textBox||m.iconBox){let I,M;this.collisionBoxArrays.has(o)?I=this.collisionBoxArrays.get(o):(I=new Map,this.collisionBoxArrays.set(o,I)),I.has(d)?M=I.get(d):(M={text:null,icon:null},I.set(d,M)),m.textBox&&(M.text=g.box),m.iconBox&&(M.icon=v.box)}if(S){let I=this.collisionCircleArrays[o];I===void 0&&(I=this.collisionCircleArrays[o]=new Qt);for(let M=0;M<S.circles.length;M+=4)I.circles.push(S.circles[M+0]),I.circles.push(S.circles[M+1]),I.circles.push(S.circles[M+2]),I.circles.push(S.collisionDetected?1:0)}}markUsedJustification(o,d,m,g){let v;v=g===l.ah.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[l.at(d)];const S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const I of S)I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=v>=0&&I!==v?0:m.crossTileID)}markUsedOrientation(o,d,m){const g=d===l.ah.horizontal||d===l.ah.horizontalOnly?d:0,v=d===l.ah.vertical?d:0,S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const I of S)o.text.placedSymbolArray.get(I).placedOrientation=g;m.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let m=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const g=d?d.symbolFadeChange(o):1,v=d?d.opacities:{},S=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const M in this.placements){const B=this.placements[M],F=v[M];F?(this.opacities[M]=new Ai(F,g,B.text,B.icon),m=m||B.text!==F.text.placed||B.icon!==F.icon.placed):(this.opacities[M]=new Ai(null,g,B.text,B.icon,B.skipFade),m=m||B.text||B.icon)}for(const M in v){const B=v[M];if(!this.opacities[M]){const F=new Ai(B,g,!1,!1);F.isHidden()||(this.opacities[M]=F,m=m||B.text.placed||B.icon.placed)}}for(const M in S)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=S[M]);for(const M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const m={};for(const g of d){const v=g.getBucket(o);v&&g.latestFeatureIndex&&o.id===v.layerIds[0]&&this.updateBucketOpacities(v,g.tileID,m,g.collisionBoxArray)}}updateBucketOpacities(o,d,m,g){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const v=o.layers[0],S=v.layout,I=new Ai(null,0,!1,!1,!0),M=S.get("text-allow-overlap"),B=S.get("icon-allow-overlap"),F=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=S.get("text-rotation-alignment")==="map",X=S.get("text-pitch-alignment")==="map",Q=S.get("icon-text-fit")!=="none",te=new Ai(null,0,M&&(B||!o.hasIconData()||S.get("icon-optional")),B&&(M||!o.hasTextData()||S.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);const le=(pe,ge,ne)=>{for(let xe=0;xe<ge/4;xe++)pe.opacityVertexArray.emplaceBack(ne);pe.hasVisibleVertices=pe.hasVisibleVertices||ne!==fo},de=this.collisionBoxArrays.get(o.bucketInstanceId);for(let pe=0;pe<o.symbolInstances.length;pe++){const ge=o.symbolInstances.get(pe),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:xe,crossTileID:Ae}=ge;let ke=this.opacities[Ae];m[Ae]?ke=I:ke||(ke=te,this.opacities[Ae]=ke),m[Ae]=!0;const Ge=ge.numIconVertices>0,Xe=this.placedOrientations[ge.crossTileID],lt=Xe===l.ah.vertical,pt=Xe===l.ah.horizontal||Xe===l.ah.horizontalOnly;if(ne>0||xe>0){const it=Wi(ke.text);le(o.text,ne,lt?fo:it),le(o.text,xe,pt?fo:it);const yt=ke.text.isHidden();[ge.rightJustifiedTextSymbolIndex,ge.centerJustifiedTextSymbolIndex,ge.leftJustifiedTextSymbolIndex].forEach(ut=>{ut>=0&&(o.text.placedSymbolArray.get(ut).hidden=yt||lt?1:0)}),ge.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ge.verticalPlacedTextSymbolIndex).hidden=yt||pt?1:0);const Lt=this.variableOffsets[ge.crossTileID];Lt&&this.markUsedJustification(o,Lt.anchor,ge,Xe);const ot=this.placedOrientations[ge.crossTileID];ot&&(this.markUsedJustification(o,"left",ge,ot),this.markUsedOrientation(o,ot,ge))}if(Ge){const it=Wi(ke.icon),yt=!(Q&&ge.verticalPlacedIconSymbolIndex&&lt);ge.placedIconSymbolIndex>=0&&(le(o.icon,ge.numIconVertices,yt?it:fo),o.icon.placedSymbolArray.get(ge.placedIconSymbolIndex).hidden=ke.icon.isHidden()),ge.verticalPlacedIconSymbolIndex>=0&&(le(o.icon,ge.numVerticalIconVertices,yt?fo:it),o.icon.placedSymbolArray.get(ge.verticalPlacedIconSymbolIndex).hidden=ke.icon.isHidden())}const nt=de&&de.has(pe)?de.get(pe):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const it=o.collisionArrays[pe];if(it){let yt=new l.P(0,0);if(it.textBox||it.verticalTextBox){let Lt=!0;if(F){const ot=this.variableOffsets[Ae];ot?(yt=sr(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale),N&&yt._rotate(X?this.transform.angle:-this.transform.angle)):Lt=!1}if(it.textBox||it.verticalTextBox){let ot;it.textBox&&(ot=lt),it.verticalTextBox&&(ot=pt),$o(o.textCollisionBox.collisionVertexArray,ke.text.placed,!Lt||ot,nt.text,yt.x,yt.y)}}if(it.iconBox||it.verticalIconBox){const Lt=!!(!pt&&it.verticalIconBox);let ot;it.iconBox&&(ot=Lt),it.verticalIconBox&&(ot=!Lt),$o(o.iconCollisionBox.collisionVertexArray,ke.icon.placed,ot,nt.icon,Q?yt.x:0,Q?yt.y:0)}}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=pe.invProjMatrix,o.placementViewportMatrix=pe.viewportMatrix,o.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const m=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*m>o}setStale(){this.stale=!0}}function $o(b,o,d,m,g,v){m&&m.length!==0||(m=[0,0,0,0]);const S=m[0]-Ot,I=m[1]-Ot,M=m[2]-Ot,B=m[3]-Ot;b.emplaceBack(o?1:0,d?1:0,g||0,v||0,S,I),b.emplaceBack(o?1:0,d?1:0,g||0,v||0,M,I),b.emplaceBack(o?1:0,d?1:0,g||0,v||0,M,B),b.emplaceBack(o?1:0,d?1:0,g||0,v||0,S,B)}const ti=Math.pow(2,25),Ur=Math.pow(2,24),$n=Math.pow(2,17),Yi=Math.pow(2,16),Hi=Math.pow(2,9),_a=Math.pow(2,8),qi=Math.pow(2,1);function Wi(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const o=b.placed?1:0,d=Math.floor(127*b.opacity);return d*ti+o*Ur+d*$n+o*Yi+d*Hi+o*_a+d*qi+o}const fo=0;function Hn(){return{isOccluded:(b,o,d)=>!1,getPitchedTextCorrection:(b,o,d)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(b,o,d,m){throw new Error("Not implemented.")},translatePosition:(b,o,d,m)=>function(g,v,S,I,M=!1){if(!S[0]&&!S[1])return[0,0];const B=M?I==="map"?g.angle:0:I==="viewport"?-g.angle:0;if(B){const F=Math.sin(B),N=Math.cos(B);S=[S[0]*N-S[1]*F,S[0]*F+S[1]*N]}return[M?S[0]:jt(v,S[0],g.zoom),M?S[1]:jt(v,S[1],g.zoom)]}(b,o,d,m),getCircleRadiusCorrection:b=>1}}class Di{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,m,g,v){const S=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(S,g,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((I,M)=>I.sortKey-M.sortKey));this._currentPartIndex<S.length;)if(d.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,v())return!0;return!1}}class Rr{constructor(o,d,m,g,v,S,I,M){this.placement=new Ir(o,Hn(),d,S,I,M),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,d,m){const g=T.now(),v=()=>!this._forceFullPlacement&&T.now()-g>2;for(;this._currentPlacementIndex>=0;){const S=d[o[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=I)&&(!S.maxzoom||S.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Di(S)),this._inProgressLayer.continuePlacement(m[S.source],this.placement,this._showCollisionBoxes,S,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const zr=512/l.X/2;class Fi{constructor(o,d,m){this.tileID=o,this.bucketInstanceId=m,this._symbolsByKey={};const g=new Map;for(let v=0;v<d.length;v++){const S=d.get(v),I=S.key,M=g.get(I);M?M.push(S):g.set(I,[S])}for(const[v,S]of g){const I={positions:S.map(M=>({x:Math.floor(M.anchorX*zr),y:Math.floor(M.anchorY*zr)})),crossTileIDs:S.map(M=>M.crossTileID)};if(I.positions.length>128){const M=new l.av(I.positions.length,16,Uint16Array);for(const{x:B,y:F}of I.positions)M.add(B,F);M.finish(),delete I.positions,I.index=M}this._symbolsByKey[v]=I}}getScaledCoordinates(o,d){const{x:m,y:g,z:v}=this.tileID.canonical,{x:S,y:I,z:M}=d.canonical,B=zr/Math.pow(2,M-v),F=(I*l.X+o.anchorY)*B,N=g*l.X*zr;return{x:Math.floor((S*l.X+o.anchorX)*B-m*l.X*zr),y:Math.floor(F-N)}}findMatches(o,d,m){const g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let v=0;v<o.length;v++){const S=o.get(v);if(S.crossTileID)continue;const I=this._symbolsByKey[S.key];if(!I)continue;const M=this.getScaledCoordinates(S,d);if(I.index){const B=I.index.range(M.x-g,M.y-g,M.x+g,M.y+g).sort();for(const F of B){const N=I.crossTileIDs[F];if(!m[N]){m[N]=!0,S.crossTileID=N;break}}}else if(I.positions)for(let B=0;B<I.positions.length;B++){const F=I.positions[B],N=I.crossTileIDs[B];if(Math.abs(F.x-M.x)<=g&&Math.abs(F.y-M.y)<=g&&!m[N]){m[N]=!0,S.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Ho{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ss{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const m in this.indexes){const g=this.indexes[m],v={};for(const S in g){const I=g[S];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),v[I.tileID.key]=I}this.indexes[m]=v}this.lng=o}addBucket(o,d,m){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let v=0;v<d.symbolInstances.length;v++)d.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const g=this.usedCrossTileIDs[o.overscaledZ];for(const v in this.indexes){const S=this.indexes[v];if(Number(v)>o.overscaledZ)for(const I in S){const M=S[I];M.tileID.isChildOf(o)&&M.findMatches(d.symbolInstances,o,g)}else{const I=S[o.scaledTo(Number(v)).key];I&&I.findMatches(d.symbolInstances,o,g)}}for(let v=0;v<d.symbolInstances.length;v++){const S=d.symbolInstances.get(v);S.crossTileID||(S.crossTileID=m.generate(),g[S.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Fi(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const m of d.getCrossTileIDsLists())for(const g of m)delete this.usedCrossTileIDs[o][g]}removeStaleBuckets(o){let d=!1;for(const m in this.indexes){const g=this.indexes[m];for(const v in g)o[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,g[v]),delete g[v],d=!0)}return d}}class ya{constructor(){this.layerIndexes={},this.crossTileIDs=new Ho,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,m){let g=this.layerIndexes[o.id];g===void 0&&(g=this.layerIndexes[o.id]=new ss);let v=!1;const S={};g.handleWrapJump(m);for(const I of d){const M=I.getBucket(o);M&&o.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(I.tileID,M,this.crossTileIDs)&&(v=!0),S[M.bucketInstanceId]=!0)}return g.removeStaleBuckets(S)&&(v=!0),v}pruneUnusedLayers(o){const d={};o.forEach(m=>{d[m]=!0});for(const m in this.layerIndexes)d[m]||delete this.layerIndexes[m]}}const jr=(b,o)=>l.t(b,o&&o.filter(d=>d.identifier!=="source.canvas")),qn=l.aw();class il extends l.E{constructor(o,d={}){super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const g=this.sourceCaches[m].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[m].reload()}},this.map=o,this.dispatcher=new Zi(wi(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(m,g)=>this.getGlyphs(m,g)),this.dispatcher.registerMessageHandler("GI",(m,g)=>this.getImages(m,g)),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new Gt(o._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Ls(256,512),this.crossTileSymbolIndex=new ya,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ay()),rs().on(Je,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.sourceCaches[m.sourceId];if(!g)return;const v=g.getSource();if(v&&v.vectorLayerIds)for(const S in this._layers){const I=this._layers[S];I.source===v.id&&this._validateLayer(I)}})}loadURL(o,d={},m){this.fire(new l.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const g=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const v=this._loadStyleRequest;l.h(g,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,d,m)}).catch(S=>{this._loadStyleRequest=null,S&&!v.signal.aborted&&this.fire(new l.j(S))})}loadJSON(o,d={},m){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(o,d,m)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(qn,{validate:!1})}_load(o,d,m){var g;const v=d.transformStyle?d.transformStyle(m,o):o;if(!d.validate||!jr(this,l.u(v))){this._loaded=!0,this.stylesheet=v;for(const S in v.sources)this.addSource(S,v.sources[S],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new Tt(this.stylesheet.light),this.sky=new $t(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const o=l.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of o){const m=l.aA(d);m.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=m}}_loadSprite(o,d=!1,m=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,S,I,M){return l._(this,void 0,void 0,function*(){const B=Te(v),F=I>1?"@2x":"",N={},X={};for(const{id:Q,url:te}of B){const le=S.transformRequest(Pe(te,F,".json"),"SpriteJSON");N[Q]=l.h(le,M);const de=S.transformRequest(Pe(te,F,".png"),"SpriteImage");X[Q]=q.getImage(de,M)}return yield Promise.all([...Object.values(N),...Object.values(X)]),function(Q,te){return l._(this,void 0,void 0,function*(){const le={};for(const de in Q){le[de]={};const pe=T.getImageCanvasContext((yield te[de]).data),ge=(yield Q[de]).data;for(const ne in ge){const{width:xe,height:Ae,x:ke,y:Ge,sdf:Xe,pixelRatio:lt,stretchX:pt,stretchY:nt,content:it,textFitWidth:yt,textFitHeight:Lt}=ge[ne];le[de][ne]={data:null,pixelRatio:lt,sdf:Xe,stretchX:pt,stretchY:nt,content:it,textFitWidth:yt,textFitHeight:Lt,spriteData:{width:xe,height:Ae,x:ke,y:Ge,context:pe}}}}return le})}(N,X)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const S in v){this._spritesImagesIds[S]=[];const I=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(M=>!(M in v)):[];for(const M of I)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in v[S]){const B=S==="default"?M:`${S}:${M}`;this._spritesImagesIds[S].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,v[S][M],!1):this.imageManager.addImage(B,v[S][M]),d&&(this._changedImages[B]=!0)}}}).catch(v=>{this._spriteRequest=null,g=v,this.fire(new l.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),m&&m(g)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(o){const d=this.sourceCaches[o.source];if(!d)return;const m=o.sourceLayer;if(!m)return;const g=d.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(m)===-1)&&this.fire(new l.j(new Error(`Source layer "${m}" does not exist on source "${g.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,d=!1){const m=this._serializedAllLayers();if(!o||o.length===0)return Object.values(d?l.aB(m):m);const g=[];for(const v of o)if(m[v]){const S=d?l.aB(m[v]):m[v];g.push(S)}return g}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const d=Object.keys(this._layers);for(const m of d){const g=this._layers[m];g.type!=="custom"&&(o[m]=g.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const d=this._changed;if(d){const g=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(g.length||v.length)&&this._updateWorkerLayers(g,v);for(const S in this._updatedSources){const I=this._updatedSources[S];if(I==="reload")this._reloadSource(S);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const m={};for(const g in this.sourceCaches){const v=this.sourceCaches[g];m[g]=v.used,v.used=!1}for(const g of this._order){const v=this._layers[g];v.recalculate(o,this._availableImages),!v.isHidden(o.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const g in m){const v=this.sourceCaches[g];!!m[g]!=!!v.used&&v.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(o),this.sky.recalculate(o),this.z=o.zoom,d&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,d={}){var m;this._checkLoaded();const g=this.serialize();if(o=d.transformStyle?d.transformStyle(g,o):o,((m=d.validate)===null||m===void 0||m)&&jr(this,l.u(o)))return!1;(o=l.aB(o)).layers=l.az(o.layers);const v=l.aC(g,o),S=this._getOperationsToPerform(v);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const I of S.operations)I();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const d=[],m=[];for(const g of o)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":d.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":d.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,g.args));break;case"setSky":d.push(()=>this.setSky.apply(this,g.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":d.push(()=>{});break;default:m.push(g.command)}return{operations:d,unimplemented:m}}addImage(o,d){if(this.getImage(o))return this.fire(new l.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,d),this._afterImageUpdated(o)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new l.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,d,m={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.u.source,`sources.${o}`,d,null,m))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const g=this.sourceCaches[o]=new Mt(o,d,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:o})),g.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===o)return this.fire(new l.j(new Error(`Source "${o}" cannot be removed while layer "${m}" is using it.`)));const d=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],d.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,d){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const m=this.sourceCaches[o].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(d),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,d,m={}){this._checkLoaded();const g=o.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let v;if(o.type==="custom"){if(jr(this,l.aD(o)))return;v=l.aA(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(g,o.source),o=l.aB(o),o=l.e(o,{source:g})),this._validate(l.u.layer,`layers.${g}`,o,{arrayIndex:-1},m))return;v=l.aA(o),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}})}const S=d?this._order.indexOf(d):this._order.length;if(d&&S===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${d}".`)));else{if(this._order.splice(S,0,g),this._layerOrderChanged=!0,this._layers[g]=v,this._removedLayers[g]&&v.source&&v.type!=="custom"){const I=this._removedLayers[g];delete this._removedLayers[g],I.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new l.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const m=this._order.indexOf(o);this._order.splice(m,1);const g=d?this._order.indexOf(d):this._order.length;d&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${o}" before non-existing layer "${d}".`))):(this._order.splice(g,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${o}".`)));d.setEventedParent(null);const m=this._order.indexOf(o);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,d,m){this._checkLoaded();const g=this.getLayer(o);g?g.minzoom===d&&g.maxzoom===m||(d!=null&&(g.minzoom=d),m!=null&&(g.maxzoom=m),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,d,m={}){this._checkLoaded();const g=this.getLayer(o);if(g){if(!l.aE(g.filter,d))return d==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.u.filter,`layers.${g.id}.filter`,d,null,m)||(g.filter=l.aB(d),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return l.aB(this.getLayer(o).filter)}setLayoutProperty(o,d,m,g={}){this._checkLoaded();const v=this.getLayer(o);v?l.aE(v.getLayoutProperty(d),m)||(v.setLayoutProperty(d,m,g),this._updateLayer(v)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,d){const m=this.getLayer(o);if(m)return m.getLayoutProperty(d);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,d,m,g={}){this._checkLoaded();const v=this.getLayer(o);v?l.aE(v.getPaintProperty(d),m)||(v.setPaintProperty(d,m,g)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,d){return this.getLayer(o).getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const m=o.source,g=o.sourceLayer,v=this.sourceCaches[m];if(v===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const S=v.getSource().type;S==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||g?(o.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(g,o.id,d)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,d){this._checkLoaded();const m=o.source,g=this.sourceCaches[m];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const v=g.getSource().type,S=v==="vector"?o.sourceLayer:void 0;v!=="vector"||S?d&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(S,o.id,d):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const d=o.source,m=o.sourceLayer,g=this.sourceCaches[d];if(g!==void 0)return g.getSource().type!=="vector"||m?(o.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(m,o.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=l.aF(this.sourceCaches,v=>v.serialize()),d=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,g=this.stylesheet;return l.aG({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:o,layers:d,terrain:m},v=>v!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const d=S=>this._layers[S].type==="fill-extrusion",m={},g=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(d(I)){m[I]=S;for(const M of o){const B=M[I];if(B)for(const F of B)g.push(F)}}}g.sort((S,I)=>I.intersectionZ-S.intersectionZ);const v=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(d(I))for(let M=g.length-1;M>=0;M--){const B=g[M].feature;if(m[B.layer.id]<S)break;v.push(B),g.pop()}else for(const M of o){const B=M[I];if(B)for(const F of B)v.push(F.feature)}}return v}queryRenderedFeatures(o,d,m){d&&d.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",d.filter,null,d);const g={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const I of d.layers){const M=this._layers[I];if(!M)return this.fire(new l.j(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];g[M.source]=!0}}const v=[];d.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const I in this.sourceCaches)d.layers&&!g[I]||v.push(ps(this.sourceCaches[I],this._layers,S,o,d,m));return this.placement&&v.push(function(I,M,B,F,N,X,Q){const te={},le=X.queryRenderedSymbols(F),de=[];for(const pe of Object.keys(le).map(Number))de.push(Q[pe]);de.sort(fs);for(const pe of de){const ge=pe.featureIndex.lookupSymbolFeatures(le[pe.bucketInstanceId],M,pe.bucketIndex,pe.sourceLayerIndex,N.filter,N.layers,N.availableImages,I);for(const ne in ge){const xe=te[ne]=te[ne]||[],Ae=ge[ne];Ae.sort((ke,Ge)=>{const Xe=pe.featureSortOrder;if(Xe){const lt=Xe.indexOf(ke.featureIndex);return Xe.indexOf(Ge.featureIndex)-lt}return Ge.featureIndex-ke.featureIndex});for(const ke of Ae)xe.push(ke)}}for(const pe in te)te[pe].forEach(ge=>{const ne=ge.feature,xe=B[I[pe].source].getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=xe});return te}(this._layers,S,this.sourceCaches,o,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(o,d){d&&d.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",d.filter,null,d);const m=this.sourceCaches[o];return m?function(g,v){const S=g.getRenderableIds().map(B=>g.getTileByID(B)),I=[],M={};for(let B=0;B<S.length;B++){const F=S[B],N=F.tileID.canonical.key;M[N]||(M[N]=!0,F.querySourceFeatures(I,v))}return I}(m,d):[]}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const S in o)if(!l.aE(o[S],m[S])){g=!0;break}if(!g)return;const v={now:T.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(v)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o,d={}){const m=this.getSky();let g=!1;if(!o&&!m)return;if(o&&!m)g=!0;else if(!o&&m)g=!0;else for(const S in o)if(!l.aE(o[S],m[S])){g=!0;break}if(!g)return;const v={now:T.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,d),this.sky.updateTransitions(v)}_validate(o,d,m,g,v={}){return(!v||v.validate!==!1)&&jr(this,o.call(l.u,l.e({key:d,style:this.serialize(),value:m,styleSpec:l.v},g)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),rs().off(Je,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const m=this.sourceCaches[d];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const d in this.sourceCaches)this.sourceCaches[d].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,d,m,g,v=!1){let S=!1,I=!1;const M={};for(const B of this._order){const F=this._layers[B];if(F.type!=="symbol")continue;if(!M[F.source]){const X=this.sourceCaches[F.source];M[F.source]=X.getRenderableIds(!0).map(Q=>X.getTileByID(Q)).sort((Q,te)=>te.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(te.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(F,M[F.source],o.center.lng);S=S||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(T.now(),o.zoom))&&(this.pauseablePlacement=new Rr(o,this.map.terrain,this._order,v,d,m,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(T.now()),I=!0),S&&this.pauseablePlacement.placement.setStale()),I||S)for(const B of this._order){const F=this._layers[B];F.type==="symbol"&&this.placement.updateLayerOpacities(F,M[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(T.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d){return l._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,d.icons),m})}getGlyphs(o,d){return l._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(d.stacks),g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,d={}){this._checkLoaded(),o&&this._validate(l.u.glyphs,"glyphs",o,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,d,m={},g){this._checkLoaded();const v=[{id:o,url:d}],S=[...Te(this.stylesheet.sprite),...v];this._validate(l.u.sprite,"sprite",S,null,m)||(this.stylesheet.sprite=S,this._loadSprite(v,!0,g))}removeSprite(o){this._checkLoaded();const d=Te(this.stylesheet.sprite);if(d.find(m=>m.id===o)){if(this._spritesImagesIds[o])for(const m of this._spritesImagesIds[o])this.imageManager.removeImage(m),this._changedImages[m]=!0;d.splice(d.findIndex(m=>m.id===o),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Te(this.stylesheet.sprite)}setSprite(o,d={},m){this._checkLoaded(),o&&this._validate(l.u.sprite,"sprite",o,null,d)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,m):(this._unloadSprite(),m&&m(null)))}}var Wn=l.Y([{name:"a_pos",type:"Int16",components:2}]);const Js={prelude:ei(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ei(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ei(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ei(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ei("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ei(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ei(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ei("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ei("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ei("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ei(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ei(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ei(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ei(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ei(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ei(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ei(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ei(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ei(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ei(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ei(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ei("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ei("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ei("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ei("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ei(b,o){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=o.match(/attribute ([\w]+) ([\w]+)/g),g=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=v?v.concat(g):g,I={};return{fragmentSource:b=b.replace(d,(M,B,F,N,X)=>(I[X]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${X}
varying ${F} ${N} ${X};
#else
uniform ${F} ${N} u_${X};
#endif
`:`
#ifdef HAS_UNIFORM_u_${X}
    ${F} ${N} ${X} = u_${X};
#endif
`)),vertexSource:o=o.replace(d,(M,B,F,N,X)=>{const Q=N==="float"?"vec2":"vec4",te=X.match(/color/)?"color":Q;return I[X]?B==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${F} ${Q} a_${X};
varying ${F} ${N} ${X};
#else
uniform ${F} ${N} u_${X};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${F} ${N} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${te}(a_${X}, u_${X}_t);
#else
    ${F} ${N} ${X} = u_${X};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${F} ${Q} a_${X};
#else
uniform ${F} ${N} u_${X};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${F} ${N} ${X} = a_${X};
#else
    ${F} ${N} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${F} ${N} ${X} = unpack_mix_${te}(a_${X}, u_${X}_t);
#else
    ${F} ${N} ${X} = u_${X};
#endif
`}),staticAttributes:m,staticUniforms:S}}class wc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,m,g,v,S,I,M,B){this.context=o;let F=this.boundPaintVertexBuffers.length!==g.length;for(let N=0;!F&&N<g.length;N++)this.boundPaintVertexBuffers[N]!==g[N]&&(F=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==m||F||this.boundIndexBuffer!==v||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==B?this.freshBind(d,m,g,v,S,I,M,B):(o.bindVertexArray.set(this.vao),I&&I.bind(),v&&v.dynamicDraw&&v.bind(),M&&M.bind(),B&&B.bind())}freshBind(o,d,m,g,v,S,I,M){const B=o.numAttributes,F=this.context,N=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=M,d.enableAttributes(N,o);for(const X of m)X.enableAttributes(N,o);S&&S.enableAttributes(N,o),I&&I.enableAttributes(N,o),M&&M.enableAttributes(N,o),d.bind(),d.setVertexAttribPointers(N,o,v);for(const X of m)X.bind(),X.setVertexAttribPointers(N,o,v);S&&(S.bind(),S.setVertexAttribPointers(N,o,v)),g&&g.bind(),I&&(I.bind(),I.setVertexAttribPointers(N,o,v)),M&&(M.bind(),M.setVertexAttribPointers(N,o,v)),F.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const xc=(b,o,d,m,g)=>({u_matrix:b,u_texture:0,u_ele_delta:o,u_fog_matrix:d,u_fog_color:m?m.properties.get("fog-color"):l.aM.white,u_fog_ground_blend:m?m.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?m.calculateFogBlendOpacity(g):0,u_horizon_color:m?m.properties.get("horizon-color"):l.aM.white,u_horizon_fog_blend:m?m.properties.get("horizon-fog-blend"):1});function K(b){const o=[];for(let d=0;d<b.length;d++){if(b[d]===null)continue;const m=b[d].split(" ");o.push(m.pop())}return o}class ie{constructor(o,d,m,g,v,S){const I=o.gl;this.program=I.createProgram();const M=K(d.staticAttributes),B=m?m.getBinderAttributes():[],F=M.concat(B),N=Js.prelude.staticUniforms?K(Js.prelude.staticUniforms):[],X=d.staticUniforms?K(d.staticUniforms):[],Q=m?m.getBinderUniforms():[],te=N.concat(X).concat(Q),le=[];for(const ke of te)le.indexOf(ke)<0&&le.push(ke);const de=m?m.defines():[];v&&de.push("#define OVERDRAW_INSPECTOR;"),S&&de.push("#define TERRAIN3D;");const pe=de.concat(Js.prelude.fragmentSource,d.fragmentSource).join(`
`),ge=de.concat(Js.prelude.vertexSource,d.vertexSource).join(`
`),ne=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(ne,pe),I.compileShader(ne),!I.getShaderParameter(ne,I.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${I.getShaderInfoLog(ne)}`);I.attachShader(this.program,ne);const xe=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(xe,ge),I.compileShader(xe),!I.getShaderParameter(xe,I.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${I.getShaderInfoLog(xe)}`);I.attachShader(this.program,xe),this.attributes={};const Ae={};this.numAttributes=F.length;for(let ke=0;ke<this.numAttributes;ke++)F[ke]&&(I.bindAttribLocation(this.program,ke,F[ke]),this.attributes[F[ke]]=ke);if(I.linkProgram(this.program),!I.getProgramParameter(this.program,I.LINK_STATUS))throw new Error(`Program failed to link: ${I.getProgramInfoLog(this.program)}`);I.deleteShader(xe),I.deleteShader(ne);for(let ke=0;ke<le.length;ke++){const Ge=le[ke];if(Ge&&!Ae[Ge]){const Xe=I.getUniformLocation(this.program,Ge);Xe&&(Ae[Ge]=Xe)}}this.fixedUniforms=g(o,Ae),this.terrainUniforms=((ke,Ge)=>({u_depth:new l.aH(ke,Ge.u_depth),u_terrain:new l.aH(ke,Ge.u_terrain),u_terrain_dim:new l.aI(ke,Ge.u_terrain_dim),u_terrain_matrix:new l.aJ(ke,Ge.u_terrain_matrix),u_terrain_unpack:new l.aK(ke,Ge.u_terrain_unpack),u_terrain_exaggeration:new l.aI(ke,Ge.u_terrain_exaggeration)}))(o,Ae),this.binderUniforms=m?m.getUniforms(o,Ae):[]}draw(o,d,m,g,v,S,I,M,B,F,N,X,Q,te,le,de,pe,ge){const ne=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(m),o.setStencilMode(g),o.setColorMode(v),o.setCullFace(S),M){o.activeTexture.set(ne.TEXTURE2),ne.bindTexture(ne.TEXTURE_2D,M.depthTexture),o.activeTexture.set(ne.TEXTURE3),ne.bindTexture(ne.TEXTURE_2D,M.texture);for(const Ae in this.terrainUniforms)this.terrainUniforms[Ae].set(M[Ae])}for(const Ae in this.fixedUniforms)this.fixedUniforms[Ae].set(I[Ae]);le&&le.setUniforms(o,this.binderUniforms,Q,{zoom:te});let xe=0;switch(d){case ne.LINES:xe=2;break;case ne.TRIANGLES:xe=3;break;case ne.LINE_STRIP:xe=1}for(const Ae of X.get()){const ke=Ae.vaos||(Ae.vaos={});(ke[B]||(ke[B]=new wc)).bind(o,this,F,le?le.getPaintVertexBuffers():[],N,Ae.vertexOffset,de,pe,ge),ne.drawElements(d,Ae.primitiveLength*xe,ne.UNSIGNED_SHORT,Ae.primitiveOffset*xe*2)}}}function _e(b,o,d){const m=1/jt(d,1,o.transform.tileZoom),g=Math.pow(2,d.tileID.overscaledZ),v=d.tileSize*Math.pow(2,o.transform.tileZoom)/g,S=v*(d.tileID.canonical.x+d.tileID.wrap*g),I=v*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[m,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[S>>16,I>>16],u_pixel_coord_lower:[65535&S,65535&I]}}const Ue=(b,o,d,m)=>{const g=o.style.light,v=g.properties.get("position"),S=[v.x,v.y,v.z],I=function(){var B=new l.A(9);return l.A!=Float32Array&&(B[1]=0,B[2]=0,B[3]=0,B[5]=0,B[6]=0,B[7]=0),B[0]=1,B[4]=1,B[8]=1,B}();g.properties.get("anchor")==="viewport"&&function(B,F){var N=Math.sin(F),X=Math.cos(F);B[0]=X,B[1]=N,B[2]=0,B[3]=-N,B[4]=X,B[5]=0,B[6]=0,B[7]=0,B[8]=1}(I,-o.transform.angle),function(B,F,N){var X=F[0],Q=F[1],te=F[2];B[0]=X*N[0]+Q*N[3]+te*N[6],B[1]=X*N[1]+Q*N[4]+te*N[7],B[2]=X*N[2]+Q*N[5]+te*N[8]}(S,S,I);const M=g.properties.get("color");return{u_matrix:b,u_lightpos:S,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+d,u_opacity:m}},qe=(b,o,d,m,g,v,S)=>l.e(Ue(b,o,d,m),_e(v,o,S),{u_height_factor:-Math.pow(2,g.overscaledZ)/S.tileSize/8}),Ct=b=>({u_matrix:b}),qt=(b,o,d,m)=>l.e(Ct(b),_e(d,o,m)),Ni=(b,o)=>({u_matrix:b,u_world:o}),gs=(b,o,d,m,g)=>l.e(qt(b,o,d,m),{u_world:g}),ns=(b,o,d,m)=>{const g=b.transform;let v,S;if(m.paint.get("circle-pitch-alignment")==="map"){const I=jt(d,1,g.zoom);v=!0,S=[I,I]}else v=!1,S=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:b.translatePosMatrix(o.posMatrix,d,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:S}},wr=(b,o,d)=>({u_matrix:b,u_inv_matrix:o,u_camera_to_center_distance:d.cameraToCenterDistance,u_viewport_size:[d.width,d.height]}),Ec=(b,o,d=1)=>({u_matrix:b,u_color:o,u_overlay:0,u_overlay_scale:d}),_s=b=>({u_matrix:b}),ys=(b,o,d,m)=>({u_matrix:b,u_extrude_scale:jt(o,1,d),u_intensity:m}),Bu=(b,o,d,m)=>{const g=l.H();l.aP(g,0,b.width,b.height,0,0,1);const v=b.context.gl;return{u_matrix:g,u_world:[v.drawingBufferWidth,v.drawingBufferHeight],u_image:d,u_color_ramp:m,u_opacity:o.paint.get("heatmap-opacity")}};function Lu(b,o){const d=Math.pow(2,o.canonical.z),m=o.canonical.y;return[new l.Z(0,m/d).toLngLat().lat,new l.Z(0,(m+1)/d).toLngLat().lat]}const Ou=(b,o,d,m)=>{const g=b.transform;return{u_matrix:$m(b,o,d,m),u_ratio:1/jt(o,1,g.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Gm=(b,o,d,m,g)=>l.e(Ou(b,o,d,g),{u_image:0,u_image_height:m}),rl=(b,o,d,m,g)=>{const v=b.transform,S=Vm(o,v);return{u_matrix:$m(b,o,d,g),u_texsize:o.imageAtlasTexture.size,u_ratio:1/jt(o,1,v.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[S,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},W1=(b,o,d,m,g,v)=>{const S=b.lineAtlas,I=Vm(o,b.transform),M=d.layout.get("line-cap")==="round",B=S.getDash(m.from,M),F=S.getDash(m.to,M),N=B.width*g.fromScale,X=F.width*g.toScale;return l.e(Ou(b,o,d,v),{u_patternscale_a:[I/N,-B.height/2],u_patternscale_b:[I/X,-F.height/2],u_sdfgamma:S.width/(256*Math.min(N,X)*b.pixelRatio)/2,u_image:0,u_tex_y_a:B.y,u_tex_y_b:F.y,u_mix:g.t})};function Vm(b,o){return 1/jt(b,1,o.tileZoom)}function $m(b,o,d,m){return b.translatePosMatrix(m?m.posMatrix:o.tileID.posMatrix,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const X1=(b,o,d,m,g)=>{return{u_matrix:b,u_tl_parent:o,u_scale_parent:d,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(S=g.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(v=g.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:K1(g.paint.get("raster-hue-rotate"))};var v,S};function K1(b){b*=Math.PI/180;const o=Math.sin(b),d=Math.cos(b);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const Hm=(b,o,d,m,g,v,S,I,M,B,F,N,X,Q)=>{const te=S.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_pitch:te.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:te.width/te.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:M,u_coord_matrix:B,u_is_text:+N,u_pitch_with_map:+m,u_is_along_line:g,u_is_variable_anchor:v,u_texsize:X,u_texture:0,u_translation:F,u_pitched_scale:Q}},Ac=(b,o,d,m,g,v,S,I,M,B,F,N,X,Q,te)=>{const le=S.transform;return l.e(Hm(b,o,d,m,g,v,S,I,M,B,F,N,X,te),{u_gamma_scale:m?Math.cos(le._pitch)*le.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:+Q})},Xd=(b,o,d,m,g,v,S,I,M,B,F,N,X,Q)=>l.e(Ac(b,o,d,m,g,v,S,I,M,B,F,!0,N,!0,Q),{u_texsize_icon:X,u_texture_icon:1}),Du=(b,o,d)=>({u_matrix:b,u_opacity:o,u_color:d}),Kd=(b,o,d,m,g,v)=>l.e(function(S,I,M,B){const F=M.imageManager.getPattern(S.from.toString()),N=M.imageManager.getPattern(S.to.toString()),{width:X,height:Q}=M.imageManager.getPixelSize(),te=Math.pow(2,B.tileID.overscaledZ),le=B.tileSize*Math.pow(2,M.transform.tileZoom)/te,de=le*(B.tileID.canonical.x+B.tileID.wrap*te),pe=le*B.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[X,Q],u_mix:I.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/jt(B,1,M.transform.tileZoom),u_pixel_coord_upper:[de>>16,pe>>16],u_pixel_coord_lower:[65535&de,65535&pe]}}(m,v,d,g),{u_matrix:b,u_opacity:o}),Jd={fillExtrusion:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_lightpos:new l.aN(b,o.u_lightpos),u_lightintensity:new l.aI(b,o.u_lightintensity),u_lightcolor:new l.aN(b,o.u_lightcolor),u_vertical_gradient:new l.aI(b,o.u_vertical_gradient),u_opacity:new l.aI(b,o.u_opacity)}),fillExtrusionPattern:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_lightpos:new l.aN(b,o.u_lightpos),u_lightintensity:new l.aI(b,o.u_lightintensity),u_lightcolor:new l.aN(b,o.u_lightcolor),u_vertical_gradient:new l.aI(b,o.u_vertical_gradient),u_height_factor:new l.aI(b,o.u_height_factor),u_image:new l.aH(b,o.u_image),u_texsize:new l.aO(b,o.u_texsize),u_pixel_coord_upper:new l.aO(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(b,o.u_pixel_coord_lower),u_scale:new l.aN(b,o.u_scale),u_fade:new l.aI(b,o.u_fade),u_opacity:new l.aI(b,o.u_opacity)}),fill:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix)}),fillPattern:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_image:new l.aH(b,o.u_image),u_texsize:new l.aO(b,o.u_texsize),u_pixel_coord_upper:new l.aO(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(b,o.u_pixel_coord_lower),u_scale:new l.aN(b,o.u_scale),u_fade:new l.aI(b,o.u_fade)}),fillOutline:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_world:new l.aO(b,o.u_world)}),fillOutlinePattern:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_world:new l.aO(b,o.u_world),u_image:new l.aH(b,o.u_image),u_texsize:new l.aO(b,o.u_texsize),u_pixel_coord_upper:new l.aO(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(b,o.u_pixel_coord_lower),u_scale:new l.aN(b,o.u_scale),u_fade:new l.aI(b,o.u_fade)}),circle:(b,o)=>({u_camera_to_center_distance:new l.aI(b,o.u_camera_to_center_distance),u_scale_with_map:new l.aH(b,o.u_scale_with_map),u_pitch_with_map:new l.aH(b,o.u_pitch_with_map),u_extrude_scale:new l.aO(b,o.u_extrude_scale),u_device_pixel_ratio:new l.aI(b,o.u_device_pixel_ratio),u_matrix:new l.aJ(b,o.u_matrix)}),collisionBox:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_pixel_extrude_scale:new l.aO(b,o.u_pixel_extrude_scale)}),collisionCircle:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_inv_matrix:new l.aJ(b,o.u_inv_matrix),u_camera_to_center_distance:new l.aI(b,o.u_camera_to_center_distance),u_viewport_size:new l.aO(b,o.u_viewport_size)}),debug:(b,o)=>({u_color:new l.aL(b,o.u_color),u_matrix:new l.aJ(b,o.u_matrix),u_overlay:new l.aH(b,o.u_overlay),u_overlay_scale:new l.aI(b,o.u_overlay_scale)}),clippingMask:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix)}),heatmap:(b,o)=>({u_extrude_scale:new l.aI(b,o.u_extrude_scale),u_intensity:new l.aI(b,o.u_intensity),u_matrix:new l.aJ(b,o.u_matrix)}),heatmapTexture:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_world:new l.aO(b,o.u_world),u_image:new l.aH(b,o.u_image),u_color_ramp:new l.aH(b,o.u_color_ramp),u_opacity:new l.aI(b,o.u_opacity)}),hillshade:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_image:new l.aH(b,o.u_image),u_latrange:new l.aO(b,o.u_latrange),u_light:new l.aO(b,o.u_light),u_shadow:new l.aL(b,o.u_shadow),u_highlight:new l.aL(b,o.u_highlight),u_accent:new l.aL(b,o.u_accent)}),hillshadePrepare:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_image:new l.aH(b,o.u_image),u_dimension:new l.aO(b,o.u_dimension),u_zoom:new l.aI(b,o.u_zoom),u_unpack:new l.aK(b,o.u_unpack)}),line:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_ratio:new l.aI(b,o.u_ratio),u_device_pixel_ratio:new l.aI(b,o.u_device_pixel_ratio),u_units_to_pixels:new l.aO(b,o.u_units_to_pixels)}),lineGradient:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_ratio:new l.aI(b,o.u_ratio),u_device_pixel_ratio:new l.aI(b,o.u_device_pixel_ratio),u_units_to_pixels:new l.aO(b,o.u_units_to_pixels),u_image:new l.aH(b,o.u_image),u_image_height:new l.aI(b,o.u_image_height)}),linePattern:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_texsize:new l.aO(b,o.u_texsize),u_ratio:new l.aI(b,o.u_ratio),u_device_pixel_ratio:new l.aI(b,o.u_device_pixel_ratio),u_image:new l.aH(b,o.u_image),u_units_to_pixels:new l.aO(b,o.u_units_to_pixels),u_scale:new l.aN(b,o.u_scale),u_fade:new l.aI(b,o.u_fade)}),lineSDF:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_ratio:new l.aI(b,o.u_ratio),u_device_pixel_ratio:new l.aI(b,o.u_device_pixel_ratio),u_units_to_pixels:new l.aO(b,o.u_units_to_pixels),u_patternscale_a:new l.aO(b,o.u_patternscale_a),u_patternscale_b:new l.aO(b,o.u_patternscale_b),u_sdfgamma:new l.aI(b,o.u_sdfgamma),u_image:new l.aH(b,o.u_image),u_tex_y_a:new l.aI(b,o.u_tex_y_a),u_tex_y_b:new l.aI(b,o.u_tex_y_b),u_mix:new l.aI(b,o.u_mix)}),raster:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_tl_parent:new l.aO(b,o.u_tl_parent),u_scale_parent:new l.aI(b,o.u_scale_parent),u_buffer_scale:new l.aI(b,o.u_buffer_scale),u_fade_t:new l.aI(b,o.u_fade_t),u_opacity:new l.aI(b,o.u_opacity),u_image0:new l.aH(b,o.u_image0),u_image1:new l.aH(b,o.u_image1),u_brightness_low:new l.aI(b,o.u_brightness_low),u_brightness_high:new l.aI(b,o.u_brightness_high),u_saturation_factor:new l.aI(b,o.u_saturation_factor),u_contrast_factor:new l.aI(b,o.u_contrast_factor),u_spin_weights:new l.aN(b,o.u_spin_weights)}),symbolIcon:(b,o)=>({u_is_size_zoom_constant:new l.aH(b,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(b,o.u_is_size_feature_constant),u_size_t:new l.aI(b,o.u_size_t),u_size:new l.aI(b,o.u_size),u_camera_to_center_distance:new l.aI(b,o.u_camera_to_center_distance),u_pitch:new l.aI(b,o.u_pitch),u_rotate_symbol:new l.aH(b,o.u_rotate_symbol),u_aspect_ratio:new l.aI(b,o.u_aspect_ratio),u_fade_change:new l.aI(b,o.u_fade_change),u_matrix:new l.aJ(b,o.u_matrix),u_label_plane_matrix:new l.aJ(b,o.u_label_plane_matrix),u_coord_matrix:new l.aJ(b,o.u_coord_matrix),u_is_text:new l.aH(b,o.u_is_text),u_pitch_with_map:new l.aH(b,o.u_pitch_with_map),u_is_along_line:new l.aH(b,o.u_is_along_line),u_is_variable_anchor:new l.aH(b,o.u_is_variable_anchor),u_texsize:new l.aO(b,o.u_texsize),u_texture:new l.aH(b,o.u_texture),u_translation:new l.aO(b,o.u_translation),u_pitched_scale:new l.aI(b,o.u_pitched_scale)}),symbolSDF:(b,o)=>({u_is_size_zoom_constant:new l.aH(b,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(b,o.u_is_size_feature_constant),u_size_t:new l.aI(b,o.u_size_t),u_size:new l.aI(b,o.u_size),u_camera_to_center_distance:new l.aI(b,o.u_camera_to_center_distance),u_pitch:new l.aI(b,o.u_pitch),u_rotate_symbol:new l.aH(b,o.u_rotate_symbol),u_aspect_ratio:new l.aI(b,o.u_aspect_ratio),u_fade_change:new l.aI(b,o.u_fade_change),u_matrix:new l.aJ(b,o.u_matrix),u_label_plane_matrix:new l.aJ(b,o.u_label_plane_matrix),u_coord_matrix:new l.aJ(b,o.u_coord_matrix),u_is_text:new l.aH(b,o.u_is_text),u_pitch_with_map:new l.aH(b,o.u_pitch_with_map),u_is_along_line:new l.aH(b,o.u_is_along_line),u_is_variable_anchor:new l.aH(b,o.u_is_variable_anchor),u_texsize:new l.aO(b,o.u_texsize),u_texture:new l.aH(b,o.u_texture),u_gamma_scale:new l.aI(b,o.u_gamma_scale),u_device_pixel_ratio:new l.aI(b,o.u_device_pixel_ratio),u_is_halo:new l.aH(b,o.u_is_halo),u_translation:new l.aO(b,o.u_translation),u_pitched_scale:new l.aI(b,o.u_pitched_scale)}),symbolTextAndIcon:(b,o)=>({u_is_size_zoom_constant:new l.aH(b,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(b,o.u_is_size_feature_constant),u_size_t:new l.aI(b,o.u_size_t),u_size:new l.aI(b,o.u_size),u_camera_to_center_distance:new l.aI(b,o.u_camera_to_center_distance),u_pitch:new l.aI(b,o.u_pitch),u_rotate_symbol:new l.aH(b,o.u_rotate_symbol),u_aspect_ratio:new l.aI(b,o.u_aspect_ratio),u_fade_change:new l.aI(b,o.u_fade_change),u_matrix:new l.aJ(b,o.u_matrix),u_label_plane_matrix:new l.aJ(b,o.u_label_plane_matrix),u_coord_matrix:new l.aJ(b,o.u_coord_matrix),u_is_text:new l.aH(b,o.u_is_text),u_pitch_with_map:new l.aH(b,o.u_pitch_with_map),u_is_along_line:new l.aH(b,o.u_is_along_line),u_is_variable_anchor:new l.aH(b,o.u_is_variable_anchor),u_texsize:new l.aO(b,o.u_texsize),u_texsize_icon:new l.aO(b,o.u_texsize_icon),u_texture:new l.aH(b,o.u_texture),u_texture_icon:new l.aH(b,o.u_texture_icon),u_gamma_scale:new l.aI(b,o.u_gamma_scale),u_device_pixel_ratio:new l.aI(b,o.u_device_pixel_ratio),u_is_halo:new l.aH(b,o.u_is_halo),u_translation:new l.aO(b,o.u_translation),u_pitched_scale:new l.aI(b,o.u_pitched_scale)}),background:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_opacity:new l.aI(b,o.u_opacity),u_color:new l.aL(b,o.u_color)}),backgroundPattern:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_opacity:new l.aI(b,o.u_opacity),u_image:new l.aH(b,o.u_image),u_pattern_tl_a:new l.aO(b,o.u_pattern_tl_a),u_pattern_br_a:new l.aO(b,o.u_pattern_br_a),u_pattern_tl_b:new l.aO(b,o.u_pattern_tl_b),u_pattern_br_b:new l.aO(b,o.u_pattern_br_b),u_texsize:new l.aO(b,o.u_texsize),u_mix:new l.aI(b,o.u_mix),u_pattern_size_a:new l.aO(b,o.u_pattern_size_a),u_pattern_size_b:new l.aO(b,o.u_pattern_size_b),u_scale_a:new l.aI(b,o.u_scale_a),u_scale_b:new l.aI(b,o.u_scale_b),u_pixel_coord_upper:new l.aO(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(b,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aI(b,o.u_tile_units_to_pixels)}),terrain:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_texture:new l.aH(b,o.u_texture),u_ele_delta:new l.aI(b,o.u_ele_delta),u_fog_matrix:new l.aJ(b,o.u_fog_matrix),u_fog_color:new l.aL(b,o.u_fog_color),u_fog_ground_blend:new l.aI(b,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.aI(b,o.u_fog_ground_blend_opacity),u_horizon_color:new l.aL(b,o.u_horizon_color),u_horizon_fog_blend:new l.aI(b,o.u_horizon_fog_blend)}),terrainDepth:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_ele_delta:new l.aI(b,o.u_ele_delta)}),terrainCoords:(b,o)=>({u_matrix:new l.aJ(b,o.u_matrix),u_texture:new l.aH(b,o.u_texture),u_terrain_coords_id:new l.aI(b,o.u_terrain_coords_id),u_ele_delta:new l.aI(b,o.u_ele_delta)}),sky:(b,o)=>({u_sky_color:new l.aL(b,o.u_sky_color),u_horizon_color:new l.aL(b,o.u_horizon_color),u_horizon:new l.aI(b,o.u_horizon),u_sky_horizon_blend:new l.aI(b,o.u_sky_horizon_blend)})};class Xn{constructor(o,d,m){this.context=o;const g=o.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const J1={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zd{constructor(o,d,m,g){this.length=d.length,this.attributes=m,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=o;const v=o.gl;this.buffer=v.createBuffer(),o.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let m=0;m<this.attributes.length;m++){const g=d.attributes[this.attributes[m].name];g!==void 0&&o.enableVertexAttribArray(g)}}setVertexAttribPointers(o,d,m){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],S=d.attributes[v.name];S!==void 0&&o.vertexAttribPointer(S,v.components,o[J1[v.type]],!1,this.itemSize,v.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const va=new WeakMap;function qo(b){var o;if(va.has(b))return va.get(b);{const d=(o=b.getParameter(b.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return va.set(b,d),d}}class ui{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fu extends ui{getDefault(){return l.aM.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Z1 extends ui{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class sl extends ui{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Y1 extends ui{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class qm extends ui{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Q1 extends ui{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Wm extends ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Yd extends ui{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Xm extends ui{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class Km extends ui{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Jm extends ui{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class Zm extends ui{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ba extends ui{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class Ym extends ui{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class ey extends ui{getDefault(){return l.aM.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Qm extends ui{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Tc extends ui{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class ty extends ui{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Nu extends ui{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class iy extends ui{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class ry extends ui{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class eg extends ui{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class tg extends ui{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class ig extends ui{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Qd extends ui{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class rg extends ui{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Uu extends ui{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class mo extends ui{getDefault(){return null}set(o){var d;if(o===this.current&&!this.dirty)return;const m=this.gl;qo(m)?m.bindVertexArray(o):(d=m.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class ep extends ui{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class tp extends ui{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class ip extends ui{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class zu extends ui{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class rp extends zu{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class wa extends zu{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class sp extends zu{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class sy{constructor(o,d,m,g,v){this.context=o,this.width=d,this.height=m;const S=o.gl,I=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new rp(o,I),g)this.depthAttachment=v?new sp(o,I):new wa(o,I);else if(v)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const m=this.depthAttachment.get();m&&o.deleteRenderbuffer(m)}o.deleteFramebuffer(this.framebuffer)}}class Qi{constructor(o,d,m){this.blendFunction=o,this.blendColor=d,this.mask=m}}Qi.Replace=[1,0],Qi.disabled=new Qi(Qi.Replace,l.aM.transparent,[!1,!1,!1,!1]),Qi.unblended=new Qi(Qi.Replace,l.aM.transparent,[!0,!0,!0,!0]),Qi.alphaBlended=new Qi([1,771],l.aM.transparent,[!0,!0,!0,!0]);class ny{constructor(o){var d,m;if(this.gl=o,this.clearColor=new Fu(this),this.clearDepth=new Z1(this),this.clearStencil=new sl(this),this.colorMask=new Y1(this),this.depthMask=new qm(this),this.stencilMask=new Q1(this),this.stencilFunc=new Wm(this),this.stencilOp=new Yd(this),this.stencilTest=new Xm(this),this.depthRange=new Km(this),this.depthTest=new Jm(this),this.depthFunc=new Zm(this),this.blend=new ba(this),this.blendFunc=new Ym(this),this.blendColor=new ey(this),this.blendEquation=new Qm(this),this.cullFace=new Tc(this),this.cullFaceSide=new ty(this),this.frontFace=new Nu(this),this.program=new iy(this),this.activeTexture=new ry(this),this.viewport=new eg(this),this.bindFramebuffer=new tg(this),this.bindRenderbuffer=new ig(this),this.bindTexture=new Qd(this),this.bindVertexBuffer=new rg(this),this.bindElementBuffer=new Uu(this),this.bindVertexArray=new mo(this),this.pixelStoreUnpack=new ep(this),this.pixelStoreUnpackPremultiplyAlpha=new tp(this),this.pixelStoreUnpackFlipY=new ip(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),qo(o)){this.HALF_FLOAT=o.HALF_FLOAT;const g=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=o.RGBA16F)!==null&&d!==void 0?d:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(m=o.RGB16F)!==null&&m!==void 0?m:g==null?void 0:g.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const g=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new Xn(this,o,d)}createVertexBuffer(o,d,m){return new Zd(this,o,d,m)}createRenderbuffer(o,d,m){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,o,d,m),this.bindRenderbuffer.set(null),v}createFramebuffer(o,d,m,g){return new sy(this,o,d,m,g)}clear({color:o,depth:d,stencil:m}){const g=this.gl;let v=0;o&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),m!==void 0&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),g.clear(v)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){l.aE(o.blendFunction,Qi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return qo(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var d;return qo(this.gl)?this.gl.deleteVertexArray(o):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class Vt{constructor(o,d,m){this.func=o,this.mask=d,this.range=m}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);const ju=7680;class Ti{constructor(o,d,m,g,v,S){this.test=o,this.ref=d,this.mask=m,this.fail=g,this.depthFail=v,this.pass=S}}Ti.disabled=new Ti({func:519,mask:0},0,0,ju,ju,ju);class gi{constructor(o,d,m){this.enable=o,this.mode=d,this.frontFace=m}}let xa;function Sc(b,o,d,m,g){const v=b.context,S=v.gl,I=b.useProgram("collisionBox"),M=[];let B=0,F=0;for(let pe=0;pe<m.length;pe++){const ge=m[pe],ne=o.getTile(ge).getBucket(d);if(!ne)continue;const xe=g?ne.textCollisionBox:ne.iconCollisionBox,Ae=ne.collisionCircleArray;if(Ae.length>0){const ke=l.H();l.aQ(ke,ne.placementInvProjMatrix,b.transform.glCoordMatrix),l.aQ(ke,ke,ne.placementViewportMatrix),M.push({circleArray:Ae,circleOffset:F,transform:ge.posMatrix,invTransform:ke,coord:ge}),B+=Ae.length/4,F=B}xe&&I.draw(v,S.LINES,Vt.disabled,Ti.disabled,b.colorModeForRenderPass(),gi.disabled,{u_matrix:ge.posMatrix,u_pixel_extrude_scale:[1/(N=b.transform).width,1/N.height]},b.style.map.terrain&&b.style.map.terrain.getTerrainData(ge),d.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,b.transform.zoom,null,null,xe.collisionVertexBuffer)}var N;if(!g||!M.length)return;const X=b.useProgram("collisionCircle"),Q=new l.aR;Q.resize(4*B),Q._trim();let te=0;for(const pe of M)for(let ge=0;ge<pe.circleArray.length/4;ge++){const ne=4*ge,xe=pe.circleArray[ne+0],Ae=pe.circleArray[ne+1],ke=pe.circleArray[ne+2],Ge=pe.circleArray[ne+3];Q.emplace(te++,xe,Ae,ke,Ge,0),Q.emplace(te++,xe,Ae,ke,Ge,1),Q.emplace(te++,xe,Ae,ke,Ge,2),Q.emplace(te++,xe,Ae,ke,Ge,3)}(!xa||xa.length<2*B)&&(xa=function(pe){const ge=2*pe,ne=new l.aT;ne.resize(ge),ne._trim();for(let xe=0;xe<ge;xe++){const Ae=6*xe;ne.uint16[Ae+0]=4*xe+0,ne.uint16[Ae+1]=4*xe+1,ne.uint16[Ae+2]=4*xe+2,ne.uint16[Ae+3]=4*xe+2,ne.uint16[Ae+4]=4*xe+3,ne.uint16[Ae+5]=4*xe+0}return ne}(B));const le=v.createIndexBuffer(xa,!0),de=v.createVertexBuffer(Q,l.aS.members,!0);for(const pe of M){const ge=wr(pe.transform,pe.invTransform,b.transform);X.draw(v,S.TRIANGLES,Vt.disabled,Ti.disabled,b.colorModeForRenderPass(),gi.disabled,ge,b.style.map.terrain&&b.style.map.terrain.getTerrainData(pe.coord),d.id,de,le,l.a0.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,b.transform.zoom,null,null,null)}de.destroy(),le.destroy()}gi.disabled=new gi(!1,1029,2305),gi.backCCW=new gi(!0,1029,2305);const Cc=l.an(new Float32Array(16));function np(b,o,d,m,g,v){const{horizontalAlign:S,verticalAlign:I}=l.au(b);return new l.P((-(S-.5)*o/g+m[0])*v,(-(I-.5)*d/g+m[1])*v)}function Ea(b,o,d,m,g,v){const S=o.tileAnchorPoint.add(new l.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let I=m.mult(v);d||(I=I.rotate(-g));const M=S.add(I);return ue(M.x,M.y,o.labelPlaneMatrix,o.getElevation).point}if(d){const I=Ne(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(b),M=Math.atan(I.y/I.x)+(I.x<0?Math.PI:0);return b.add(m.rotate(M))}return b.add(m)}function nl(b,o,d,m,g,v,S,I,M,B,F,N,X,Q){const te=b.text.placedSymbolArray,le=b.text.dynamicLayoutVertexArray,de=b.icon.dynamicLayoutVertexArray,pe={};le.clear();for(let ge=0;ge<te.length;ge++){const ne=te.get(ge),xe=ne.hidden||!ne.crossTileID||b.allowVerticalPlacement&&!ne.placedOrientation?null:m[ne.crossTileID];if(xe){const Ae=new l.P(ne.anchorX,ne.anchorY),ke={getElevation:Q,width:g.width,height:g.height,labelPlaneMatrix:v,lineVertexArray:null,pitchWithMap:d,projection:F,projectionCache:null,tileAnchorPoint:Ae,translation:N,unwrappedTileID:X},Ge=d?ue(Ae.x,Ae.y,S,Q):Ne(Ae.x,Ae.y,ke),Xe=G(g.cameraToCenterDistance,Ge.signedDistanceFromCamera);let lt=l.ai(b.textSizeData,M,ne)*Xe/l.ap;d&&(lt*=b.tilePixelRatio/I);const{width:pt,height:nt,anchor:it,textOffset:yt,textBoxScale:Lt}=xe,ot=np(it,pt,nt,yt,Lt,lt),ut=F.getPitchedTextCorrection(g,Ae.add(new l.P(N[0],N[1])),X),kt=Ea(Ge.point,ke,o,ot,g.angle,ut),Mi=b.allowVerticalPlacement&&ne.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Ut=0;Ut<ne.numGlyphs;Ut++)l.aj(le,kt,Mi);B&&ne.associatedIconIndex>=0&&(pe[ne.associatedIconIndex]={shiftedAnchor:kt,angle:Mi})}else St(ne.numGlyphs,le)}if(B){de.clear();const ge=b.icon.placedSymbolArray;for(let ne=0;ne<ge.length;ne++){const xe=ge.get(ne);if(xe.hidden)St(xe.numGlyphs,de);else{const Ae=pe[ne];if(Ae)for(let ke=0;ke<xe.numGlyphs;ke++)l.aj(de,Ae.shiftedAnchor,Ae.angle);else St(xe.numGlyphs,de)}}b.icon.dynamicLayoutVertexBuffer.updateData(de)}b.text.dynamicLayoutVertexBuffer.updateData(le)}function Zs(b,o,d){return d.iconsInText&&o?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function op(b,o,d,m,g,v,S,I,M,B,F,N){const X=b.context,Q=X.gl,te=b.transform,le=Hn(),de=I==="map",pe=M==="map",ge=I!=="viewport"&&d.layout.get("symbol-placement")!=="point",ne=de&&!pe&&!ge,xe=!pe&&ge,Ae=!d.layout.get("symbol-sort-key").isConstant();let ke=!1;const Ge=b.depthModeForSublayer(0,Vt.ReadOnly),Xe=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),lt=[],pt=le.getCircleRadiusCorrection(te);for(const nt of m){const it=o.getTile(nt),yt=it.getBucket(d);if(!yt)continue;const Lt=g?yt.text:yt.icon;if(!Lt||!Lt.segments.get().length||!Lt.hasVisibleVertices)continue;const ot=Lt.programConfigurations.get(d.id),ut=g||yt.sdfIcons,kt=g?yt.textSizeData:yt.iconSizeData,Mi=pe||te.pitch!==0,Ut=b.useProgram(Zs(ut,g,yt),ot),Wt=l.ag(kt,te.zoom),Pi=b.style.map.terrain&&b.style.map.terrain.getTerrainData(nt);let Vr,xn,ki,vs,os=[0,0],$r=null;if(g)xn=it.glyphAtlasTexture,ki=Q.LINEAR,Vr=it.glyphAtlasTexture.size,yt.iconsInText&&(os=it.imageAtlasTexture.size,$r=it.imageAtlasTexture,vs=Mi||b.options.rotating||b.options.zooming||kt.kind==="composite"||kt.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const Jt=d.layout.get("icon-size").constantOr(0)!==1||yt.iconsNeedLinear;xn=it.imageAtlasTexture,ki=ut||b.options.rotating||b.options.zooming||Jt||Mi?Q.LINEAR:Q.NEAREST,Vr=it.imageAtlasTexture.size}const as=jt(it,1,b.transform.zoom),Zn=xe?nt.posMatrix:Cc,wl=vn(Zn,pe,de,b.transform,as),oh=Fs(Zn,pe,de,b.transform,as),xl=Fs(nt.posMatrix,pe,de,b.transform,as),en=le.translatePosition(b.transform,it,v,S),ah=Xe&&yt.hasTextData(),Pp=d.layout.get("icon-text-fit")!=="none"&&ah&&yt.hasIconData();if(ge){const Jt=b.style.map.terrain?(El,Al)=>b.style.map.terrain.getElevation(nt,El,Al):null,Ia=d.layout.get("text-rotation-alignment")==="map";Y(yt,nt.posMatrix,b,g,wl,xl,pe,B,Ia,le,nt.toUnwrapped(),te.width,te.height,en,Jt)}const tn=nt.posMatrix,rn=g&&Xe||Pp,Wo=ge||rn?Cc:wl,En=oh,Mr=ut&&d.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Hr;Hr=ut?yt.iconsInText?Xd(kt.kind,Wt,ne,pe,ge,rn,b,tn,Wo,En,en,Vr,os,pt):Ac(kt.kind,Wt,ne,pe,ge,rn,b,tn,Wo,En,en,g,Vr,!0,pt):Hm(kt.kind,Wt,ne,pe,ge,rn,b,tn,Wo,En,en,g,Vr,pt);const zs={program:Ut,buffers:Lt,uniformValues:Hr,atlasTexture:xn,atlasTextureIcon:$r,atlasInterpolation:ki,atlasInterpolationIcon:vs,isSDF:ut,hasHalo:Mr};if(Ae&&yt.canOverlap){ke=!0;const Jt=Lt.segments.get();for(const Ia of Jt)lt.push({segments:new l.a0([Ia]),sortKey:Ia.sortKey,state:zs,terrainData:Pi})}else lt.push({segments:Lt.segments,sortKey:0,state:zs,terrainData:Pi})}ke&&lt.sort((nt,it)=>nt.sortKey-it.sortKey);for(const nt of lt){const it=nt.state;if(X.activeTexture.set(Q.TEXTURE0),it.atlasTexture.bind(it.atlasInterpolation,Q.CLAMP_TO_EDGE),it.atlasTextureIcon&&(X.activeTexture.set(Q.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),it.isSDF){const yt=it.uniformValues;it.hasHalo&&(yt.u_is_halo=1,ap(it.buffers,nt.segments,d,b,it.program,Ge,F,N,yt,nt.terrainData)),yt.u_is_halo=0}ap(it.buffers,nt.segments,d,b,it.program,Ge,F,N,it.uniformValues,nt.terrainData)}}function ap(b,o,d,m,g,v,S,I,M,B){const F=m.context;g.draw(F,F.gl.TRIANGLES,v,S,I,gi.disabled,M,B,d.id,b.layoutVertexBuffer,b.indexBuffer,o,d.paint,m.transform.zoom,b.programConfigurations.get(d.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function lp(b,o,d,m){const g=b.context,v=g.gl,S=Ti.disabled,I=new Qi([v.ONE,v.ONE],l.aM.transparent,[!0,!0,!0,!0]),M=o.getBucket(d);if(!M)return;const B=m.key;let F=d.heatmapFbos.get(B);F||(F=Ic(g,o.tileSize,o.tileSize),d.heatmapFbos.set(B,F)),g.bindFramebuffer.set(F.framebuffer),g.viewport.set([0,0,o.tileSize,o.tileSize]),g.clear({color:l.aM.transparent});const N=M.programConfigurations.get(d.id),X=b.useProgram("heatmap",N),Q=b.style.map.terrain.getTerrainData(m);X.draw(g,v.TRIANGLES,Vt.disabled,S,I,gi.disabled,ys(m.posMatrix,o,b.transform.zoom,d.paint.get("heatmap-intensity")),Q,d.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,d.paint,b.transform.zoom,N)}function Aa(b,o,d){const m=b.context,g=m.gl;m.setColorMode(b.colorModeForRenderPass());const v=Rc(m,o),S=d.key,I=o.heatmapFbos.get(S);I&&(m.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,I.colorAttachment.get()),m.activeTexture.set(g.TEXTURE1),v.bind(g.LINEAR,g.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(m,g.TRIANGLES,Vt.disabled,Ti.disabled,b.colorModeForRenderPass(),gi.disabled,Bu(b,o,0,1),null,o.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments,o.paint,b.transform.zoom),I.destroy(),o.heatmapFbos.delete(S))}function Ic(b,o,d){var m,g;const v=b.gl,S=v.createTexture();v.bindTexture(v.TEXTURE_2D,S),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR);const I=(m=b.HALF_FLOAT)!==null&&m!==void 0?m:v.UNSIGNED_BYTE,M=(g=b.RGBA16F)!==null&&g!==void 0?g:v.RGBA;v.texImage2D(v.TEXTURE_2D,0,M,o,d,0,v.RGBA,I,null);const B=b.createFramebuffer(o,d,!1,!1);return B.colorAttachment.set(S),B}function Rc(b,o){return o.colorRampTexture||(o.colorRampTexture=new ze(b,o.colorRamp,b.gl.RGBA)),o.colorRampTexture}function ol(b,o,d,m,g){if(!d||!m||!m.imageAtlas)return;const v=m.imageAtlas.patternPositions;let S=v[d.to.toString()],I=v[d.from.toString()];if(!S&&I&&(S=I),!I&&S&&(I=S),!S||!I){const M=g.getPaintProperty(o);S=v[M],I=v[M]}S&&I&&b.setConstantPatternPositions(S,I)}function Mc(b,o,d,m,g,v,S){const I=b.context.gl,M="fill-pattern",B=d.paint.get(M),F=B&&B.constantOr(1),N=d.getCrossfadeParameters();let X,Q,te,le,de;S?(Q=F&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=I.LINES):(Q=F?"fillPattern":"fill",X=I.TRIANGLES);const pe=B.constantOr(null);for(const ge of m){const ne=o.getTile(ge);if(F&&!ne.patternsLoaded())continue;const xe=ne.getBucket(d);if(!xe)continue;const Ae=xe.programConfigurations.get(d.id),ke=b.useProgram(Q,Ae),Ge=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ge);F&&(b.context.activeTexture.set(I.TEXTURE0),ne.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ae.updatePaintBuffers(N)),ol(Ae,M,pe,ne,d);const Xe=Ge?ge:null,lt=b.translatePosMatrix(Xe?Xe.posMatrix:ge.posMatrix,ne,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(S){le=xe.indexBuffer2,de=xe.segments2;const pt=[I.drawingBufferWidth,I.drawingBufferHeight];te=Q==="fillOutlinePattern"&&F?gs(lt,b,N,ne,pt):Ni(lt,pt)}else le=xe.indexBuffer,de=xe.segments,te=F?qt(lt,b,N,ne):Ct(lt);ke.draw(b.context,X,g,b.stencilModeForClipping(ge),v,gi.disabled,te,Ge,d.id,xe.layoutVertexBuffer,le,de,d.paint,b.transform.zoom,Ae)}}function Gu(b,o,d,m,g,v,S){const I=b.context,M=I.gl,B="fill-extrusion-pattern",F=d.paint.get(B),N=F.constantOr(1),X=d.getCrossfadeParameters(),Q=d.paint.get("fill-extrusion-opacity"),te=F.constantOr(null);for(const le of m){const de=o.getTile(le),pe=de.getBucket(d);if(!pe)continue;const ge=b.style.map.terrain&&b.style.map.terrain.getTerrainData(le),ne=pe.programConfigurations.get(d.id),xe=b.useProgram(N?"fillExtrusionPattern":"fillExtrusion",ne);N&&(b.context.activeTexture.set(M.TEXTURE0),de.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ne.updatePaintBuffers(X)),ol(ne,B,te,de,d);const Ae=b.translatePosMatrix(le.posMatrix,de,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),ke=d.paint.get("fill-extrusion-vertical-gradient"),Ge=N?qe(Ae,b,ke,Q,le,X,de):Ue(Ae,b,ke,Q);xe.draw(I,I.gl.TRIANGLES,g,v,S,gi.backCCW,Ge,ge,d.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,d.paint,b.transform.zoom,ne,b.style.map.terrain&&pe.centroidVertexBuffer)}}function al(b,o,d,m,g,v,S){const I=b.context,M=I.gl,B=d.fbo;if(!B)return;const F=b.useProgram("hillshade"),N=b.style.map.terrain&&b.style.map.terrain.getTerrainData(o);I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,B.colorAttachment.get()),F.draw(I,M.TRIANGLES,g,v,S,gi.disabled,((X,Q,te,le)=>{const de=te.paint.get("hillshade-shadow-color"),pe=te.paint.get("hillshade-highlight-color"),ge=te.paint.get("hillshade-accent-color");let ne=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(ne-=X.transform.angle);const xe=!X.options.moving;return{u_matrix:le?le.posMatrix:X.transform.calculatePosMatrix(Q.tileID.toUnwrapped(),xe),u_image:0,u_latrange:Lu(0,Q.tileID),u_light:[te.paint.get("hillshade-exaggeration"),ne],u_shadow:de,u_highlight:pe,u_accent:ge}})(b,d,m,N?o:null),N,m.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}function ll(b,o,d,m,g,v){const S=b.context,I=S.gl,M=o.dem;if(M&&M.data){const B=M.dim,F=M.stride,N=M.getPixels();if(S.activeTexture.set(I.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||b.getTileTexture(F),o.demTexture){const Q=o.demTexture;Q.update(N,{premultiply:!1}),Q.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else o.demTexture=new ze(S,N,I.RGBA,{premultiply:!1}),o.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);S.activeTexture.set(I.TEXTURE0);let X=o.fbo;if(!X){const Q=new ze(S,{width:B,height:B,data:null},I.RGBA);Q.bind(I.LINEAR,I.CLAMP_TO_EDGE),X=o.fbo=S.createFramebuffer(B,B,!0,!1),X.colorAttachment.set(Q.texture)}S.bindFramebuffer.set(X.framebuffer),S.viewport.set([0,0,B,B]),b.useProgram("hillshadePrepare").draw(S,I.TRIANGLES,m,g,v,gi.disabled,((Q,te)=>{const le=te.stride,de=l.H();return l.aP(de,0,l.X,-l.X,0,0,1),l.J(de,de,[0,-l.X,0]),{u_matrix:de,u_image:1,u_dimension:[le,le],u_zoom:Q.overscaledZ,u_unpack:te.getUnpackVector()}})(o.tileID,M),null,d.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function sg(b,o,d,m,g,v){const S=m.paint.get("raster-fade-duration");if(!v&&S>0){const I=T.now(),M=(I-b.timeAdded)/S,B=o?(I-o.timeAdded)/S:-1,F=d.getSource(),N=g.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),X=!o||Math.abs(o.tileID.overscaledZ-N)>Math.abs(b.tileID.overscaledZ-N),Q=X&&b.refreshedUponExpiration?1:l.ac(X?M:1-B,0,1);return b.refreshedUponExpiration&&M>=1&&(b.refreshedUponExpiration=!1),o?{opacity:1,mix:1-Q}:{opacity:Q,mix:0}}return{opacity:1,mix:0}}const cp=new l.aM(1,0,0,1),ni=new l.aM(0,1,0,1),Vu=new l.aM(0,0,1,1),oy=new l.aM(1,0,1,1),ng=new l.aM(0,1,1,1);function cl(b,o,d,m){$u(b,0,o+d/2,b.transform.width,d,m)}function og(b,o,d,m){$u(b,o-d/2,0,d,b.transform.height,m)}function $u(b,o,d,m,g,v){const S=b.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*b.pixelRatio,d*b.pixelRatio,m*b.pixelRatio,g*b.pixelRatio),S.clear({color:v}),I.disable(I.SCISSOR_TEST)}function ag(b,o,d){const m=b.context,g=m.gl,v=d.posMatrix,S=b.useProgram("debug"),I=Vt.disabled,M=Ti.disabled,B=b.colorModeForRenderPass(),F="$debug",N=b.style.map.terrain&&b.style.map.terrain.getTerrainData(d);m.activeTexture.set(g.TEXTURE0);const X=o.getTileByID(d.key).latestRawTileData,Q=Math.floor((X&&X.byteLength||0)/1024),te=o.getTile(d).tileSize,le=512/Math.min(te,512)*(d.overscaledZ/b.transform.zoom)*.5;let de=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(de+=` => ${d.overscaledZ}`),function(pe,ge){pe.initDebugOverlayCanvas();const ne=pe.debugOverlayCanvas,xe=pe.context.gl,Ae=pe.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,ne.width,ne.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(ge,5,5),Ae.strokeText(ge,5,5),pe.debugOverlayTexture.update(ne),pe.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(b,`${de} ${Q}kB`),S.draw(m,g.TRIANGLES,I,M,Qi.alphaBlended,gi.disabled,Ec(v,l.aM.transparent,le),null,F,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),S.draw(m,g.LINE_STRIP,I,M,B,gi.disabled,Ec(v,l.aM.red),N,F,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function lg(b,o,d){const m=b.context,g=m.gl,v=b.colorModeForRenderPass(),S=new Vt(g.LEQUAL,Vt.ReadWrite,b.depthRangeFor3D),I=b.useProgram("terrain"),M=o.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,b.width,b.height]);for(const B of d){const F=b.renderToTexture.getTexture(B),N=o.getTerrainData(B.tileID);m.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,F.texture);const X=b.transform.calculatePosMatrix(B.tileID.toUnwrapped()),Q=o.getMeshFrameDelta(b.transform.zoom),te=b.transform.calculateFogMatrix(B.tileID.toUnwrapped()),le=xc(X,Q,te,b.style.sky,b.transform.pitch);I.draw(m,g.TRIANGLES,S,Ti.disabled,v,gi.backCCW,le,N,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class Hu{constructor(o,d,m){this.vertexBuffer=o,this.indexBuffer=d,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class qu{constructor(o,d){this.context=new ny(o),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Mt.maxUnderzooming+Mt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ya}resize(o,d,m){if(this.width=Math.floor(o*m),this.height=Math.floor(d*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const o=this.context,d=new l.aX;d.emplaceBack(0,0),d.emplaceBack(l.X,0),d.emplaceBack(0,l.X),d.emplaceBack(l.X,l.X),this.tileExtentBuffer=o.createVertexBuffer(d,Wn.members),this.tileExtentSegments=l.a0.simpleSegment(0,0,4,2);const m=new l.aX;m.emplaceBack(0,0),m.emplaceBack(l.X,0),m.emplaceBack(0,l.X),m.emplaceBack(l.X,l.X),this.debugBuffer=o.createVertexBuffer(m,Wn.members),this.debugSegments=l.a0.simpleSegment(0,0,4,5);const g=new l.$;g.emplaceBack(0,0,0,0),g.emplaceBack(l.X,0,l.X,0),g.emplaceBack(0,l.X,0,l.X),g.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=o.createVertexBuffer(g,Vn.members),this.rasterBoundsSegments=l.a0.simpleSegment(0,0,4,2);const v=new l.aX;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,Wn.members),this.viewportSegments=l.a0.simpleSegment(0,0,4,2);const S=new l.aZ;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(S);const I=new l.aY;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I);const M=this.context.gl;this.stencilClearMode=new Ti({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=l.H();l.aP(m,0,this.width,this.height,0,0,1),l.K(m,m,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,d.TRIANGLES,Vt.disabled,this.stencilClearMode,Qi.disabled,gi.disabled,_s(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,d){if(this.currentStencilSource===o.source||!o.isTileClipped()||!d||!d.length)return;this.currentStencilSource=o.source;const m=this.context,g=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(Qi.disabled),m.setDepthMode(Vt.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of d){const I=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);v.draw(m,g.TRIANGLES,Vt.disabled,new Ti({func:g.ALWAYS,mask:0},I,255,g.KEEP,g.KEEP,g.REPLACE),Qi.disabled,gi.disabled,_s(S.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new Ti({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){const d=this.context.gl;return new Ti({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,m=o.sort((S,I)=>I.overscaledZ-S.overscaledZ),g=m[m.length-1].overscaledZ,v=m[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const S={};for(let I=0;I<v;I++)S[I+g]=new Ti({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=v,[S,m]}return[{[g]:Ti.disabled},m]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Qi([o.CONSTANT_COLOR,o.ONE],new l.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Qi.unblended:Qi.alphaBlended}depthModeForSublayer(o,d,m){if(!this.opaquePassEnabledForLayer())return Vt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Vt(m||this.context.gl.LEQUAL,d,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(T.now()),this.imageManager.beginFrame();const m=this.style._order,g=this.style.sourceCaches,v={},S={},I={};for(const M in g){const B=g[M];B.used&&B.prepare(this.context),v[M]=B.getVisibleCoordinates(),S[M]=v[M].slice().reverse(),I[M]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<m.length;M++)if(this.style._layers[m[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of m){const B=this.style._layers[M];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const F=S[B.source];(B.type==="custom"||F.length)&&this.renderLayer(this,g[B.source],B,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.aM.black:l.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(M,B){const F=M.context,N=F.gl,X=((pe,ge,ne)=>({u_sky_color:pe.properties.get("sky-color"),u_horizon_color:pe.properties.get("horizon-color"),u_horizon:(ge.height/2+ge.getHorizon())*ne,u_sky_horizon_blend:pe.properties.get("sky-horizon-blend")*ge.height/2*ne}))(B,M.style.map.transform,M.pixelRatio),Q=new Vt(N.LEQUAL,Vt.ReadWrite,[0,1]),te=Ti.disabled,le=M.colorModeForRenderPass(),de=M.useProgram("sky");if(!B.mesh){const pe=new l.aX;pe.emplaceBack(-1,-1),pe.emplaceBack(1,-1),pe.emplaceBack(1,1),pe.emplaceBack(-1,1);const ge=new l.aY;ge.emplaceBack(0,1,2),ge.emplaceBack(0,2,3),B.mesh=new Hu(F.createVertexBuffer(pe,Wn.members),F.createIndexBuffer(ge),l.a0.simpleSegment(0,0,pe.length,ge.length))}de.draw(F,N.TRIANGLES,Q,te,le,gi.disabled,X,void 0,"sky",B.mesh.vertexBuffer,B.mesh.indexBuffer,B.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[m[this.currentLayer]],B=g[M.source],F=v[M.source];this._renderTileClippingMasks(M,F),this.renderLayer(this,B,M,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const M=this.style._layers[m[this.currentLayer]],B=g[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const F=(M.type==="symbol"?I:S)[M.source];this._renderTileClippingMasks(M,v[M.source]),this.renderLayer(this,B,M,F)}if(this.options.showTileBoundaries){const M=function(B,F){let N=null;const X=Object.values(B._layers).flatMap(de=>de.source&&!de.isHidden(F)?[B.sourceCaches[de.source]]:[]),Q=X.filter(de=>de.getSource().type==="vector"),te=X.filter(de=>de.getSource().type!=="vector"),le=de=>{(!N||N.getSource().maxzoom<de.getSource().maxzoom)&&(N=de)};return Q.forEach(de=>le(de)),N||te.forEach(de=>le(de)),N}(this.style,this.transform.zoom);M&&function(B,F,N){for(let X=0;X<N.length;X++)ag(B,F,N[X])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const B=M.transform.padding;cl(M,M.transform.height-(B.top||0),3,cp),cl(M,B.bottom||0,3,ni),og(M,B.left||0,3,Vu),og(M,M.transform.width-(B.right||0),3,oy);const F=M.transform.centerPoint;(function(N,X,Q,te){$u(N,X-1,Q-10,2,20,te),$u(N,X-10,Q-1,20,2,te)})(M,F.x,M.transform.height-F.y,ng)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let g=this.terrainFacilitator.dirty;g||(g=o?!l.a_(d,m):!l.a$(d,m)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(l.b0(d,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,S){const I=v.context,M=I.gl,B=Qi.unblended,F=new Vt(M.LEQUAL,Vt.ReadWrite,[0,1]),N=S.getTerrainMesh(),X=S.sourceCache.getRenderableTiles(),Q=v.useProgram("terrainDepth");I.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),I.clear({color:l.aM.transparent,depth:1});for(const te of X){const le=S.getTerrainData(te.tileID),de={u_matrix:v.transform.calculatePosMatrix(te.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(v.transform.zoom)};Q.draw(I,M.TRIANGLES,F,Ti.disabled,B,gi.backCCW,de,le,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,S){const I=v.context,M=I.gl,B=Qi.unblended,F=new Vt(M.LEQUAL,Vt.ReadWrite,[0,1]),N=S.getTerrainMesh(),X=S.getCoordsTexture(),Q=S.sourceCache.getRenderableTiles(),te=v.useProgram("terrainCoords");I.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),I.clear({color:l.aM.transparent,depth:1}),S.coordsIndex=[];for(const le of Q){const de=S.getTerrainData(le.tileID);I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,X.texture);const pe={u_matrix:v.transform.calculatePosMatrix(le.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(v.transform.zoom)};te.draw(I,M.TRIANGLES,F,Ti.disabled,B,gi.backCCW,pe,de,"terrain",N.vertexBuffer,N.indexBuffer,N.segments),S.coordsIndex.push(le.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}renderLayer(o,d,m,g){if(!m.isHidden(this.transform.zoom)&&(m.type==="background"||m.type==="custom"||(g||[]).length))switch(this.id=m.id,m.type){case"symbol":(function(v,S,I,M,B){if(v.renderPass!=="translucent")return;const F=Ti.disabled,N=v.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(X,Q,te,le,de,pe,ge,ne,xe){const Ae=Q.transform,ke=Hn(),Ge=de==="map",Xe=pe==="map";for(const lt of X){const pt=le.getTile(lt),nt=pt.getBucket(te);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const it=l.ag(nt.textSizeData,Ae.zoom),yt=jt(pt,1,Q.transform.zoom),Lt=vn(lt.posMatrix,Xe,Ge,Q.transform,yt),ot=te.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(it){const ut=Math.pow(2,Ae.zoom-pt.tileID.overscaledZ),kt=Q.style.map.terrain?(Ut,Wt)=>Q.style.map.terrain.getElevation(lt,Ut,Wt):null,Mi=ke.translatePosition(Ae,pt,ge,ne);nl(nt,Ge,Xe,xe,Ae,Lt,lt.posMatrix,ut,it,ot,ke,Mi,lt.toUnwrapped(),kt)}}}(M,v,I,S,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),B),I.paint.get("icon-opacity").constantOr(1)!==0&&op(v,S,I,M,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),F,N),I.paint.get("text-opacity").constantOr(1)!==0&&op(v,S,I,M,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),F,N),S.map.showCollisionBoxes&&(Sc(v,S,I,M,!0),Sc(v,S,I,M,!1))})(o,d,m,g,this.style.placement.variableOffsets);break;case"circle":(function(v,S,I,M){if(v.renderPass!=="translucent")return;const B=I.paint.get("circle-opacity"),F=I.paint.get("circle-stroke-width"),N=I.paint.get("circle-stroke-opacity"),X=!I.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(F.constantOr(1)===0||N.constantOr(1)===0))return;const Q=v.context,te=Q.gl,le=v.depthModeForSublayer(0,Vt.ReadOnly),de=Ti.disabled,pe=v.colorModeForRenderPass(),ge=[];for(let ne=0;ne<M.length;ne++){const xe=M[ne],Ae=S.getTile(xe),ke=Ae.getBucket(I);if(!ke)continue;const Ge=ke.programConfigurations.get(I.id),Xe=v.useProgram("circle",Ge),lt=ke.layoutVertexBuffer,pt=ke.indexBuffer,nt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(xe),it={programConfiguration:Ge,program:Xe,layoutVertexBuffer:lt,indexBuffer:pt,uniformValues:ns(v,xe,Ae,I),terrainData:nt};if(X){const yt=ke.segments.get();for(const Lt of yt)ge.push({segments:new l.a0([Lt]),sortKey:Lt.sortKey,state:it})}else ge.push({segments:ke.segments,sortKey:0,state:it})}X&&ge.sort((ne,xe)=>ne.sortKey-xe.sortKey);for(const ne of ge){const{programConfiguration:xe,program:Ae,layoutVertexBuffer:ke,indexBuffer:Ge,uniformValues:Xe,terrainData:lt}=ne.state;Ae.draw(Q,te.TRIANGLES,le,de,pe,gi.disabled,Xe,lt,I.id,ke,Ge,ne.segments,I.paint,v.transform.zoom,xe)}})(o,d,m,g);break;case"heatmap":(function(v,S,I,M){if(I.paint.get("heatmap-opacity")===0)return;const B=v.context;if(v.style.map.terrain){for(const F of M){const N=S.getTile(F);S.hasRenderableParent(F)||(v.renderPass==="offscreen"?lp(v,N,I,F):v.renderPass==="translucent"&&Aa(v,I,F))}B.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?function(F,N,X,Q){const te=F.context,le=te.gl,de=Ti.disabled,pe=new Qi([le.ONE,le.ONE],l.aM.transparent,[!0,!0,!0,!0]);(function(ge,ne,xe){const Ae=ge.gl;ge.activeTexture.set(Ae.TEXTURE1),ge.viewport.set([0,0,ne.width/4,ne.height/4]);let ke=xe.heatmapFbos.get(l.aU);ke?(Ae.bindTexture(Ae.TEXTURE_2D,ke.colorAttachment.get()),ge.bindFramebuffer.set(ke.framebuffer)):(ke=Ic(ge,ne.width/4,ne.height/4),xe.heatmapFbos.set(l.aU,ke))})(te,F,X),te.clear({color:l.aM.transparent});for(let ge=0;ge<Q.length;ge++){const ne=Q[ge];if(N.hasRenderableParent(ne))continue;const xe=N.getTile(ne),Ae=xe.getBucket(X);if(!Ae)continue;const ke=Ae.programConfigurations.get(X.id),Ge=F.useProgram("heatmap",ke),{zoom:Xe}=F.transform;Ge.draw(te,le.TRIANGLES,Vt.disabled,de,pe,gi.disabled,ys(ne.posMatrix,xe,Xe,X.paint.get("heatmap-intensity")),null,X.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,X.paint,F.transform.zoom,ke)}te.viewport.set([0,0,F.width,F.height])}(v,S,I,M):v.renderPass==="translucent"&&function(F,N){const X=F.context,Q=X.gl;X.setColorMode(F.colorModeForRenderPass());const te=N.heatmapFbos.get(l.aU);te&&(X.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,te.colorAttachment.get()),X.activeTexture.set(Q.TEXTURE1),Rc(X,N).bind(Q.LINEAR,Q.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(X,Q.TRIANGLES,Vt.disabled,Ti.disabled,F.colorModeForRenderPass(),gi.disabled,Bu(F,N,0,1),null,N.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,N.paint,F.transform.zoom))}(v,I)})(o,d,m,g);break;case"line":(function(v,S,I,M){if(v.renderPass!=="translucent")return;const B=I.paint.get("line-opacity"),F=I.paint.get("line-width");if(B.constantOr(1)===0||F.constantOr(1)===0)return;const N=v.depthModeForSublayer(0,Vt.ReadOnly),X=v.colorModeForRenderPass(),Q=I.paint.get("line-dasharray"),te=I.paint.get("line-pattern"),le=te.constantOr(1),de=I.paint.get("line-gradient"),pe=I.getCrossfadeParameters(),ge=le?"linePattern":Q?"lineSDF":de?"lineGradient":"line",ne=v.context,xe=ne.gl;let Ae=!0;for(const ke of M){const Ge=S.getTile(ke);if(le&&!Ge.patternsLoaded())continue;const Xe=Ge.getBucket(I);if(!Xe)continue;const lt=Xe.programConfigurations.get(I.id),pt=v.context.program.get(),nt=v.useProgram(ge,lt),it=Ae||nt.program!==pt,yt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ke),Lt=te.constantOr(null);if(Lt&&Ge.imageAtlas){const kt=Ge.imageAtlas,Mi=kt.patternPositions[Lt.to.toString()],Ut=kt.patternPositions[Lt.from.toString()];Mi&&Ut&&lt.setConstantPatternPositions(Mi,Ut)}const ot=yt?ke:null,ut=le?rl(v,Ge,I,pe,ot):Q?W1(v,Ge,I,Q,pe,ot):de?Gm(v,Ge,I,Xe.lineClipsArray.length,ot):Ou(v,Ge,I,ot);if(le)ne.activeTexture.set(xe.TEXTURE0),Ge.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),lt.updatePaintBuffers(pe);else if(Q&&(it||v.lineAtlas.dirty))ne.activeTexture.set(xe.TEXTURE0),v.lineAtlas.bind(ne);else if(de){const kt=Xe.gradients[I.id];let Mi=kt.texture;if(I.gradientVersion!==kt.version){let Ut=256;if(I.stepInterpolant){const Wt=S.getSource().maxzoom,Pi=ke.canonical.z===Wt?Math.ceil(1<<v.transform.maxZoom-ke.canonical.z):1;Ut=l.ac(l.aV(Xe.maxLineLength/l.X*1024*Pi),256,ne.maxTextureSize)}kt.gradient=l.aW({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:Ut,image:kt.gradient||void 0,clips:Xe.lineClipsArray}),kt.texture?kt.texture.update(kt.gradient):kt.texture=new ze(ne,kt.gradient,xe.RGBA),kt.version=I.gradientVersion,Mi=kt.texture}ne.activeTexture.set(xe.TEXTURE0),Mi.bind(I.stepInterpolant?xe.NEAREST:xe.LINEAR,xe.CLAMP_TO_EDGE)}nt.draw(ne,xe.TRIANGLES,N,v.stencilModeForClipping(ke),X,gi.disabled,ut,yt,I.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,I.paint,v.transform.zoom,lt,Xe.layoutVertexBuffer2),Ae=!1}})(o,d,m,g);break;case"fill":(function(v,S,I,M){const B=I.paint.get("fill-color"),F=I.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const N=v.colorModeForRenderPass(),X=I.paint.get("fill-pattern"),Q=v.opaquePassEnabledForLayer()&&!X.constantOr(1)&&B.constantOr(l.aM.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===Q){const te=v.depthModeForSublayer(1,v.renderPass==="opaque"?Vt.ReadWrite:Vt.ReadOnly);Mc(v,S,I,M,te,N,!1)}if(v.renderPass==="translucent"&&I.paint.get("fill-antialias")){const te=v.depthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly);Mc(v,S,I,M,te,N,!0)}})(o,d,m,g);break;case"fill-extrusion":(function(v,S,I,M){const B=I.paint.get("fill-extrusion-opacity");if(B!==0&&v.renderPass==="translucent"){const F=new Vt(v.context.gl.LEQUAL,Vt.ReadWrite,v.depthRangeFor3D);if(B!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))Gu(v,S,I,M,F,Ti.disabled,Qi.disabled),Gu(v,S,I,M,F,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const N=v.colorModeForRenderPass();Gu(v,S,I,M,F,Ti.disabled,N)}}})(o,d,m,g);break;case"hillshade":(function(v,S,I,M){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const B=v.context,F=v.depthModeForSublayer(0,Vt.ReadOnly),N=v.colorModeForRenderPass(),[X,Q]=v.renderPass==="translucent"?v.stencilConfigForOverlap(M):[{},M];for(const te of Q){const le=S.getTile(te);le.needsHillshadePrepare!==void 0&&le.needsHillshadePrepare&&v.renderPass==="offscreen"?ll(v,le,I,F,Ti.disabled,N):v.renderPass==="translucent"&&al(v,te,le,I,F,X[te.overscaledZ],N)}B.viewport.set([0,0,v.width,v.height])})(o,d,m,g);break;case"raster":(function(v,S,I,M){if(v.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!M.length)return;const B=v.context,F=B.gl,N=S.getSource(),X=v.useProgram("raster"),Q=v.colorModeForRenderPass(),[te,le]=N instanceof _n?[{},M]:v.stencilConfigForOverlap(M),de=le[le.length-1].overscaledZ,pe=!v.options.moving;for(const ge of le){const ne=v.depthModeForSublayer(ge.overscaledZ-de,I.paint.get("raster-opacity")===1?Vt.ReadWrite:Vt.ReadOnly,F.LESS),xe=S.getTile(ge);xe.registerFadeDuration(I.paint.get("raster-fade-duration"));const Ae=S.findLoadedParent(ge,0),ke=S.findLoadedSibling(ge),Ge=sg(xe,Ae||ke||null,S,I,v.transform,v.style.map.terrain);let Xe,lt;const pt=I.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;B.activeTexture.set(F.TEXTURE0),xe.texture.bind(pt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(F.TEXTURE1),Ae?(Ae.texture.bind(pt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Xe=Math.pow(2,Ae.tileID.overscaledZ-xe.tileID.overscaledZ),lt=[xe.tileID.canonical.x*Xe%1,xe.tileID.canonical.y*Xe%1]):xe.texture.bind(pt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),xe.texture.useMipmap&&B.extTextureFilterAnisotropic&&v.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const nt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ge),it=nt?ge:null,yt=it?it.posMatrix:v.transform.calculatePosMatrix(ge.toUnwrapped(),pe),Lt=X1(yt,lt||[0,0],Xe||1,Ge,I);N instanceof _n?X.draw(B,F.TRIANGLES,ne,Ti.disabled,Q,gi.disabled,Lt,nt,I.id,N.boundsBuffer,v.quadTriangleIndexBuffer,N.boundsSegments):X.draw(B,F.TRIANGLES,ne,te[ge.overscaledZ],Q,gi.disabled,Lt,nt,I.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(o,d,m,g);break;case"background":(function(v,S,I,M){const B=I.paint.get("background-color"),F=I.paint.get("background-opacity");if(F===0)return;const N=v.context,X=N.gl,Q=v.transform,te=Q.tileSize,le=I.paint.get("background-pattern");if(v.isPatternMissing(le))return;const de=!le&&B.a===1&&F===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==de)return;const pe=Ti.disabled,ge=v.depthModeForSublayer(0,de==="opaque"?Vt.ReadWrite:Vt.ReadOnly),ne=v.colorModeForRenderPass(),xe=v.useProgram(le?"backgroundPattern":"background"),Ae=M||Q.coveringTiles({tileSize:te,terrain:v.style.map.terrain});le&&(N.activeTexture.set(X.TEXTURE0),v.imageManager.bind(v.context));const ke=I.getCrossfadeParameters();for(const Ge of Ae){const Xe=M?Ge.posMatrix:v.transform.calculatePosMatrix(Ge.toUnwrapped()),lt=le?Kd(Xe,F,v,le,{tileID:Ge,tileSize:te},ke):Du(Xe,F,B),pt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ge);xe.draw(N,X.TRIANGLES,ge,pe,ne,gi.disabled,lt,pt,I.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(o,0,m,g);break;case"custom":(function(v,S,I){const M=v.context,B=I.implementation;if(v.renderPass==="offscreen"){const F=B.prerender;F&&(v.setCustomLayerDefaults(),M.setColorMode(v.colorModeForRenderPass()),F.call(B,M.gl,v.transform.customLayerMatrix()),M.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),M.setColorMode(v.colorModeForRenderPass()),M.setStencilMode(Ti.disabled);const F=B.renderingMode==="3d"?new Vt(v.context.gl.LEQUAL,Vt.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,Vt.ReadOnly);M.setDepthMode(F),B.render(M.gl,v.transform.customLayerMatrix(),{farZ:v.transform.farZ,nearZ:v.transform.nearZ,fov:v.transform._fov,modelViewProjectionMatrix:v.transform.modelViewProjectionMatrix,projectionMatrix:v.transform.projectionMatrix}),M.setDirty(),v.setBaseState(),M.bindFramebuffer.set(null)}})(o,0,m)}}translatePosMatrix(o,d,m,g,v){if(!m[0]&&!m[1])return o;const S=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(S){const B=Math.sin(S),F=Math.cos(S);m=[m[0]*F-m[1]*B,m[0]*B+m[1]*F]}const I=[v?m[0]:jt(d,m[0],this.transform.zoom),v?m[1]:jt(d,m[1],this.transform.zoom),0],M=new Float32Array(16);return l.J(M,o,I),M}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),m=this.imageManager.getPattern(o.to.toString());return!d||!m}useProgram(o,d){this.cache=this.cache||{};const m=o+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new ie(this.context,Js[o],d,Jd[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ze(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:d}=this.context.gl;return this.width!==o||this.height!==d}}class ul{constructor(o,d){this.points=o,this.planes=d}static fromInvProjectionMatrix(o,d,m){const g=Math.pow(2,m),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const M=1/(I=l.af([],I,o))[3]/d*g;return l.b1(I,I,[M,M,1/I[3],M])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const M=function(X,Q){var te=Q[0],le=Q[1],de=Q[2],pe=te*te+le*le+de*de;return pe>0&&(pe=1/Math.sqrt(pe)),X[0]=Q[0]*pe,X[1]=Q[1]*pe,X[2]=Q[2]*pe,X}([],function(X,Q,te){var le=Q[0],de=Q[1],pe=Q[2],ge=te[0],ne=te[1],xe=te[2];return X[0]=de*xe-pe*ne,X[1]=pe*ge-le*xe,X[2]=le*ne-de*ge,X}([],be([],v[I[0]],v[I[1]]),be([],v[I[2]],v[I[1]]))),B=-((F=M)[0]*(N=v[I[1]])[0]+F[1]*N[1]+F[2]*N[2]);var F,N;return M.concat(B)});return new ul(v,S)}}class hl{constructor(o,d){this.min=o,this.max=d,this.center=function(m,g,v){return m[0]=.5*g[0],m[1]=.5*g[1],m[2]=.5*g[2],m}([],function(m,g,v){return m[0]=g[0]+v[0],m[1]=g[1]+v[1],m[2]=g[2]+v[2],m}([],this.min,this.max))}quadrant(o){const d=[o%2==0,o<2],m=we(this.min),g=we(this.max);for(let v=0;v<d.length;v++)m[v]=d[v]?this.min[v]:this.center[v],g[v]=d[v]?this.center[v]:this.max[v];return g[2]=this.max[2],new hl(m,g)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let g=0;g<o.planes.length;g++){const v=o.planes[g];let S=0;for(let I=0;I<d.length;I++)l.b2(v,d[I])>=0&&S++;if(S===0)return 0;S!==d.length&&(m=!1)}if(m)return 2;for(let g=0;g<3;g++){let v=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let I=0;I<o.points.length;I++){const M=o.points[I][g]-this.min[g];v=Math.min(v,M),S=Math.max(S,M)}if(S<0||v>this.max[g]-this.min[g])return 0}return 1}}class dl{constructor(o=0,d=0,m=0,g=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(m)||m<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=m,this.right=g}interpolate(o,d,m){return d.top!=null&&o.top!=null&&(this.top=l.y.number(o.top,d.top,m)),d.bottom!=null&&o.bottom!=null&&(this.bottom=l.y.number(o.bottom,d.bottom,m)),d.left!=null&&o.left!=null&&(this.left=l.y.number(o.left,d.left,m)),d.right!=null&&o.right!=null&&(this.right=l.y.number(o.right,d.right,m)),this}getCenter(o,d){const m=l.ac((this.left+o-this.right)/2,0,o),g=l.ac((this.top+d-this.bottom)/2,0,d);return new l.P(m,g)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new dl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const up=85.051129;class pl{constructor(o,d,m,g,v){this.tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new dl,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new pl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.lngRange=o.lngRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const d=-l.b3(o,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var m=new l.A(4);return l.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}(),function(m,g,v){var S=g[0],I=g[1],M=g[2],B=g[3],F=Math.sin(v),N=Math.cos(v);m[0]=S*N+M*F,m[1]=I*N+B*F,m[2]=S*-F+M*N,m[3]=I*-F+B*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=l.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,m){this._unmodified=!1,this._edgeInsets.interpolate(o,d,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new l.b4(0,o)];if(this._renderWorldCopies){const m=this.pointCoordinate(new l.P(0,0)),g=this.pointCoordinate(new l.P(this.width,0)),v=this.pointCoordinate(new l.P(this.width,this.height)),S=this.pointCoordinate(new l.P(0,this.height)),I=Math.floor(Math.min(m.x,g.x,v.x,S.x)),M=Math.floor(Math.max(m.x,g.x,v.x,S.x)),B=1;for(let F=I-B;F<=M+B;F++)F!==0&&d.push(new l.b4(F,o))}return d}coveringTiles(o){var d,m;let g=this.coveringZoomLevel(o);const v=g;if(o.minzoom!==void 0&&g<o.minzoom)return[];o.maxzoom!==void 0&&g>o.maxzoom&&(g=o.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),I=l.Z.fromLngLat(this.center),M=Math.pow(2,g),B=[M*S.x,M*S.y,0],F=[M*I.x,M*I.y,0],N=ul.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,g);let X=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(X=g);const Q=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,te=ne=>({aabb:new hl([ne*M,0,0],[(ne+1)*M,M,0]),zoom:0,x:0,y:0,wrap:ne,fullyVisible:!1}),le=[],de=[],pe=g,ge=o.reparseOverscaled?v:g;if(this._renderWorldCopies)for(let ne=1;ne<=3;ne++)le.push(te(-ne)),le.push(te(ne));for(le.push(te(0));le.length>0;){const ne=le.pop(),xe=ne.x,Ae=ne.y;let ke=ne.fullyVisible;if(!ke){const nt=ne.aabb.intersects(N);if(nt===0)continue;ke=nt===2}const Ge=o.terrain?B:F,Xe=ne.aabb.distanceX(Ge),lt=ne.aabb.distanceY(Ge),pt=Math.max(Math.abs(Xe),Math.abs(lt));if(ne.zoom===pe||pt>Q+(1<<pe-ne.zoom)-2&&ne.zoom>=X){const nt=pe-ne.zoom,it=B[0]-.5-(xe<<nt),yt=B[1]-.5-(Ae<<nt);de.push({tileID:new l.S(ne.zoom===pe?ge:ne.zoom,ne.wrap,ne.zoom,xe,Ae),distanceSq:me([F[0]-.5-xe,F[1]-.5-Ae]),tileDistanceToCamera:Math.sqrt(it*it+yt*yt)})}else for(let nt=0;nt<4;nt++){const it=(xe<<1)+nt%2,yt=(Ae<<1)+(nt>>1),Lt=ne.zoom+1;let ot=ne.aabb.quadrant(nt);if(o.terrain){const ut=new l.S(Lt,ne.wrap,Lt,it,yt),kt=o.terrain.getMinMaxElevation(ut),Mi=(d=kt.minElevation)!==null&&d!==void 0?d:this.elevation,Ut=(m=kt.maxElevation)!==null&&m!==void 0?m:this.elevation;ot=new hl([ot.min[0],ot.min[1],Mi],[ot.max[0],ot.max[1],Ut])}le.push({aabb:ot,zoom:Lt,x:it,y:yt,wrap:ne.wrap,fullyVisible:ke})}}return de.sort((ne,xe)=>ne.distanceSq-xe.distanceSq).map(ne=>ne.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=l.ac(o.lat,-85.051129,up);return new l.P(l.O(o.lng)*this.worldSize,l.Q(d)*this.worldSize)}unproject(o){return new l.Z(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const d=this.elevation,m=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,o),v=o.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-v))return;const S=m+d-v,I=Math.cos(this._pitch)*this.cameraToCenterDistance/S/l.b5(1,g.lat),M=this.scaleZoom(I/this.tileSize);this._elevation=v,this._center=g,this.zoom=M}setLocationAtPoint(o,d){const m=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(o),S=new l.Z(v.x-(m.x-g.x),v.y-(m.y-g.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,d){return d?this.coordinatePoint(this.locationCoordinate(o),d.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,d){return this.coordinateLocation(this.pointCoordinate(o,d))}locationCoordinate(o){return l.Z.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,d){if(d){const X=d.pointCoordinate(o);if(X!=null)return X}const m=[o.x,o.y,0,1],g=[o.x,o.y,1,1];l.af(m,m,this.pixelMatrixInverse),l.af(g,g,this.pixelMatrixInverse);const v=m[3],S=g[3],I=m[1]/v,M=g[1]/S,B=m[2]/v,F=g[2]/S,N=B===F?0:(0-B)/(F-B);return new l.Z(l.y.number(m[0]/v,g[0]/S,N)/this.worldSize,l.y.number(I,M,N)/this.worldSize)}coordinatePoint(o,d=0,m=this.pixelMatrix){const g=[o.x*this.worldSize,o.y*this.worldSize,d,1];return l.af(g,g,m),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new Oe().extend(this.pointLocation(new l.P(0,o))).extend(this.pointLocation(new l.P(this.width,o))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Oe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,up])}calculateTileMatrix(o){const d=o.canonical,m=this.worldSize/this.zoomScale(d.z),g=d.x+Math.pow(2,d.z)*o.wrap,v=l.an(new Float64Array(16));return l.J(v,v,[g*m,d.y*m,0]),l.K(v,v,[m/l.X,m/l.X,1]),v}calculatePosMatrix(o,d=!1){const m=o.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[m])return g[m];const v=this.calculateTileMatrix(o);return l.L(v,d?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,v),g[m]=new Float32Array(v),g[m]}calculateFogMatrix(o){const d=o.key,m=this._fogMatrixCache;if(m[d])return m[d];const g=this.calculateTileMatrix(o);return l.L(g,this.fogMatrix,g),m[d]=new Float32Array(g),m[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,d){d=l.ac(+d,this.minZoom,this.maxZoom);const m={center:new l.N(o.lng,o.lat),zoom:d};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const ne=179.9999999999;g=[-ne,ne]}const v=this.tileSize*this.zoomScale(m.zoom);let S=0,I=v,M=0,B=v,F=0,N=0;const{x:X,y:Q}=this.size;if(this.latRange){const ne=this.latRange;S=l.Q(ne[1])*v,I=l.Q(ne[0])*v,I-S<Q&&(F=Q/(I-S))}g&&(M=l.b3(l.O(g[0])*v,0,v),B=l.b3(l.O(g[1])*v,0,v),B<M&&(B+=v),B-M<X&&(N=X/(B-M)));const{x:te,y:le}=this.project.call({worldSize:v},o);let de,pe;const ge=Math.max(N||0,F||0);if(ge){const ne=new l.P(N?(B+M)/2:te,F?(I+S)/2:le);return m.center=this.unproject.call({worldSize:v},ne).wrap(),m.zoom+=this.scaleZoom(ge),m}if(this.latRange){const ne=Q/2;le-ne<S&&(pe=S+ne),le+ne>I&&(pe=I-ne)}if(g){const ne=(M+B)/2;let xe=te;this._renderWorldCopies&&(xe=l.b3(te,ne-v/2,ne+v/2));const Ae=X/2;xe-Ae<M&&(de=M+Ae),xe+Ae>B&&(de=B-Ae)}if(de!==void 0||pe!==void 0){const ne=new l.P(de??te,pe??le);m.center=this.unproject.call({worldSize:v},ne).wrap()}return m}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:d,zoom:m}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=m,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b5(1,this.center.lat)*this.worldSize;let g=l.an(new Float64Array(16));l.K(g,g,[this.width/2,-this.height/2,1]),l.J(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.an(new Float64Array(16)),l.K(g,g,[1,-1,1]),l.J(g,g,[-1,-1,0]),l.K(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this.minElevationForCurrentTile),I=v-S*this._pixelPerMeter/Math.cos(this._pitch),M=S<0?I:v,B=Math.PI/2+this._pitch,F=this._fov*(.5+o.y/this.height),N=Math.sin(F)*M/Math.sin(l.ac(Math.PI-B-F,.01,Math.PI-.01)),X=this.getHorizon(),Q=2*Math.atan(X/this.cameraToCenterDistance)*(.5+o.y/(2*X)),te=Math.sin(Q)*M/Math.sin(l.ac(Math.PI-B-Q,.01,Math.PI-.01)),le=Math.min(N,te);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*le+M),this.nearZ=this.height/50,g=new Float64Array(16),l.b6(g,this._fov,this.width/this.height,this.nearZ,this.farZ),g[8]=2*-o.x/this.width,g[9]=2*o.y/this.height,this.projectionMatrix=l.ae(g),l.K(g,g,[1,-1,1]),l.J(g,g,[0,0,-this.cameraToCenterDistance]),l.b7(g,g,this._pitch),l.ad(g,g,this.angle),l.J(g,g,[-d,-m,0]),this.mercatorMatrix=l.K([],g,[this.worldSize,this.worldSize,this.worldSize]),l.K(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.L(new Float64Array(16),this.labelPlaneMatrix,g),l.J(g,g,[0,0,-this.elevation]),this.modelViewProjectionMatrix=g,this.invModelViewProjectionMatrix=l.as([],g),this.fogMatrix=new Float64Array(16),l.b6(this.fogMatrix,this._fov,this.width/this.height,v,this.farZ),this.fogMatrix[8]=2*-o.x/this.width,this.fogMatrix[9]=2*o.y/this.height,l.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b7(this.fogMatrix,this.fogMatrix,this._pitch),l.ad(this.fogMatrix,this.fogMatrix,this.angle),l.J(this.fogMatrix,this.fogMatrix,[-d,-m,0]),l.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=l.L(new Float64Array(16),this.labelPlaneMatrix,g);const de=this.width%2/2,pe=this.height%2/2,ge=Math.cos(this.angle),ne=Math.sin(this.angle),xe=d-Math.round(d)+ge*de+ne*pe,Ae=m-Math.round(m)+ge*pe+ne*de,ke=new Float64Array(g);if(l.J(ke,ke,[xe>.5?xe-1:xe,Ae>.5?Ae-1:Ae,0]),this.alignedModelViewProjectionMatrix=ke,g=l.as(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new l.P(0,0)),d=[o.x*this.worldSize,o.y*this.worldSize,0,1];return l.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,o))}getCameraQueryGeometry(o){const d=this.getCameraPoint();if(o.length===1)return[o[0],d];{let m=d.x,g=d.y,v=d.x,S=d.y;for(const I of o)m=Math.min(m,I.x),g=Math.min(g,I.y),v=Math.max(v,I.x),S=Math.max(S,I.y);return[new l.P(m,g),new l.P(v,g),new l.P(v,S),new l.P(m,S),new l.P(m,g)]}}lngLatToCameraDepth(o,d){const m=this.locationCoordinate(o),g=[m.x*this.worldSize,m.y*this.worldSize,d,1];return l.af(g,g,this.modelViewProjectionMatrix),g[2]/g[3]}}function Pc(b,o){let d,m=!1,g=null,v=null;const S=()=>{g=null,m&&(b.apply(v,d),g=setTimeout(S,o),m=!1)};return(...I)=>(m=!0,v=this,d=I,g||S(),g)}class Wu{constructor(o){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let m;return d.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(m=g)}),(m&&m[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:m,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const m=d.join("/");let g=m;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${m}`);let v=window.location.hash.replace(g,"");v.startsWith("#&")?v=v.slice(0,1)+v.slice(2):v==="#"&&(v="");let S=window.location.href.replace(/(#.+)?$/,v);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=Pc(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const d=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,g=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),S=Math.round(d.lng*v)/v,I=Math.round(d.lat*v)/v,M=this._map.getBearing(),B=this._map.getPitch();let F="";if(F+=o?`/${S}/${I}/${m}`:`${m}/${I}/${S}`,(M||B)&&(F+="/"+Math.round(10*M)/10),B&&(F+=`/${Math.round(B)}`),this._hashName){const N=this._hashName;let X=!1;const Q=window.location.hash.slice(1).split("&").map(te=>{const le=te.split("=")[0];return le===N?(X=!0,`${le}=${F}`):te}).filter(te=>te);return X||Q.push(`${N}=${F}`),`#${Q.join("&")}`}return`#${F}`}}const Xu={linearity:.3,easing:l.b8(0,0,.3,1)},hp=l.e({deceleration:2500,maxSpeed:1400},Xu),ay=l.e({deceleration:20,maxSpeed:1400},Xu),cg=l.e({deceleration:1e3,maxSpeed:360},Xu),Ku=l.e({deceleration:1e3,maxSpeed:90},Xu);class dp{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:T.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=T.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)d.zoom+=v.zoomDelta||0,d.bearing+=v.bearingDelta||0,d.pitch+=v.pitchDelta||0,v.panDelta&&d.pan._add(v.panDelta),v.around&&(d.around=v.around),v.pinchAround&&(d.pinchAround=v.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(d.pan.mag()){const v=Bc(d.pan.mag(),m,l.e({},hp,o||{}));g.offset=d.pan.mult(v.amount/d.pan.mag()),g.center=this._map.transform.center,kc(g,v)}if(d.zoom){const v=Bc(d.zoom,m,ay);g.zoom=this._map.transform.zoom+v.amount,kc(g,v)}if(d.bearing){const v=Bc(d.bearing,m,cg);g.bearing=this._map.transform.bearing+l.ac(v.amount,-179,179),kc(g,v)}if(d.pitch){const v=Bc(d.pitch,m,Ku);g.pitch=this._map.transform.pitch+v.amount,kc(g,v)}if(g.zoom||g.bearing){const v=d.pinchAround===void 0?d.around:d.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function kc(b,o){(!b.duration||b.duration<o.duration)&&(b.duration=o.duration,b.easing=o.easing)}function Bc(b,o,d){const{maxSpeed:m,linearity:g,deceleration:v}=d,S=l.ac(b*g/(o/1e3),-m,m),I=Math.abs(S)/(v*g);return{easing:d.easing,duration:1e3*I,amount:S*(I/2)}}class Gr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,m,g={}){const v=R.mousePos(d.getCanvas(),m),S=d.unproject(v);super(o,l.e({point:v,lngLat:S,originalEvent:m},g)),this._defaultPrevented=!1,this.target=d}}class Ta extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,m){const g=o==="touchend"?m.changedTouches:m.touches,v=R.touchPos(d.getCanvasContainer(),g),S=v.map(M=>d.unproject(M)),I=v.reduce((M,B,F,N)=>M.add(B.div(N.length)),new l.P(0,0));super(o,{points:v,point:I,lngLats:S,lngLat:d.unproject(I),originalEvent:m}),this._defaultPrevented=!1}}class ug extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,m){super(o,{originalEvent:m}),this._defaultPrevented=!1}}class hg{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new ug(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new Gr(o.type,this._map,o))}mouseup(o){this._map.fire(new Gr(o.type,this._map,o))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Gr(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Gr(o.type,this._map,o))}mouseover(o){this._map.fire(new Gr(o.type,this._map,o))}mouseout(o){this._map.fire(new Gr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Ta(o.type,this._map,o))}touchmove(o){this._map.fire(new Ta(o.type,this._map,o))}touchend(o){this._map.fire(new Ta(o.type,this._map,o))}touchcancel(o){this._map.fire(new Ta(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class er{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Gr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Gr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bn{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(l.P.convert(o),this._map.terrain)}}class Ns{constructor(o,d){this._map=o,this._tr=new bn(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(R.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const m=d;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=m,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const v=Math.min(g.x,m.x),S=Math.max(g.x,m.x),I=Math.min(g.y,m.y),M=Math.max(g.y,m.y);R.setTransform(this._box,`translate(${v}px,${I}px)`),this._box.style.width=S-v+"px",this._box.style.height=M-I+"px"}mouseupWindow(o,d){if(!this._active||o.button!==0)return;const m=this._startPos,g=d;if(this.reset(),R.suppressClick(),m.x!==g.x||m.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:o})),{cameraAnimation:v=>v.fitScreenCoordinates(m,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new l.k(o,{originalEvent:d}))}}function Lc(b,o){if(b.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${o.length}`);const d={};for(let m=0;m<b.length;m++)d[b[m].identifier]=o[m];return d}class pp{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,d,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),m.length===this.numTouches&&(this.centroid=function(g){const v=new l.P(0,0);for(const S of g)v._add(S);return v.div(g.length)}(d),this.touches=Lc(m,d)))}touchmove(o,d,m){if(this.aborted||!this.centroid)return;const g=Lc(m,d);for(const v in this.touches){const S=g[v];(!S||S.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(o,d,m){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Ju{constructor(o){this.singleTap=new pp(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,d,m){this.singleTap.touchstart(o,d,m)}touchmove(o,d,m){this.singleTap.touchmove(o,d,m)}touchend(o,d,m){const g=this.singleTap.touchend(o,d,m);if(g){const v=o.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(g)<30;if(v&&S||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class fl{constructor(o){this._tr=new bn(o),this._zoomIn=new Ju({numTouches:1,numTaps:2}),this._zoomOut=new Ju({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,m){this._zoomIn.touchstart(o,d,m),this._zoomOut.touchstart(o,d,m)}touchmove(o,d,m){this._zoomIn.touchmove(o,d,m),this._zoomOut.touchmove(o,d,m)}touchend(o,d,m){const g=this._zoomIn.touchend(o,d,m),v=this._zoomOut.touchend(o,d,m),S=this._tr;return g?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(g)},{originalEvent:o})}):v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(v)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class go{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const d=this._moveFunction(...o);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(o,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,d){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const g=d.length?d[0]:d;return!this._moved&&g.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(m,g))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&R.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const fp={0:1,2:2};class Zu{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const d=R.mouseButton(o);this._eventButton=d}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(d,m){const g=fp[m];return d.buttons===void 0||(d.buttons&g)!==g}(o,this._eventButton)}isValidEndEvent(o){return R.mouseButton(o)===this._eventButton}}class mp{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const Yu=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=o=>{o.preventDefault()}},gp=({enable:b,clickTolerance:o,bearingDegreesPerPixelMoved:d=.8})=>{const m=new Zu({checkCorrectEvent:g=>R.mouseButton(g)===0&&g.ctrlKey||R.mouseButton(g)===2});return new go({clickTolerance:o,move:(g,v)=>({bearingDelta:(v.x-g.x)*d}),moveStateManager:m,enable:b,assignEvents:Yu})},_p=({enable:b,clickTolerance:o,pitchDegreesPerPixelMoved:d=-.5})=>{const m=new Zu({checkCorrectEvent:g=>R.mouseButton(g)===0&&g.ctrlKey||R.mouseButton(g)===2});return new go({clickTolerance:o,move:(g,v)=>({pitchDelta:(v.y-g.y)*d}),moveStateManager:m,enable:b,assignEvents:Yu})};class Sa{constructor(o,d){this._clickTolerance=o.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,d,m){return this._calculateTransform(o,d,m)}touchmove(o,d,m){if(this._active){if(!this._shouldBePrevented(m.length))return o.preventDefault(),this._calculateTransform(o,d,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,d,m){this._calculateTransform(o,d,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,m){m.length>0&&(this._active=!0);const g=Lc(m,d),v=new l.P(0,0),S=new l.P(0,0);let I=0;for(const B in g){const F=g[B],N=this._touches[B];N&&(v._add(F),S._add(F.sub(N)),I++,g[B]=F)}if(this._touches=g,this._shouldBePrevented(I)||!S.mag())return;const M=S.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(I),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,d,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,m){if(!this._firstTwoTouches)return;o.preventDefault();const[g,v]=this._firstTwoTouches,S=Oc(m,d,g),I=Oc(m,d,v);if(!S||!I)return;const M=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],M,o)}touchend(o,d,m){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,S=Oc(m,d,g),I=Oc(m,d,v);S&&I||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Oc(b,o,d){for(let m=0;m<b.length;m++)if(b[m].identifier===d)return o[m]}function yp(b,o){return Math.log(b/o)/Math.LN2}class vp extends Qu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const m=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(yp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yp(this._distance,m),pinchAround:d}}}function bp(b,o){return 180*b.angleWith(o)/Math.PI}class wp extends Qu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d,m){const g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bp(this._vector,g),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,m=bp(o,this._startVector);return Math.abs(m)<d}}function eh(b){return Math.abs(b.y)>Math.abs(b.x)}class ml extends Qu{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,d,m){super.touchstart(o,d,m),this._currentTouchCount=m.length}_start(o){this._lastPoints=o,eh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=o[0].sub(this._lastPoints[0]),v=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,v,m.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(g.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(o,d,m){if(this._valid!==void 0)return this._valid;const g=o.mag()>=2,v=d.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=o.y>0==d.y>0;return eh(o)&&eh(d)&&S}}const dg={panStep:100,bearingStep:15,pitchStep:10};class Ys{constructor(o){this._tr=new bn(o);const d=dg;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,m=0,g=0,v=0,S=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?m=-1:(o.preventDefault(),v=-1);break;case 39:o.shiftKey?m=1:(o.preventDefault(),v=1);break;case 38:o.shiftKey?g=1:(o.preventDefault(),S=-1);break;case 40:o.shiftKey?g=-1:(o.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,g=0),{cameraAnimation:I=>{const M=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:Kn,zoom:d?Math.round(M.zoom)+d*(o.shiftKey?2:1):M.zoom,bearing:M.bearing+m*this._bearingStep,pitch:M.pitch+g*this._pitchStep,offset:[-v*this._panStep,-S*this._panStep],center:M.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Kn(b){return b*(2-b)}const xp=4.000244140625;class wn{constructor(o,d){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=o,this._tr=new bn(o),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const m=T.now(),g=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,d!==0&&d%xp==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=R.mousePos(this._map.getCanvas(),o),m=this._tr;this._around=d.y>m.transform.height/2-m.transform.getHorizon()?l.N.convert(this._aroundCenter?m.center:m.unproject(d)):l.N.convert(m.center),this._aroundPoint=m.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>xp?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&B!==0&&(B=1/B);const F=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(F*B))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,m=this._startZoom,g=this._easing;let v,S=!1;const I=T.now()-this._lastWheelEventTime;if(this._type==="wheel"&&m&&g&&I){const M=Math.min(I/200,1),B=g(M);v=l.y.number(m,d,B),M<1?this._frameId||(this._frameId=!0):S=!0}else v=d,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:v-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=l.b9;if(this._prevEase){const m=this._prevEase,g=(T.now()-m.start)/m.duration,v=m.easing(g+.01)-m.easing(g),S=.27/Math.sqrt(v*v+1e-4)*.01,I=Math.sqrt(.0729-S*S);d=l.b8(S,I,.25,1)}return this._prevEase={start:T.now(),duration:o,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ca{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ly{constructor(o){this._tr=new bn(o),this.reset()}reset(){this._active=!1}dblclick(o,d){return o.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cy{constructor(){this._tap=new Ju({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,d,m){if(!this._swipePoint)if(this._tapTime){const g=d[0],v=o.timeStamp-this._tapTime<500,S=this._tapPoint.dist(g)<30;v&&S?m.length>0&&(this._swipePoint=g,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(o,d,m)}touchmove(o,d,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const g=d[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,o.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(o,d,m)}touchend(o,d,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const g=this._tap.touchend(o,d,m);g&&(this._tapTime=o.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pg{constructor(o,d,m){this._el=o,this._mousePan=d,this._touchPan=m}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fg{constructor(o,d,m){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ep{constructor(o,d,m,g){this._el=o,this._touchZoom=d,this._touchRotate=m,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class gl{constructor(o,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=R.create("div","maplibregl-cooperative-gesture-screen",o);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=d,this._container.appendChild(g);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=m,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(R.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,d){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:o,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Qs=b=>b.zoom||b.drag||b.pitch||b.rotate;class mt extends l.k{}function th(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class Ap{constructor(o,d){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,v)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=g.type==="renderFrame"?void 0:g,I={needsRenderFrame:!1},M={},B={},F=g.touches,N=F?this._getMapTouches(F):void 0,X=N?R.touchPos(this._map.getCanvas(),N):R.mousePos(this._map.getCanvas(),g);for(const{handlerName:le,handler:de,allowed:pe}of this._handlers){if(!de.isEnabled())continue;let ge;this._blockedByActive(B,pe,le)?de.reset():de[v||g.type]&&(ge=de[v||g.type](g,X,N),this.mergeHandlerResult(I,M,ge,le,S),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()),(ge||de.isActive())&&(B[le]=de)}const Q={};for(const le in this._previousActiveHandlers)B[le]||(Q[le]=S);this._previousActiveHandlers=B,(Object.keys(Q).length||th(I))&&(this._changes.push([I,M,Q]),this._triggerRenderFrame()),(Object.keys(B).length||th(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:te}=I;te&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],te(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dp(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,v,S]of this._listeners)R.addEventListener(g,v,g===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[o,d,m]of this._listeners)R.removeEventListener(o,d,o===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(o){const d=this._map,m=d.getCanvasContainer();this._add("mapEvent",new hg(d,o));const g=d.boxZoom=new Ns(d,o);this._add("boxZoom",g),o.interactive&&o.boxZoom&&g.enable();const v=d.cooperativeGestures=new gl(d,o.cooperativeGestures);this._add("cooperativeGestures",v),o.cooperativeGestures&&v.enable();const S=new fl(d),I=new ly(d);d.doubleClickZoom=new Ca(I,S),this._add("tapZoom",S),this._add("clickZoom",I),o.interactive&&o.doubleClickZoom&&d.doubleClickZoom.enable();const M=new cy;this._add("tapDragZoom",M);const B=d.touchPitch=new ml(d);this._add("touchPitch",B),o.interactive&&o.touchPitch&&d.touchPitch.enable(o.touchPitch);const F=gp(o),N=_p(o);d.dragRotate=new fg(o,F,N),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]),o.interactive&&o.dragRotate&&d.dragRotate.enable();const X=(({enable:ge,clickTolerance:ne})=>{const xe=new Zu({checkCorrectEvent:Ae=>R.mouseButton(Ae)===0&&!Ae.ctrlKey});return new go({clickTolerance:ne,move:(Ae,ke)=>({around:ke,panDelta:ke.sub(Ae)}),activateOnStart:!0,moveStateManager:xe,enable:ge,assignEvents:Yu})})(o),Q=new Sa(o,d);d.dragPan=new pg(m,X,Q),this._add("mousePan",X),this._add("touchPan",Q,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&d.dragPan.enable(o.dragPan);const te=new wp,le=new vp;d.touchZoomRotate=new Ep(m,le,te,M),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&d.touchZoomRotate.enable(o.touchZoomRotate);const de=d.scrollZoom=new wn(d,()=>this._triggerRenderFrame());this._add("scrollZoom",de,["mousePan"]),o.interactive&&o.scrollZoom&&d.scrollZoom.enable(o.scrollZoom);const pe=d.keyboard=new Ys(d);this._add("keyboard",pe),o.interactive&&o.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new er(d))}_add(o,d,m){this._handlers.push({handlerName:o,handler:d,allowed:m}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qs(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,m){for(const g in o)if(g!==m&&(!d||d.indexOf(g)<0))return!0;return!1}_getMapTouches(o){const d=[];for(const m of o)this._el.contains(m.target)&&d.push(m);return d}mergeHandlerResult(o,d,m,g,v){if(!m)return;l.e(o,m);const S={handlerName:g,originalEvent:m.originalEvent||v};m.zoomDelta!==void 0&&(d.zoom=S),m.panDelta!==void 0&&(d.drag=S),m.pitchDelta!==void 0&&(d.pitch=S),m.bearingDelta!==void 0&&(d.rotate=S)}_applyChanges(){const o={},d={},m={};for(const[g,v,S]of this._changes)g.panDelta&&(o.panDelta=(o.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(o.around=g.around),g.pinchAround!==void 0&&(o.pinchAround=g.pinchAround),g.noInertia&&(o.noInertia=g.noInertia),l.e(d,v),l.e(m,S);this._updateMapTransform(o,d,m),this._changes=[]}_updateMapTransform(o,d,m){const g=this._map,v=g._getTransformForUpdate(),S=g.terrain;if(!(th(o)||S&&this._terrainMovement))return this._fireEvents(d,m,!0);let{panDelta:I,zoomDelta:M,bearingDelta:B,pitchDelta:F,around:N,pinchAround:X}=o;X!==void 0&&(N=X),g._stop(!0),N=N||g.transform.centerPoint;const Q=v.pointLocation(I?N.sub(I):N);B&&(v.bearing+=B),F&&(v.pitch+=F),M&&(v.zoom+=M),S?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(I)):v.setLocationAtPoint(Q,N):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(Q,N)):v.setLocationAtPoint(Q,N),g._applyUpdatedTransform(v),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,m,!0)}_fireEvents(o,d,m){const g=Qs(this._eventsInProgress),v=Qs(o),S={};for(const N in o){const{originalEvent:X}=o[N];this._eventsInProgress[N]||(S[`${N}start`]=X),this._eventsInProgress[N]=o[N]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const N in S)this._fireEvent(N,S[N]);v&&this._fireEvent("move",v.originalEvent);for(const N in o){const{originalEvent:X}=o[N];this._fireEvent(N,X)}const I={};let M;for(const N in this._eventsInProgress){const{handlerName:X,originalEvent:Q}=this._eventsInProgress[N];this._handlersById[X].isActive()||(delete this._eventsInProgress[N],M=d[X]||Q,I[`${N}end`]=M)}for(const N in I)this._fireEvent(N,I[N]);const B=Qs(this._eventsInProgress),F=(g||v)&&!B;if(F&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const N=this._map._getTransformForUpdate();N.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(N)}if(m&&F){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=Q=>Q!==0&&-this._bearingSnap<Q&&Q<this._bearingSnap;!N||!N.essential&&T.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:M})),X(this._map.getBearing())&&this._map.resetNorth()):(X(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new l.k(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new mt("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class mg extends l.E{constructor(o,d){super(),this._renderFrameCallback=()=>{const m=Math.min((T.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,m){return o=l.P.convert(o).mult(-1),this.panTo(this.transform.center,l.e({offset:o},d),m)}panTo(o,d,m){return this.easeTo(l.e({center:o},d),m)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,m){return this.easeTo(l.e({zoom:o},d),m)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,m){return this.easeTo(l.e({bearing:o},d),m)}resetNorth(o,d){return this.rotateTo(0,l.e({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=Oe.convert(o).adjustAntiMeridian();const m=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),m,d)}_cameraForBoxAndBearing(o,d,m,g){const v={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const nt=g.padding;g.padding={top:nt,bottom:nt,right:nt,left:nt}}g.padding=l.e(v,g.padding);const S=this.transform,I=S.padding,M=new Oe(o,d),B=S.project(M.getNorthWest()),F=S.project(M.getNorthEast()),N=S.project(M.getSouthEast()),X=S.project(M.getSouthWest()),Q=l.ba(-m),te=B.rotate(Q),le=F.rotate(Q),de=N.rotate(Q),pe=X.rotate(Q),ge=new l.P(Math.max(te.x,le.x,pe.x,de.x),Math.max(te.y,le.y,pe.y,de.y)),ne=new l.P(Math.min(te.x,le.x,pe.x,de.x),Math.min(te.y,le.y,pe.y,de.y)),xe=ge.sub(ne),Ae=(S.width-(I.left+I.right+g.padding.left+g.padding.right))/xe.x,ke=(S.height-(I.top+I.bottom+g.padding.top+g.padding.bottom))/xe.y;if(ke<0||Ae<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ge=Math.min(S.scaleZoom(S.scale*Math.min(Ae,ke)),g.maxZoom),Xe=l.P.convert(g.offset),lt=new l.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(l.ba(m)),pt=Xe.add(lt).mult(S.scale/S.zoomScale(Ge));return{center:S.unproject(B.add(N).div(2).sub(pt)),zoom:Ge,bearing:m}}fitBounds(o,d,m){return this._fitInternal(this.cameraForBounds(o,d),d,m)}fitScreenCoordinates(o,d,m,g,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(o)),this.transform.pointLocation(l.P.convert(d)),m,g),g,v)}_fitInternal(o,d,m){return o?(delete(d=l.e(o,d)).padding,d.linear?this.easeTo(d,m):this.flyTo(d,m)):this}jumpTo(o,d){this.stop();const m=this._getTransformForUpdate();let g=!1,v=!1,S=!1;return"zoom"in o&&m.zoom!==+o.zoom&&(g=!0,m.zoom=+o.zoom),o.center!==void 0&&(m.center=l.N.convert(o.center)),"bearing"in o&&m.bearing!==+o.bearing&&(v=!0,m.bearing=+o.bearing),"pitch"in o&&m.pitch!==+o.pitch&&(S=!0,m.pitch=+o.pitch),o.padding==null||m.isPaddingEqual(o.padding)||(m.padding=o.padding),this._applyUpdatedTransform(m),this.fire(new l.k("movestart",d)).fire(new l.k("move",d)),g&&this.fire(new l.k("zoomstart",d)).fire(new l.k("zoom",d)).fire(new l.k("zoomend",d)),v&&this.fire(new l.k("rotatestart",d)).fire(new l.k("rotate",d)).fire(new l.k("rotateend",d)),S&&this.fire(new l.k("pitchstart",d)).fire(new l.k("pitch",d)).fire(new l.k("pitchend",d)),this.fire(new l.k("moveend",d))}calculateCameraOptionsFromTo(o,d,m,g=0){const v=l.Z.fromLngLat(o,d),S=l.Z.fromLngLat(m,g),I=S.x-v.x,M=S.y-v.y,B=S.z-v.z,F=Math.hypot(I,M,B);if(F===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(I,M),X=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),Q=180*Math.atan2(I,-M)/Math.PI;let te=180*Math.acos(N/F)/Math.PI;return te=B<0?90-te:90+te,{center:S.toLngLat(),zoom:X,pitch:te,bearing:Q}}easeTo(o,d){var m;this._stop(!1,o.easeId),((o=l.e({offset:[0,0],duration:500,easing:l.b9},o)).animate===!1||!o.essential&&T.prefersReducedMotion)&&(o.duration=0);const g=this._getTransformForUpdate(),v=g.zoom,S=g.bearing,I=g.pitch,M=g.padding,B="bearing"in o?this._normalizeBearing(o.bearing,S):S,F="pitch"in o?+o.pitch:I,N="padding"in o?o.padding:g.padding,X=l.P.convert(o.offset);let Q=g.centerPoint.add(X);const te=g.pointLocation(Q),{center:le,zoom:de}=g.getConstrained(l.N.convert(o.center||te),(m=o.zoom)!==null&&m!==void 0?m:v);this._normalizeCenter(le,g);const pe=g.project(te),ge=g.project(le).sub(pe),ne=g.zoomScale(de-v);let xe,Ae;o.around&&(xe=l.N.convert(o.around),Ae=g.locationPoint(xe));const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||de!==v,this._rotating=this._rotating||S!==B,this._pitching=this._pitching||F!==I,this._padding=!g.isPaddingEqual(N),this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,ke),this.terrain&&this._prepareElevation(le),this._ease(Ge=>{if(this._zooming&&(g.zoom=l.y.number(v,de,Ge)),this._rotating&&(g.bearing=l.y.number(S,B,Ge)),this._pitching&&(g.pitch=l.y.number(I,F,Ge)),this._padding&&(g.interpolatePadding(M,N,Ge),Q=g.centerPoint.add(X)),this.terrain&&!o.freezeElevation&&this._updateElevation(Ge),xe)g.setLocationAtPoint(xe,Ae);else{const Xe=g.zoomScale(g.zoom-v),lt=de>v?Math.min(2,ne):Math.max(.5,ne),pt=Math.pow(lt,1-Ge),nt=g.unproject(pe.add(ge.mult(Ge*pt)).mult(Xe));g.setLocationAtPoint(g.renderWorldCopies?nt.wrap():nt,Q)}this._applyUpdatedTransform(g),this._fireMoveEvents(d)},Ge=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(d,Ge)},o),this}_prepareEase(o,d,m={}){this._moving=!0,d||m.moving||this.fire(new l.k("movestart",o)),this._zooming&&!m.zooming&&this.fire(new l.k("zoomstart",o)),this._rotating&&!m.rotating&&this.fire(new l.k("rotatestart",o)),this._pitching&&!m.pitching&&this.fire(new l.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&d!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(m-(d-(m*o+this._elevationStart))/(1-o)),this._elevationTarget=d}this.transform.elevation=l.y.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){const d=o.getCameraPosition(),m=this.terrain.getElevationForLngLatZoom(d.lngLat,o.zoom);if(d.altitude<m){const g=this.calculateCameraOptionsFromTo(d.lngLat,m,o.center,o.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(o){const d=[];if(this.terrain&&d.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&d.push(g=>this.transformCameraUpdate(g)),!d.length)return;const m=o.clone();for(const g of d){const v=m.clone(),{center:S,zoom:I,pitch:M,bearing:B,elevation:F}=g(v);S&&(v.center=S),I!==void 0&&(v.zoom=I),M!==void 0&&(v.pitch=M),B!==void 0&&(v.bearing=B),F!==void 0&&(v.elevation=F),m.apply(v)}this.transform.apply(m)}_fireMoveEvents(o){this.fire(new l.k("move",o)),this._zooming&&this.fire(new l.k("zoom",o)),this._rotating&&this.fire(new l.k("rotate",o)),this._pitching&&this.fire(new l.k("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const m=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new l.k("zoomend",o)),g&&this.fire(new l.k("rotateend",o)),v&&this.fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}flyTo(o,d){var m;if(!o.essential&&T.prefersReducedMotion){const ut=l.M(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ut,d)}this.stop(),o=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b9},o);const g=this._getTransformForUpdate(),v=g.zoom,S=g.bearing,I=g.pitch,M=g.padding,B="bearing"in o?this._normalizeBearing(o.bearing,S):S,F="pitch"in o?+o.pitch:I,N="padding"in o?o.padding:g.padding,X=l.P.convert(o.offset);let Q=g.centerPoint.add(X);const te=g.pointLocation(Q),{center:le,zoom:de}=g.getConstrained(l.N.convert(o.center||te),(m=o.zoom)!==null&&m!==void 0?m:v);this._normalizeCenter(le,g);const pe=g.zoomScale(de-v),ge=g.project(te),ne=g.project(le).sub(ge);let xe=o.curve;const Ae=Math.max(g.width,g.height),ke=Ae/pe,Ge=ne.mag();if("minZoom"in o){const ut=l.ac(Math.min(o.minZoom,v,de),g.minZoom,g.maxZoom),kt=Ae/g.zoomScale(ut-v);xe=Math.sqrt(kt/Ge*2)}const Xe=xe*xe;function lt(ut){const kt=(ke*ke-Ae*Ae+(ut?-1:1)*Xe*Xe*Ge*Ge)/(2*(ut?ke:Ae)*Xe*Ge);return Math.log(Math.sqrt(kt*kt+1)-kt)}function pt(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function nt(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const it=lt(!1);let yt=function(ut){return nt(it)/nt(it+xe*ut)},Lt=function(ut){return Ae*((nt(it)*(pt(kt=it+xe*ut)/nt(kt))-pt(it))/Xe)/Ge;var kt},ot=(lt(!0)-it)/xe;if(Math.abs(Ge)<1e-6||!isFinite(ot)){if(Math.abs(Ae-ke)<1e-6)return this.easeTo(o,d);const ut=ke<Ae?-1:1;ot=Math.abs(Math.log(ke/Ae))/xe,Lt=()=>0,yt=kt=>Math.exp(ut*xe*kt)}return o.duration="duration"in o?+o.duration:1e3*ot/("screenSpeed"in o?+o.screenSpeed/xe:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=S!==B,this._pitching=F!==I,this._padding=!g.isPaddingEqual(N),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(le),this._ease(ut=>{const kt=ut*ot,Mi=1/yt(kt);g.zoom=ut===1?de:v+g.scaleZoom(Mi),this._rotating&&(g.bearing=l.y.number(S,B,ut)),this._pitching&&(g.pitch=l.y.number(I,F,ut)),this._padding&&(g.interpolatePadding(M,N,ut),Q=g.centerPoint.add(X)),this.terrain&&!o.freezeElevation&&this._updateElevation(ut);const Ut=ut===1?le:g.unproject(ge.add(ne.mult(Lt(kt))).mult(Mi));g.setLocationAtPoint(g.renderWorldCopies?Ut.wrap():Ut,Q),this._applyUpdatedTransform(g),this._fireMoveEvents(d)},()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(d)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,d)}return o||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(o,d,m){m.animate===!1||m.duration===0?(o(1),d()):(this._easeStart=T.now(),this._easeOptions=m,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,d){o=l.b3(o,-180,180);const m=Math.abs(o-d);return Math.abs(o-360-d)<m&&(o-=360),Math.abs(o+360-d)<m&&(o+=360),o}_normalizeCenter(o,d){if(!d.renderWorldCopies||d.lngRange)return;const m=o.lng-d.center.lng;o.lng+=m>180?-360:m<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const _l={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class yl{constructor(o=_l){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const m=this._map._getUIString(`AttributionControl.${d}`);o.title=m,o.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const d=this._map.style.sourceCaches;for(const g in d){const v=d[g];if(v.used||v.usedForTerrain){const S=v.getSource();S.attribution&&o.indexOf(S.attribution)<0&&o.push(S.attribution)}}o=o.filter(g=>String(g).trim()),o.sort((g,v)=>g.length-v.length),o=o.filter((g,v)=>{for(let S=v+1;S<o.length;S++)if(o[S].indexOf(g)>=0)return!1;return!0});const m=o.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,o.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Tp{constructor(o={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const m=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const d=R.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Kt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,m=d?this._queue.concat(d):this._queue;for(const g of m)if(g.id===o)return void(g.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const m of d)if(!m.cancelled&&(m.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Sp=l.Y([{name:"a_pos3d",type:"Int16",components:3}]);class uy extends l.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,d){this.sourceCache.update(o,d),this._renderableTilesKeys=[];const m={};for(const g of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))m[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.aP(g.posMatrix,0,l.X,0,l.X,0,1),this._tiles[g.key]=new Xs(g,this.tileSize));for(const g in this._tiles)m[g]||delete this._tiles[g]}freeRtt(o){for(const d in this._tiles){const m=this._tiles[d];(!o||m.tileID.equals(o)||m.tileID.isChildOf(o)||o.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const d={};for(const m of this._renderableTilesKeys){const g=this._tiles[m].tileID;if(g.canonical.equals(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16),l.aP(v.posMatrix,0,l.X,0,l.X,0,1),d[m]=v}else if(g.canonical.isChildOf(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const S=g.canonical.z-o.canonical.z,I=g.canonical.x-(g.canonical.x>>S<<S),M=g.canonical.y-(g.canonical.y>>S<<S),B=l.X>>S;l.aP(v.posMatrix,0,B,0,B,0,1),l.J(v.posMatrix,v.posMatrix,[-I*B,-M*B,0]),d[m]=v}else if(o.canonical.isChildOf(g.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const S=o.canonical.z-g.canonical.z,I=o.canonical.x-(o.canonical.x>>S<<S),M=o.canonical.y-(o.canonical.y>>S<<S),B=l.X>>S;l.aP(v.posMatrix,0,l.X,0,l.X,0,1),l.J(v.posMatrix,v.posMatrix,[I*B,M*B,0]),l.K(v.posMatrix,v.posMatrix,[1/2**S,1/2**S,0]),d[m]=v}}return d}getSourceTile(o,d){const m=this.sourceCache._source;let g=o.overscaledZ-this.deltaZoom;if(g>m.maxzoom&&(g=m.maxzoom),g<m.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(g).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!v||!v.dem)&&d)for(;g>=m.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(o.scaledTo(g--).key);return v}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=o)}}class Cp{constructor(o,d,m){this.painter=o,this.sourceCache=new uy(d),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,d,m,g=l.X){var v;if(!(d>=0&&d<g&&m>=0&&m<g))return 0;const S=this.getTerrainData(o),I=(v=S.tile)===null||v===void 0?void 0:v.dem;if(!I)return 0;const M=function(te,le,de){var pe=le[0],ge=le[1];return te[0]=de[0]*pe+de[4]*ge+de[12],te[1]=de[1]*pe+de[5]*ge+de[13],te}([],[d/g*l.X,m/g*l.X],S.u_terrain_matrix),B=[M[0]*I.dim,M[1]*I.dim],F=Math.floor(B[0]),N=Math.floor(B[1]),X=B[0]-F,Q=B[1]-N;return I.get(F,N)*(1-X)*(1-Q)+I.get(F+1,N)*X*(1-Q)+I.get(F,N+1)*(1-X)*Q+I.get(F+1,N+1)*X*Q}getElevationForLngLatZoom(o,d){if(!l.bb(d,o.wrap()))return 0;const{tileID:m,mercatorX:g,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(o,d);return this.getElevation(m,g%l.X,v%l.X,l.X)}getElevation(o,d,m,g=l.X){return this.getDEMElevation(o,d,m,g)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const g=this.painter.context,v=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ze(g,v,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ze(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const d=this.sourceCache.getSourceTile(o,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const g=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new ze(g,d.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),d.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const m=d&&d+d.tileID.key+o.key;if(m&&!this._demMatrixCache[m]){const g=this.sourceCache.sourceCache._source.maxzoom;let v=o.canonical.z-d.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=g?v=o.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=o.canonical.x-(o.canonical.x>>v<<v),I=o.canonical.y-(o.canonical.y>>v<<v),M=l.bc(new Float64Array(16),[1/(l.X<<v),1/(l.X<<v),0]);l.J(M,M,[S*l.X,I*l.X,0]),this._demMatrixCache[o.key]={matrix:M,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(o){const d=this.painter,m=d.width/devicePixelRatio,g=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ze(d.context,{width:m,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ze(d.context,{width:m,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(m,g,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,m,g))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,S=0;v<this._coordsTextureSize;v++)for(let I=0;I<this._coordsTextureSize;I++,S+=4)d[S+0]=255&I,d[S+1]=255&v,d[S+2]=I>>8<<4|v>>8,d[S+3]=0;const m=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),g=new ze(o,m,o.gl.RGBA,{premultiply:!1});return g.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),m=this.painter.context,g=m.gl,v=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),I=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(v,I-S-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null);const M=d[0]+(d[2]>>4<<8),B=d[1]+((15&d[2])<<8),F=this.coordsIndex[255-d[3]],N=F&&this.sourceCache.getTileByID(F);if(!N)return null;const X=this._coordsTextureSize,Q=(1<<N.tileID.canonical.z)*X;return new l.Z((N.tileID.canonical.x*X+M)/Q+N.tileID.wrap,(N.tileID.canonical.y*X+B)/Q,this.getElevation(N.tileID,M,B,X))}depthAtPoint(o){const d=new Uint8Array(4),m=this.painter.context,g=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,d=new l.bd,m=new l.aY,g=this.meshSize,v=l.X/g,S=g*g;for(let N=0;N<=g;N++)for(let X=0;X<=g;X++)d.emplaceBack(X*v,N*v,0);for(let N=0;N<S;N+=g+1)for(let X=0;X<g;X++)m.emplaceBack(X+N,g+X+N+1,g+X+N+2),m.emplaceBack(X+N,g+X+N+2,X+N+1);const I=d.length,M=I+2*(g+1);for(const N of[0,1])for(let X=0;X<=g;X++)for(const Q of[0,1])d.emplaceBack(X*v,N*l.X,Q);for(let N=0;N<2*g;N+=2)m.emplaceBack(M+N,M+N+1,M+N+3),m.emplaceBack(M+N,M+N+3,M+N+2),m.emplaceBack(I+N,I+N+3,I+N+1),m.emplaceBack(I+N,I+N+2,I+N+3);const B=d.length,F=B+2*(g+1);for(const N of[0,1])for(let X=0;X<=g;X++)for(const Q of[0,1])d.emplaceBack(N*l.X,X*v,Q);for(let N=0;N<2*g;N+=2)m.emplaceBack(B+N,B+N+1,B+N+3),m.emplaceBack(B+N,B+N+3,B+N+2),m.emplaceBack(F+N,F+N+3,F+N+1),m.emplaceBack(F+N,F+N+2,F+N+3);return this._mesh=new Hu(o.createVertexBuffer(d,Sp.members),o.createIndexBuffer(m),l.a0.simpleSegment(0,0,d.length,m.length)),this._mesh}getMeshFrameDelta(o){return 2*Math.PI*l.be/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,d){var m;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(o,d);return(m=this.getMinMaxElevation(g).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(o){const d=this.getTerrainData(o).tile,m={minElevation:null,maxElevation:null};return d&&d.dem&&(m.minElevation=d.dem.min*this.exaggeration,m.maxElevation=d.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(o,d){const m=l.Z.fromLngLat(o.wrap()),g=(1<<d)*l.X,v=m.x*g,S=m.y*g,I=Math.floor(v/l.X),M=Math.floor(S/l.X);return{tileID:new l.S(d,0,d,I,M),mercatorX:v,mercatorY:S}}}class hy{constructor(o,d,m){this._context=o,this._size=d,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new ze(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(m.texture),{id:o,fbo:d,texture:m,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>o.id!==d),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const vl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class gg{constructor(o,d){this.painter=o,this.terrain=d,this.pool=new hy(o.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(m=>!o._layers[m].isHidden(d)),this._coordsDescendingInv={};for(const m in o.sourceCaches){this._coordsDescendingInv[m]={};const g=o.sourceCaches[m].getVisibleCoordinates();for(const v of g){const S=this.terrain.sourceCache.getTerrainCoords(v);for(const I in S)this._coordsDescendingInv[m][I]||(this._coordsDescendingInv[m][I]=[]),this._coordsDescendingInv[m][I].push(S[I])}}this._coordsDescendingInvStr={};for(const m of o._order){const g=o._layers[m],v=g.source;if(vl[g.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const S in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][S]=this._coordsDescendingInv[v][S].map(I=>I.key).sort().join()}}for(const m of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[g][m.tileID.key];v&&v!==m.rttCoords[g]&&(m.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const d=o.type,m=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(vl[d]&&(this._prevType&&vl[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(o.id),!g))return!0;if(vl[this._prevType]||vl[d]&&g){this._prevType=d;const v=this._stacks.length-1,S=this._stacks[v]||[];for(const I of this._renderableTiles){if(this.pool.isFull()&&(lg(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[v]){const B=this.pool.getObjectForId(I.rtt[v].id);if(B.stamp===I.rtt[v].stamp){this.pool.useObject(B);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),I.rtt[v]={id:M.id,stamp:M.stamp},m.context.bindFramebuffer.set(M.fbo.framebuffer),m.context.clear({color:l.aM.transparent,stencil:0}),m.currentStencilSource=void 0;for(let B=0;B<S.length;B++){const F=m.style._layers[S[B]],N=F.source?this._coordsDescendingInv[F.source][I.tileID.key]:[I.tileID];m.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),m._renderTileClippingMasks(F,N),m.renderLayer(m,m.style.sourceCaches[F.source],F,N),F.source&&(I.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][I.tileID.key])}}return lg(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),vl[d]}return!1}}const Ip={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},_g=f,dy={hash:!1,interactive:!0,bearingSnap:7,attributionControl:_l,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Rp=b=>{b.touchstart=b.dragStart,b.touchmoveWindow=b.dragMove,b.touchend=b.dragEnd},py={showCompass:!0,showZoom:!0,visualizePitch:!1};class fy{constructor(o,d,m=!1){this.mousedown=S=>{this.startMouse(l.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),R.mousePos(this.element,S)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,R.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=o.dragRotate._mouseRotate.getClickTolerance(),v=o.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=gp({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:I,bearingDegreesPerPixelMoved:M=.8})=>{const B=new mp;return new go({clickTolerance:I,move:(F,N)=>({bearingDelta:(N.x-F.x)*M}),moveStateManager:B,enable:S,assignEvents:Rp})})({clickTolerance:g,enable:!0}),this.map=o,m&&(this.mousePitch=_p({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:I,pitchDegreesPerPixelMoved:M=-.5})=>{const B=new mp;return new go({clickTolerance:I,move:(F,N)=>({pitchDelta:(N.y-F.y)*M}),moveStateManager:B,enable:S,assignEvents:Rp})})({clickTolerance:v,enable:!0})),R.addEventListener(d,"mousedown",this.mousedown),R.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(d,"touchcancel",this.reset)}startMouse(o,d){this.mouseRotate.dragStart(o,d),this.mousePitch&&this.mousePitch.dragStart(o,d),R.disableDrag()}startTouch(o,d){this.touchRotate.dragStart(o,d),this.touchPitch&&this.touchPitch.dragStart(o,d),R.disableDrag()}moveMouse(o,d){const m=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(o,d)||{};if(g&&m.setBearing(m.getBearing()+g),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(o,d)||{};v&&m.setPitch(m.getPitch()+v)}}moveTouch(o,d){const m=this.map,{bearingDelta:g}=this.touchRotate.dragMove(o,d)||{};if(g&&m.setBearing(m.getBearing()+g),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(o,d)||{};v&&m.setPitch(m.getPitch()+v)}}off(){const o=this.element;R.removeEventListener(o,"mousedown",this.mousedown),R.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let Us;function Ri(b,o,d){const m=new l.N(b.lng,b.lat);if(b=new l.N(b.lng,b.lat),o){const g=new l.N(b.lng-360,b.lat),v=new l.N(b.lng+360,b.lat),S=d.locationPoint(b).distSqr(o);d.locationPoint(g).distSqr(o)<S?b=g:d.locationPoint(v).distSqr(o)<S&&(b=v)}for(;Math.abs(b.lng-d.center.lng)>180;){const g=d.locationPoint(b);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;b.lng>d.center.lng?b.lng-=360:b.lng+=360}return b.lng!==m.lng&&d.locationPoint(b).y>d.height/2-d.getHorizon()?b:m}const bl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ih(b,o,d){const m=b.classList;for(const g in bl)m.remove(`maplibregl-${d}-anchor-${g}`);m.add(`maplibregl-${d}-anchor-${o}`)}class rh extends l.E{constructor(o){if(super(),this._onKeyPress=d=>{const m=d.code,g=d.charCode||d.keyCode;m!=="Space"&&m!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=d=>{const m=d.originalEvent.target,g=this._element;this._popup&&(m===g||g.contains(m))&&this.togglePopup()},this._update=d=>{var m;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ri(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${bl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${v}`),T.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=l.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div");const d=R.createNS("http://www.w3.org/2000/svg","svg"),m=41,g=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${g}px`),d.setAttributeNS(null,"viewBox",`0 0 ${g} ${m}`);const v=R.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const S=R.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const I=R.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pe of M){const ge=R.createNS("http://www.w3.org/2000/svg","ellipse");ge.setAttributeNS(null,"opacity","0.04"),ge.setAttributeNS(null,"cx","10.5"),ge.setAttributeNS(null,"cy","5.80029008"),ge.setAttributeNS(null,"rx",pe.rx),ge.setAttributeNS(null,"ry",pe.ry),I.appendChild(ge)}const B=R.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const F=R.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(F);const N=R.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const X=R.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(X);const Q=R.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Q.setAttributeNS(null,"fill","#FFFFFF");const te=R.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const le=R.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#000000"),le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962");const de=R.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#FFFFFF"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962"),te.appendChild(le),te.appendChild(de),S.appendChild(I),S.appendChild(B),S.appendChild(N),S.appendChild(Q),S.appendChild(te),d.appendChild(S),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(d),this._offset=l.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),ih(this._element,this._anchor,"marker"),o&&o.className)for(const d of o.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=l.N.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const d=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var d,m;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,v=g.terrain.depthAtPoint(this._pos),S=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,S)-v<.006)return void(this._element.style.opacity=this._opacity);const I=-this._offset.y/g.transform._pixelPerMeter,M=Math.sin(g.getPitch()*Math.PI/180)*I,B=g.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),F=g.transform.lngLatToCameraDepth(this._lngLat,S+M)-B>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=l.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,d){return o===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const yg={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Dc=0,Fc=!1;const Jn={maxWidth:100,unit:"metric"};function Nc(b,o,d){const m=d&&d.maxWidth||100,g=b._container.clientHeight/2,v=b.unproject([0,g]),S=b.unproject([m,g]),I=v.distanceTo(S);if(d&&d.unit==="imperial"){const M=3.2808*I;M>5280?_t(o,m,M/5280,b._getUIString("ScaleControl.Miles")):_t(o,m,M,b._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?_t(o,m,I/1852,b._getUIString("ScaleControl.NauticalMiles")):I>=1e3?_t(o,m,I/1e3,b._getUIString("ScaleControl.Kilometers")):_t(o,m,I,b._getUIString("ScaleControl.Meters"))}function _t(b,o,d,m){const g=function(v){const S=Math.pow(10,`${Math.floor(v)}`.length-1);let I=v/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(M){const B=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*B)/B}(I),S*I}(d);b.style.width=o*(g/d)+"px",b.innerHTML=`${g}&nbsp;${m}`}const Rt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},sh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nh(b){if(b){if(typeof b=="number"){const o=Math.round(Math.abs(b)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,b),"top-left":new l.P(o,o),"top-right":new l.P(-o,o),bottom:new l.P(0,-b),"bottom-left":new l.P(o,-o),"bottom-right":new l.P(-o,-o),left:new l.P(b,0),right:new l.P(-b,0)}}if(b instanceof l.P||Array.isArray(b)){const o=l.P.convert(b);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:l.P.convert(b.center||[0,0]),top:l.P.convert(b.top||[0,0]),"top-left":l.P.convert(b["top-left"]||[0,0]),"top-right":l.P.convert(b["top-right"]||[0,0]),bottom:l.P.convert(b.bottom||[0,0]),"bottom-left":l.P.convert(b["bottom-left"]||[0,0]),"bottom-right":l.P.convert(b["bottom-right"]||[0,0]),left:l.P.convert(b.left||[0,0]),right:l.P.convert(b.right||[0,0])}}return nh(new l.P(0,0))}const Mp=f;c.AJAXError=l.bh,c.Evented=l.E,c.LngLat=l.N,c.MercatorCoordinate=l.Z,c.Point=l.P,c.addProtocol=l.bi,c.config=l.a,c.removeProtocol=l.bj,c.AttributionControl=yl,c.BoxZoomHandler=Ns,c.CanvasSource=ms,c.CooperativeGesturesHandler=gl,c.DoubleClickZoomHandler=Ca,c.DragPanHandler=pg,c.DragRotateHandler=fg,c.EdgeInsets=dl,c.FullscreenControl=class extends l.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var o;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=d==null?void 0:d.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=vr,c.GeolocateControl=class extends l.E{constructor(b){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const d=new l.N(o.coords.longitude,o.coords.latitude),m=o.coords.accuracy,g=this._map.getBearing(),v=l.e({bearing:g},this.options.fitBoundsOptions),S=Oe.fromLngLat(d,m);this._map.fitBounds(S,v,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const d=new l.N(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&Fc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new rh({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},yg,b)}onAdd(b){return this._map=b,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(o=!1){if(Us!==void 0&&!o)return Us;if(window.navigator.permissions===void 0)return Us=!!window.navigator.geolocation,Us;try{Us=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Us=!!window.navigator.geolocation}return Us})}().then(o=>this._finishSetupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Dc=0,Fc=!1}_isOutOfMapMaxBounds(b){const o=this._map.getMaxBounds(),d=b.coords;return o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const b=this._map.getBounds(),o=b.getSouthEast(),d=b.getNorthEast(),m=o.distanceTo(d),g=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Dc--,Fc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Dc++,Dc>1?(b={maximumAge:6e5,timeout:0},Fc=!0):(b=this.options.positionOptions,Fc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=Wu,c.ImageSource=_n,c.KeyboardHandler=Ys,c.LngLatBounds=Oe,c.LogoControl=Tp,c.Map=class extends mg{constructor(b){l.bf.mark(l.bg.create);const o=Object.assign(Object.assign({},dy),b);if(o.minZoom!=null&&o.maxZoom!=null&&o.minZoom>o.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(o.minPitch!=null&&o.maxPitch!=null&&o.minPitch>o.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(o.minPitch!=null&&o.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(o.maxPitch!=null&&o.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new pl(o.minZoom,o.maxZoom,o.minPitch,o.maxPitch,o.renderWorldCopies),{bearingSnap:o.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Kt,this._controls=[],this._mapId=l.a4(),this._contextLost=d=>{d.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:d}))},this._contextRestored=d=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:d}))},this._onMapScroll=d=>{if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=o.interactive,this._maxTileCacheSize=o.maxTileCacheSize,this._maxTileCacheZoomLevels=o.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=o.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=o.preserveDrawingBuffer===!0,this._antialias=o.antialias===!0,this._trackResize=o.trackResize===!0,this._bearingSnap=o.bearingSnap,this._refreshExpiredTiles=o.refreshExpiredTiles===!0,this._fadeDuration=o.fadeDuration,this._crossSourceCollisions=o.crossSourceCollisions===!0,this._collectResourceTiming=o.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ip),o.locale),this._clickTolerance=o.clickTolerance,this._overridePixelRatio=o.pixelRatio,this._maxCanvasSize=o.maxCanvasSize,this.transformCameraUpdate=o.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=o.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=q.addThrottleControl(()=>this.isMoving()),this._requestManager=new ce(o.transformRequest),typeof o.container=="string"){if(this._container=document.getElementById(o.container),!this._container)throw new Error(`Container '${o.container}' not found.`)}else{if(!(o.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=o.container}if(o.maxBounds&&this.setMaxBounds(o.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let d=!1;const m=Pc(g=>{this._trackResize&&!this._removed&&(this.resize(g),this.redraw())},50);this._resizeObserver=new ResizeObserver(g=>{d?m(g):d=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ap(this,o),this._hash=o.hash&&new Wu(typeof o.hash=="string"&&o.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch}),o.bounds&&(this.resize(),this.fitBounds(o.bounds,l.e({},o.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=o.localIdeographFontFamily,this._validateStyle=o.validateStyle,o.style&&this.setStyle(o.style,{localIdeographFontFamily:o.localIdeographFontFamily}),o.attributionControl&&this.addControl(new yl(typeof o.attributionControl=="boolean"?void 0:o.attributionControl)),o.maplibreLogo&&this.addControl(new Tp,o.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new l.k(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new l.k(`${d.dataType}dataloading`,d))}),this.on("dataabort",d=>{this.fire(new l.k("sourcedataabort",d))})}_getMapId(){return this._mapId}addControl(b,o){if(o===void 0&&(o=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=b.onAdd(this);this._controls.push(b);const m=this._controlPositions[o];return o.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(b);return o>-1&&this._controls.splice(o,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}calculateCameraOptionsFromTo(b,o,d,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,o,d,m)}resize(b){var o;const d=this._containerDimensions(),m=d[0],g=d[1],v=this._getClampedPixelRatio(m,g);if(this._resizeCanvas(m,g,v),this.painter.resize(m,g,v),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const M=this._getClampedPixelRatio(m,g);this._resizeCanvas(m,g,M),this.painter.resize(m,g,M)}this.transform.resize(m,g),(o=this._requestedCameraState)===null||o===void 0||o.resize(m,g);const S=!this._moving;return S&&(this.stop(),this.fire(new l.k("movestart",b)).fire(new l.k("move",b))),this.fire(new l.k("resize",b)),S&&this.fire(new l.k("moveend",b)),this}_getClampedPixelRatio(b,o){const{0:d,1:m}=this._maxCanvasSize,g=this.getPixelRatio(),v=b*g,S=o*g;return Math.min(v>d?d/v:1,S>m?m/S:1)*g}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(Oe.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this._update()}project(b){return this.transform.locationPoint(l.N.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.pointLocation(l.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,o,d){if(b==="mouseenter"||b==="mouseover"){let m=!1;return{layers:o,listener:d,delegates:{mousemove:g=>{const v=o.filter(I=>this.getLayer(I)),S=v.length!==0?this.queryRenderedFeatures(g.point,{layers:v}):[];S.length?m||(m=!0,d.call(this,new Gr(b,this,g.originalEvent,{features:S}))):m=!1},mouseout:()=>{m=!1}}}}if(b==="mouseleave"||b==="mouseout"){let m=!1;return{layers:o,listener:d,delegates:{mousemove:g=>{const v=o.filter(S=>this.getLayer(S));(v.length!==0?this.queryRenderedFeatures(g.point,{layers:v}):[]).length?m=!0:m&&(m=!1,d.call(this,new Gr(b,this,g.originalEvent)))},mouseout:g=>{m&&(m=!1,d.call(this,new Gr(b,this,g.originalEvent)))}}}}{const m=g=>{const v=o.filter(I=>this.getLayer(I)),S=v.length!==0?this.queryRenderedFeatures(g.point,{layers:v}):[];S.length&&(g.features=S,d.call(this,g),delete g.features)};return{layers:o,listener:d,delegates:{[b]:m}}}}_saveDelegatedListener(b,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(o)}_removeDelegatedListener(b,o,d){if(!this._delegatedListeners||!this._delegatedListeners[b])return;const m=this._delegatedListeners[b];for(let g=0;g<m.length;g++){const v=m[g];if(v.listener===d&&v.layers.length===o.length&&v.layers.every(S=>o.includes(S))){for(const S in v.delegates)this.off(S,v.delegates[S]);return void m.splice(g,1)}}}on(b,o,d){if(d===void 0)return super.on(b,o);const m=this._createDelegatedListener(b,typeof o=="string"?[o]:o,d);this._saveDelegatedListener(b,m);for(const g in m.delegates)this.on(g,m.delegates[g]);return this}once(b,o,d){if(d===void 0)return super.once(b,o);const m=typeof o=="string"?[o]:o,g=this._createDelegatedListener(b,m,d);for(const v in g.delegates){const S=g.delegates[v];g.delegates[v]=(...I)=>{this._removeDelegatedListener(b,m,d),S(...I)}}this._saveDelegatedListener(b,g);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(b,o,d){return d===void 0?super.off(b,o):(this._removeDelegatedListener(b,typeof o=="string"?[o]:o,d),this)}queryRenderedFeatures(b,o){if(!this.style)return[];let d;const m=b instanceof l.P||Array.isArray(b),g=m?b:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(m?{}:b)||{},g instanceof l.P||typeof g[0]=="number")d=[l.P.convert(g)];else{const v=l.P.convert(g[0]),S=l.P.convert(g[1]);d=[v,new l.P(S.x,v.y),S,new l.P(v.x,S.y),v]}return this.style.queryRenderedFeatures(d,o,this.transform)}querySourceFeatures(b,o){return this.style.querySourceFeatures(b,o)}setStyle(b,o){return(o=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(b,o))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const o=this._locale[b];if(o==null)throw new Error(`Missing UI string '${b}'`);return o}_updateStyle(b,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(b,o));const d=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new il(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,o,d):this.style.loadJSON(b,o,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new il(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,o){if(typeof b=="string"){const d=this._requestManager.transformRequest(b,"Style");l.h(d,new AbortController).then(m=>{this._updateDiff(m.data,o)}).catch(m=>{m&&this.fire(new l.j(m))})}else typeof b=="object"&&this._updateDiff(b,o)}_updateDiff(b,o){try{this.style.setState(b,o)&&this._update(!0)}catch(d){l.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(b,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(b,o){return this._lazyInitEmptyStyle(),this.style.addSource(b,o),this._update(!0)}isSourceLoaded(b){const o=this.style&&this.style.sourceCaches[b];if(o!==void 0)return o.loaded();this.fire(new l.j(new Error(`There is no source with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const o=this.style.sourceCaches[b.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&o.reload();for(const d in this.style._layers){const m=this.style._layers[d];m.type==="hillshade"&&m.source===b.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Cp(this.painter,o,b),this.painter.renderToTexture=new gg(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==b.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:b})),this}getTerrain(){var b,o;return(o=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const o in b){const d=b[o]._tiles;for(const m in d){const g=d[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}addImage(b,o,d={}){const{pixelRatio:m=1,sdf:g=!1,stretchX:v,stretchY:S,content:I,textFitWidth:M,textFitHeight:B}=d;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||l.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:F,height:N,data:X}=o,Q=o;return this.style.addImage(b,{data:new l.R({width:F,height:N},new Uint8Array(X)),pixelRatio:m,stretchX:v,stretchY:S,content:I,textFitWidth:M,textFitHeight:B,sdf:g,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,b),this}}{const{width:F,height:N,data:X}=T.getImageData(o);this.style.addImage(b,{data:new l.R({width:F,height:N},X),pixelRatio:m,stretchX:v,stretchY:S,content:I,textFitWidth:M,textFitHeight:B,sdf:g,version:0})}}updateImage(b,o){const d=this.style.getImage(b);if(!d)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=o instanceof HTMLImageElement||l.b(o)?T.getImageData(o):o,{width:g,height:v,data:S}=m;if(g===void 0||v===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==d.data.width||v!==d.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(o instanceof HTMLImageElement||l.b(o));return d.data.replace(S,I),this.style.updateImage(b,d),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return q.getImage(this._requestManager.transformRequest(b,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,o){return this._lazyInitEmptyStyle(),this.style.addLayer(b,o),this._update(!0)}moveLayer(b,o){return this.style.moveLayer(b,o),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,o,d){return this.style.setLayerZoomRange(b,o,d),this._update(!0)}setFilter(b,o,d={}){return this.style.setFilter(b,o,d),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,o,d,m={}){return this.style.setPaintProperty(b,o,d,m),this._update(!0)}getPaintProperty(b,o){return this.style.getPaintProperty(b,o)}setLayoutProperty(b,o,d,m={}){return this.style.setLayoutProperty(b,o,d,m),this._update(!0)}getLayoutProperty(b,o){return this.style.getLayoutProperty(b,o)}setGlyphs(b,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,o,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,o,d,m=>{m||this._update(!0)}),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,o,d=>{d||this._update(!0)}),this}setLight(b,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(b){return this._lazyInitEmptyStyle(),this.style.setSky(b),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(b,o){return this.style.setFeatureState(b,o),this._update()}removeFeatureState(b,o){return this.style.removeFeatureState(b,o),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,o=0;return this._container&&(b=this._container.clientWidth||400,o=this._container.clientHeight||300),[b,o]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const o=this._canvasContainer=R.create("div","maplibregl-canvas-container",b);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),m=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],m);const g=this._controlContainer=R.create("div","maplibregl-control-container",b),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{v[S]=R.create("div",`maplibregl-ctrl-${S} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,o,d){this._canvas.width=Math.floor(d*b),this._canvas.height=Math.floor(d*o),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const b={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{o={requestedAttributes:b},m&&(o.statusMessage=m.statusMessage,o.type=m.type)},{once:!0});const d=this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b);if(!d){const m="Failed to initialize WebGL";throw o?(o.message=m,new Error(JSON.stringify(o))):new Error(m)}this.painter=new qu(d,this.transform),D.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,v=T.now();this.style.zoomHistory.update(g,v);const S=new l.z(g,{now:v,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),I=S.crossFadingFactor();I===1&&I===this._crossFadingFactor||(d=!0,this._crossFadingFactor=I),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bf.mark(l.bg.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const m=this._sourcesDirty||this._styleDirty||this._placementDirty;return m||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,l.bf.mark(l.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),q.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o!=null&&o.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bf.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(b=>{l.bf.frame(b),this._frameRequest=null,this._render(b)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return _g}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=Gr,c.MapTouchEvent=Ta,c.MapWheelEvent=ug,c.Marker=rh,c.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const o=this._map.getZoom(),d=o===this._map.getMaxZoom(),m=o===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,d)=>{const m=this._map._getUIString(`NavigationControl.${d}`);o.title=m,o.setAttribute("aria-label",m)},this.options=l.e({},py,b),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fy(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,o){const d=R.create("button",b,this._container);return d.type="button",d.addEventListener("click",o),d}},c.Popup=class extends l.E{constructor(b){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ri(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!o)return;const m=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const v=nh(this.options.offset);if(!g){const I=this._container.offsetWidth,M=this._container.offsetHeight;let B;B=m.y+v.bottom.y<M?["top"]:m.y>this._map.transform.height-M?["bottom"]:[],m.x<I/2?B.push("left"):m.x>this._map.transform.width-I/2&&B.push("right"),g=B.length===0?"bottom":B.join("-")}let S=m.add(v[g]);this.options.subpixelPositioning||(S=S.round()),R.setTransform(this._container,`${bl[g]} translate(${S.x}px,${S.y}px)`),ih(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Rt),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=l.N.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const o=document.createDocumentFragment(),d=document.createElement("body");let m;for(d.innerHTML=b;m=d.firstChild,m;)o.appendChild(m);return this.setDOMContent(o)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){return this._container&&this._container.classList.add(b),this}removeClassName(b){return this._container&&this._container.classList.remove(b),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(sh);b&&b.focus()}},c.RasterDEMTileSource=xi,c.RasterTileSource=Yt,c.ScaleControl=class{constructor(b){this._onMove=()=>{Nc(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Nc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Jn),b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=wn,c.Style=il,c.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=ml,c.TwoFingersTouchRotateHandler=wp,c.TwoFingersTouchZoomHandler=vp,c.TwoFingersTouchZoomRotateHandler=Ep,c.VectorTileSource=jo,c.VideoSource=Go,c.addSourceType=(b,o)=>l._(void 0,void 0,void 0,function*(){if(Vo(b))throw new Error(`A source type called "${b}" already exists.`);((d,m)=>{ga[d]=m})(b,o)}),c.clearPrewarmedResources=function(){const b=si;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(cr),si=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return rs().getRTLTextPluginStatus()},c.getVersion=function(){return Mp},c.getWorkerCount=function(){return Dr.workerCount},c.getWorkerUrl=function(){return l.a.WORKER_URL},c.importScriptInWorkers=function(b){return Gn().broadcast("IS",b)},c.prewarm=function(){wi().acquire(cr)},c.setMaxParallelImageRequests=function(b){l.a.MAX_PARALLEL_IMAGE_REQUESTS=b},c.setRTLTextPlugin=function(b,o){return rs().setRTLTextPlugin(b,o)},c.setWorkerCount=function(b){Dr.workerCount=b},c.setWorkerUrl=function(b){l.a.WORKER_URL=b}});var n=i;return n})})(qM);var Da=qM.exports;const jF=HM(Da),o_=$M({__proto__:null,default:jF},[Da]),GF="https://api.olamaps.io/tiles/vector/v1/styles/default-light-standard/style.json?key=0.4.0",VF="https://api.olamaps.io/tiles/vector/v1/3dtiles/tileset.json",$F=t=>`<svg width="108" height="18" viewBox="0 0 108 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M31.0629 8.9393L34.6986 15.7293H38.2743L31.0629 2.2793L23.8516 15.7293H27.4273L31.0629 8.9393Z" fill="${t}"/><path d="M19.2265 12.5798L19.2365 2.25977H16.0703V15.7298H22.163L23.851 12.5798H19.2265Z" fill="${t}"/><path d="M7.22135 1.7793C5.79466 1.77733 4.39943 2.19909 3.21222 2.99123C2.025 3.78337 1.09915 4.91029 0.551806 6.22939C0.00446369 7.5485 -0.139771 9.00051 0.137352 10.4017C0.414475 11.8029 1.1005 13.0903 2.10863 14.1011C3.11676 15.1118 4.40168 15.8004 5.80082 16.0798C7.19996 16.3592 8.65043 16.2168 9.96872 15.6707C11.287 15.1245 12.4139 14.1991 13.2067 13.0116C13.9995 11.824 14.4227 10.4277 14.4227 8.9993C14.4227 7.08617 13.6643 5.25125 12.3141 3.89753C10.9639 2.5438 9.13219 1.78195 7.22135 1.7793ZM7.22135 12.8893C6.45207 12.8933 5.69892 12.6685 5.05735 12.2435C4.41579 11.8184 3.91469 11.2123 3.61755 10.5019C3.32041 9.79141 3.24061 9.00864 3.38827 8.25274C3.53592 7.49684 3.90438 6.80184 4.44695 6.25581C4.98952 5.70978 5.68178 5.3373 6.43601 5.18558C7.19023 5.03385 7.97246 5.10971 8.68358 5.40354C9.3947 5.69737 10.0027 6.19594 10.4305 6.83607C10.8583 7.4762 11.0867 8.22908 11.0867 8.9993C11.0867 9.51015 10.9862 10.016 10.791 10.4879C10.5957 10.9599 10.3095 11.3887 9.94873 11.7499C9.58794 12.1112 9.15963 12.3977 8.68823 12.5932C8.21684 12.7887 7.71161 12.8893 7.20138 12.8893H7.22135Z" fill="${t}"/><path d="M55.5634 4.82953V4.33953L50.4296 15.7295H49.4308L44.3768 4.33953V4.82953L43.9773 15.7295H42.9785L43.438 2.26953H44.5766L49.7104 13.8095C49.8003 14.0495 49.9102 14.2895 49.9801 14.5095C50.0543 14.2675 50.1513 14.0332 50.2698 13.8095L55.3437 2.26953H56.4723L56.9318 15.7295H55.933L55.5634 4.82953Z" fill="${t}"/><path d="M60.3287 15.7495H59.25L65.2428 2.26953H66.5513L72.5441 15.7495H71.4254L69.6875 11.8395H62.0666L60.3287 15.7495ZM66.4614 4.54953C66.2216 3.96953 66.0019 3.41953 65.8621 3.01953C65.7322 3.41953 65.5125 4.01953 65.2928 4.54953L62.4462 10.9095H69.288L66.4614 4.54953Z" fill="${t}"/><path d="M79.1611 2.14062C82.6669 2.14062 84.4048 3.62063 84.4048 6.62063C84.4048 9.62063 82.6669 11.0706 79.211 11.0706H75.9949V15.5906H74.9961V2.14062H79.1611ZM79.1611 10.1406C82.0077 10.1406 83.436 8.97062 83.416 6.61062C83.396 4.25062 82.0077 3.06062 79.1411 3.06062H75.9949V10.1406H79.1611Z" fill="${t}"/><path d="M95.1406 3.9293C93.7557 3.25763 92.2346 2.91539 90.6959 2.9293C88.8481 2.9293 87.6995 4.0193 87.6995 5.2293C87.6995 6.8693 88.5984 7.3593 91.6248 8.3693C94.6511 9.3793 95.9995 10.3693 95.9995 12.3693C95.9995 14.9993 93.942 15.9293 91.6947 15.9293C89.6115 15.9429 87.5948 15.1964 86.0215 13.8293L86.5009 13.0693C87.9375 14.3316 89.7833 15.0282 91.6947 15.0293C93.902 15.0293 95.0007 14.1193 95.0007 12.4893C95.0007 10.8593 94.1617 10.2093 90.9356 9.1293C88.069 8.1793 86.7007 7.5993 86.7007 5.2793C86.7007 3.3993 88.2488 2.0293 90.6959 2.0293C92.3497 2.03153 93.9817 2.40754 95.4702 3.1293L95.1406 3.9293Z" fill="${t}"/></svg>`;async function Rm(t,e,i,r){return r._parse(t,e,i,r)}function Ui(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const E1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),HT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);HT&&parseFloat(HT[1]);const Mv=globalThis,a_=globalThis.process||{},HF=globalThis.navigator||{};function XM(t){var e,i;if(typeof window<"u"&&((e=window.process)==null?void 0:e.type)==="renderer"||typeof process<"u"&&(i=process.versions)!=null&&i.electron)return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function yc(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||XM()}function qF(t){return yc()?XM()?"Electron":(HF.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const KM="4.0.7";function WF(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class XF{constructor(e,i,r="sessionStorage"){this.storage=WF(r),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function KF(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function JF(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var F0;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(F0||(F0={}));const ZF=10;function qT(t){return typeof t!="string"?t:(t=t.toUpperCase(),F0[t]||F0.WHITE)}function YF(t,e,i){return!yc&&typeof t=="string"&&(e&&(t=`\x1B[${qT(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${qT(i)+ZF}m${t}\x1B[49m`)),t}function QF(t,e=["constructor"]){const i=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(i),s=t;for(const n of r){const c=s[n];typeof c=="function"&&(e.find(l=>n===l)||(s[n]=c.bind(t)))}}function F2(t,e){if(!t)throw new Error("Assertion failed")}function Eh(){var t,e,i;let r;if(yc()&&Mv.performance)r=(e=(t=Mv==null?void 0:Mv.performance)==null?void 0:t.now)==null?void 0:e.call(t);else if("hrtime"in a_){const s=(i=a_==null?void 0:a_.hrtime)==null?void 0:i.call(a_);r=s[0]*1e3+s[1]/1e6}else r=Date.now();return r}const Ah={debug:yc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},eN={enabled:!0,level:0};function Th(){}const WT={},XT={once:!0};class Gd{constructor({id:e}={id:""}){this.VERSION=KM,this._startTs=Eh(),this._deltaTs=Eh(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new XF(`__probe-${this.id}__`,eN),this.timeStamp(`${this.id} started`),QF(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Eh()-this._startTs).toPrecision(10))}getDelta(){return Number((Eh()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Ah.warn,arguments,XT)}error(e){return this._getLogFunction(0,e,Ah.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,Ah.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,Ah.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,Ah.debug||Ah.info,arguments,XT)}table(e,i,r){return i?this._getLogFunction(e,i,console.table||Th,r&&[r],{tag:iN(i)}):Th}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||Th)}group(e,i,r={collapsed:!1}){const s=KT({logLevel:e,message:i,opts:r}),{collapsed:n}=r;return s.method=(n?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,i,r={}){return this.group(e,i,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Th)}withGroup(e,i,r){this.group(e,i)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=JM(e)}_getLogFunction(e,i,r,s,n){if(this._shouldLog(e)){n=KT({logLevel:e,message:i,args:s,opts:n}),r=r||n.method,F2(r),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=Eh();const c=n.tag||n.message;if(n.once&&c)if(!WT[c])WT[c]=Eh();else return Th;return i=tN(this.id,n.message,n),r.bind(console,i,...n.args)}return Th}}Gd.VERSION=KM;function JM(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return F2(Number.isFinite(e)&&e>=0),e}function KT(t){const{logLevel:e,message:i}=t;t.logLevel=JM(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&r.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return F2(s==="string"||s==="object"),Object.assign(t,{args:r},t.opts)}function tN(t,e,i){if(typeof e=="string"){const r=i.time?JF(KF(i.total)):"";e=i.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=YF(e,i.color,i.background)}return e}function iN(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}globalThis.probe={};const ZM=new Gd({id:"@probe.gl/log"}),Pv="4.3.1",rN=Pv[0]>="0"&&Pv[0]<="9"?`v${Pv}`:"";function sN(){const t=new Gd({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=rN,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const nN=sN();function oN(t,e){return YM(t||{},e)}function YM(t,e,i=0){if(i>3)return e;const r={...t};for(const[s,n]of Object.entries(e))n&&typeof n=="object"&&!Array.isArray(n)?r[s]=YM(r[s]||{},e[s],i+1):r[s]=e[s];return r}function aN(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}function lN(t){var e,i;return((i=(e=globalThis.loaders)==null?void 0:e.modules)==null?void 0:i[t])||null}const cN="latest";function uN(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const QM=uN();function Ya(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const lo=typeof process!="object"||String(process)!=="[object process]"||process.browser,N2=typeof importScripts=="function",hN=typeof window<"u"&&typeof window.orientation<"u",JT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);JT&&parseFloat(JT[1]);class dN{constructor(e,i){O(this,"name"),O(this,"workerThread"),O(this,"isRunning",!0),O(this,"result"),O(this,"_resolve",()=>{}),O(this,"_reject",()=>{}),this.name=e,this.workerThread=i,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){Ya(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ya(this.isRunning),this.isRunning=!1,this._reject(e)}}class kv{terminate(){}}const Bv=new Map;function pN(t){Ya(t.source&&!t.url||!t.source&&t.url);let e=Bv.get(t.source||t.url);return e||(t.url&&(e=fN(t.url),Bv.set(t.url,e)),t.source&&(e=eP(t.source),Bv.set(t.source,e))),Ya(e),e}function fN(t){if(!t.startsWith("http"))return t;const e=mN(t);return eP(e)}function eP(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function mN(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function tP(t,e=!0,i){const r=i||new Set;if(t){if(ZT(t))r.add(t);else if(ZT(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)&&e&&typeof t=="object")for(const s in t)tP(t[s],e,r)}return i===void 0?Array.from(r):[]}function ZT(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Lv=()=>{};class Uw{constructor(e){O(this,"name"),O(this,"source"),O(this,"url"),O(this,"terminated",!1),O(this,"worker"),O(this,"onMessage"),O(this,"onError"),O(this,"_loadableURL","");const{name:i,source:r,url:s}=e;Ya(r||s),this.name=i,this.source=r,this.url=s,this.onMessage=Lv,this.onError=n=>console.log(n),this.worker=lo?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&lo||typeof kv<"u"&&!lo}destroy(){this.onMessage=Lv,this.onError=Lv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||tP(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=pN({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new kv(i,{eval:!1})}else if(this.source)e=new kv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class gN{constructor(e){O(this,"name","unnamed"),O(this,"source"),O(this,"url"),O(this,"maxConcurrency",1),O(this,"maxMobileConcurrency",1),O(this,"onDebug",()=>{}),O(this,"reuseWorkers",!0),O(this,"props",{}),O(this,"jobQueue",[]),O(this,"idleQueue",[]),O(this,"count",0),O(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Uw.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(s,n,c)=>s.done(c),r=(s,n)=>s.error(n)){const s=new Promise(n=>(this.jobQueue.push({name:e,onMessage:i,onError:r,onStart:n}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const r=new dN(i.name,e);e.onMessage=s=>i.onMessage(r,s.type,s.payload),e.onError=s=>i.onError(r,s),i.onStart(r);try{await r.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!lo||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Uw({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return hN?this.maxMobileConcurrency:this.maxConcurrency}}const _N={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},iP=class Fh{constructor(e){O(this,"props"),O(this,"workerPools",new Map),this.props={..._N},this.setProps(e),this.workerPools=new Map}static isSupported(){return Uw.isSupported()}static getWorkerFarm(e={}){return Fh._workerFarm=Fh._workerFarm||new Fh({}),Fh._workerFarm.setProps(e),Fh._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:r,url:s}=e;let n=this.workerPools.get(i);return n||(n=new gN({name:i,source:r,url:s}),n.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};O(iP,"_workerFarm");let rP=iP;function yN(t,e={}){const i=e[t.id]||{},r=lo?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=i.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(lo?s=`modules/${t.module}/dist/${r}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let n=t.version;n==="latest"&&(n=cN);const c=n?`@${n}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${c}/dist/${r}`}return Ya(s),s}function vN(t,e=QM){Ya(t,"no worker provided");const i=t.version;return!(!e||!i)}const Ov={};async function fu(t,e=null,i={},r=null){return e&&(t=bN(t,e,i,r)),Ov[t]=Ov[t]||wN(t),await Ov[t]}function bN(t,e,i={},r=null){if(!i.useLocalLibraries&&t.startsWith("http"))return t;r=r||t;const s=i.modules||{};return s[r]?s[r]:lo?i.CDN?(Ya(i.CDN.startsWith("http")),`${i.CDN}/${e}@${QM}/dist/libs/${r}`):N2?`../src/libs/${r}`:`modules/${e}/src/libs/${r}`:`modules/${e}/dist/libs/${r}`}async function wN(t){if(t.endsWith("wasm"))return await EN(t);if(!lo)try{const{requireFromFile:i}=globalThis.loaders||{};return await(i==null?void 0:i(t))}catch(i){return console.error(i),null}if(N2)return importScripts(t);const e=await AN(t);return xN(e,t)}function xN(t,e){if(!lo){const{requireFromString:r}=globalThis.loaders||{};return r==null?void 0:r(t,e)}if(N2)return eval.call(globalThis,t),null;const i=document.createElement("script");i.id=e;try{i.appendChild(document.createTextNode(t))}catch{i.text=t}return document.body.appendChild(i),null}async function EN(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return lo||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function AN(t){const{readFileAsText:e}=globalThis.loaders||{};return lo||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function TN(t,e){return!rP.isSupported()||!lo&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function SN(t,e,i,r,s){const n=t.id,c=yN(t,i),l=rP.getWorkerFarm(i).getWorkerPool({name:n,url:c});i=JSON.parse(JSON.stringify(i)),r=JSON.parse(JSON.stringify(r||{}));const f=await l.startJob("process-on-worker",CN.bind(null,s));return f.postMessage("process",{input:e,options:i,context:r}),await(await f.result).result}async function CN(t,e,i,r){switch(i){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:n,options:c}=r;try{const l=await t(n,c);e.postMessage("done",{id:s,result:l})}catch(l){const f=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:s,error:f})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function IN(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?YT(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?YT(t,0,e):""}function YT(t,e,i){if(t.byteLength<=e+i)return"";const r=new DataView(t);let s="";for(let n=0;n<i;n++)s+=String.fromCharCode(r.getUint8(e+n));return s}function RN(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${IN(t)}"`)}}function MN(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const r=new Uint8Array(t),s=new Uint8Array(e);for(let n=0;n<r.length;++n)if(r[n]!==s[n])return!1;return!0}function PN(...t){return kN(t)}function kN(t){const e=t.map(n=>n instanceof ArrayBuffer?new Uint8Array(n):n),i=e.reduce((n,c)=>n+c.byteLength,0),r=new Uint8Array(i);let s=0;for(const n of e)r.set(n,s),s+=n.byteLength;return r.buffer}function U2(t,e,i){const r=i!==void 0?new Uint8Array(t).subarray(e,e+i):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function Mm(t,e){return Ui(t>=0),Ui(e>0),t+(e-1)&~(e-1)}function BN(t,e,i){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const s=t.byteOffset,n=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,s,n)}return e.set(r,i),i+Mm(r.byteLength,4)}async function LN(t){const e=[];for await(const i of t)e.push(i);return PN(...e)}function QT(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class eS{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=QT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(QT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Vd{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:r}=e;let s=this.stats[i];return s||(e instanceof eS?s=e:s=new eS(i,r),this.stats[i]=s),s}}const ON="Queued Requests",DN="Active Requests",FN="Cancelled Requests",NN="Queued Requests Ever",UN="Active Requests Ever",zN={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class jN{constructor(e={}){O(this,"props"),O(this,"stats"),O(this,"activeRequestCount",0),O(this,"requestQueue",[]),O(this,"requestMap",new Map),O(this,"updateTimer",null),this.props={...zN,...e},this.stats=new Vd({id:this.props.id}),this.stats.get(ON),this.stats.get(DN),this.stats.get(FN),this.stats.get(NN),this.stats.get(UN)}scheduleRequest(e,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:i},s=new Promise(n=>(r.resolve=n,r));return this.requestQueue.push(r),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:i,resolve:r}=e;let s=!1;const n=()=>{s||(s=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:n}):Promise.resolve({done:n})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let i=0;i<e;++i){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let i=0;i<e.length;++i){const r=e[i];this._updateRequest(r)||(e.splice(i,1),this.requestMap.delete(r.handle),i--)}e.sort((i,r)=>i.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let GN="";const tS={};function VN(t){for(const e in tS)if(t.startsWith(e)){const i=tS[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${GN}${t}`),t}function $N(t){return t&&typeof t=="object"&&t.isBuffer}function sP(t){if($N(t)||t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function HN(){var t;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const e=(t=window.location)==null?void 0:t.pathname;return(e==null?void 0:e.slice(0,e.lastIndexOf("/")+1))||""}function nP(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function z2(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function qN(...t){const e=[];for(let n=0;n<t.length;n++)e[n]=t[n];let i="",r=!1,s;for(let n=e.length-1;n>=-1&&!r;n--){let c;n>=0?c=e[n]:(s===void 0&&(s=HN()),c=s),c.length!==0&&(i=`${c}/${i}`,r=c.charCodeAt(0)===xf)}return i=WN(i,!r),r?`/${i}`:i.length>0?i:"."}const xf=47,Dv=46;function WN(t,e){let i="",r=-1,s=0,n,c=!1;for(let l=0;l<=t.length;++l){if(l<t.length)n=t.charCodeAt(l);else{if(n===xf)break;n=xf}if(n===xf){if(!(r===l-1||s===1))if(r!==l-1&&s===2){if(i.length<2||!c||i.charCodeAt(i.length-1)!==Dv||i.charCodeAt(i.length-2)!==Dv){if(i.length>2){const f=i.length-1;let y=f;for(;y>=0&&i.charCodeAt(y)!==xf;--y);if(y!==f){i=y===-1?"":i.slice(0,y),r=l,s=0,c=!1;continue}}else if(i.length===2||i.length===1){i="",r=l,s=0,c=!1;continue}}e&&(i.length>0?i+="/..":i="..",c=!0)}else{const f=t.slice(r+1,l);i.length>0?i+=`/${f}`:i=f,c=!1}r=l,s=0}else n===Dv&&s!==-1?++s:s=-1}return i}const XN=t=>typeof t=="boolean",zf=t=>typeof t=="function",Pm=t=>t!==null&&typeof t=="object",iS=t=>Pm(t)&&t.constructor==={}.constructor,KN=t=>!!t&&typeof t[Symbol.iterator]=="function",JN=t=>t&&typeof t[Symbol.asyncIterator]=="function",Iu=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ru=t=>typeof Blob<"u"&&t instanceof Blob,ZN=t=>t&&typeof t=="object"&&t.isBuffer,YN=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Pm(t)&&zf(t.tee)&&zf(t.cancel)&&zf(t.getReader),QN=t=>Pm(t)&&zf(t.read)&&zf(t.pipe)&&XN(t.readable),oP=t=>YN(t)||QN(t);class e9 extends Error{constructor(e,i){super(e),O(this,"reason"),O(this,"url"),O(this,"response"),this.reason=i.reason,this.url=i.url,this.response=i.response}}const t9=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,i9=/^([-\w.]+\/[-\w.+]+)/;function rS(t,e){return t.toLowerCase()===e.toLowerCase()}function r9(t){const e=i9.exec(t);return e?e[1]:t}function sS(t){const e=t9.exec(t);return e?e[1]:""}const aP=/\?.*/;function s9(t){const e=t.match(aP);return e&&e[0]}function j2(t){return t.replace(aP,"")}function n9(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function A1(t){return Iu(t)?t.url:Ru(t)?t.name||"":typeof t=="string"?t:""}function G2(t){if(Iu(t)){const e=t,i=e.headers.get("content-type")||"",r=j2(e.url);return r9(i)||sS(r)}return Ru(t)?t.type||"":typeof t=="string"?sS(t):""}function o9(t){return Iu(t)?t.headers["content-length"]||-1:Ru(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function lP(t){if(Iu(t))return t;const e={},i=o9(t);i>=0&&(e["content-length"]=String(i));const r=A1(t),s=G2(t);s&&(e["content-type"]=s);const n=await c9(t);n&&(e["x-first-bytes"]=n),typeof t=="string"&&(t=new TextEncoder().encode(t));const c=new Response(t,{headers:e});return Object.defineProperty(c,"url",{value:r}),c}async function a9(t){if(!t.ok)throw await l9(t)}async function l9(t){const e=n9(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const r={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&s!=null&&s.includes("application/json")?await t.json():await t.text()}catch{}return new e9(i,r)}async function c9(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const e=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var n;return i((n=s==null?void 0:s.target)==null?void 0:n.result)},r.readAsDataURL(e)})}if(t instanceof ArrayBuffer){const e=t.slice(0,5);return`data:base64,${u9(e)}`}return null}function u9(t){let e="";const i=new Uint8Array(t);for(let r=0;r<i.byteLength;r++)e+=String.fromCharCode(i[r]);return btoa(e)}function h9(t){return!d9(t)&&!p9(t)}function d9(t){return t.startsWith("http:")||t.startsWith("https:")}function p9(t){return t.startsWith("data:")}async function nS(t,e){var i,r;if(typeof t=="string"){const s=VN(t);return h9(s)&&(i=globalThis.loaders)!=null&&i.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(s,e):await fetch(s,e)}return await lP(t)}const oS=new Gd({id:"loaders.gl"});class f9{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class m9{constructor(){O(this,"console"),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const cP={fetch:null,mimeType:void 0,nothrow:!1,log:new m9,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:E1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},g9={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function uP(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function hP(){const t=uP();return t.globalOptions=t.globalOptions||{...cP},t.globalOptions}function _9(t,e,i,r){return i=i||[],i=Array.isArray(i)?i:[i],y9(t,i),b9(e,t,r)}function y9(t,e){aS(t,null,cP,g9,e);for(const i of e){const r=t&&t[i.id]||{},s=i.options&&i.options[i.id]||{},n=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};aS(r,i.id,s,n,e)}}function aS(t,e,i,r,s){const n=e||"Top level",c=e?`${e}.`:"";for(const l in t){const f=!e&&Pm(t[l]),y=l==="baseUri"&&!e,E=l==="workerUrl"&&e;if(!(l in i)&&!y&&!E){if(l in r)oS.warn(`${n} loader option '${c}${l}' no longer supported, use '${r[l]}'`)();else if(!f){const T=v9(l,s);oS.warn(`${n} loader option '${c}${l}' not recognized. ${T}`)()}}}}function v9(t,e){const i=t.toLowerCase();let r="";for(const s of e)for(const n in s.options){if(t===n)return`Did you mean '${s.id}.${n}'?`;const c=n.toLowerCase();(i.startsWith(c)||c.startsWith(i))&&(r=r||`Did you mean '${s.id}.${n}'?`)}return r}function b9(t,e,i){const r={...t.options||{}};return w9(r,i),r.log===null&&(r.log=new f9),lS(r,hP()),lS(r,e),r}function lS(t,e){for(const i in e)if(i in e){const r=e[i];iS(r)&&iS(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function w9(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function V2(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function $2(t){Ui(t,"null loader"),Ui(V2(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const dP=()=>{const t=uP();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function x9(t){const e=dP();t=Array.isArray(t)?t:[t];for(const i of t){const r=$2(i);e.find(s=>r===s)||e.unshift(r)}}function E9(){return dP()}const A9=/\.([^.]+)$/;async function T9(t,e=[],i,r){if(!pP(t))return null;let s=cS(t,e,{...i,nothrow:!0},r);if(s)return s;if(Ru(t)&&(t=await t.slice(0,10).arrayBuffer(),s=cS(t,e,i,r)),!s&&!(i!=null&&i.nothrow))throw new Error(fP(t));return s}function cS(t,e=[],i,r){if(!pP(t))return null;if(e&&!Array.isArray(e))return $2(e);let s=[];e&&(s=s.concat(e)),i!=null&&i.ignoreRegisteredLoaders||s.push(...E9()),C9(s);const n=S9(t,s,i,r);if(!n&&!(i!=null&&i.nothrow))throw new Error(fP(t));return n}function S9(t,e,i,r){const s=A1(t),n=G2(t),c=j2(s)||(r==null?void 0:r.url);let l=null,f="";return i!=null&&i.mimeType&&(l=Fv(e,i==null?void 0:i.mimeType),f=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),l=l||I9(e,c),f=f||(l?`matched url ${c}`:""),l=l||Fv(e,n),f=f||(l?`matched MIME type ${n}`:""),l=l||M9(e,t),f=f||(l?`matched initial data ${mP(t)}`:""),i!=null&&i.fallbackMimeType&&(l=l||Fv(e,i==null?void 0:i.fallbackMimeType),f=f||(l?`matched fallback MIME type ${n}`:"")),f&&nN.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${f}.`),l}function pP(t){return!(t instanceof Response&&t.status===204)}function fP(t){const e=A1(t),i=G2(t);let r="No valid loader found (";r+=e?`${nP(e)}, `:"no url provided, ",r+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const s=t?mP(t):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function C9(t){for(const e of t)$2(e)}function I9(t,e){const i=e&&A9.exec(e),r=i&&i[1];return r?R9(t,r):null}function R9(t,e){e=e.toLowerCase();for(const i of t)for(const r of i.extensions)if(r.toLowerCase()===e)return i;return null}function Fv(t,e){var i;for(const r of t)if((i=r.mimeTypes)!=null&&i.some(s=>rS(e,s))||rS(e,`application/x.${r.id}`))return r;return null}function M9(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(P9(e,i))return i}else if(ArrayBuffer.isView(e)){if(uS(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&uS(e,0,i))return i;return null}function P9(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function uS(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(r=>k9(t,e,i,r))}function k9(t,e,i,r){if(r instanceof ArrayBuffer)return MN(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const s=zw(t,e,r.length);return r===s;default:return!1}}function mP(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?zw(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?zw(t,0,e):""}function zw(t,e,i){if(t.byteLength<e+i)return"";const r=new DataView(t);let s="";for(let n=0;n<i;n++)s+=String.fromCharCode(r.getUint8(e+n));return s}const B9=256*1024;function*L9(t,e){const i=(e==null?void 0:e.chunkSize)||B9;let r=0;const s=new TextEncoder;for(;r<t.length;){const n=Math.min(t.length-r,i),c=t.slice(r,r+n);r+=n,yield s.encode(c)}}const O9=256*1024;function*D9(t,e={}){const{chunkSize:i=O9}=e;let r=0;for(;r<t.byteLength;){const s=Math.min(t.byteLength-r,i),n=new ArrayBuffer(s),c=new Uint8Array(t,r,s);new Uint8Array(n).set(c),r+=s,yield n}}const F9=1024*1024;async function*N9(t,e){const i=(e==null?void 0:e.chunkSize)||F9;let r=0;for(;r<t.size;){const s=r+i,n=await t.slice(r,s).arrayBuffer();r=s,yield n}}function hS(t,e){return E1?U9(t,e):z9(t)}async function*U9(t,e){const i=t.getReader();let r;try{for(;;){const s=r||i.read();e!=null&&e._streamReadAhead&&(r=i.read());const{done:n,value:c}=await s;if(n)return;yield sP(c)}}catch{i.releaseLock()}}async function*z9(t,e){for await(const i of t)yield sP(i)}function j9(t,e){if(typeof t=="string")return L9(t,e);if(t instanceof ArrayBuffer)return D9(t,e);if(Ru(t))return N9(t,e);if(oP(t))return hS(t,e);if(Iu(t))return hS(t.body,e);throw new Error("makeIterator")}const gP="Cannot convert supplied data type";function G9(t,e,i){if(e.text&&typeof t=="string")return t;if(ZN(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+s)),r}throw new Error(gP)}async function V9(t,e,i){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return G9(t,e);if(Ru(t)&&(t=await lP(t)),Iu(t)){const s=t;return await a9(s),e.binary?await s.arrayBuffer():await s.text()}if(oP(t)&&(t=j9(t,i)),KN(t)||JN(t))return LN(t);throw new Error(gP)}function _P(t,e){const i=hP(),r=t||i;return typeof r.fetch=="function"?r.fetch:Pm(r.fetch)?s=>nS(s,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:nS}function $9(t,e,i){if(i)return i;const r={fetch:_P(e,t),...t};if(r.url){const s=j2(r.url);r.baseUrl=s,r.queryString=s9(r.url),r.filename=nP(s),r.baseUrl=z2(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function H9(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...r]:r}return i&&i.length?i:void 0}async function N0(t,e,i,r){e&&!Array.isArray(e)&&!V2(e)&&(r=void 0,i=e,e=void 0),t=await t,i=i||{};const s=A1(t),n=H9(e,r),c=await T9(t,n,i);return c?(i=_9(i,c,n,s),r=$9({url:s,_parse:N0,loaders:n},i,r||null),await q9(c,t,i,r)):null}async function q9(t,e,i,r){if(vN(t),i=oN(t.options,i),Iu(e)){const n=e,{ok:c,redirected:l,status:f,statusText:y,type:E,url:T}=n,R=Object.fromEntries(n.headers.entries());r.response={headers:R,ok:c,redirected:l,status:f,statusText:y,type:E,url:T}}e=await V9(e,t,i);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,i,r);if(TN(t,i))return await SN(t,e,i,r,N0);if(s.parseText&&typeof e=="string")return await s.parseText(e,i,r);if(s.parse)return await s.parse(e,i,r);throw Ya(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function W9(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function yP(t){let e=1/0,i=1/0,r=1/0,s=-1/0,n=-1/0,c=-1/0;const l=t.POSITION?t.POSITION.value:[],f=l&&l.length;for(let y=0;y<f;y+=3){const E=l[y],T=l[y+1],R=l[y+2];e=E<e?E:e,i=T<i?T:i,r=R<r?R:r,s=E>s?E:s,n=T>n?T:n,c=R>c?R:c}return[[e,i,r],[s,n,c]]}function X9(t,e,i){const r=W9(e.value),s=i||K9(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:s}}function K9(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function dc(t,e,i,r){let s,n;!Array.isArray(e)&&!V2(e)?(s=[],n=e):(s=e,n=i);const c=_P(n);let l=t;return typeof t=="string"&&(l=await c(t)),Ru(t)&&(l=await c(t)),Array.isArray(s)?await N0(l,s,n):await N0(l,s,n)}const J9="4.3.1";var dS;const Z9=(dS=globalThis.loaders)==null?void 0:dS.parseImageNode,jw=typeof Image<"u",Gw=typeof ImageBitmap<"u",Y9=!!Z9,Vw=E1?!0:Y9;function Q9(t){switch(t){case"auto":return Gw||jw||Vw;case"imagebitmap":return Gw;case"image":return jw;case"data":return Vw;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function e7(){if(Gw)return"imagebitmap";if(jw)return"image";if(Vw)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function t7(t){const e=i7(t);if(!e)throw new Error("Not an image");return e}function vP(t){switch(t7(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function i7(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const r7=/^data:image\/svg\+xml/,s7=/\.svg((\?|#).*)?$/;function H2(t){return t&&(r7.test(t)||s7.test(t))}function n7(t,e){if(H2(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return bP(t,e)}function bP(t,e){if(H2(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function wP(t,e,i){const r=n7(t,i),s=self.URL||self.webkitURL,n=typeof r!="string"&&s.createObjectURL(r);try{return await o7(n||r,e)}finally{n&&s.revokeObjectURL(n)}}async function o7(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((r,s)=>{try{i.onload=()=>r(i),i.onerror=n=>{const c=n instanceof Error?n.message:"error";s(new Error(c))}}catch(n){s(n)}})}const a7={};let pS=!0;async function l7(t,e,i){let r;H2(i)?r=await wP(t,e,i):r=bP(t,i);const s=e&&e.imagebitmap;return await c7(r,s)}async function c7(t,e=null){if((u7(e)||!pS)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),pS=!1}return await createImageBitmap(t)}function u7(t){for(const e in t||a7)return!1;return!0}function h7(t){return!m7(t,"ftyp",4)||!(t[8]&96)?null:d7(t)}function d7(t){switch(p7(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function p7(t,e,i){return String.fromCharCode(...t.slice(e,i))}function f7(t){return[...t].map(e=>e.charCodeAt(0))}function m7(t,e,i=0){const r=f7(e);for(let s=0;s<r.length;++s)if(r[s]!==t[s+i])return!1;return!0}const ca=!1,jf=!0;function q2(t){const e=km(t);return _7(e)||b7(e)||y7(e)||v7(e)||g7(e)}function g7(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=h7(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function _7(t){const e=km(t);return e.byteLength>=24&&e.getUint32(0,ca)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ca),height:e.getUint32(20,ca)}:null}function y7(t){const e=km(t);return e.byteLength>=10&&e.getUint32(0,ca)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,jf),height:e.getUint16(8,jf)}:null}function v7(t){const e=km(t);return e.byteLength>=14&&e.getUint16(0,ca)===16973&&e.getUint32(2,jf)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,jf),height:e.getUint32(22,jf)}:null}function b7(t){const e=km(t);if(!(e.byteLength>=3&&e.getUint16(0,ca)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=w7();let s=2;for(;s+9<e.byteLength;){const n=e.getUint16(s,ca);if(r.has(n))return{mimeType:"image/jpeg",height:e.getUint16(s+5,ca),width:e.getUint16(s+7,ca)};if(!i.has(n))return null;s+=2,s+=e.getUint16(s,ca)}return null}function w7(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function km(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function x7(t,e){var i;const{mimeType:r}=q2(t)||{},s=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Ui(s),await s(t,r)}async function E7(t,e,i){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=i||{},n=A7(r);let c;switch(n){case"imagebitmap":c=await l7(t,e,s);break;case"image":c=await wP(t,e,s);break;case"data":c=await x7(t);break;default:Ui(!1)}return r==="data"&&(c=vP(c)),c}function A7(t){switch(t){case"auto":case"data":return e7();default:return Q9(t),t}}const T7=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],S7=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],C7={image:{type:"auto",decode:!0}},xP={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:J9,mimeTypes:S7,extensions:T7,parse:E7,tests:[t=>!!q2(new DataView(t))],options:C7},Nv={};function I7(t){if(Nv[t]===void 0){const e=E1?M7(t):R7(t);Nv[t]=e}return Nv[t]}function R7(t){var e,i;const r=["image/png","image/jpeg","image/gif"],s=((e=globalThis.loaders)==null?void 0:e.imageFormatsNode)||r;return!!((i=globalThis.loaders)!=null&&i.parseImageNode)&&s.includes(t)}function M7(t){switch(t){case"image/avif":case"image/webp":return P7(t);default:return!0}}function P7(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const fi=new Gd({id:"deck"});let $w={};function k7(t){$w=t}function Rs(t,e,i,r){fi.level>0&&$w[t]&&$w[t].call(null,e,i,r)}function B7(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const L7={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:B7,parseTextSync:JSON.parse};function O7(){const t="9.0.35",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(fi.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:fi,_registerLoggers:k7},x9([L7,[xP,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const D7=O7();function lu(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Uv={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function F7(t){const e={};for(const[i,r]of Object.entries(t))e[i]=U7(r);return e}function N7(t,e,i){const r={};for(const[s,n]of Object.entries(e))t&&s in t&&!n.private?(n.validate&&lu(n.validate(t[s],n),`${i}: invalid ${s}`),r[s]=t[s]):r[s]=n.value;return r}function U7(t){let e=fS(t);if(e!=="object")return{value:t,...Uv[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Uv[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=fS(t.value),{...t,...Uv[e],type:e}):{type:"object",value:null};throw new Error("props")}function fS(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const z7=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,j7=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,G7={vertex:z7,fragment:j7},mS=/void\s+main\s*\([^)]*\)\s*\{\n?/,gS=/}\n?[^{}]*$/,zv=[],Y_="__LUMA_INJECT_DECLARATIONS__";function V7(t){const e={vertex:{},fragment:{}};for(const i in t){let r=t[i];const s=$7(i);typeof r=="string"&&(r={order:0,injection:r}),e[s][i]=r}return e}function $7(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function U0(t,e,i,r=!1){const s=e==="vertex";for(const n in i){const c=i[n];c.sort((f,y)=>f.order-y.order),zv.length=c.length;for(let f=0,y=c.length;f<y;++f)zv[f]=c[f].injection;const l=`${zv.join(`
`)}
`;switch(n){case"vs:#decl":s&&(t=t.replace(Y_,l));break;case"vs:#main-start":s&&(t=t.replace(mS,f=>f+l));break;case"vs:#main-end":s&&(t=t.replace(gS,f=>l+f));break;case"fs:#decl":s||(t=t.replace(Y_,l));break;case"fs:#main-start":s||(t=t.replace(mS,f=>f+l));break;case"fs:#main-end":s||(t=t.replace(gS,f=>l+f));break;default:t=t.replace(n,f=>f+l)}}return t=t.replace(Y_,""),r&&(t=t.replace(/\}\s*$/,n=>n+G7[e])),t}let H7=1;class cu{constructor(e){O(this,"name"),O(this,"vs"),O(this,"fs"),O(this,"getModuleUniforms"),O(this,"dependencies"),O(this,"deprecations"),O(this,"defines"),O(this,"injections"),O(this,"uniforms",{}),O(this,"uniformTypes",{});const{name:i,vs:r,fs:s,dependencies:n=[],uniformTypes:c={},uniformPropTypes:l={},getUniforms:f,deprecations:y=[],defines:E={},inject:T={}}=e;lu(typeof i=="string"),this.name=i,this.vs=r,this.fs=s,this.getModuleUniforms=f,this.dependencies=cu.instantiateModules(n),this.deprecations=this._parseDeprecationDefinitions(y),this.defines=E,this.injections=V7(T),this.uniformTypes=c,l&&(this.uniforms=F7(l))}static instantiateModules(e){return e.map(i=>{if(i instanceof cu)return i;lu(typeof i!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(i)}' and use it directly.`),i.name||(console.warn("shader module has no name"),i.name=`shader-module-${H7++}`);const r=new cu(i);return r.dependencies=cu.instantiateModules(i.dependencies||[]),r})}getModuleSource(e){let i;switch(e){case"vertex":i=this.vs||"";break;case"fragment":i=this.fs||"";break;default:lu(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${i}

`}getUniforms(e,i){return this.getModuleUniforms?this.getModuleUniforms(e,i):N7(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,i){this.deprecations.forEach(r=>{var s;(s=r.regex)!=null&&s.test(e)&&(r.deprecated?i.deprecated(r.old,r.new)():i.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp(`\\b${i.old}\\(`);break;default:i.regex=new RegExp(`${i.type} ${i.old};`)}}),e}_defaultGetUniforms(e={}){const i={},r=this.uniforms;for(const s in r){const n=r[s];s in e&&!n.private?(n.validate&&lu(n.validate(e[s],n),`${this.name}: invalid ${s}`),i[s]=e[s]):i[s]=n.value}return i}}function _S(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=yS(t.platformInfo,t.vs);let i;return t.fs&&(i=yS(t.platformInfo,t.fs)),{...t,vs:e,fs:i}}function yS(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function T1(t){const e=cu.instantiateModules(t);return q7(e)}function q7(t){const e={},i={};return EP({modules:t,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((r,s)=>i[s]-i[r]).map(r=>e[r])}function EP(t){const{modules:e,level:i,moduleMap:r,moduleDepth:s}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const n of e)r[n.name]=n,(s[n.name]===void 0||s[n.name]<i)&&(s[n.name]=i);for(const n of e)n.dependencies&&EP({modules:n.dependencies,level:i+1,moduleMap:r,moduleDepth:s})}function W7(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function X7(t,e){var i;if(Number(((i=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=vS(t,K7),t;case"fragment":return t=vS(t,J7),t;default:throw new Error(e)}}const AP=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],K7=[...AP,[Hw("attribute"),"in $1"],[Hw("varying"),"out $1"]],J7=[...AP,[Hw("varying"),"in $1"]];function vS(t,e){for(const[i,r]of e)t=t.replace(i,r);return t}function Hw(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function TP(t,e){let i="";for(const r in t){const s=t[r];if(i+=`void ${s.signature} {
`,s.header&&(i+=`  ${s.header}`),e[r]){const n=e[r];n.sort((c,l)=>c.order-l.order);for(const c of n)i+=`  ${c.injection}
`}s.footer&&(i+=`  ${s.footer}`),i+=`}
`}return i}function SP(t){const e={vertex:{},fragment:{}};for(const i of t){let r,s;typeof i!="string"?(r=i,s=r.hook):(r={},s=i),s=s.trim();const[n,c]=s.split(":"),l=s.replace(/\(.+/,""),f=Object.assign(r,{signature:c});switch(n){case"vs":e.vertex[l]=f;break;case"fs":e.fragment[l]=f;break;default:throw new Error(n)}}return e}function Z7(t,e){return{name:Y7(t,e),language:"glsl",version:Q7(t)}}function Y7(t,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return i?i[1]:e}function Q7(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const CP=`

${Y_}
`,eU=`precision highp float;
`;function tU(t){const e=T1(t.modules||[]);return{source:qw(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:W2(e)}}function iU(t){const e=T1(t.modules||[]);return{vs:qw(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:qw(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:W2(e)}}function rU(t){const{vs:e,fs:i}=t,r=T1(t.modules||[]);return{vs:bS(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:bS(t.platformInfo,{...t,source:i,stage:"fragment",modules:r}),getUniforms:W2(r)}}function qw(t,e){const{source:i,stage:r,modules:s,hookFunctions:n=[],inject:c={},log:l}=e;lu(typeof i=="string","shader source must be a string");const f=i;let y="";const E=SP(n),T={},R={},D={};for(const H in c){const ee=typeof c[H]=="string"?{injection:c[H],order:0}:c[H],z=/^(v|f)s:(#)?([\w-]+)$/.exec(H);if(z){const W=z[2],q=z[3];W?q==="decl"?R[H]=[ee]:D[H]=[ee]:T[H]=[ee]}else D[H]=[ee]}const V=t.type!=="webgpu"?s:[];for(const H of V){l&&H.checkDeprecations(f,l);const ee=H.getModuleSource(r,"wgsl");y+=ee;const z=H.injections[r];for(const W in z){const q=/^(v|f)s:#([\w-]+)$/.exec(W);if(q){const ce=q[2]==="decl"?R:D;ce[W]=ce[W]||[],ce[W].push(z[W])}else T[W]=T[W]||[],T[W].push(z[W])}}return y+=CP,y=U0(y,r,R),y+=TP(E[r],T),y+=f,y=U0(y,r,D),y}function bS(t,e){const{id:i,source:r,stage:s,language:n="glsl",modules:c,defines:l={},hookFunctions:f=[],inject:y={},prologue:E=!0,log:T}=e;lu(typeof r=="string","shader source must be a string");const R=n==="glsl"?Z7(r).version:-1,D=t.shaderLanguageVersion,V=R===100?"#version 100":"#version 300 es",H=r.split(`
`).slice(1).join(`
`),ee={};c.forEach(re=>{Object.assign(ee,re.getDefines())}),Object.assign(ee,l);let z="";switch(n){case"wgsl":break;case"glsl":z=E?`${V}

// ----- PROLOGUE -------------------------
${sU({id:i,source:r,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}
${W7(t)}
${s==="fragment"?eU:""}

// ----- APPLICATION DEFINES -------------------------

${nU(ee)}

`:`${V}
`;break}const W=SP(f),q={},ce={},we={};for(const re in y){const be=typeof y[re]=="string"?{injection:y[re],order:0}:y[re],me=/^(v|f)s:(#)?([\w-]+)$/.exec(re);if(me){const Te=me[2],Pe=me[3];Te?Pe==="decl"?ce[re]=[be]:we[re]=[be]:q[re]=[be]}else we[re]=[be]}for(const re of c){T&&re.checkDeprecations(H,T);const be=re.getModuleSource(s);z+=be;const me=re.injections[s];for(const Te in me){const Pe=/^(v|f)s:#([\w-]+)$/.exec(Te);if(Pe){const ze=Pe[2]==="decl"?ce:we;ze[Te]=ze[Te]||[],ze[Te].push(me[Te])}else q[Te]=q[Te]||[],q[Te].push(me[Te])}}return z+="// ----- MAIN SHADER SOURCE -------------------------",z+=CP,z=U0(z,s,ce),z+=TP(W[s],q),z+=H,z=U0(z,s,we),n==="glsl"&&R!==D&&(z=X7(z,s)),z.trim()}function W2(t){return function(e){const i={};for(const r of t){const s=r.getUniforms(e,i);Object.assign(i,s)}return i}}function sU(t){const{id:e,source:i,stage:r}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function nU(t={}){let e="";for(const i in t){const r=t[i];(r||Number.isFinite(r))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}const IP=class Ef{constructor(){O(this,"_hookFunctions",[]),O(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Ef.defaultShaderAssembler=Ef.defaultShaderAssembler||new Ef,Ef.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const i=this._getModuleList(e.modules),r=this._hookFunctions,s=_S(e);return{...tU({platformInfo:e.platformInfo,...s,modules:i,hookFunctions:r}),modules:i}}assembleShaderPair(e){const i=_S(e),r=this._getModuleList(e.modules),s=this._hookFunctions,{platformInfo:n}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?iU({platformInfo:n,...i,modules:r,hookFunctions:s}):rU({platformInfo:n,...i,modules:r,hookFunctions:s}),modules:r}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),r={};let s=0;for(let n=0,c=this._defaultModules.length;n<c;++n){const l=this._defaultModules[n],f=l.name;i[s++]=l,r[f]=!0}for(let n=0,c=e.length;n<c;++n){const l=e[n],f=l.name;r[f]||(i[s++]=l,r[f]=!0)}return i.length=s,cu.instantiateModules(i)}};O(IP,"defaultShaderAssembler");let RP=IP;const oU=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,aU=`#version 300 es
${oU}`;function lU(t){const{input:e,inputChannels:i,output:r}={};if(!e)return aU;if(!i)throw new Error("inputChannels");const s=cU(i),n=uU(e,i);return`#version 300 es
in ${s} ${e};
out vec4 ${r};
void main() {
  ${r} = ${n};
}`}function cU(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function uU(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const Qe=new Gd({id:"luma.gl"});class hU{constructor(){O(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Vd({id:e})),this.stats.get(e)}}const X2=new hU;function dU(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(yc()&&Qe.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:Qe,stats:X2}),t}const pU=dU();function fU(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function dm(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:fU(t)}const jv={};function vc(t="id"){jv[t]=jv[t]||1;const e=jv[t]++;return`${t}-${e}`}function z0(t){let e=!0;for(const i in t){e=!1;break}return e}var Gv;let Oi=(Gv=class{constructor(t,e,i){if(O(this,"id"),O(this,"props"),O(this,"userData",{}),O(this,"_device"),O(this,"destroyed",!1),O(this,"allocatedBytes",0),O(this,"_attachedResources",new Set),!t)throw new Error("no device");this._device=t,this.props=mU(e,i);const r=this.props.id!=="undefined"?this.props.id:vc(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(t),i.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}},O(Gv,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Gv);function mU(t,e){const i={...e};for(const r in t)t[r]!==void 0&&(i[r]=t[r]);return i}const kn=class Q_ extends Oi{constructor(e,i){const r={...i};(i.usage||0)&Q_.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?r.indexType="uint32":i.data instanceof Uint16Array&&(r.indexType="uint16")),super(e,r,Q_.defaultProps),O(this,"usage"),O(this,"indexType"),O(this,"updateTimestamp"),O(this,"debugData",new ArrayBuffer(0)),this.usage=i.usage||0,this.indexType=r.indexType,this.updateTimestamp=e.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(e,i){throw new Error("not implemented")}_setDebugData(e,i,r){const s=ArrayBuffer.isView(e)?e.buffer:e,n=Math.min(e?e.byteLength:r,Q_.DEBUG_DATA_MAX_LENGTH);e===null?this.debugData=new ArrayBuffer(n):i===0&&r===e.byteLength?this.debugData=s.slice(0,n):this.debugData=s.slice(i,i+n)}};O(kn,"defaultProps",{...Oi.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),O(kn,"MAP_READ",1),O(kn,"MAP_WRITE",2),O(kn,"COPY_SRC",4),O(kn,"COPY_DST",8),O(kn,"INDEX",16),O(kn,"VERTEX",32),O(kn,"UNIFORM",64),O(kn,"STORAGE",128),O(kn,"INDIRECT",256),O(kn,"QUERY_RESOLVE",512),O(kn,"DEBUG_DATA_MAX_LENGTH",32);let yr=kn;function MP(t){const e=wS[t],i=gU(e),r=t.includes("norm"),s=!r&&!t.startsWith("float"),n=t.startsWith("s");return{dataType:wS[t],byteLength:i,integer:s,signed:n,normalized:r}}function gU(t){return _U[t]}const wS={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},_U={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},yU=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],vU=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function bU(t){return yU.some(e=>t.startsWith(e))}function PP(t){const e=vU.exec(t);if(e){const[,i,r,s,n,c]=e;if(i){const l=`${s}${r}`,f=MP(l);return{format:i,components:i.length,srgb:n==="-srgb",unsized:c==="-unsized",webgl:c==="-webgl",...f}}}return xU(t)}const wU={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function xU(t){var e;const i=wU[t];if(!i)throw new Error(`Unknown format ${t}`);return{format:i.format||"",components:i.components||((e=i.format)==null?void 0:e.length)||1,byteLength:i.bpp||1,srgb:!1,unsized:!1}}class EU{}class AU{constructor(e=[],i){O(this,"features"),O(this,"disabledFeatures"),this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Ww=class kP{constructor(e){O(this,"id"),O(this,"props"),O(this,"userData",{}),O(this,"statsManager",X2),O(this,"_lumaData",{}),O(this,"timestamp",0),this.props={...kP.defaultProps,...e},this.id=this.props.id||vc(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return bU(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&yr.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":Qe.warn("indices buffer content must be of integer type")()),i}};O(Ww,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Qe.get("debug"),spector:!!(Qe.get("spector")||Qe.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:t=>Qe.error(t.message)}),O(Ww,"VERSION",pU);let j0=Ww;function bi(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const nf=new Map,e0=class BP{static registerDevices(e){for(const i of e)bi(i.type&&i.isSupported&&i.create),nf.set(i.type,i)}static getAvailableDevices(){return Array.from(nf).map(e=>e.type)}static getSupportedDevices(){return Array.from(nf).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(j0.defaultProps,e)}static async attachDevice(e){const i=xS(e.devices)||nf;if(e.handle instanceof WebGL2RenderingContext){const r=i.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=i.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var i,r;e={...BP.defaultProps,...e},e.gl&&(e.type="webgl");const s=xS(e.devices)||nf;let n,c;switch(e.type){case"webgpu":if(n=s.get("webgpu"),n)return await n.create(e);break;case"webgl":if(c=s.get("webgl"),c)return await c.create(e);break;case"unknown":const l=s.get("unknown");if(l)return await l.create(e);break;case"best-available":if(n=s.get("webgpu"),(i=n==null?void 0:n.isSupported)!=null&&i.call(n))return await n.create(e);if(c=s.get("webgl"),(r=c==null?void 0:c.isSupported)!=null&&r.call(c))return await c.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const i=HTMLCanvasElement.prototype;if(!e&&i.originalGetContext){i.getContext=i.originalGetContext,i.originalGetContext=void 0;return}i.originalGetContext=i.getContext,i.getContext=function(r,s){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",s):this.originalGetContext(r,s)}}};O(e0,"defaultProps",{...j0.defaultProps,type:"best-available",devices:void 0}),O(e0,"stats",X2),O(e0,"log",Qe);let t0=e0;function xS(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const i of t)e.set(i.type,i);return e}const TU=yc()&&typeof document<"u",S1=()=>TU&&document.readyState==="complete",SU={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class K2{constructor(e){if(O(this,"id"),O(this,"props"),O(this,"canvas"),O(this,"htmlCanvas"),O(this,"offscreenCanvas"),O(this,"type"),O(this,"width",1),O(this,"height",1),O(this,"resizeObserver"),O(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1}),this.props={...SU,...e},e=this.props,!yc()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=RU(e.canvas):this.canvas=e.canvas;else{const i=MU(e),r=IU((e==null?void 0:e.container)||null);r.insertBefore(i,r.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const r of i)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return S1()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:i}=this._canvasSizeInfo;return i?e/i:1}catch{return 1}}cssToDevicePixels(e,i=!0){const r=this.cssToDeviceRatio(),[s,n]=this.getDrawingBufferSize();return PU(e,r,s,n,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let r="width"in i?i.width:this.htmlCanvas.clientWidth,s="height"in i?i.height:this.htmlCanvas.clientHeight;(!r||!s)&&(Qe.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const n=this._canvasSizeInfo;if(n.clientWidth!==r||n.clientHeight!==s||n.devicePixelRatio!==e){let c=e;const l=Math.floor(r*c),f=Math.floor(s*c);this.htmlCanvas.width=l,this.htmlCanvas.height=f;const[y,E]=this.getDrawingBufferSize();(y!==l||E!==f)&&(c=Math.min(y/r,E/s),this.htmlCanvas.width=Math.floor(r*c),this.htmlCanvas.height=Math.floor(s*c),Qe.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}O(K2,"pageLoaded",CU());function CU(){return S1()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function IU(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!S1())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function RU(t){const e=document.getElementById(t);if(!e&&!S1())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function MU(t){const{width:e,height:i}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=i||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(i)?`${i}px`:"100%",r}function PU(t,e,i,r,s){const n=t,c=ES(n[0],e,i);let l=AS(n[1],e,r,s),f=ES(n[0]+1,e,i);const y=f===i-1?f:f-1;f=AS(n[1]+1,e,r,s);let E;return s?(f=f===0?f:f+1,E=l,l=f):E=f===r-1?f:f-1,{x:c,y:l,width:Math.max(y-c+1,1),height:Math.max(E-l+1,1)}}function ES(t,e,i){return Math.min(Math.round(t*e),i-1)}function AS(t,e,i,r){return r?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const eu=class LP extends Oi{constructor(e,i,r=LP.defaultProps){super(e,i,r),O(this,"dimension"),O(this,"format"),O(this,"width"),O(this,"height"),O(this,"depth"),O(this,"updateTimestamp"),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=e.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};O(eu,"defaultProps",{...Oi.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),O(eu,"COPY_SRC",1),O(eu,"COPY_DST",2),O(eu,"TEXTURE_BINDING",4),O(eu,"STORAGE_BINDING",8),O(eu,"RENDER_ATTACHMENT",16);let Mo=eu;const OP=class DP extends Oi{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,DP.defaultProps)}};O(OP,"defaultProps",{...Oi.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let FP=OP;function kU(t,e,i){let r="";const s=e.split(/\r?\n/),n=t.slice().sort((c,l)=>c.lineNum-l.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let c=0;for(let l=1;l<=s.length;l++)for(r+=NP(s[l-1],l,i);n.length>c&&n[c].lineNum===l;){const f=n[c++];r+=TS(f,s,f.lineNum,{...i,inlineSource:!1})}return r;case"issues":case"no":for(const l of t)r+=TS(l,s,l.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return r}}function TS(t,e,i,r){if(r!=null&&r.inlineSource){const s=BU(e,i),n=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${n}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function BU(t,e,i){let r="";for(let s=e-2;s<=e;s++){const n=t[s-1];n!==void 0&&(r+=NP(n,e,i))}return r}function NP(t,e,i){const r=i!=null&&i.html?OU(t):t;return`${LU(String(e),4)}: ${r}${i!=null&&i.html?"<br/>":`
`}`}function LU(t,e){let i="";for(let r=t.length;r<e;++r)i+=" ";return i+t}function OU(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function UP(t,e){return{name:DU(t,e),language:"glsl",version:FU(t)}}function DU(t,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return i?i[1]:e}function FU(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(e=r)}return e}const zP=class jP extends Oi{constructor(e,i){super(e,{id:NU(i),...i},jP.defaultProps),O(this,"stage"),O(this,"source"),O(this,"compilationStatus","pending"),this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(e=this.props.debug){switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();this.props.debug==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(e){var i;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=UP(this.source).name,s=`${this.stage} ${r}`;let n=kU(e,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(n+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${c}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${n}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l);const f=document.getElementsByClassName("luma-compiler-log-error");(i=f[0])!=null&&i.scrollIntoView&&f[0].scrollIntoView(),l.onclick=()=>{const y=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(y)}}};O(zP,"defaultProps",{...Oi.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let GP=zP;function NU(t){return UP(t.source).name||t.id||vc(`unnamed ${t.stage}-shader`)}const VP=class $P extends Oi{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){super(e,i,$P.defaultProps)}};O(VP,"defaultProps",{...Oi.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let HP=VP;const qP=class WP extends Oi{constructor(e,i={}){super(e,i,WP.defaultProps),O(this,"width"),O(this,"height"),O(this,"colorAttachments",[]),O(this,"depthStencilAttachment",null),this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(e){let i=!e;if(e){const[r,s]=Array.isArray(e)?e:[e.width,e.height];i=i||s!==this.height||r!==this.width,this.width=r,this.height=s}i&&(Qe.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(i=>{if(typeof i=="string"){const r=this.createColorTexture(i);return this.attachResource(r),r.view}return i instanceof Mo?i.view:i});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const i=this.createDepthStencilTexture(e);this.attachResource(i),this.depthStencilAttachment=i.view}else e instanceof Mo?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e){return this.device.createTexture({id:"color-attachment",usage:Mo.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}createDepthStencilTexture(e){return this.device.createTexture({id:"depth-stencil-attachment",usage:Mo.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,i){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const s=this.device._createTexture({...this.colorAttachments[r].props,width:e,height:i});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const r=this.device._createTexture({...this.depthStencilAttachment.props,width:e,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}}};O(qP,"defaultProps",{...Oi.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let XP=qP;const KP=class JP extends Oi{constructor(e,i){super(e,i,JP.defaultProps),O(this,"shaderLayout"),O(this,"bufferLayout"),O(this,"linkStatus","pending"),O(this,"hash",""),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(e){throw new Error("Use uniform blocks")}};O(KP,"defaultProps",{...Oi.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let C1=KP;const ZP=class YP extends Oi{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){super(e,i,YP.defaultProps)}};O(ZP,"defaultProps",{...Oi.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let UU=ZP;const QP=class e4 extends Oi{constructor(e,i){super(e,i,e4.defaultProps),O(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};O(QP,"defaultProps",{...Oi.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let SS=QP;const t4=class i4 extends Oi{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,i4.defaultProps)}};O(t4,"defaultProps",{...Oi.defaultProps,measureExecutionTime:void 0});let zU=t4;const r4=class s4 extends Oi{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,s4.defaultProps)}};O(r4,"defaultProps",{...Oi.defaultProps});let jU=r4;function GU(t){const[e,i]=$U[t],r=e==="i32"||e==="u32",s=e!=="u32",n=HU[e]*i,c=VU(e,i);return{dataType:e,components:i,defaultVertexFormat:c,byteLength:n,integer:r,signed:s}}function VU(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const $U={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},HU={f32:4,f16:2,i32:4,u32:4};function n4(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,r]=t.split("x"),s=i,n=r?parseInt(r):1,c=MP(s),l={type:s,components:n,byteLength:c.byteLength*n,integer:c.integer,signed:c.signed,normalized:c.normalized};return e&&(l.webglOnly=!0),l}function o4(t,e){const i={};for(const r of t.attributes)i[r.name]=WU(t,e,r.name);return i}function qU(t,e,i=16){const r=o4(t,e),s=new Array(i).fill(null);for(const n of Object.values(r))s[n.location]=n;return s}function WU(t,e,i){const r=XU(t,i),s=KU(e,i);if(!r)return null;const n=GU(r.type),c=(s==null?void 0:s.vertexFormat)||n.defaultVertexFormat,l=n4(c);return{attributeName:(s==null?void 0:s.attributeName)||r.name,bufferName:(s==null?void 0:s.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:n.dataType,shaderComponents:n.components,vertexFormat:c,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:n.integer,stepMode:(s==null?void 0:s.stepMode)||r.stepMode,byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function XU(t,e){const i=t.attributes.find(r=>r.name===e);return i||Qe.warn(`shader layout attribute "${e}" not present in shader`),i||null}function KU(t,e){JU(t);let i=ZU(t,e);return i||(i=YU(t,e),i)?i:(Qe.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function JU(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Qe.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function ZU(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function YU(t,e){var i;for(const r of t){let s=r.byteStride;if(typeof r.byteStride!="number")for(const c of r.attributes||[]){const l=n4(c.format);s+=l.byteLength}const n=(i=r.attributes)==null?void 0:i.find(c=>c.attribute===e);if(n)return{attributeName:n.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:n.format,byteOffset:n.byteOffset,byteStride:s}}return null}function QU(t,e){const i={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const s=i.attributes.find(n=>n.name===r.name);s?(s.type=r.type||s.type,s.stepMode=r.stepMode||s.stepMode):Qe.warn(`shader layout attribute ${r.name} not present in shader`)}return i}const a4=class l4 extends Oi{constructor(e,i){super(e,i,l4.defaultProps),O(this,"maxVertexAttributes"),O(this,"attributeInfos"),O(this,"indexBuffer",null),O(this,"attributes"),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=qU(i.renderPipeline.shaderLayout,i.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(e,i){throw new Error("constant attributes not supported")}};O(a4,"defaultProps",{...Oi.defaultProps,renderPipeline:null});let ez=a4;const c4=class u4 extends Oi{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,u4.defaultProps)}};O(c4,"defaultProps",{...Oi.defaultProps,layout:void 0,buffers:{}});let tz=c4;const h4=class d4 extends Oi{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,d4.defaultProps)}};O(h4,"defaultProps",{...Oi.defaultProps,type:void 0,count:void 0});let iz=h4;const rz={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function sz(t){const e=rz[t];return bi(t),e}function nz(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let l_;function p4(t){return(!l_||l_.byteLength<t)&&(l_=new ArrayBuffer(t)),l_}function oz(t,e){const i=p4(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function az(t){const{target:e,source:i,start:r=0,count:s=1}=t,n=i.length,c=s*n;let l=0;for(let f=r;l<n;l++)e[f++]=i[l];for(;l<c;)l<c-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+c-l),l=c);return t.target}const CS=1024;class lz{constructor(e){O(this,"layout",{}),O(this,"byteLength");let i=0;for(const[s,n]of Object.entries(e)){const c=sz(n),{type:l,components:f}=c;i=nz(i,f);const y=i;i+=f,this.layout[s]={type:l,size:f,offset:y}}i+=(4-i%4)%4;const r=i*4;this.byteLength=Math.max(r,CS)}getData(e){const i=Math.max(this.byteLength,CS),r=p4(i),s={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[n,c]of Object.entries(e)){const l=this.layout[n];if(!l){Qe.warn(`Supplied uniform value ${n} not present in uniform block layout`)();continue}const{type:f,size:y,offset:E}=l,T=s[f];if(y===1){if(typeof c!="number"&&typeof c!="boolean"){Qe.warn(`Supplied value for single component uniform ${n} is not a number: ${c}`)();continue}T[E]=Number(c)}else{const R=dm(c);if(!R){Qe.warn(`Supplied value for multi component / array uniform ${n} is not a numeric array: ${c}`)();continue}T.set(R,E)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function cz(t,e,i=16){if(t!==e)return!1;const r=dm(t);if(!r)return!1;const s=dm(e);if(s&&r.length===s.length){for(let n=0;n<r.length;++n)if(s[n]!==r[n])return!1}return!0}function uz(t){const e=dm(t);return e?e.slice():t}class hz{constructor(e){O(this,"name"),O(this,"uniforms",{}),O(this,"modifiedUniforms",{}),O(this,"modified",!0),O(this,"bindingLayout",{}),O(this,"needsRedraw","initialized");var i;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&e!=null&&e.shaderLayout){const r=(i=e==null?void 0:e.shaderLayout.bindings)==null?void 0:i.find(n=>n.type==="uniform"&&n.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const s=r;for(const n of s.uniforms||[])this.bindingLayout[n.name]=n}}setUniforms(e){for(const[i,r]of Object.entries(e))this._setUniform(i,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,i){cz(this.uniforms[e],i)||(this.uniforms[e]=uz(i),this.modifiedUniforms[e]=!0,this.modified=!0)}}class dz{constructor(e){O(this,"uniformBlocks",new Map),O(this,"uniformBufferLayouts",new Map),O(this,"uniformBuffers",new Map);for(const[i,r]of Object.entries(e)){const s=i,n=new lz(r.uniformTypes||{});this.uniformBufferLayouts.set(s,n);const c=new hz({name:i});c.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(s,c)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[i,r]of Object.entries(e))this.uniformBlocks.get(i).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const i=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(i)}createUniformBuffer(e,i,r){r&&this.setUniforms(r);const s=this.getUniformBufferByteLength(i),n=e.createBuffer({usage:yr.UNIFORM|yr.COPY_DST,byteLength:s}),c=this.getUniformBufferData(i);return n.write(c),n}getManagedUniformBuffer(e,i){if(!this.uniformBuffers.get(i)){const r=this.getUniformBufferByteLength(i),s=e.createBuffer({usage:yr.UNIFORM|yr.COPY_DST,byteLength:r});this.uniformBuffers.set(i,s)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let e=!1;for(const i of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(i);e||(e=r)}return e&&Qe.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const i=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let s=!1;if(r&&i.needsRedraw){s||(s=i.needsRedraw);const n=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(n);const c=this.uniformBlocks.get(e).getAllUniforms();Qe.log(4,`Writing to uniform buffer ${String(e)}`,n,c)()}return s}}function f4(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function m4(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function pz(t,e,i){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let s=f4(t);if(s==="uint8"&&i&&r===1)return"unorm8-webgl";if(s==="uint8"&&i&&r===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return i&&(s=s.replace("int","norm")),`${s}x${r}`}if(s==="uint16"||s==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return i&&(s=s.replace("int","norm")),`${s}x${r}`}return r===1?s:`${s}x${r}`}function fz(t){return dm(t)!==null||typeof t=="number"||typeof t=="boolean"}function J2(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const r=t[i];fz(r)?e.uniforms[i]=r:e.bindings[i]=r}),e}function mz(t,e,i){const{removedProps:r={},deprecatedProps:s={},replacedProps:n={}}=i;for(const l in r)if(l in e){const f=r[l]?`${t}.${r[l]}`:"N/A";Qe.removed(`${t}.${l}`,f)()}for(const l in s)if(l in e){const f=s[l];Qe.deprecated(`${t}.${l}`,`${t}.${f}`)()}let c=null;for(const[l,f]of Object.entries(n))l in e&&(Qe.deprecated(`${t}.${l}`,`${t}.${f}`)(),c=c||Object.assign({},e),c[f]=e[l],delete c[l]);return c||e}let gz="";async function _z(t,e){return await new Promise((i,r)=>{try{const s=new Image;s.onload=()=>i(s),s.onerror=()=>r(new Error(`Could not load image ${t}.`)),s.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",s.src=t.startsWith("http")?t:gz+t}catch(s){r(s)}})}async function g4(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((s,n)=>{r.onload=s,r.onerror=c=>n(new Error(`Unable to load script '${t}': ${c}`)),i.appendChild(r)})}function Xw(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Xw(t[r],e[r],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const n of r)if(!e.hasOwnProperty(n)||!Xw(t[n],e[n],i-1))return!1;return!0}return!1}function yz(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function vz(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class bz{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class tl{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,i){if(e){i(G0.instance);for(const r of e)r instanceof Array?this.searchBlock(r,i):r.search(i);i(V0.instance)}}}class G0 extends tl{}G0.instance=new G0;class V0 extends tl{}V0.instance=new V0;class rr extends tl{constructor(){super()}}class Kw extends rr{constructor(e,i,r,s,n,c){super(),this.calls=new Set,this.name=e,this.args=i,this.returnType=r,this.body=s,this.startLine=n,this.endLine=c}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class wz extends rr{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class xz extends rr{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Ez extends rr{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Az extends rr{constructor(e,i,r,s){super(),this.init=e,this.condition=i,this.increment=r,this.body=s}get astNodeType(){return"for"}search(e){var i,r,s;(i=this.init)===null||i===void 0||i.search(e),(r=this.condition)===null||r===void 0||r.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class ru extends rr{constructor(e,i,r,s,n){super(),this.name=e,this.type=i,this.storage=r,this.access=s,this.value=n}get astNodeType(){return"var"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class _4 extends rr{constructor(e,i,r){super(),this.name=e,this.type=i,this.value=r}get astNodeType(){return"override"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class Jw extends rr{constructor(e,i,r,s,n){super(),this.name=e,this.type=i,this.storage=r,this.access=s,this.value=n}get astNodeType(){return"let"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class IS extends rr{constructor(e,i,r,s,n){super(),this.name=e,this.type=i,this.storage=r,this.access=s,this.value=n}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}var Id;(function(t){t.increment="++",t.decrement="--"})(Id||(Id={}));(function(t){function e(i){const r=i;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(Id||(Id={}));class Tz extends rr{constructor(e,i){super(),this.operator=e,this.variable=i}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var pm;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(pm||(pm={}));(function(t){function e(i){const r=i;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(pm||(pm={}));class Sz extends rr{constructor(e,i,r){super(),this.operator=e,this.variable=i,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class y4 extends rr{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"call"}search(e){for(const i of this.args)i.search(e);e(this)}}class Cz extends rr{constructor(e,i){super(),this.body=e,this.continuing=i}get astNodeType(){return"loop"}}class Iz extends rr{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"body"}}class Rz extends rr{constructor(e,i,r,s){super(),this.condition=e,this.body=i,this.elseif=r,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Mz extends rr{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class Pz extends rr{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class kz extends rr{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Bz extends rr{constructor(e,i){super(),this.severity=e,this.rule=i}get astNodeType(){return"diagnostic"}}class v4 extends rr{constructor(e,i){super(),this.name=e,this.type=i}get astNodeType(){return"alias"}}class Lz extends rr{constructor(){super()}get astNodeType(){return"discard"}}class Oz extends rr{constructor(){super()}get astNodeType(){return"break"}}class Dz extends rr{constructor(){super()}get astNodeType(){return"continue"}}class Mu extends rr{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class tu extends Mu{constructor(e,i,r,s){super(e),this.members=i,this.startLine=r,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let i=0;i<this.members.length;i++)if(this.members[i].name==e)return i;return-1}}class b4 extends Mu{constructor(e,i,r){super(e),this.format=i,this.access=r}get astNodeType(){return"template"}}class Fz extends Mu{constructor(e,i,r,s){super(e),this.storage=i,this.type=r,this.access=s}get astNodeType(){return"pointer"}}class w4 extends Mu{constructor(e,i,r,s){super(e),this.attributes=i,this.format=r,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class Af extends Mu{constructor(e,i,r){super(e),this.format=i,this.access=r}get astNodeType(){return"sampler"}}class ma extends tl{constructor(){super()}}class Nz extends ma{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class ed extends ma{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const i of this.args)i.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class x4 extends ma{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const i of this.args)i.search(e);e(this)}}class Zw extends ma{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const i=e.constants.get(this.name);if(!i)throw new Error("Cannot evaluate node");return i.evaluate(e)}}class RS extends ma{constructor(e,i){super(),this.name=e,this.initializer=i}get astNodeType(){return"constExpr"}evaluate(e){var i,r;if(this.initializer instanceof ed){const s=(i=this.postfix)===null||i===void 0?void 0:i.evaluateString(e),n=(r=this.initializer.type)===null||r===void 0?void 0:r.name,c=e.structs.get(n),l=c==null?void 0:c.getMemberIndex(s);return l!==void 0&&l!=-1?this.initializer.args[l].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class MS extends ma{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Uz extends ma{constructor(e,i){super(),this.type=e,this.value=i}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class PS extends ma{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class zz extends ma{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class E4 extends ma{constructor(){super()}}class jz extends E4{constructor(e,i){super(),this.operator=e,this.right=i}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class ea extends E4{constructor(e,i,r){super(),this.operator=e,this.left=i,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class A4 extends tl{constructor(){super()}}class Gz extends A4{constructor(e,i){super(),this.selector=e,this.body=i}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Vz extends A4{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class $z extends tl{constructor(e,i,r){super(),this.name=e,this.type=i,this.attributes=r}get astNodeType(){return"argument"}}class Hz extends tl{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class qz extends tl{constructor(e,i,r){super(),this.name=e,this.type=i,this.attributes=r}get astNodeType(){return"member"}}let Wz=class extends tl{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}};var Le,Ce;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Ce||(Ce={}));class Ie{constructor(e,i,r){this.name=e,this.type=i,this.rule=r}toString(){return this.name}}class se{}Le=se;se.none=new Ie("",Ce.reserved,"");se.eof=new Ie("EOF",Ce.token,"");se.reserved={asm:new Ie("asm",Ce.reserved,"asm"),bf16:new Ie("bf16",Ce.reserved,"bf16"),do:new Ie("do",Ce.reserved,"do"),enum:new Ie("enum",Ce.reserved,"enum"),f16:new Ie("f16",Ce.reserved,"f16"),f64:new Ie("f64",Ce.reserved,"f64"),handle:new Ie("handle",Ce.reserved,"handle"),i8:new Ie("i8",Ce.reserved,"i8"),i16:new Ie("i16",Ce.reserved,"i16"),i64:new Ie("i64",Ce.reserved,"i64"),mat:new Ie("mat",Ce.reserved,"mat"),premerge:new Ie("premerge",Ce.reserved,"premerge"),regardless:new Ie("regardless",Ce.reserved,"regardless"),typedef:new Ie("typedef",Ce.reserved,"typedef"),u8:new Ie("u8",Ce.reserved,"u8"),u16:new Ie("u16",Ce.reserved,"u16"),u64:new Ie("u64",Ce.reserved,"u64"),unless:new Ie("unless",Ce.reserved,"unless"),using:new Ie("using",Ce.reserved,"using"),vec:new Ie("vec",Ce.reserved,"vec"),void:new Ie("void",Ce.reserved,"void")};se.keywords={array:new Ie("array",Ce.keyword,"array"),atomic:new Ie("atomic",Ce.keyword,"atomic"),bool:new Ie("bool",Ce.keyword,"bool"),f32:new Ie("f32",Ce.keyword,"f32"),i32:new Ie("i32",Ce.keyword,"i32"),mat2x2:new Ie("mat2x2",Ce.keyword,"mat2x2"),mat2x3:new Ie("mat2x3",Ce.keyword,"mat2x3"),mat2x4:new Ie("mat2x4",Ce.keyword,"mat2x4"),mat3x2:new Ie("mat3x2",Ce.keyword,"mat3x2"),mat3x3:new Ie("mat3x3",Ce.keyword,"mat3x3"),mat3x4:new Ie("mat3x4",Ce.keyword,"mat3x4"),mat4x2:new Ie("mat4x2",Ce.keyword,"mat4x2"),mat4x3:new Ie("mat4x3",Ce.keyword,"mat4x3"),mat4x4:new Ie("mat4x4",Ce.keyword,"mat4x4"),ptr:new Ie("ptr",Ce.keyword,"ptr"),sampler:new Ie("sampler",Ce.keyword,"sampler"),sampler_comparison:new Ie("sampler_comparison",Ce.keyword,"sampler_comparison"),struct:new Ie("struct",Ce.keyword,"struct"),texture_1d:new Ie("texture_1d",Ce.keyword,"texture_1d"),texture_2d:new Ie("texture_2d",Ce.keyword,"texture_2d"),texture_2d_array:new Ie("texture_2d_array",Ce.keyword,"texture_2d_array"),texture_3d:new Ie("texture_3d",Ce.keyword,"texture_3d"),texture_cube:new Ie("texture_cube",Ce.keyword,"texture_cube"),texture_cube_array:new Ie("texture_cube_array",Ce.keyword,"texture_cube_array"),texture_multisampled_2d:new Ie("texture_multisampled_2d",Ce.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ie("texture_storage_1d",Ce.keyword,"texture_storage_1d"),texture_storage_2d:new Ie("texture_storage_2d",Ce.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ie("texture_storage_2d_array",Ce.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ie("texture_storage_3d",Ce.keyword,"texture_storage_3d"),texture_depth_2d:new Ie("texture_depth_2d",Ce.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ie("texture_depth_2d_array",Ce.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ie("texture_depth_cube",Ce.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ie("texture_depth_cube_array",Ce.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ie("texture_depth_multisampled_2d",Ce.keyword,"texture_depth_multisampled_2d"),texture_external:new Ie("texture_external",Ce.keyword,"texture_external"),u32:new Ie("u32",Ce.keyword,"u32"),vec2:new Ie("vec2",Ce.keyword,"vec2"),vec3:new Ie("vec3",Ce.keyword,"vec3"),vec4:new Ie("vec4",Ce.keyword,"vec4"),bitcast:new Ie("bitcast",Ce.keyword,"bitcast"),block:new Ie("block",Ce.keyword,"block"),break:new Ie("break",Ce.keyword,"break"),case:new Ie("case",Ce.keyword,"case"),continue:new Ie("continue",Ce.keyword,"continue"),continuing:new Ie("continuing",Ce.keyword,"continuing"),default:new Ie("default",Ce.keyword,"default"),diagnostic:new Ie("diagnostic",Ce.keyword,"diagnostic"),discard:new Ie("discard",Ce.keyword,"discard"),else:new Ie("else",Ce.keyword,"else"),enable:new Ie("enable",Ce.keyword,"enable"),fallthrough:new Ie("fallthrough",Ce.keyword,"fallthrough"),false:new Ie("false",Ce.keyword,"false"),fn:new Ie("fn",Ce.keyword,"fn"),for:new Ie("for",Ce.keyword,"for"),function:new Ie("function",Ce.keyword,"function"),if:new Ie("if",Ce.keyword,"if"),let:new Ie("let",Ce.keyword,"let"),const:new Ie("const",Ce.keyword,"const"),loop:new Ie("loop",Ce.keyword,"loop"),while:new Ie("while",Ce.keyword,"while"),private:new Ie("private",Ce.keyword,"private"),read:new Ie("read",Ce.keyword,"read"),read_write:new Ie("read_write",Ce.keyword,"read_write"),return:new Ie("return",Ce.keyword,"return"),requires:new Ie("requires",Ce.keyword,"requires"),storage:new Ie("storage",Ce.keyword,"storage"),switch:new Ie("switch",Ce.keyword,"switch"),true:new Ie("true",Ce.keyword,"true"),alias:new Ie("alias",Ce.keyword,"alias"),type:new Ie("type",Ce.keyword,"type"),uniform:new Ie("uniform",Ce.keyword,"uniform"),var:new Ie("var",Ce.keyword,"var"),override:new Ie("override",Ce.keyword,"override"),workgroup:new Ie("workgroup",Ce.keyword,"workgroup"),write:new Ie("write",Ce.keyword,"write"),r8unorm:new Ie("r8unorm",Ce.keyword,"r8unorm"),r8snorm:new Ie("r8snorm",Ce.keyword,"r8snorm"),r8uint:new Ie("r8uint",Ce.keyword,"r8uint"),r8sint:new Ie("r8sint",Ce.keyword,"r8sint"),r16uint:new Ie("r16uint",Ce.keyword,"r16uint"),r16sint:new Ie("r16sint",Ce.keyword,"r16sint"),r16float:new Ie("r16float",Ce.keyword,"r16float"),rg8unorm:new Ie("rg8unorm",Ce.keyword,"rg8unorm"),rg8snorm:new Ie("rg8snorm",Ce.keyword,"rg8snorm"),rg8uint:new Ie("rg8uint",Ce.keyword,"rg8uint"),rg8sint:new Ie("rg8sint",Ce.keyword,"rg8sint"),r32uint:new Ie("r32uint",Ce.keyword,"r32uint"),r32sint:new Ie("r32sint",Ce.keyword,"r32sint"),r32float:new Ie("r32float",Ce.keyword,"r32float"),rg16uint:new Ie("rg16uint",Ce.keyword,"rg16uint"),rg16sint:new Ie("rg16sint",Ce.keyword,"rg16sint"),rg16float:new Ie("rg16float",Ce.keyword,"rg16float"),rgba8unorm:new Ie("rgba8unorm",Ce.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ie("rgba8unorm_srgb",Ce.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ie("rgba8snorm",Ce.keyword,"rgba8snorm"),rgba8uint:new Ie("rgba8uint",Ce.keyword,"rgba8uint"),rgba8sint:new Ie("rgba8sint",Ce.keyword,"rgba8sint"),bgra8unorm:new Ie("bgra8unorm",Ce.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ie("bgra8unorm_srgb",Ce.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ie("rgb10a2unorm",Ce.keyword,"rgb10a2unorm"),rg11b10float:new Ie("rg11b10float",Ce.keyword,"rg11b10float"),rg32uint:new Ie("rg32uint",Ce.keyword,"rg32uint"),rg32sint:new Ie("rg32sint",Ce.keyword,"rg32sint"),rg32float:new Ie("rg32float",Ce.keyword,"rg32float"),rgba16uint:new Ie("rgba16uint",Ce.keyword,"rgba16uint"),rgba16sint:new Ie("rgba16sint",Ce.keyword,"rgba16sint"),rgba16float:new Ie("rgba16float",Ce.keyword,"rgba16float"),rgba32uint:new Ie("rgba32uint",Ce.keyword,"rgba32uint"),rgba32sint:new Ie("rgba32sint",Ce.keyword,"rgba32sint"),rgba32float:new Ie("rgba32float",Ce.keyword,"rgba32float"),static_assert:new Ie("static_assert",Ce.keyword,"static_assert")};se.tokens={decimal_float_literal:new Ie("decimal_float_literal",Ce.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Ie("hex_float_literal",Ce.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Ie("int_literal",Ce.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ie("uint_literal",Ce.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Ie("ident",Ce.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ie("and",Ce.token,"&"),and_and:new Ie("and_and",Ce.token,"&&"),arrow:new Ie("arrow ",Ce.token,"->"),attr:new Ie("attr",Ce.token,"@"),forward_slash:new Ie("forward_slash",Ce.token,"/"),bang:new Ie("bang",Ce.token,"!"),bracket_left:new Ie("bracket_left",Ce.token,"["),bracket_right:new Ie("bracket_right",Ce.token,"]"),brace_left:new Ie("brace_left",Ce.token,"{"),brace_right:new Ie("brace_right",Ce.token,"}"),colon:new Ie("colon",Ce.token,":"),comma:new Ie("comma",Ce.token,","),equal:new Ie("equal",Ce.token,"="),equal_equal:new Ie("equal_equal",Ce.token,"=="),not_equal:new Ie("not_equal",Ce.token,"!="),greater_than:new Ie("greater_than",Ce.token,">"),greater_than_equal:new Ie("greater_than_equal",Ce.token,">="),shift_right:new Ie("shift_right",Ce.token,">>"),less_than:new Ie("less_than",Ce.token,"<"),less_than_equal:new Ie("less_than_equal",Ce.token,"<="),shift_left:new Ie("shift_left",Ce.token,"<<"),modulo:new Ie("modulo",Ce.token,"%"),minus:new Ie("minus",Ce.token,"-"),minus_minus:new Ie("minus_minus",Ce.token,"--"),period:new Ie("period",Ce.token,"."),plus:new Ie("plus",Ce.token,"+"),plus_plus:new Ie("plus_plus",Ce.token,"++"),or:new Ie("or",Ce.token,"|"),or_or:new Ie("or_or",Ce.token,"||"),paren_left:new Ie("paren_left",Ce.token,"("),paren_right:new Ie("paren_right",Ce.token,")"),semicolon:new Ie("semicolon",Ce.token,";"),star:new Ie("star",Ce.token,"*"),tilde:new Ie("tilde",Ce.token,"~"),underscore:new Ie("underscore",Ce.token,"_"),xor:new Ie("xor",Ce.token,"^"),plus_equal:new Ie("plus_equal",Ce.token,"+="),minus_equal:new Ie("minus_equal",Ce.token,"-="),times_equal:new Ie("times_equal",Ce.token,"*="),division_equal:new Ie("division_equal",Ce.token,"/="),modulo_equal:new Ie("modulo_equal",Ce.token,"%="),and_equal:new Ie("and_equal",Ce.token,"&="),or_equal:new Ie("or_equal",Ce.token,"|="),xor_equal:new Ie("xor_equal",Ce.token,"^="),shift_right_equal:new Ie("shift_right_equal",Ce.token,">>="),shift_left_equal:new Ie("shift_left_equal",Ce.token,"<<=")};se.simpleTokens={"@":Le.tokens.attr,"{":Le.tokens.brace_left,"}":Le.tokens.brace_right,":":Le.tokens.colon,",":Le.tokens.comma,"(":Le.tokens.paren_left,")":Le.tokens.paren_right,";":Le.tokens.semicolon};se.literalTokens={"&":Le.tokens.and,"&&":Le.tokens.and_and,"->":Le.tokens.arrow,"/":Le.tokens.forward_slash,"!":Le.tokens.bang,"[":Le.tokens.bracket_left,"]":Le.tokens.bracket_right,"=":Le.tokens.equal,"==":Le.tokens.equal_equal,"!=":Le.tokens.not_equal,">":Le.tokens.greater_than,">=":Le.tokens.greater_than_equal,">>":Le.tokens.shift_right,"<":Le.tokens.less_than,"<=":Le.tokens.less_than_equal,"<<":Le.tokens.shift_left,"%":Le.tokens.modulo,"-":Le.tokens.minus,"--":Le.tokens.minus_minus,".":Le.tokens.period,"+":Le.tokens.plus,"++":Le.tokens.plus_plus,"|":Le.tokens.or,"||":Le.tokens.or_or,"*":Le.tokens.star,"~":Le.tokens.tilde,_:Le.tokens.underscore,"^":Le.tokens.xor,"+=":Le.tokens.plus_equal,"-=":Le.tokens.minus_equal,"*=":Le.tokens.times_equal,"/=":Le.tokens.division_equal,"%=":Le.tokens.modulo_equal,"&=":Le.tokens.and_equal,"|=":Le.tokens.or_equal,"^=":Le.tokens.xor_equal,">>=":Le.tokens.shift_right_equal,"<<=":Le.tokens.shift_left_equal};se.regexTokens={decimal_float_literal:Le.tokens.decimal_float_literal,hex_float_literal:Le.tokens.hex_float_literal,int_literal:Le.tokens.int_literal,uint_literal:Le.tokens.uint_literal,ident:Le.tokens.ident};se.storage_class=[Le.keywords.function,Le.keywords.private,Le.keywords.workgroup,Le.keywords.uniform,Le.keywords.storage];se.access_mode=[Le.keywords.read,Le.keywords.write,Le.keywords.read_write];se.sampler_type=[Le.keywords.sampler,Le.keywords.sampler_comparison];se.sampled_texture_type=[Le.keywords.texture_1d,Le.keywords.texture_2d,Le.keywords.texture_2d_array,Le.keywords.texture_3d,Le.keywords.texture_cube,Le.keywords.texture_cube_array];se.multisampled_texture_type=[Le.keywords.texture_multisampled_2d];se.storage_texture_type=[Le.keywords.texture_storage_1d,Le.keywords.texture_storage_2d,Le.keywords.texture_storage_2d_array,Le.keywords.texture_storage_3d];se.depth_texture_type=[Le.keywords.texture_depth_2d,Le.keywords.texture_depth_2d_array,Le.keywords.texture_depth_cube,Le.keywords.texture_depth_cube_array,Le.keywords.texture_depth_multisampled_2d];se.texture_external_type=[Le.keywords.texture_external];se.any_texture_type=[...Le.sampled_texture_type,...Le.multisampled_texture_type,...Le.storage_texture_type,...Le.depth_texture_type,...Le.texture_external_type];se.texel_format=[Le.keywords.r8unorm,Le.keywords.r8snorm,Le.keywords.r8uint,Le.keywords.r8sint,Le.keywords.r16uint,Le.keywords.r16sint,Le.keywords.r16float,Le.keywords.rg8unorm,Le.keywords.rg8snorm,Le.keywords.rg8uint,Le.keywords.rg8sint,Le.keywords.r32uint,Le.keywords.r32sint,Le.keywords.r32float,Le.keywords.rg16uint,Le.keywords.rg16sint,Le.keywords.rg16float,Le.keywords.rgba8unorm,Le.keywords.rgba8unorm_srgb,Le.keywords.rgba8snorm,Le.keywords.rgba8uint,Le.keywords.rgba8sint,Le.keywords.bgra8unorm,Le.keywords.bgra8unorm_srgb,Le.keywords.rgb10a2unorm,Le.keywords.rg11b10float,Le.keywords.rg32uint,Le.keywords.rg32sint,Le.keywords.rg32float,Le.keywords.rgba16uint,Le.keywords.rgba16sint,Le.keywords.rgba16float,Le.keywords.rgba32uint,Le.keywords.rgba32sint,Le.keywords.rgba32float];se.const_literal=[Le.tokens.int_literal,Le.tokens.uint_literal,Le.tokens.decimal_float_literal,Le.tokens.hex_float_literal,Le.keywords.true,Le.keywords.false];se.literal_or_ident=[Le.tokens.ident,Le.tokens.int_literal,Le.tokens.uint_literal,Le.tokens.decimal_float_literal,Le.tokens.hex_float_literal];se.element_count_expression=[Le.tokens.int_literal,Le.tokens.uint_literal,Le.tokens.ident];se.template_types=[Le.keywords.vec2,Le.keywords.vec3,Le.keywords.vec4,Le.keywords.mat2x2,Le.keywords.mat2x3,Le.keywords.mat2x4,Le.keywords.mat3x2,Le.keywords.mat3x3,Le.keywords.mat3x4,Le.keywords.mat4x2,Le.keywords.mat4x3,Le.keywords.mat4x4,Le.keywords.atomic,Le.keywords.bitcast,...Le.any_texture_type];se.attribute_name=[Le.tokens.ident,Le.keywords.block,Le.keywords.diagnostic];se.assignment_operators=[Le.tokens.equal,Le.tokens.plus_equal,Le.tokens.minus_equal,Le.tokens.times_equal,Le.tokens.division_equal,Le.tokens.modulo_equal,Le.tokens.and_equal,Le.tokens.or_equal,Le.tokens.xor_equal,Le.tokens.shift_right_equal,Le.tokens.shift_left_equal];se.increment_operators=[Le.tokens.plus_plus,Le.tokens.minus_minus];class kS{constructor(e,i,r){this.type=e,this.lexeme=i,this.line=r}toString(){return this.lexeme}isTemplateType(){return se.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==se.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Xz{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new kS(se.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let c=1;for(;c>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),c--,c==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),c++)}return!0}}const i=se.simpleTokens[e];if(i)return this._addToken(i),!0;let r=se.none;const s=this._isAlpha(e),n=e==="_";if(this._isAlphaNumeric(e)){let c=this._peekAhead();for(;this._isAlphaNumeric(c);)e+=this._advance(),c=this._peekAhead()}if(s){const c=se.keywords[e];if(c)return this._addToken(c),!0}if(s||n)return this._addToken(se.tokens.ident),!0;for(;;){let c=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(se.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(se.tokens.minus_minus),!0;const f=this._tokens.length-1;if((se.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==se.tokens.paren_right)&&l!=">")return this._addToken(c),!0}if(e==">"&&(l==">"||l=="=")){let f=!1,y=this._tokens.length-1;for(let E=0;E<5&&y>=0&&se.assignment_operators.indexOf(this._tokens[y].type)===-1;++E,--y)if(this._tokens[y].type===se.tokens.less_than){y>0&&this._tokens[y-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(c),!0}if(c===se.none){let f=e,y=0;const E=2;for(let T=0;T<E;++T)if(f+=this._peekAhead(T),c=this._findType(f),c!==se.none){y=T;break}if(c===se.none)return r===se.none?!1:(this._current--,this._addToken(r),!0);e=f,this._current+=y+1}if(r=c,this._isAtEnd())break;e+=this._advance()}return r===se.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in se.regexTokens){const s=se.regexTokens[r];if(this._match(e,s.rule))return s}return se.literalTokens[e]||se.none}_match(e,i){const r=i.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let i=this._source[this._current];return e=e||0,e++,this._current+=e,i}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const i=this._source.substring(this._start,this._current);this._tokens.push(new kS(e,i,this._line))}}class Kz{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new bz,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;i.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const s=r.arrayType,n=r.countNode;if(n instanceof Zw){const c=n.name,l=this._context.constants.get(c);if(l)try{const f=l.evaluate(this._context);s.count=f}catch{}}}this._deferArrayCountEval.length=0}return i}_initialize(e){if(e)if(typeof e=="string"){const i=new Xz(e);this._tokens=i.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,i){return{token:e,message:i,toString:function(){return`${i}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==se.eof}_match(e){if(e instanceof Ie)return this._check(e)?(this._advance(),!0):!1;for(let i=0,r=e.length;i<r;++i){const s=e[i];if(this._check(s))return this._advance(),!0}return!1}_consume(e,i){if(this._check(e))return this._advance();throw this._error(this._peek(),i)}_check(e){if(this._isAtEnd())return!1;const i=this._peek();if(e instanceof Array){const r=i.type;return e.indexOf(r)!=-1}return i.type==e}_advance(){var e,i;return this._currentLine=(i=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(se.tokens.semicolon)&&!this._isAtEnd(););if(this._match(se.keywords.alias)){const i=this._type_alias();return this._consume(se.tokens.semicolon,"Expected ';'"),i}if(this._match(se.keywords.diagnostic)){const i=this._diagnostic();return this._consume(se.tokens.semicolon,"Expected ';'"),i}if(this._match(se.keywords.requires)){const i=this._requires_directive();return this._consume(se.tokens.semicolon,"Expected ';'"),i}if(this._match(se.keywords.enable)){const i=this._enable_directive();return this._consume(se.tokens.semicolon,"Expected ';'"),i}const e=this._attribute();if(this._check(se.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=e),this._consume(se.tokens.semicolon,"Expected ';'."),i}if(this._check(se.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=e),this._consume(se.tokens.semicolon,"Expected ';'."),i}if(this._check(se.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=e),this._consume(se.tokens.semicolon,"Expected ';'."),i}if(this._check(se.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=e),this._consume(se.tokens.semicolon,"Expected ';'."),i}if(this._check(se.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=e),i}if(this._check(se.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=e),i}return null}_function_decl(){if(!this._match(se.keywords.fn))return null;const e=this._currentLine,i=this._consume(se.tokens.ident,"Expected function name.").toString();this._consume(se.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(se.tokens.paren_right))do{if(this._check(se.tokens.paren_right))break;const l=this._attribute(),f=this._consume(se.tokens.ident,"Expected argument name.").toString();this._consume(se.tokens.colon,"Expected ':' for argument type.");const y=this._attribute(),E=this._type_decl();E!=null&&(E.attributes=y,r.push(new $z(f,E,l)))}while(this._match(se.tokens.comma));this._consume(se.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(se.tokens.arrow)){const l=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=l)}const n=this._compound_statement(),c=this._currentLine;return new Kw(i,r,s,n,e,c)}_compound_statement(){const e=[];for(this._consume(se.tokens.brace_left,"Expected '{' for block.");!this._check(se.tokens.brace_right);){const i=this._statement();i!==null&&e.push(i)}return this._consume(se.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(se.tokens.semicolon)&&!this._isAtEnd(););if(this._check(se.tokens.attr)&&this._attribute(),this._check(se.keywords.if))return this._if_statement();if(this._check(se.keywords.switch))return this._switch_statement();if(this._check(se.keywords.loop))return this._loop_statement();if(this._check(se.keywords.for))return this._for_statement();if(this._check(se.keywords.while))return this._while_statement();if(this._check(se.keywords.continuing))return this._continuing_statement();if(this._check(se.keywords.static_assert))return this._static_assert_statement();if(this._check(se.tokens.brace_left))return this._compound_statement();let e=null;return this._check(se.keywords.return)?e=this._return_statement():this._check([se.keywords.var,se.keywords.let,se.keywords.const])?e=this._variable_statement():this._match(se.keywords.discard)?e=new Lz:this._match(se.keywords.break)?e=new Oz:this._match(se.keywords.continue)?e=new Dz:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(se.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(se.keywords.static_assert))return null;const e=this._optional_paren_expression();return new wz(e)}_while_statement(){if(!this._match(se.keywords.while))return null;const e=this._optional_paren_expression();this._check(se.tokens.attr)&&this._attribute();const i=this._compound_statement();return new xz(e,i)}_continuing_statement(){if(!this._match(se.keywords.continuing))return null;const e=this._compound_statement();return new Ez(e)}_for_statement(){if(!this._match(se.keywords.for))return null;this._consume(se.tokens.paren_left,"Expected '('.");const e=this._check(se.tokens.semicolon)?null:this._for_init();this._consume(se.tokens.semicolon,"Expected ';'.");const i=this._check(se.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(se.tokens.semicolon,"Expected ';'.");const r=this._check(se.tokens.paren_right)?null:this._for_increment();this._consume(se.tokens.paren_right,"Expected ')'."),this._check(se.tokens.attr)&&this._attribute();const s=this._compound_statement();return new Az(e,i,r,s)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(se.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(se.tokens.equal)&&(i=this._short_circuit_or_expression()),new ru(e.name,e.type,e.storage,e.access,i)}if(this._match(se.keywords.let)){const e=this._consume(se.tokens.ident,"Expected name for let.").toString();let i=null;if(this._match(se.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(se.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new Jw(e,i,null,null,r)}if(this._match(se.keywords.const)){const e=this._consume(se.tokens.ident,"Expected name for const.").toString();let i=null;if(this._match(se.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(se.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new IS(e,i,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(se.increment_operators))return this._current=e,null;const r=this._consume(se.increment_operators,"Expected increment operator");return new Tz(r.type===se.tokens.plus_plus?Id.increment:Id.decrement,i)}_assignment_statement(){let e=null;if(this._check(se.tokens.brace_right))return null;let i=this._match(se.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const r=this._consume(se.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return new Sz(pm.parse(r.lexeme),e,s)}_func_call_statement(){if(!this._check(se.tokens.ident))return null;const e=this._current,i=this._consume(se.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new y4(i.lexeme,r)}_loop_statement(){if(!this._match(se.keywords.loop))return null;this._check(se.tokens.attr)&&this._attribute(),this._consume(se.tokens.brace_left,"Expected '{' for loop.");const e=[];let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let s of i)e.push(s);else e.push(i);i=this._statement()}let r=null;return this._match(se.keywords.continuing)&&(r=this._compound_statement()),this._consume(se.tokens.brace_right,"Expected '}' for loop."),new Cz(e,r)}_switch_statement(){if(!this._match(se.keywords.switch))return null;const e=this._optional_paren_expression();this._check(se.tokens.attr)&&this._attribute(),this._consume(se.tokens.brace_left,"Expected '{' for switch.");const i=this._switch_body();if(i==null||i.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(se.tokens.brace_right,"Expected '}' for switch."),new Iz(e,i)}_switch_body(){const e=[];if(this._match(se.keywords.case)){const i=this._case_selectors();this._match(se.tokens.colon),this._check(se.tokens.attr)&&this._attribute(),this._consume(se.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(se.tokens.brace_right,"Exected '}' for switch case."),e.push(new Gz(i,r))}if(this._match(se.keywords.default)){this._match(se.tokens.colon),this._check(se.tokens.attr)&&this._attribute(),this._consume(se.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(se.tokens.brace_right,"Exected '}' for switch default."),e.push(new Vz(i))}if(this._check([se.keywords.default,se.keywords.case])){const i=this._switch_body();e.push(i[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(se.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(se.keywords.fallthrough))return this._consume(se.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const i=this._case_body();return i.length==0?e:[...e,i[0]]}_if_statement(){if(!this._match(se.keywords.if))return null;const e=this._optional_paren_expression();this._check(se.tokens.attr)&&this._attribute();const i=this._compound_statement();let r=[];this._match_elseif()&&(this._check(se.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let s=null;return this._match(se.keywords.else)&&(this._check(se.tokens.attr)&&this._attribute(),s=this._compound_statement()),new Rz(e,i,r,s)}_match_elseif(){return this._tokens[this._current].type===se.keywords.else&&this._tokens[this._current+1].type===se.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const i=this._optional_paren_expression(),r=this._compound_statement();return e.push(new Hz(i,r)),this._match_elseif()&&(this._check(se.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(se.keywords.return))return null;const e=this._short_circuit_or_expression();return new Mz(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(se.tokens.or_or);)e=new ea(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(se.tokens.and_and);)e=new ea(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(se.tokens.or);)e=new ea(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(se.tokens.xor);)e=new ea(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(se.tokens.and);)e=new ea(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([se.tokens.equal_equal,se.tokens.not_equal])?new ea(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([se.tokens.less_than,se.tokens.greater_than,se.tokens.less_than_equal,se.tokens.greater_than_equal]);)e=new ea(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([se.tokens.shift_left,se.tokens.shift_right]);)e=new ea(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([se.tokens.plus,se.tokens.minus]);)e=new ea(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([se.tokens.star,se.tokens.forward_slash,se.tokens.modulo]);)e=new ea(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([se.tokens.minus,se.tokens.bang,se.tokens.tilde,se.tokens.star,se.tokens.and])?new jz(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),i=this._postfix_expression();return i&&(e.postfix=i),e}_postfix_expression(){if(this._match(se.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(se.tokens.bracket_right,"Expected ']'.");const i=new zz(e),r=this._postfix_expression();return r&&(i.postfix=r),i}if(this._match(se.tokens.period)){const e=this._consume(se.tokens.ident,"Expected member name."),i=this._postfix_expression(),r=new Nz(e.lexeme);return i&&(r.postfix=i),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(se.tokens.ident)){const r=this._previous().toString();if(this._check(se.tokens.paren_left)){const s=this._argument_expression_list(),n=this._getStruct(r);return n!=null?new ed(n,s):new x4(r,s)}if(this._context.constants.has(r)){const s=this._context.constants.get(r);return new RS(r,s.value)}return new Zw(r)}if(this._match(se.const_literal))return new MS(parseFloat(this._previous().toString()));if(this._check(se.tokens.paren_left))return this._paren_expression();if(this._match(se.keywords.bitcast)){this._consume(se.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(se.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return new Uz(r,s)}const e=this._type_decl(),i=this._argument_expression_list();return new ed(e,i)}_argument_expression_list(){if(!this._match(se.tokens.paren_left))return null;const e=[];do{if(this._check(se.tokens.paren_right))break;const i=this._short_circuit_or_expression();e.push(i)}while(this._match(se.tokens.comma));return this._consume(se.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(se.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(se.tokens.paren_right),new PS([e])}_paren_expression(){this._consume(se.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(se.tokens.paren_right,"Expected ')'."),new PS([e])}_struct_decl(){if(!this._match(se.keywords.struct))return null;const e=this._currentLine,i=this._consume(se.tokens.ident,"Expected name for struct.").toString();this._consume(se.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(se.tokens.brace_right);){const c=this._attribute(),l=this._consume(se.tokens.ident,"Expected variable name.").toString();this._consume(se.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),y=this._type_decl();y!=null&&(y.attributes=f),this._check(se.tokens.brace_right)?this._match(se.tokens.comma):this._consume(se.tokens.comma,"Expected ',' for struct member."),r.push(new qz(l,y,c))}this._consume(se.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,n=new tu(i,r,e,s);return this._context.structs.set(i,n),n}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(se.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(se.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(se.keywords.const))return null;const e=this._consume(se.tokens.ident,"Expected variable name");let i=null;if(this._match(se.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}let r=null;if(this._match(se.tokens.equal)){const n=this._short_circuit_or_expression();if(n instanceof ed)r=n;else if(n instanceof RS&&n.initializer instanceof ed)r=n.initializer;else try{const c=n.evaluate(this._context);r=new MS(c)}catch{r=n}}const s=new IS(e.toString(),i,"","",r);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(se.keywords.let))return null;const e=this._consume(se.tokens.ident,"Expected variable name");let i=null;if(this._match(se.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}let r=null;return this._match(se.tokens.equal)&&(r=this._const_expression()),new Jw(e.toString(),i,"","",r)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(se.keywords.var))return null;let e="",i="";this._match(se.tokens.less_than)&&(e=this._consume(se.storage_class,"Expected storage_class.").toString(),this._match(se.tokens.comma)&&(i=this._consume(se.access_mode,"Expected access_mode.").toString()),this._consume(se.tokens.greater_than,"Expected '>'."));const r=this._consume(se.tokens.ident,"Expected variable name");let s=null;if(this._match(se.tokens.colon)){const n=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=n)}return new ru(r.toString(),s,e,i,null)}_override_decl(){if(!this._match(se.keywords.override))return null;const e=this._consume(se.tokens.ident,"Expected variable name");let i=null;if(this._match(se.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}return new _4(e.toString(),i,null)}_diagnostic(){this._consume(se.tokens.paren_left,"Expected '('");const e=this._consume(se.tokens.ident,"Expected severity control name.");this._consume(se.tokens.comma,"Expected ','");const i=this._consume(se.tokens.ident,"Expected diagnostic rule name.");return this._consume(se.tokens.paren_right,"Expected ')'"),new Bz(e.toString(),i.toString())}_enable_directive(){const e=this._consume(se.tokens.ident,"identity expected.");return new Pz(e.toString())}_requires_directive(){const e=[this._consume(se.tokens.ident,"identity expected.").toString()];for(;this._match(se.tokens.comma);){const i=this._consume(se.tokens.ident,"identity expected.");e.push(i.toString())}return new kz(e)}_type_alias(){const e=this._consume(se.tokens.ident,"identity expected.");this._consume(se.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const r=new v4(e.toString(),i);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([se.tokens.ident,...se.texel_format,se.keywords.bool,se.keywords.f32,se.keywords.i32,se.keywords.u32])){const r=this._advance(),s=r.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:new Mu(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(se.template_types)){let r=this._advance().toString(),s=null,n=null;return this._match(se.tokens.less_than)&&(s=this._type_decl(),n=null,this._match(se.tokens.comma)&&(n=this._consume(se.access_mode,"Expected access_mode for pointer").toString()),this._consume(se.tokens.greater_than,"Expected '>' for type.")),new b4(r,s,n)}if(this._match(se.keywords.ptr)){let r=this._previous().toString();this._consume(se.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(se.storage_class,"Expected storage_class for pointer");this._consume(se.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let c=null;return this._match(se.tokens.comma)&&(c=this._consume(se.access_mode,"Expected access_mode for pointer").toString()),this._consume(se.tokens.greater_than,"Expected '>' for pointer."),new Fz(r,s.toString(),n,c)}const i=this._attribute();if(this._match(se.keywords.array)){let r=null,s=-1;const n=this._previous();let c=null;if(this._match(se.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let f="";if(this._match(se.tokens.comma)){c=this._shift_expression();try{f=c.evaluate(this._context).toString(),c=null}catch{f="1"}}this._consume(se.tokens.greater_than,"Expected '>' for array."),s=f?parseInt(f):0}const l=new w4(n.toString(),i,r,s);return c&&this._deferArrayCountEval.push({arrayType:l,countNode:c}),l}return null}_texture_sampler_types(){if(this._match(se.sampler_type))return new Af(this._previous().toString(),null,null);if(this._match(se.depth_texture_type))return new Af(this._previous().toString(),null,null);if(this._match(se.sampled_texture_type)||this._match(se.multisampled_texture_type)){const e=this._previous();this._consume(se.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(se.tokens.greater_than,"Expected '>' for sampler type."),new Af(e.toString(),i,null)}if(this._match(se.storage_texture_type)){const e=this._previous();this._consume(se.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(se.texel_format,"Invalid texel format.").toString();this._consume(se.tokens.comma,"Expected ',' after texel format.");const r=this._consume(se.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(se.tokens.greater_than,"Expected '>' for sampler type."),new Af(e.toString(),i,r)}return null}_attribute(){let e=[];for(;this._match(se.tokens.attr);){const i=this._consume(se.attribute_name,"Expected attribute name"),r=new Wz(i.toString(),null);if(this._match(se.tokens.paren_left)){if(r.value=this._consume(se.literal_or_ident,"Expected attribute value").toString(),this._check(se.tokens.comma)){this._advance();do{const s=this._consume(se.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(s)}while(this._match(se.tokens.comma))}this._consume(se.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class md{constructor(e,i){this.name=e,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class BS{constructor(e,i,r){this.name=e,this.type=i,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class c_ extends md{constructor(e,i){super(e,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Vv extends md{constructor(e,i){super(e,i),this.count=0,this.stride=0}get isArray(){return!0}}class LS extends md{constructor(e,i,r,s){super(e,r),this.format=i,this.access=s}get isTemplate(){return!0}}var $l;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})($l||($l={}));class u_{constructor(e,i,r,s,n,c,l){this.name=e,this.type=i,this.group=r,this.binding=s,this.attributes=n,this.resourceType=c,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Jz{constructor(e,i){this.name=e,this.type=i}}class h_{constructor(e,i){this.align=e,this.size=i}}class Zz{constructor(e,i,r,s){this.name=e,this.type=i,this.locationType=r,this.location=s,this.interpolation=null}}class OS{constructor(e,i,r,s){this.name=e,this.type=i,this.locationType=r,this.location=s}}class Yz{constructor(e,i,r,s){this.name=e,this.type=i,this.attributes=r,this.id=s}}class Qz{constructor(e,i){this.name=e,this.type=i}}class ej{constructor(e,i=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=i}}class tj{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class ij{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Va{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new tj,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const i=new Kz().parse(e);for(const r of i)r instanceof Kw&&this._functions.set(r.name,new ij(r));for(const r of i)if(r instanceof tu){const s=this._getTypeInfo(r,null);s instanceof c_&&this.structs.push(s)}for(const r of i){if(r instanceof v4){this.aliases.push(this._getAliasInfo(r));continue}if(r instanceof _4){const s=r,n=this._getAttributeNum(s.attributes,"id",0),c=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new Yz(s.name,c,s.attributes,n));continue}if(this._isUniformVar(r)){const s=r,n=this._getAttributeNum(s.attributes,"group",0),c=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),f=new u_(s.name,l,n,c,s.attributes,$l.Uniform,s.access);this.uniforms.push(f);continue}if(this._isStorageVar(r)){const s=r,n=this._getAttributeNum(s.attributes,"group",0),c=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),f=this._isStorageTexture(l),y=new u_(s.name,l,n,c,s.attributes,f?$l.StorageTexture:$l.Storage,s.access);this.storage.push(y);continue}if(this._isTextureVar(r)){const s=r,n=this._getAttributeNum(s.attributes,"group",0),c=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),f=this._isStorageTexture(l),y=new u_(s.name,l,n,c,s.attributes,f?$l.StorageTexture:$l.Texture,s.access);f?this.storage.push(y):this.textures.push(y);continue}if(this._isSamplerVar(r)){const s=r,n=this._getAttributeNum(s.attributes,"group",0),c=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),f=new u_(s.name,l,n,c,s.attributes,$l.Sampler,s.access);this.samplers.push(f);continue}if(r instanceof Kw){const s=this._getAttribute(r,"vertex"),n=this._getAttribute(r,"fragment"),c=this._getAttribute(r,"compute"),l=s||n||c,f=new ej(r.name,l==null?void 0:l.name);f.startLine=r.startLine,f.endLine=r.endLine,this.functions.push(f),this._functions.get(r.name).info=f,l?(this._functions.get(r.name).inUse=!0,f.inUse=!0,f.resources=this._findResources(r,!!l),f.inputs=this._getInputs(r.args),f.outputs=this._getOutputs(r.returnType),this.entry[l.name].push(f)):(f.arguments=r.args.map(y=>new Qz(y.name,this._getTypeInfo(y.type,y.attributes))),f.returnType=r.returnType?this._getTypeInfo(r.returnType,r.attributes):null);continue}}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this._functions.values())r.node.search(s=>{var n;if(s.astNodeType==="varExpr"){const c=s;for(const l of this.overrides)c.name==l.name&&((n=r.info)===null||n===void 0||n.overrides.push(l))}});for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const i of e.members)this._markStructsInUse(i.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const i=this._getAlias(e.name);i&&this._markStructsInUse(i)}}_addCalls(e,i){var r;for(const s of e.calls){const n=(r=this._functions.get(s.name))===null||r===void 0?void 0:r.info;n&&i.add(n)}}findResource(e,i){for(const r of this.uniforms)if(r.group==e&&r.binding==i)return r;for(const r of this.storage)if(r.group==e&&r.binding==i)return r;for(const r of this.textures)if(r.group==e&&r.binding==i)return r;for(const r of this.samplers)if(r.group==e&&r.binding==i)return r;return null}_findResource(e){for(const i of this.uniforms)if(i.name==e)return i;for(const i of this.storage)if(i.name==e)return i;for(const i of this.textures)if(i.name==e)return i;for(const i of this.samplers)if(i.name==e)return i;return null}_markStructsFromAST(e){const i=this._getTypeInfo(e,null);this._markStructsInUse(i)}_findResources(e,i){const r=[],s=this,n=[];return e.search(c=>{if(c instanceof G0)n.push({});else if(c instanceof V0)n.pop();else if(c instanceof ru){const l=c;i&&l.type!==null&&this._markStructsFromAST(l.type),n.length>0&&(n[n.length-1][l.name]=l)}else if(c instanceof ed){const l=c;i&&l.type!==null&&this._markStructsFromAST(l.type)}else if(c instanceof Jw){const l=c;i&&l.type!==null&&this._markStructsFromAST(l.type),n.length>0&&(n[n.length-1][l.name]=l)}else if(c instanceof Zw){const l=c;if(n.length>0&&n[n.length-1][l.name])return;const f=s._findResource(l.name);f&&r.push(f)}else if(c instanceof x4){const l=c,f=s._functions.get(l.name);f&&(i&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,i)),r.push(...f.resources))}else if(c instanceof y4){const l=c,f=s._functions.get(l.name);f&&(i&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,i)),r.push(...f.resources))}}),[...new Map(r.map(c=>[c.name,c])).values()]}getBindGroups(){const e=[];function i(r,s){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),s>=e[r].length&&(e[r].length=s+1)}for(const r of this.uniforms){i(r.group,r.binding);const s=e[r.group];s[r.binding]=r}for(const r of this.storage){i(r.group,r.binding);const s=e[r.group];s[r.binding]=r}for(const r of this.textures){i(r.group,r.binding);const s=e[r.group];s[r.binding]=r}for(const r of this.samplers){i(r.group,r.binding);const s=e[r.group];s[r.binding]=r}return e}_getOutputs(e,i=void 0){if(i===void 0&&(i=[]),e instanceof tu)this._getStructOutputs(e,i);else{const r=this._getOutputInfo(e);r!==null&&i.push(r)}return i}_getStructOutputs(e,i){for(const r of e.members)if(r.type instanceof tu)this._getStructOutputs(r.type,i);else{const s=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(s!==null){const n=this._getTypeInfo(r.type,r.type.attributes),c=this._parseInt(s.value),l=new OS(r.name,n,s.name,c);i.push(l)}}}_getOutputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const r=this._getTypeInfo(e,e.attributes),s=this._parseInt(i.value);return new OS("",r,i.name,s)}return null}_getInputs(e,i=void 0){i===void 0&&(i=[]);for(const r of e)if(r.type instanceof tu)this._getStructInputs(r.type,i);else{const s=this._getInputInfo(r);s!==null&&i.push(s)}return i}_getStructInputs(e,i){for(const r of e.members)if(r.type instanceof tu)this._getStructInputs(r.type,i);else{const s=this._getInputInfo(r);s!==null&&i.push(s)}}_getInputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const r=this._getAttribute(e,"interpolation"),s=this._getTypeInfo(e.type,e.attributes),n=this._parseInt(i.value),c=new Zz(e.name,s,i.name,n);return r!==null&&(c.interpolation=this._parseString(r.value)),c}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const i=parseInt(e);return isNaN(i)?e:i}_getAlias(e){for(const i of this.aliases)if(i.name==e)return i.type;return null}_getAliasInfo(e){return new Jz(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,i){if(this._types.has(e))return this._types.get(e);if(e instanceof w4){const s=e,n=s.format?this._getTypeInfo(s.format,s.attributes):null,c=new Vv(s.name,i);return c.format=n,c.count=s.count,this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof tu){const s=e,n=new c_(s.name,i);n.startLine=s.startLine,n.endLine=s.endLine;for(const c of s.members){const l=this._getTypeInfo(c.type,c.attributes);n.members.push(new BS(c.name,l,c.attributes))}return this._types.set(e,n),this._updateTypeInfo(n),n}if(e instanceof Af){const s=e,n=s.format instanceof Mu,c=s.format?n?this._getTypeInfo(s.format,null):new md(s.format,null):null,l=new LS(s.name,c,i,s.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof b4){const s=e,n=s.format?this._getTypeInfo(s.format,null):null,c=new LS(s.name,n,i,s.access);return this._types.set(e,c),this._updateTypeInfo(c),c}const r=new md(e.name,i);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var i,r;const s=this._getTypeSize(e);if(e.size=(i=s==null?void 0:s.size)!==null&&i!==void 0?i:0,e instanceof Vv&&e.format){const n=this._getTypeSize(e.format);e.stride=(r=n==null?void 0:n.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof c_&&this._updateStructInfo(e)}_updateStructInfo(e){var i;let r=0,s=0,n=0,c=0;for(let l=0,f=e.members.length;l<f;++l){const y=e.members[l],E=this._getTypeSize(y);if(!E)continue;(i=this._getAlias(y.type.name))!==null&&i!==void 0||y.type;const T=E.align,R=E.size;r=this._roundUp(T,r+s),s=R,n=r,c=Math.max(c,T),y.offset=r,y.size=R,this._updateTypeInfo(y.type)}e.size=this._roundUp(c,n+s),e.align=c}_getTypeSize(e){var i,r;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),n=this._getAttributeNum(e.attributes,"align",0);if(e instanceof BS&&(e=e.type),e instanceof md){const c=this._getAlias(e.name);c!==null&&(e=c)}{const c=Va._typeInfo[e.name];if(c!==void 0){const l=((i=e.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new h_(Math.max(n,c.align/l),Math.max(s,c.size/l))}}{const c=Va._typeInfo[e.name.substring(0,e.name.length-1)];if(c){const l=e.name[e.name.length-1]==="h"?2:1;return new h_(Math.max(n,c.align/l),Math.max(s,c.size/l))}}if(e instanceof Vv){let c=e,l=8,f=8;const y=this._getTypeSize(c.format);y!==null&&(f=y.size,l=y.align);const E=c.count,T=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(l,f));return f=E*T,s&&(f=s),new h_(Math.max(n,l),Math.max(s,f))}if(e instanceof c_){let c=0,l=0,f=0,y=0,E=0;for(const T of e.members){const R=this._getTypeSize(T.type);R!==null&&(c=Math.max(R.align,c),f=this._roundUp(R.align,f+y),y=R.size,E=f)}return l=this._roundUp(c,E+y),new h_(Math.max(n,c),Math.max(s,l))}return null}_isUniformVar(e){return e instanceof ru&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ru&&e.storage=="storage"}_isTextureVar(e){return e instanceof ru&&e.type!==null&&Va._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ru&&e.type!==null&&Va._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,i){const r=e;if(!r||!r.attributes)return null;const s=r.attributes;for(let n of s)if(n.name==i)return n;return null}_getAttributeNum(e,i,r){if(e===null)return r;for(let s of e)if(s.name==i){let n=s!==null&&s.value!==null?s.value:r;return n instanceof Array&&(n=n[0]),typeof n=="number"?n:typeof n=="string"?parseInt(n):r}return r}_roundUp(e,i){return Math.ceil(i/e)*e}}Va._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Va._textureTypes=se.any_texture_type.map(t=>t.name);Va._samplerTypes=se.sampler_type.map(t=>t.name);function rj(t){var e;const i={attributes:[],bindings:[]};let r;try{r=sj(t)}catch(c){return Qe.error(c.message)(),i}for(const c of r.uniforms){const l=[];for(const f of((e=c.type)==null?void 0:e.members)||[])l.push({name:f.name,type:DS(f.type)});i.bindings.push({type:"uniform",name:c.name,location:c.binding,group:c.group,members:l})}const s=r.entry.vertex[0],n=(s==null?void 0:s.inputs.length)||0;for(let c=0;c<n;c++){const l=s.inputs[c];if(l.locationType==="location"){const f=DS(l.type);i.attributes.push({name:l.name,location:Number(l.location),type:f})}}return i}function DS(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function sj(t){try{return new Va(t)}catch(e){if(e instanceof Error)throw e;let i="WGSL parse error";throw typeof e=="object"&&e!=null&&e.message&&(i+=`: ${e.message} `),typeof e=="object"&&e!=null&&e.token&&(i+=e.token.line||""),new Error(i,{cause:e})}}const nj=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,oj={name:"fp32",vs:nj},aj=[0,1,1,1],lj=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,cj=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,FS={name:"picking",vs:lj,fs:cj,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:aj},getUniforms:uj};function uj(t={},e){const i={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,s=>s/255);Number.isFinite(r[3])||(r[3]=1),i.highlightColor=r}return t.isActive!==void 0&&(i.isActive=!!t.isActive,i.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(i.useFloatColors=!!t.useFloatColors),i}function T4(t,e=[],i=0){const r=Math.fround(t),s=t-r;return e[i]=r,e[i+1]=s,e}function hj(t){return t-Math.fround(t)}function dj(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let r=0;r<4;++r){const s=i*4+r;T4(t[r*4+i],e,s*2)}return e}const pj=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,fj={ONE:1};function mj(){return fj}const gj={name:"fp64-arithmetic",vs:pj,getUniforms:mj,fp64ify:T4,fp64LowPart:hj,fp64ifyMatrix4:dj},_j=1/Math.PI*180,yj=1/180*Math.PI,vj={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...vj}};const Or=globalThis.mathgl.config;function bj(t,{precision:e=Or.precision}={}){return t=Aj(t),`${parseFloat(t.toPrecision(e))}`}function pc(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function wj(t){return Ej(t)}function xj(t){return Co(t)}function Ej(t,e){return Z2(t,i=>i*yj,e)}function Co(t,e){return Z2(t,i=>i*_j,e)}function $a(t,e,i){return Z2(t,r=>Math.max(e,Math.min(i,r)))}function $0(t,e,i){return pc(t)?t.map((r,s)=>$0(r,e[s],i)):i*e+(1-i)*t}function Do(t,e,i){const r=Or.EPSILON;i&&(Or.EPSILON=i);try{if(t===e)return!0;if(pc(t)&&pc(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!Do(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Or.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Or.EPSILON=r}}function Aj(t){return Math.round(t/Or.EPSILON)*Or.EPSILON}function Tj(t){return t.clone?t.clone():new Array(t.length)}function Z2(t,e,i){if(pc(t)){const r=t;i=i||Tj(r);for(let s=0;s<i.length&&s<r.length;++s){const n=typeof t=="number"?t:t[s];i[s]=e(n,s,i)}return i}return e(t)}class Y2 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+i];return this.check()}toArray(e=[],i=0){for(let r=0;r<this.ELEMENTS;++r)e[i+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:pc(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Or)}formatString(e){let i="";for(let r=0;r<this.ELEMENTS;++r)i+=(r>0?", ":"")+bj(this[r],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!Do(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,r){if(r===void 0)return this.lerp(this,e,i);for(let s=0;s<this.ELEMENTS;++s){const n=e[s],c=typeof i=="number"?i:i[s];this[s]=n+r*(c-n)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),i[r]);return this.check()}add(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=i[r];return this.check()}subtract(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=i[r];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(Or.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),i);return this.check()}get elements(){return this}}function Sj(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function vi(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Gf(t,e,i=""){if(Or.debug&&!Sj(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function Io(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class Q2 extends Y2{get x(){return this[0]}set x(e){this[0]=vi(e)}get y(){return this[1]}set y(e){this[1]=vi(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];i+=s*s}return vi(i)}dot(e){let i=0;for(let r=0;r<this.ELEMENTS;++r)i+=this[r]*e[r];return vi(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=i[r];return this.check()}divide(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=i[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Io(e>=0&&e<this.ELEMENTS,"index is out of range"),vi(this[e])}setComponent(e,i){return Io(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const Vf=1e-6;let Uo=typeof Float32Array<"u"?Float32Array:Array;function Cj(){const t=new Uo(2);return Uo!=Float32Array&&(t[0]=0,t[1]=0),t}function NS(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Ij(t,e){return t[0]=-e[0],t[1]=-e[1],t}function S4(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function Rj(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function Mj(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function C4(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function I4(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}(function(){const t=Cj();return function(e,i,r,s,n,c){let l,f;for(i||(i=2),r||(r=0),s?f=Math.min(s*i+r,e.length):f=e.length,l=r;l<f;l+=i)t[0]=e[l],t[1]=e[l+1],n(t,t,c),e[l]=t[0],e[l+1]=t[1];return e}})();function R4(t,e,i){const r=e[0],s=e[1],n=i[3]*r+i[7]*s||1;return t[0]=(i[0]*r+i[4]*s)/n,t[1]=(i[1]*r+i[5]*s)/n,t}function M4(t,e,i){const r=e[0],s=e[1],n=e[2],c=i[3]*r+i[7]*s+i[11]*n||1;return t[0]=(i[0]*r+i[4]*s+i[8]*n)/c,t[1]=(i[1]*r+i[5]*s+i[9]*n)/c,t[2]=(i[2]*r+i[6]*s+i[10]*n)/c,t}function Pj(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t[2]=e[2],t}function kj(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t[2]=e[2],t[3]=e[3],t}function P4(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[3]*s+i[6]*n,t[1]=i[1]*r+i[4]*s+i[7]*n,t[2]=i[2]*r+i[5]*s+i[8]*n,t[3]=e[3],t}class eE extends Q2{constructor(e=0,i=0){super(2),pc(e)&&arguments.length===1?this.copy(e):(Or.debug&&(vi(e),vi(i)),this[0]=e,this[1]=i)}set(e,i){return this[0]=e,this[1]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Or.debug&&(vi(e.x),vi(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return I4(this,this,e),this.check()}transformAsVector(e){return R4(this,this,e),this.check()}transformByMatrix3(e){return C4(this,this,e),this.check()}transformByMatrix2x3(e){return Mj(this,this,e),this.check()}transformByMatrix2(e){return Rj(this,this,e),this.check()}}function k4(){const t=new Uo(3);return Uo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function B4(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function US(t,e,i){const r=new Uo(3);return r[0]=t,r[1]=e,r[2]=i,r}function Bj(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Lj(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Oj(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function tE(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function i0(t,e,i){const r=e[0],s=e[1],n=e[2],c=i[0],l=i[1],f=i[2];return t[0]=s*f-n*l,t[1]=n*c-r*f,t[2]=r*l-s*c,t}function iE(t,e,i){const r=e[0],s=e[1],n=e[2];let c=i[3]*r+i[7]*s+i[11]*n+i[15];return c=c||1,t[0]=(i[0]*r+i[4]*s+i[8]*n+i[12])/c,t[1]=(i[1]*r+i[5]*s+i[9]*n+i[13])/c,t[2]=(i[2]*r+i[6]*s+i[10]*n+i[14])/c,t}function L4(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function O4(t,e,i){const r=i[0],s=i[1],n=i[2],c=i[3],l=e[0],f=e[1],y=e[2];let E=s*y-n*f,T=n*l-r*y,R=r*f-s*l,D=s*R-n*T,V=n*E-r*R,H=r*T-s*E;const ee=c*2;return E*=ee,T*=ee,R*=ee,D*=2,V*=2,H*=2,t[0]=l+E+D,t[1]=f+T+V,t[2]=y+R+H,t}function Dj(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function Fj(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function Nj(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function Uj(t,e){const i=t[0],r=t[1],s=t[2],n=e[0],c=e[1],l=e[2],f=Math.sqrt((i*i+r*r+s*s)*(n*n+c*c+l*l)),y=f&&tE(t,e)/f;return Math.acos(Math.min(Math.max(y,-1),1))}const zj=Bj,jj=B4;(function(){const t=k4();return function(e,i,r,s,n,c){let l,f;for(i||(i=3),r||(r=0),s?f=Math.min(s*i+r,e.length):f=e.length,l=r;l<f;l+=i)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],n(t,t,c),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const $v=[0,0,0];let d_;class Be extends Q2{static get ZERO(){return d_||(d_=new Be(0,0,0),Object.freeze(d_)),d_}constructor(e=0,i=0,r=0){super(-0,-0,-0),arguments.length===1&&pc(e)?this.copy(e):(Or.debug&&(vi(e),vi(i),vi(r)),this[0]=e,this[1]=i,this[2]=r)}set(e,i,r){return this[0]=e,this[1]=i,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Or.debug&&(vi(e.x),vi(e.y),vi(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=vi(e)}angle(e){return Uj(this,e)}cross(e){return i0(this,this,e),this.check()}rotateX({radians:e,origin:i=$v}){return Dj(this,this,i,e),this.check()}rotateY({radians:e,origin:i=$v}){return Fj(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=$v}){return Nj(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return iE(this,this,e),this.check()}transformAsVector(e){return M4(this,this,e),this.check()}transformByMatrix3(e){return L4(this,this,e),this.check()}transformByMatrix2(e){return Pj(this,this,e),this.check()}transformByQuaternion(e){return O4(this,this,e),this.check()}}let p_;class rE extends Q2{static get ZERO(){return p_||(p_=new rE(0,0,0,0),Object.freeze(p_)),p_}constructor(e=0,i=0,r=0,s=0){super(-0,-0,-0,-0),pc(e)&&arguments.length===1?this.copy(e):(Or.debug&&(vi(e),vi(i),vi(r),vi(s)),this[0]=e,this[1]=i,this[2]=r,this[3]=s)}set(e,i,r,s){return this[0]=e,this[1]=i,this[2]=r,this[3]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Or.debug&&(vi(e.x),vi(e.y),vi(e.z),vi(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=vi(e)}get w(){return this[3]}set w(e){this[3]=vi(e)}transform(e){return iE(this,this,e),this.check()}transformByMatrix3(e){return P4(this,this,e),this.check()}transformByMatrix2(e){return kj(this,this,e),this.check()}transformByQuaternion(e){return O4(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class D4 extends Y2{toString(){let e="[";if(Or.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,r){return this[i*this.RANK+e]=vi(r),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)i[s]=this[r+s];return i}setColumn(e,i){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=i[s];return this}}function Gj(){const t=new Uo(9);return Uo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Vj(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function $j(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],c=e[4],l=e[5],f=e[6],y=e[7],E=e[8],T=E*c-l*y,R=-E*n+l*f,D=y*n-c*f;let V=i*T+r*R+s*D;return V?(V=1/V,t[0]=T*V,t[1]=(-E*r+s*y)*V,t[2]=(l*r-s*c)*V,t[3]=R*V,t[4]=(E*i-s*f)*V,t[5]=(-l*i+s*n)*V,t[6]=D*V,t[7]=(-y*i+r*f)*V,t[8]=(c*i-r*n)*V,t):null}function Hj(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],c=t[5],l=t[6],f=t[7],y=t[8];return e*(y*n-c*f)+i*(-y*s+c*l)+r*(f*s-n*l)}function zS(t,e,i){const r=e[0],s=e[1],n=e[2],c=e[3],l=e[4],f=e[5],y=e[6],E=e[7],T=e[8],R=i[0],D=i[1],V=i[2],H=i[3],ee=i[4],z=i[5],W=i[6],q=i[7],ce=i[8];return t[0]=R*r+D*c+V*y,t[1]=R*s+D*l+V*E,t[2]=R*n+D*f+V*T,t[3]=H*r+ee*c+z*y,t[4]=H*s+ee*l+z*E,t[5]=H*n+ee*f+z*T,t[6]=W*r+q*c+ce*y,t[7]=W*s+q*l+ce*E,t[8]=W*n+q*f+ce*T,t}function qj(t,e,i){const r=e[0],s=e[1],n=e[2],c=e[3],l=e[4],f=e[5],y=e[6],E=e[7],T=e[8],R=i[0],D=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=c,t[4]=l,t[5]=f,t[6]=R*r+D*c+y,t[7]=R*s+D*l+E,t[8]=R*n+D*f+T,t}function Wj(t,e,i){const r=e[0],s=e[1],n=e[2],c=e[3],l=e[4],f=e[5],y=e[6],E=e[7],T=e[8],R=Math.sin(i),D=Math.cos(i);return t[0]=D*r+R*c,t[1]=D*s+R*l,t[2]=D*n+R*f,t[3]=D*c-R*r,t[4]=D*l-R*s,t[5]=D*f-R*n,t[6]=y,t[7]=E,t[8]=T,t}function jS(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Xj(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],c=i+i,l=r+r,f=s+s,y=i*c,E=r*c,T=r*l,R=s*c,D=s*l,V=s*f,H=n*c,ee=n*l,z=n*f;return t[0]=1-T-V,t[3]=E-z,t[6]=R+ee,t[1]=E+z,t[4]=1-y-V,t[7]=D-H,t[2]=R-ee,t[5]=D+H,t[8]=1-y-T,t}var Yw;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(Yw||(Yw={}));const Kj=Object.freeze([1,0,0,0,1,0,0,0,1]);class pr extends D4{static get IDENTITY(){return Zj()}static get ZERO(){return Jj()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Yw}constructor(e,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):i.length>0?this.copy([e,...i]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(Kj)}fromObject(e){return this.check()}fromQuaternion(e){return Xj(this,e),this.check()}set(e,i,r,s,n,c,l,f,y){return this[0]=e,this[1]=i,this[2]=r,this[3]=s,this[4]=n,this[5]=c,this[6]=l,this[7]=f,this[8]=y,this.check()}setRowMajor(e,i,r,s,n,c,l,f,y){return this[0]=e,this[1]=s,this[2]=l,this[3]=i,this[4]=n,this[5]=f,this[6]=r,this[7]=c,this[8]=y,this.check()}determinant(){return Hj(this)}transpose(){return Vj(this,this),this.check()}invert(){return $j(this,this),this.check()}multiplyLeft(e){return zS(this,e,this),this.check()}multiplyRight(e){return zS(this,this,e),this.check()}rotate(e){return Wj(this,this,e),this.check()}scale(e){return Array.isArray(e)?jS(this,this,e):jS(this,this,[e,e]),this.check()}translate(e){return qj(this,this,e),this.check()}transform(e,i){let r;switch(e.length){case 2:r=C4(i||[-0,-0],e,this);break;case 3:r=L4(i||[-0,-0,-0],e,this);break;case 4:r=P4(i||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Gf(r,e.length),r}transformVector(e,i){return this.transform(e,i)}transformVector2(e,i){return this.transform(e,i)}transformVector3(e,i){return this.transform(e,i)}}let f_,m_=null;function Jj(){return f_||(f_=new pr([0,0,0,0,0,0,0,0,0]),Object.freeze(f_)),f_}function Zj(){return m_||(m_=new pr,Object.freeze(m_)),m_}function Yj(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qj(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],c=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=c,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Qw(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],c=e[4],l=e[5],f=e[6],y=e[7],E=e[8],T=e[9],R=e[10],D=e[11],V=e[12],H=e[13],ee=e[14],z=e[15],W=i*l-r*c,q=i*f-s*c,ce=i*y-n*c,we=r*f-s*l,re=r*y-n*l,be=s*y-n*f,me=E*H-T*V,Te=E*ee-R*V,Pe=E*z-D*V,ze=T*ee-R*H,Ke=T*z-D*H,We=R*z-D*ee;let Ze=W*We-q*Ke+ce*ze+we*Pe-re*Te+be*me;return Ze?(Ze=1/Ze,t[0]=(l*We-f*Ke+y*ze)*Ze,t[1]=(s*Ke-r*We-n*ze)*Ze,t[2]=(H*be-ee*re+z*we)*Ze,t[3]=(R*re-T*be-D*we)*Ze,t[4]=(f*Pe-c*We-y*Te)*Ze,t[5]=(i*We-s*Pe+n*Te)*Ze,t[6]=(ee*ce-V*be-z*q)*Ze,t[7]=(E*be-R*ce+D*q)*Ze,t[8]=(c*Ke-l*Pe+y*me)*Ze,t[9]=(r*Pe-i*Ke-n*me)*Ze,t[10]=(V*re-H*ce+z*W)*Ze,t[11]=(T*ce-E*re-D*W)*Ze,t[12]=(l*Te-c*ze-f*me)*Ze,t[13]=(i*ze-r*Te+s*me)*Ze,t[14]=(H*q-V*we-ee*W)*Ze,t[15]=(E*we-T*q+R*W)*Ze,t):null}function eG(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],c=t[5],l=t[6],f=t[7],y=t[8],E=t[9],T=t[10],R=t[11],D=t[12],V=t[13],H=t[14],ee=t[15],z=e*c-i*n,W=e*l-r*n,q=i*l-r*c,ce=y*V-E*D,we=y*H-T*D,re=E*H-T*V,be=e*re-i*we+r*ce,me=n*re-c*we+l*ce,Te=y*q-E*W+T*z,Pe=D*q-V*W+H*z;return f*be-s*me+ee*Te-R*Pe}function mu(t,e,i){const r=e[0],s=e[1],n=e[2],c=e[3],l=e[4],f=e[5],y=e[6],E=e[7],T=e[8],R=e[9],D=e[10],V=e[11],H=e[12],ee=e[13],z=e[14],W=e[15];let q=i[0],ce=i[1],we=i[2],re=i[3];return t[0]=q*r+ce*l+we*T+re*H,t[1]=q*s+ce*f+we*R+re*ee,t[2]=q*n+ce*y+we*D+re*z,t[3]=q*c+ce*E+we*V+re*W,q=i[4],ce=i[5],we=i[6],re=i[7],t[4]=q*r+ce*l+we*T+re*H,t[5]=q*s+ce*f+we*R+re*ee,t[6]=q*n+ce*y+we*D+re*z,t[7]=q*c+ce*E+we*V+re*W,q=i[8],ce=i[9],we=i[10],re=i[11],t[8]=q*r+ce*l+we*T+re*H,t[9]=q*s+ce*f+we*R+re*ee,t[10]=q*n+ce*y+we*D+re*z,t[11]=q*c+ce*E+we*V+re*W,q=i[12],ce=i[13],we=i[14],re=i[15],t[12]=q*r+ce*l+we*T+re*H,t[13]=q*s+ce*f+we*R+re*ee,t[14]=q*n+ce*y+we*D+re*z,t[15]=q*c+ce*E+we*V+re*W,t}function H0(t,e,i){const r=i[0],s=i[1],n=i[2];let c,l,f,y,E,T,R,D,V,H,ee,z;return e===t?(t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15]):(c=e[0],l=e[1],f=e[2],y=e[3],E=e[4],T=e[5],R=e[6],D=e[7],V=e[8],H=e[9],ee=e[10],z=e[11],t[0]=c,t[1]=l,t[2]=f,t[3]=y,t[4]=E,t[5]=T,t[6]=R,t[7]=D,t[8]=V,t[9]=H,t[10]=ee,t[11]=z,t[12]=c*r+E*s+V*n+e[12],t[13]=l*r+T*s+H*n+e[13],t[14]=f*r+R*s+ee*n+e[14],t[15]=y*r+D*s+z*n+e[15]),t}function sE(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function tG(t,e,i,r){let s=r[0],n=r[1],c=r[2],l=Math.sqrt(s*s+n*n+c*c),f,y,E,T,R,D,V,H,ee,z,W,q,ce,we,re,be,me,Te,Pe,ze,Ke,We,Ze,Ft;return l<Vf?null:(l=1/l,s*=l,n*=l,c*=l,y=Math.sin(i),f=Math.cos(i),E=1-f,T=e[0],R=e[1],D=e[2],V=e[3],H=e[4],ee=e[5],z=e[6],W=e[7],q=e[8],ce=e[9],we=e[10],re=e[11],be=s*s*E+f,me=n*s*E+c*y,Te=c*s*E-n*y,Pe=s*n*E-c*y,ze=n*n*E+f,Ke=c*n*E+s*y,We=s*c*E+n*y,Ze=n*c*E-s*y,Ft=c*c*E+f,t[0]=T*be+H*me+q*Te,t[1]=R*be+ee*me+ce*Te,t[2]=D*be+z*me+we*Te,t[3]=V*be+W*me+re*Te,t[4]=T*Pe+H*ze+q*Ke,t[5]=R*Pe+ee*ze+ce*Ke,t[6]=D*Pe+z*ze+we*Ke,t[7]=V*Pe+W*ze+re*Ke,t[8]=T*We+H*Ze+q*Ft,t[9]=R*We+ee*Ze+ce*Ft,t[10]=D*We+z*Ze+we*Ft,t[11]=V*We+W*Ze+re*Ft,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function F4(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],c=e[5],l=e[6],f=e[7],y=e[8],E=e[9],T=e[10],R=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+y*r,t[5]=c*s+E*r,t[6]=l*s+T*r,t[7]=f*s+R*r,t[8]=y*s-n*r,t[9]=E*s-c*r,t[10]=T*s-l*r,t[11]=R*s-f*r,t}function iG(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],c=e[1],l=e[2],f=e[3],y=e[8],E=e[9],T=e[10],R=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-y*r,t[1]=c*s-E*r,t[2]=l*s-T*r,t[3]=f*s-R*r,t[8]=n*r+y*s,t[9]=c*r+E*s,t[10]=l*r+T*s,t[11]=f*r+R*s,t}function N4(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],c=e[1],l=e[2],f=e[3],y=e[4],E=e[5],T=e[6],R=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+y*r,t[1]=c*s+E*r,t[2]=l*s+T*r,t[3]=f*s+R*r,t[4]=y*s-n*r,t[5]=E*s-c*r,t[6]=T*s-l*r,t[7]=R*s-f*r,t}function rG(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],c=e[5],l=e[6],f=e[8],y=e[9],E=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+c*c+l*l),t[2]=Math.sqrt(f*f+y*y+E*E),t}function sG(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],c=i+i,l=r+r,f=s+s,y=i*c,E=r*c,T=r*l,R=s*c,D=s*l,V=s*f,H=n*c,ee=n*l,z=n*f;return t[0]=1-T-V,t[1]=E+z,t[2]=R-ee,t[3]=0,t[4]=E-z,t[5]=1-y-V,t[6]=D+H,t[7]=0,t[8]=R+ee,t[9]=D-H,t[10]=1-y-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nG(t,e,i,r,s,n,c){const l=1/(i-e),f=1/(s-r),y=1/(n-c);return t[0]=n*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n*2*f,t[6]=0,t[7]=0,t[8]=(i+e)*l,t[9]=(s+r)*f,t[10]=(c+n)*y,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*n*2*y,t[15]=0,t}function oG(t,e,i,r,s){const n=1/Math.tan(e/2);if(t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0){const c=1/(r-s);t[10]=(s+r)*c,t[14]=2*s*r*c}else t[10]=-1,t[14]=-2*r;return t}const aG=oG;function lG(t,e,i,r,s,n,c){const l=1/(e-i),f=1/(r-s),y=1/(n-c);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*y,t[11]=0,t[12]=(e+i)*l,t[13]=(s+r)*f,t[14]=(c+n)*y,t[15]=1,t}const cG=lG;function uG(t,e,i,r){let s,n,c,l,f,y,E,T,R,D;const V=e[0],H=e[1],ee=e[2],z=r[0],W=r[1],q=r[2],ce=i[0],we=i[1],re=i[2];return Math.abs(V-ce)<Vf&&Math.abs(H-we)<Vf&&Math.abs(ee-re)<Vf?Yj(t):(T=V-ce,R=H-we,D=ee-re,s=1/Math.sqrt(T*T+R*R+D*D),T*=s,R*=s,D*=s,n=W*D-q*R,c=q*T-z*D,l=z*R-W*T,s=Math.sqrt(n*n+c*c+l*l),s?(s=1/s,n*=s,c*=s,l*=s):(n=0,c=0,l=0),f=R*l-D*c,y=D*n-T*l,E=T*c-R*n,s=Math.sqrt(f*f+y*y+E*E),s?(s=1/s,f*=s,y*=s,E*=s):(f=0,y=0,E=0),t[0]=n,t[1]=f,t[2]=T,t[3]=0,t[4]=c,t[5]=y,t[6]=R,t[7]=0,t[8]=l,t[9]=E,t[10]=D,t[11]=0,t[12]=-(n*V+c*H+l*ee),t[13]=-(f*V+y*H+E*ee),t[14]=-(T*V+R*H+D*ee),t[15]=1,t)}function hG(){const t=new Uo(4);return Uo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function dG(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function U4(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function pG(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function fG(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function mG(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let c=i*i+r*r+s*s+n*n;return c>0&&(c=1/Math.sqrt(c)),t[0]=i*c,t[1]=r*c,t[2]=s*c,t[3]=n*c,t}function gG(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function _G(t,e,i,r){const s=e[0],n=e[1],c=e[2],l=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=c+r*(i[2]-c),t[3]=l+r*(i[3]-l),t}function Bm(t,e,i){const r=e[0],s=e[1],n=e[2],c=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*c,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*c,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*c,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*c,t}function yG(t,e,i){const r=e[0],s=e[1],n=e[2],c=i[0],l=i[1],f=i[2],y=i[3],E=y*r+l*n-f*s,T=y*s+f*r-c*n,R=y*n+c*s-l*r,D=-c*r-l*s-f*n;return t[0]=E*y+D*-c+T*-f-R*-l,t[1]=T*y+D*-l+R*-c-E*-f,t[2]=R*y+D*-f+E*-l-T*-c,t[3]=e[3],t}(function(){const t=hG();return function(e,i,r,s,n,c){let l,f;for(i||(i=4),r||(r=0),s?f=Math.min(s*i+r,e.length):f=e.length,l=r;l<f;l+=i)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],n(t,t,c),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var ex;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(ex||(ex={}));const vG=45*Math.PI/180,bG=1,Hv=.1,qv=500,wG=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ai extends D4{static get IDENTITY(){return EG()}static get ZERO(){return xG()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return ex}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,r,s,n,c,l,f,y,E,T,R,D,V,H,ee){return this[0]=e,this[1]=i,this[2]=r,this[3]=s,this[4]=n,this[5]=c,this[6]=l,this[7]=f,this[8]=y,this[9]=E,this[10]=T,this[11]=R,this[12]=D,this[13]=V,this[14]=H,this[15]=ee,this.check()}setRowMajor(e,i,r,s,n,c,l,f,y,E,T,R,D,V,H,ee){return this[0]=e,this[1]=n,this[2]=y,this[3]=D,this[4]=i,this[5]=c,this[6]=E,this[7]=V,this[8]=r,this[9]=l,this[10]=T,this[11]=H,this[12]=s,this[13]=f,this[14]=R,this[15]=ee,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(wG)}fromObject(e){return this.check()}fromQuaternion(e){return sG(this,e),this.check()}frustum(e){const{left:i,right:r,bottom:s,top:n,near:c=Hv,far:l=qv}=e;return l===1/0?AG(this,i,r,s,n,c):nG(this,i,r,s,n,c,l),this.check()}lookAt(e){const{eye:i,center:r=[0,0,0],up:s=[0,1,0]}=e;return uG(this,i,r,s),this.check()}ortho(e){const{left:i,right:r,bottom:s,top:n,near:c=Hv,far:l=qv}=e;return cG(this,i,r,s,n,c,l),this.check()}orthographic(e){const{fovy:i=vG,aspect:r=bG,focalDistance:s=1,near:n=Hv,far:c=qv}=e;GS(i);const l=i/2,f=s*Math.tan(l),y=f*r;return this.ortho({left:-y,right:y,bottom:-f,top:f,near:n,far:c})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:r=1,near:s=.1,far:n=500}=e;return GS(i),aG(this,i,r,s,n),this.check()}determinant(){return eG(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),s=1/r[0],n=1/r[1],c=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*n,e[2]=this[2]*c,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*n,e[6]=this[6]*c,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*n,e[10]=this[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),s=1/r[0],n=1/r[1],c=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*n,e[2]=this[2]*c,e[3]=this[4]*s,e[4]=this[5]*n,e[5]=this[6]*c,e[6]=this[8]*s,e[7]=this[9]*n,e[8]=this[10]*c,e}transpose(){return Qj(this,this),this.check()}invert(){return Qw(this,this),this.check()}multiplyLeft(e){return mu(this,e,this),this.check()}multiplyRight(e){return mu(this,this,e),this.check()}rotateX(e){return F4(this,this,e),this.check()}rotateY(e){return iG(this,this,e),this.check()}rotateZ(e){return N4(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return tG(this,this,e,i),this.check()}scale(e){return sE(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return H0(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Bm(i||[-0,-0,-0,-0],e,this),Gf(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:r}=e;let s;switch(r){case 2:s=I4(i||[-0,-0],e,this);break;case 3:s=iE(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Gf(s,e.length),s}transformAsVector(e,i){let r;switch(e.length){case 2:r=R4(i||[-0,-0],e,this);break;case 3:r=M4(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Gf(r,e.length),r}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,r){return this.identity().translate([e,i,r])}}let g_,__;function xG(){return g_||(g_=new ai([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(g_)),g_}function EG(){return __||(__=new ai,Object.freeze(__)),__}function GS(t){if(t>Math.PI*2)throw Error("expected radians")}function AG(t,e,i,r,s,n){const c=2*n/(i-e),l=2*n/(s-r),f=(i+e)/(i-e),y=(s+r)/(s-r),E=-1,T=-1,R=-2*n;return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=f,t[9]=y,t[10]=E,t[11]=T,t[12]=0,t[13]=0,t[14]=R,t[15]=0,t}function VS(){const t=new Uo(4);return Uo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function TG(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function z4(t,e,i){i=i*.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function $S(t,e,i){const r=e[0],s=e[1],n=e[2],c=e[3],l=i[0],f=i[1],y=i[2],E=i[3];return t[0]=r*E+c*l+s*y-n*f,t[1]=s*E+c*f+n*l-r*y,t[2]=n*E+c*y+r*f-s*l,t[3]=c*E-r*l-s*f-n*y,t}function SG(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],c=e[3],l=Math.sin(i),f=Math.cos(i);return t[0]=r*f+c*l,t[1]=s*f+n*l,t[2]=n*f-s*l,t[3]=c*f-r*l,t}function CG(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],c=e[3],l=Math.sin(i),f=Math.cos(i);return t[0]=r*f-n*l,t[1]=s*f+c*l,t[2]=n*f+r*l,t[3]=c*f-s*l,t}function IG(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],c=e[3],l=Math.sin(i),f=Math.cos(i);return t[0]=r*f+s*l,t[1]=s*f-r*l,t[2]=n*f+c*l,t[3]=c*f-n*l,t}function RG(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function r0(t,e,i,r){const s=e[0],n=e[1],c=e[2],l=e[3];let f=i[0],y=i[1],E=i[2],T=i[3],R,D,V,H,ee;return R=s*f+n*y+c*E+l*T,R<0&&(R=-R,f=-f,y=-y,E=-E,T=-T),1-R>Vf?(D=Math.acos(R),ee=Math.sin(D),V=Math.sin((1-r)*D)/ee,H=Math.sin(r*D)/ee):(V=1-r,H=r),t[0]=V*s+H*f,t[1]=V*n+H*y,t[2]=V*c+H*E,t[3]=V*l+H*T,t}function MG(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],c=i*i+r*r+s*s+n*n,l=c?1/c:0;return t[0]=-i*l,t[1]=-r*l,t[2]=-s*l,t[3]=n*l,t}function PG(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function j4(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);const n=(s+1)%3,c=(s+2)%3;r=Math.sqrt(e[s*3+s]-e[n*3+n]-e[c*3+c]+1),t[s]=.5*r,r=.5/r,t[3]=(e[n*3+c]-e[c*3+n])*r,t[n]=(e[n*3+s]+e[s*3+n])*r,t[c]=(e[c*3+s]+e[s*3+c])*r}return t}const kG=dG,BG=U4,LG=gG,OG=_G,DG=pG,FG=fG,G4=mG,NG=function(){const t=k4(),e=US(1,0,0),i=US(0,1,0);return function(r,s,n){const c=tE(s,n);return c<-.999999?(i0(t,e,s),jj(t)<1e-6&&i0(t,i,s),Oj(t,t),z4(r,t,Math.PI),r):c>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(i0(t,s,n),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+c,G4(r,r))}}();(function(){const t=VS(),e=VS();return function(i,r,s,n,c,l){return r0(t,r,c,l),r0(e,s,n,l),r0(i,t,e,2*l*(1-l)),i}})();(function(){const t=Gj();return function(e,i,r,s){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],G4(e,j4(e,t))}})();const UG=[0,0,0,1];class fm extends Y2{constructor(e=0,i=0,r=0,s=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,i,r,s)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,i,r,s){return this[0]=e,this[1]=i,this[2]=r,this[3]=s,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return j4(this,e),this.check()}fromAxisRotation(e,i){return z4(this,e,i),this.check()}identity(){return TG(this),this.check()}setAxisAngle(e,i){return this.fromAxisRotation(e,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=vi(e)}get y(){return this[1]}set y(e){this[1]=vi(e)}get z(){return this[2]}set z(e){this[2]=vi(e)}get w(){return this[3]}set w(e){this[3]=vi(e)}len(){return DG(this)}lengthSquared(){return FG(this)}dot(e){return LG(this,e)}rotationTo(e,i){return NG(this,e,i),this.check()}add(e){return kG(this,this,e),this.check()}calculateW(){return RG(this,this),this.check()}conjugate(){return PG(this,this),this.check()}invert(){return MG(this,this),this.check()}lerp(e,i,r){return r===void 0?this.lerp(this,e,i):(OG(this,e,i,r),this.check())}multiplyRight(e){return $S(this,this,e),this.check()}multiplyLeft(e){return $S(this,e,this),this.check()}normalize(){const e=this.len(),i=e>0?1/e:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,e===0&&(this[3]=1),this.check()}rotateX(e){return SG(this,this,e),this.check()}rotateY(e){return CG(this,this,e),this.check()}rotateZ(e){return IG(this,this,e),this.check()}scale(e){return BG(this,this,e),this.check()}slerp(e,i,r){let s,n,c;switch(arguments.length){case 1:({start:s=UG,target:n,ratio:c}=e);break;case 2:s=this,n=e,c=i;break;default:s=e,n=i,c=r}return r0(this,s,n,c),this.check()}transformVector4(e,i=new rE){return yG(i,e,this),Gf(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,i){return this.setAxisAngle(e,i)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const zG=.1,jG=1e-12,V4=1e-15,GG=1e-20,HS=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,VG={lightSources:{}};function Wv(t={}){const{color:e=[0,0,0],intensity:i=1}=t;return e.map(r=>r*i/255)}function $G({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const r={};return t?r["lighting_uAmbientLight.color"]=Wv(t):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((s,n)=>{r[`lighting_uPointLight[${n}].color`]=Wv(s),r[`lighting_uPointLight[${n}].position`]=s.position,r[`lighting_uPointLight[${n}].attenuation`]=s.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,i.forEach((s,n)=>{r[`lighting_uDirectionalLight[${n}].color`]=Wv(s),r[`lighting_uDirectionalLight[${n}].direction`]=s.direction}),r.lighting_uDirectionalLightCount=i.length,r}function $4(t=VG){var e,i;if("lightSources"in t){const{ambientLight:r,pointLights:s,directionalLights:n}=t.lightSources||{};return r||s&&s.length>0||n&&n.length>0?Object.assign({},$G({ambientLight:r,pointLights:s,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const r={pointLights:[],directionalLights:[]};for(const s of t.lights||[])switch(s.type){case"ambient":r.ambientLight=s;break;case"directional":(e=r.directionalLights)==null||e.push(s);break;case"point":(i=r.pointLights)==null||i.push(s);break}return $4({lightSources:r})}return{}}const nE={name:"lights",vs:HS,fs:HS,getUniforms:$4,defines:{MAX_LIGHTS:3}},H4=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,HG={};function qG(t){const{ambient:e=.35,diffuse:i=.6,shininess:r=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:r,lighting_uSpecularColor:s.map(n=>n/255)}}function q4(t=HG){if(!("material"in t))return{};const{material:e}=t;return e?qG(e):{lighting_uEnabled:!1}}const WG={name:"gouraud-lighting",dependencies:[nE],vs:H4,defines:{LIGHTING_VERTEX:1},getUniforms:q4},XG={name:"phong-lighting",dependencies:[nE],fs:H4,defines:{LIGHTING_FRAGMENT:1},getUniforms:q4},KG=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,JG=`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,oE={name:"pbr",vs:KG,fs:JG,defines:{LIGHTING_FRAGMENT:1},dependencies:[nE]},W4="#define SMOOTH_EDGE_RADIUS 0.5",ZG=`
${W4}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,YG=`
${W4}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,QG={name:"geometry",vs:ZG,fs:YG},li={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(li,"IDENTITY",{get:()=>(fi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ha={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},tx={common:0,meters:1,pixels:2},ix={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},eV=Object.keys(li).map(t=>`const int COORDINATE_SYSTEM_${t} = ${li[t]};`).join(""),tV=Object.keys(ha).map(t=>`const int PROJECTION_MODE_${t} = ${ha[t]};`).join(""),iV=Object.keys(tx).map(t=>`const int UNIT_${t.toUpperCase()} = ${tx[t]};`).join(""),rV=`${eV}
${tV}
${iV}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function sV(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Lm(t){let e={},i;return r=>{for(const s in r)if(!sV(r[s],e[s])){i=t(r),e=r;break}return i}}const qS=[0,0,0,0],nV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],X4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],oV=[0,0,0],K4=[0,0,0],aV=Lm(uV);function J4(t,e,i=K4){i.length<3&&(i=[i[0],i[1],0]);let r=i,s,n=!0;switch(e===li.LNGLAT_OFFSETS||e===li.METER_OFFSETS?s=i:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ha.WEB_MERCATOR:(e===li.LNGLAT||e===li.CARTESIAN)&&(s=[0,0,0],n=!1);break;case ha.WEB_MERCATOR_AUTO_OFFSET:e===li.LNGLAT?r=s:e===li.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(r),r[0]-=i[0],r[1]-=i[1],r[2]-=i[2]);break;case ha.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case ha.GLOBE:n=!1,s=null;break;default:n=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:n}}function lV(t,e,i){const{viewMatrixUncentered:r,projectionMatrix:s}=t;let{viewMatrix:n,viewProjectionMatrix:c}=t,l=qS,f=qS,y=t.cameraPosition;const{geospatialOrigin:E,shaderCoordinateOrigin:T,offsetMode:R}=J4(t,e,i);return R&&(f=t.projectPosition(E||T),y=[y[0]-f[0],y[1]-f[1],y[2]-f[2]],f[3]=1,l=Bm([],f,c),n=r||n,c=mu([],s,n),c=mu([],c,nV)),{viewMatrix:n,viewProjectionMatrix:c,projectionCenter:l,originCommon:f,cameraPosCommon:y,shaderCoordinateOrigin:T,geospatialOrigin:E}}function cV({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:r=li.DEFAULT,coordinateOrigin:s=K4,autoWrapLongitude:n=!1}){r===li.DEFAULT&&(r=t.isGeospatial?li.LNGLAT:li.CARTESIAN);const c=aV({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:s});return c.project_uWrapLongitude=n,c.project_uModelMatrix=i||X4,c}function uV({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r}){const{projectionCenter:s,viewProjectionMatrix:n,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:f,geospatialOrigin:y}=lV(t,i,r),E=t.getDistanceScales(),T=[t.width*e,t.height*e],R=Bm([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,D={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:f,project_uCommonOrigin:c.slice(0,3),project_uCenter:s,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:T,project_uDevicePixelRatio:e,project_uFocalDistance:R,project_uCommonUnitsPerMeter:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:oV,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:n,project_uModelMatrix:X4,project_uCameraPosition:l};if(y){const V=t.getDistanceScales(y);switch(i){case li.METER_OFFSETS:D.project_uCommonUnitsPerWorldUnit=V.unitsPerMeter,D.project_uCommonUnitsPerWorldUnit2=V.unitsPerMeter2;break;case li.LNGLAT:case li.LNGLAT_OFFSETS:t._pseudoMeters||(D.project_uCommonUnitsPerMeter=V.unitsPerMeter),D.project_uCommonUnitsPerWorldUnit=V.unitsPerDegree,D.project_uCommonUnitsPerWorldUnit2=V.unitsPerDegree2;break;case li.CARTESIAN:D.project_uCommonUnitsPerWorldUnit=[1,1,V.unitsPerMeter[2]],D.project_uCommonUnitsPerWorldUnit2=[0,0,V.unitsPerMeter2[2]];break}}return D}const hV={};function dV(t=hV){return"viewport"in t?cV(t):{}}const aE={name:"project",dependencies:[oj,QG],vs:rV,getUniforms:dV},pV=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,lE={name:"project32",dependencies:[aE],vs:pV};function fV(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function gd(t,e){const i=Bm([],e,t);return U4(i,i,1/i[3]),i}function WS(t,e){const i=t%e;return i<0?e+i:i}function rx(t,e,i){return t<e?e:t>i?i:t}function mV(t){return Math.log(t)*Math.LOG2E}const cE=Math.log2||mV;function Qa(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Po=Math.PI,Z4=Po/4,co=Po/180,sx=180/Po,Rd=512,q0=4003e4,y_=85.051129,gV=1.5;function _V(t){return cE(t)}function mm(t){const[e,i]=t;Qa(Number.isFinite(e)),Qa(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const r=e*co,s=i*co,n=Rd*(r+Po)/(2*Po),c=Rd*(Po+Math.log(Math.tan(Z4+s*.5)))/(2*Po);return[n,c]}function Md(t){const[e,i]=t,r=e/Rd*(2*Po)-Po,s=2*(Math.atan(Math.exp(i/Rd*(2*Po)-Po))-Z4);return[r*sx,s*sx]}function yV(t){const{latitude:e}=t;Qa(Number.isFinite(e));const i=Math.cos(e*co);return _V(q0*i)-9}function s0(t){const e=Math.cos(t*co);return Rd/q0/e}function nx(t){const{latitude:e,longitude:i,highPrecision:r=!1}=t;Qa(Number.isFinite(e)&&Number.isFinite(i));const s=Rd,n=Math.cos(e*co),c=s/360,l=c/n,f=s/q0/n,y={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[c,l,f],degreesPerUnit:[1/c,1/l,1/f]};if(r){const E=co*Math.tan(e*co)/n,T=c*E/2,R=s/q0*E,D=R/l*f;y.unitsPerDegree2=[0,T,R],y.unitsPerMeter2=[D,0,D]}return y}function Y4(t,e){const[i,r,s]=t,[n,c,l]=e,{unitsPerMeter:f,unitsPerMeter2:y}=nx({longitude:i,latitude:r,highPrecision:!0}),E=mm(t);E[0]+=n*(f[0]+y[0]*c),E[1]+=c*(f[1]+y[1]*c);const T=Md(E),R=(s||0)+(l||0);return Number.isFinite(s)||Number.isFinite(l)?[T[0],T[1],R]:T}function vV(t){const{height:e,pitch:i,bearing:r,altitude:s,scale:n,center:c}=t,l=fV();H0(l,l,[0,0,-s]),F4(l,l,-i*co),N4(l,l,r*co);const f=n/e;return sE(l,l,[f,f,f]),c&&H0(l,l,Lj([],c)),l}function bV(t){const{width:e,height:i,altitude:r,pitch:s=0,offset:n,center:c,scale:l,nearZMultiplier:f=1,farZMultiplier:y=1}=t;let{fovy:E=W0(gV)}=t;r!==void 0&&(E=W0(r));const T=E*co,R=s*co,D=Q4(E);let V=D;c&&(V+=c[2]*l/Math.cos(R)/i);const H=T*(.5+(n?n[1]:0)/i),ee=Math.sin(H)*V/Math.sin(rx(Math.PI/2-R-H,.01,Math.PI-.01)),z=Math.sin(R)*ee+V,W=V*10,q=Math.min(z*y,W);return{fov:T,aspect:e/i,focalDistance:D,near:f,far:q}}function W0(t){return 2*Math.atan(.5/t)*sx}function Q4(t){return .5/Math.tan(.5*t*co)}function ek(t,e){const[i,r,s=0]=t;return Qa(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(s)),gd(e,[i,r,s,1])}function uE(t,e,i=0){const[r,s,n]=t;if(Qa(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(n))return gd(e,[r,s,n,1]);const c=gd(e,[r,s,0,1]),l=gd(e,[r,s,1,1]),f=c[2],y=l[2],E=f===y?0:((i||0)-f)/(y-f);return S4([],c,l,E)}function wV(t){const{width:e,height:i,bounds:r,minExtent:s=0,maxZoom:n=24,offset:c=[0,0]}=t,[[l,f],[y,E]]=r,T=xV(t.padding),R=mm([l,rx(E,-y_,y_)]),D=mm([y,rx(f,-y_,y_)]),V=[Math.max(Math.abs(D[0]-R[0]),s),Math.max(Math.abs(D[1]-R[1]),s)],H=[e-T.left-T.right-Math.abs(c[0])*2,i-T.top-T.bottom-Math.abs(c[1])*2];Qa(H[0]>0&&H[1]>0);const ee=H[0]/V[0],z=H[1]/V[1],W=(T.right-T.left)/2/ee,q=(T.top-T.bottom)/2/z,ce=[(D[0]+R[0])/2+W,(D[1]+R[1])/2+q],we=Md(ce),re=Math.min(n,cE(Math.abs(Math.min(ee,z))));return Qa(Number.isFinite(re)),{longitude:we[0],latitude:we[1],zoom:re}}function xV(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Qa(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const XS=Math.PI/180;function EV(t,e=0){const{width:i,height:r,unproject:s}=t,n={targetZ:e},c=s([0,r],n),l=s([i,r],n);let f,y;const E=t.fovy?.5*t.fovy*XS:Math.atan(.5/t.altitude),T=(90-t.pitch)*XS;return E>T-.01?(f=KS(t,0,e),y=KS(t,i,e)):(f=s([0,0],n),y=s([i,0],n)),[c,l,y,f]}function KS(t,e,i){const{pixelUnprojectionMatrix:r}=t,s=gd(r,[e,0,1,1]),n=gd(r,[e,t.height,1,1]),c=(i*t.distanceScales.unitsPerMeter[2]-s[2])/(n[2]-s[2]),l=S4([],s,n,c),f=Md(l);return f.push(i),f}const JS=512;function AV(t){const{width:e,height:i,pitch:r=0}=t;let{longitude:s,latitude:n,zoom:c,bearing:l=0}=t;(s<-180||s>180)&&(s=WS(s+180,360)-180),(l<-180||l>180)&&(l=WS(l+180,360)-180);const f=cE(i/JS);if(c<=f)c=f,n=0;else{const y=i/2/Math.pow(2,c),E=Md([0,y])[1];if(n<E)n=E;else{const T=Md([0,JS-y])[1];n>T&&(n=T)}}return{width:e,height:i,longitude:s,latitude:n,zoom:c,pitch:r,bearing:l}}const TV=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,SV=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,CV=Lm(kV),IV=Lm(BV),RV=[0,0,0,1],MV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function PV(t,e){const[i,r,s]=t,n=uE([i,r,s],e);return Number.isFinite(s)?n:[n[0],n[1],0]}function kV({viewport:t,center:e}){return new ai(t.viewProjectionMatrix).invert().transform(e)}function BV({viewport:t,shadowMatrices:e}){const i=[],r=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,n=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(c=>PV(c,r));for(const c of e){const l=c.clone().translate(new Be(t.center).negate()),f=n.map(E=>l.transform(E)),y=new ai().ortho({left:Math.min(...f.map(E=>E[0])),right:Math.max(...f.map(E=>E[0])),bottom:Math.min(...f.map(E=>E[1])),top:Math.max(...f.map(E=>E[1])),near:Math.min(...f.map(E=>-E[2])),far:Math.max(...f.map(E=>-E[2]))});i.push(y.multiplyRight(c))}return i}function LV(t,e){const{shadowEnabled:i=!0}=t;if(!i||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||RV,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},s=CV({viewport:t.viewport,center:e.project_uCenter}),n=[],c=IV({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const f=c[l],y=f.clone().translate(new Be(t.viewport.center).negate());e.project_uCoordinateSystem===li.LNGLAT&&e.project_uProjectionMode===ha.WEB_MERCATOR?(c[l]=y,n[l]=s):(c[l]=f.clone().multiplyRight(MV),n[l]=y.transform(s))}for(let l=0;l<c.length;l++)r[`shadow_uViewProjectionMatrices[${l}]`]=c[l],r[`shadow_uProjectCenters[${l}]`]=n[l];for(let l=0;l<2;l++)r[`shadow_uShadowMap${l}`]=t.shadowMaps&&t.shadowMaps[l]||t.dummyShadowMap;return r}const ZS={name:"shadow",dependencies:[aE],vs:TV,fs:SV,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?LV(t,e):{}},hE={...FS,defaultUniforms:{...FS.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},OV=[aE],DV=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function FV(){const t=RP.getDefaultShaderAssembler();for(const e of OV)t.addDefaultModule(e);for(const e of DV)t.addShaderHook(e);return t}const NV=[255,255,255],UV=1;let zV=0;class jV{constructor(e={}){this.type="ambient";const{color:i=NV}=e,{intensity:r=UV}=e;this.id=e.id||`ambient-${zV++}`,this.color=i,this.intensity=r}}const GV=[255,255,255],VV=1,$V=[0,0,-1];let HV=0;class YS{constructor(e={}){this.type="directional";const{color:i=GV}=e,{intensity:r=VV}=e,{direction:s=$V}=e,{_shadow:n=!1}=e;this.id=e.id||`directional-${HV++}`,this.color=i,this.intensity=r,this.type="directional",this.direction=new Be(s).normalize().toArray(),this.shadow=n}getProjectedLight(e){return this}}class qV{constructor(e,i={id:"pass"}){const{id:r}=i;this.id=r,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class dE extends qV{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,r]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,n=e.clearColor??(s?[0,0,0,0]:!1),c=s?1:!1,l=s?0:!1,f=e.colorMask??15,y={viewport:[0,0,i,r]};e.colorMask&&(y.colorMask=f),e.scissorRect&&(y.scissorRect=e.scissorRect);const E=this.device.beginRenderPass({framebuffer:e.target,parameters:y,clearColor:n,clearDepth:c,clearStencil:l});try{return this._drawLayers(E,e)}finally{E.end()}}_drawLayers(e,i){const{target:r,moduleParameters:s,viewports:n,views:c,onViewportActive:l,clearStack:f=!0}=i;i.pass=i.pass||"unknown",f&&(this._lastRenderIndex=-1);const y=[];for(const E of n){const T=c&&c[E.id];l==null||l(E);const R=this._getDrawLayerParams(E,i),D=E.subViewports||[E];for(const V of D){const H=this._drawLayersInViewport(e,{target:r,moduleParameters:s,viewport:V,view:T,pass:i.pass,layers:i.layers},R);y.push(H)}}return y}_getDrawLayerParams(e,{layers:i,pass:r,isPicking:s=!1,layerFilter:n,cullRect:c,effects:l,moduleParameters:f},y=!1){var E;const T=[],R=tk(this._lastRenderIndex+1),D={layer:i[0],viewport:e,isPicking:s,renderPass:r,cullRect:c},V={};for(let H=0;H<i.length;H++){const ee=i[H],z=this._shouldDrawLayer(ee,D,n,V),W={shouldDrawLayer:z};z&&!y&&(W.layerRenderIndex=R(ee,z),W.moduleParameters=this._getModuleParameters(ee,l,r,f),W.layerParameters={...(E=ee.context.deck)==null?void 0:E.props.parameters,...this.getLayerParameters(ee,H,e)}),T[H]=W}return T}_drawLayersInViewport(e,{layers:i,moduleParameters:r,pass:s,target:n,viewport:c,view:l},f){const y=WV(this.device,{moduleParameters:r,target:n,viewport:c});if(l&&l.props.clear){const T=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:y},()=>this.device.clearWebGL(T))}const E={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:y});for(let T=0;T<i.length;T++){const R=i[T],{shouldDrawLayer:D,layerRenderIndex:V,moduleParameters:H,layerParameters:ee}=f[T];if(D&&R.props.pickable&&E.pickableCount++,R.isComposite)E.compositeCount++;else if(D){E.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,V),H.viewport=c,R.context.renderPass=e;try{R._drawLayer({renderPass:e,moduleParameters:H,uniforms:{layerIndex:V},parameters:ee})}catch(z){R.raiseError(z,`drawing ${R} to ${s}`)}}}return E}shouldDrawLayer(e){return!0}getModuleParameters(e,i){return null}getLayerParameters(e,i,r){return e.props.parameters}_shouldDrawLayer(e,i,r,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let n=e.parent;for(;n;){if(!n.props.visible||!n.filterSubLayer(i))return!1;i.layer=n,n=n.parent}if(r){const c=i.layer.id;if(c in s||(s[c]=r(i)),!s[c])return!1}return e.activateViewport(i.viewport),!0}_getModuleParameters(e,i,r,s){var n,c;const l=this.device.canvasContext.cssToDeviceRatio(),f=Object.assign(Object.create(((n=e.internalState)==null?void 0:n.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:l});if(i)for(const y of i)Object.assign(f,(c=y.getModuleParameters)==null?void 0:c.call(y,e));return Object.assign(f,this.getModuleParameters(e,i),s)}}function tk(t=0,e={}){const i={},r=(s,n)=>{const c=s.props._offset,l=s.id,f=s.parent&&s.parent.id;let y;if(f&&!(f in e)&&r(s.parent,!1),f in i){const E=i[f]=i[f]||tk(e[f],e);y=E(s,n),i[l]=E}else Number.isFinite(c)?(y=c+(e[f]||0),i[l]=null):y=t;return n&&y>=t&&(t=y+1),e[l]=y,y};return r}function WV(t,{moduleParameters:e,target:i,viewport:r}){const s=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,n]=t.canvasContext.getDrawingBufferSize(),c=i?i.height:n,l=r;return[l.x*s,c-(l.y+l.height)*s,l.width*s,l.height*s]}class XV extends dE{constructor(e,i){super(e,i),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const i=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],n=s.width*r,c=s.height*r,l=[1,1,1,1];(n!==i.width||c!==i.height)&&i.resize({width:n,height:c}),super.render({...e,clearColor:l,target:i,pass:"shadow"})}getLayerParameters(e,i,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const KV={color:[255,255,255],intensity:1},QS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],JV=[0,0,0,200/255];class ik{constructor(e={}){this.id="lighting-effect",this.shadowColor=JV,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),r._addDefaultShaderModule(ZS),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const i in e){const r=e[i];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:r,onViewportActive:s,views:n}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let c=0;c<this.shadowPasses.length;c++)this.shadowPasses[c].render({layers:e,layerFilter:i,viewports:r,onViewportActive:s,views:n,moduleParameters:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},i}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(ZS))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const r=new ai().lookAt({eye:new Be(i.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const r=new XV(e);this.shadowPasses[i]=r,this.shadowMaps[i]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:r}=this;!e&&i.length===0&&r.length===0&&(this.ambientLight=new jV(KV),this.directionalLights.push(new YS(QS[0]),new YS(QS[1])))}}class ZV{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:r=1,type:s,padding:n=0,copy:c=!1,initialize:l=!1,maxCount:f}){const y=s||e&&e.constructor||Float32Array,E=i*r+n;if(ArrayBuffer.isView(e)){if(E<=e.length)return e;if(E*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new y(e.buffer,0,E)}let T=1/0;f&&(T=f*r+n);const R=this._allocate(y,E,l,T);return e&&c?R.set(e):l||R.fill(0,0,4),this._release(e),R}release(e){this._release(e)}_allocate(e,i,r,s){let n=Math.max(Math.ceil(i*this.opts.overAlloc),1);n>s&&(n=s);const c=this._pool,l=e.BYTES_PER_ELEMENT*n,f=c.findIndex(y=>y.byteLength>=l);if(f>=0){const y=new e(c.splice(f,1)[0],0,n);return r&&y.fill(0),y}return new e(n)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:r}=e,{byteLength:s}=r,n=i.findIndex(c=>c.byteLength>=s);n<0?i.push(r):(n>0||i.length<this.opts.poolSize)&&i.splice(n,0,r),i.length>this.opts.poolSize&&i.shift()}}const gm=new ZV;function Tf(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function YV(t){return[t[12],t[13],t[14]]}function QV(t){return{left:Sh(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Sh(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Sh(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Sh(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Sh(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Sh(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const eC=new Be;function Sh(t,e,i,r){eC.set(t,e,i);const s=eC.len();return{distance:r/s,normal:new Be(-t/s,-e/s,-i/s)}}function e$(t){return t-Math.fround(t)}let of;function Xv(t,e){const{size:i=1,startIndex:r=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,n=(s-r)/i;of=gm.allocate(of,n,{type:Float32Array,size:i*2});let c=r,l=0;for(;c<s;){for(let f=0;f<i;f++){const y=t[c++];of[l+f]=y,of[l+f+i]=e$(y)}l+=i*2}return of.subarray(0,n*i*2)}function t$(t){let e=null,i=!1;for(const r of t)r&&(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const i$=Math.PI/180,r$=Tf(),tC=[0,0,0],s$={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function n$({width:t,height:e,orthographic:i,fovyRadians:r,focalDistance:s,padding:n,near:c,far:l}){const f=t/e,y=i?new ai().orthographic({fovy:r,aspect:f,focalDistance:s,near:c,far:l}):new ai().perspective({fovy:r,aspect:f,near:c,far:l});if(n){const{left:E=0,right:T=0,top:R=0,bottom:D=0}=n,V=$a((E+t-T)/2,0,t)-t/2,H=$a((R+e-D)/2,0,e)-e/2;y[8]-=V*2/t,y[9]+=H*2/e}return y}class Om{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||s$,this.focalDistance=e.focalDistance||1,this.position=e.position||tC,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ha.WEB_MERCATOR:ha.WEB_MERCATOR_AUTO_OFFSET:ha.IDENTITY}equals(e){return e instanceof Om?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Do(e.projectionMatrix,this.projectionMatrix)&&Do(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const r=this.projectPosition(e),s=ek(r,this.pixelProjectionMatrix),[n,c]=s,l=i?c:this.height-c;return e.length===2?[n,l]:[n,l,s[2]]}unproject(e,{topLeft:i=!0,targetZ:r}={}){const[s,n,c]=e,l=i?n:this.height-n,f=r&&r*this.distanceScales.unitsPerMeter[2],y=uE([s,l,c],this.pixelUnprojectionMatrix,f),[E,T,R]=this.unprojectPosition(y);return Number.isFinite(c)?[E,T,R]:Number.isFinite(r)?[E,T,r]:[E,T]}projectPosition(e){const[i,r]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,r,s]}unprojectPosition(e){const[i,r]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,r,s]}projectFlat(e){if(this.isGeospatial){const i=mm(e);return i[1]=$a(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?Md(e):e}getBounds(e={}){const i={targetZ:e.z||0},r=this.unproject([0,0],i),s=this.unproject([this.width,0],i),n=this.unproject([0,this.height],i),c=this.unproject([this.width,this.height],i);return[Math.min(r[0],s[0],n[0],c[0]),Math.min(r[1],s[1],n[1],c[1]),Math.max(r[0],s[0],n[0],c[0]),Math.max(r[1],s[1],n[1],c[1])]}getDistanceScales(e){return e?nx({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:r=1,height:s=1}){return e<this.x+this.width&&this.x<e+r&&i<this.y+this.height&&this.y<i+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,QV(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=yV({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||nx({latitude:r,longitude:i}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:n,modelMatrix:c}=e;let l=tC;if(n&&(l=c?new ai(c).transformAsVector(n,[]):n),this.isGeospatial){const f=this.projectPosition([i,r,0]);this.center=new Be(l).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:i=r$,projectionMatrix:r=null,orthographic:s=!1,fovyRadians:n,fovy:c=75,near:l=.1,far:f=1e3,padding:y=null,focalDistance:E=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new ai().multiplyRight(i).translate(new Be(this.center).negate()),this.projectionMatrix=r||n$({width:this.width,height:this.height,orthographic:s,fovyRadians:n||c*i$,focalDistance:E,padding:y,near:l,far:f});const T=Tf();mu(T,T,this.projectionMatrix),mu(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=Qw([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=YV(this.viewMatrixInverse);const R=Tf(),D=Tf();sE(R,R,[this.width/2,-this.height/2,1]),H0(R,R,[1,-1,0]),mu(D,R,this.viewProjectionMatrix),this.pixelProjectionMatrix=D,this.pixelUnprojectionMatrix=Qw(Tf(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||fi.warn("Pixel project matrix not invertible")()}}Om.displayName="Viewport";class xu extends Om{constructor(e={}){const{latitude:i=0,longitude:r=0,zoom:s=0,pitch:n=0,bearing:c=0,nearZMultiplier:l=.1,farZMultiplier:f=1.01,nearZ:y,farZ:E,orthographic:T=!1,projectionMatrix:R,repeat:D=!1,worldOffset:V=0,position:H,padding:ee,legacyMeterSizes:z=!1}=e;let{width:W,height:q,altitude:ce=1.5}=e;const we=Math.pow(2,s);W=W||1,q=q||1;let re,be=null;if(R)ce=R[5]/2,re=W0(ce);else{e.fovy?(re=e.fovy,ce=Q4(re)):re=W0(ce);let Te;if(ee){const{top:Pe=0,bottom:ze=0}=ee;Te=[0,$a((Pe+q-ze)/2,0,q)-q/2]}be=bV({width:W,height:q,scale:we,center:H&&[0,0,H[2]*s0(i)],offset:Te,pitch:n,fovy:re,nearZMultiplier:l,farZMultiplier:f}),Number.isFinite(y)&&(be.near=y),Number.isFinite(E)&&(be.far=E)}let me=vV({height:q,pitch:n,bearing:c,scale:we,altitude:ce});V&&(me=new ai().translate([512*V,0,0]).multiplyLeft(me)),super({...e,width:W,height:q,viewMatrix:me,longitude:r,latitude:i,zoom:s,...be,fovy:re,focalDistance:ce}),this.latitude=i,this.longitude=r,this.zoom=s,this.pitch=n,this.bearing=c,this.altitude=ce,this.fovy=re,this.orthographic=T,this._subViewports=D?[]:null,this._pseudoMeters=z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let s=i;s<=r;s++){const n=s?new xu({...this,worldOffset:s}):this;this._subViewports.push(n)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,r]=this.projectFlat(e),s=(e[2]||0)*s0(e[1]);return[i,r,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,r]=this.unprojectFlat(e),s=(e[2]||0)/s0(r);return[i,r,s]}addMetersToLngLat(e,i){return Y4(e,i)}panByPosition(e,i){const r=uE(i,this.pixelUnprojectionMatrix),s=this.projectFlat(e),n=NS([],s,Ij([],r)),c=NS([],this.center,n),[l,f]=this.unprojectFlat(c);return{longitude:l,latitude:f}}getBounds(e={}){const i=EV(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:r,height:s}=this,{longitude:n,latitude:c,zoom:l}=wV({width:r,height:s,bounds:e,...i});return new xu({width:r,height:s,longitude:n,latitude:c,zoom:l})}}xu.displayName="WebMercatorViewport";const iC=[0,0,0];function Kv(t,e,i=!1){const r=e.projectPosition(t);if(i&&e instanceof xu){const[s,n,c=0]=t,l=e.getDistanceScales([s,n]);r[2]=c*l.unitsPerMeter[2]}return r}function o$(t){const{viewport:e,modelMatrix:i,coordinateOrigin:r}=t;let{coordinateSystem:s,fromCoordinateSystem:n,fromCoordinateOrigin:c}=t;return s===li.DEFAULT&&(s=e.isGeospatial?li.LNGLAT:li.CARTESIAN),n===void 0&&(n=s),c===void 0&&(c=r),{viewport:e,coordinateSystem:s,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:n,fromCoordinateOrigin:c}}function rk(t,{viewport:e,modelMatrix:i,coordinateSystem:r,coordinateOrigin:s,offsetMode:n}){let[c,l,f=0]=t;switch(i&&([c,l,f]=Bm([],[c,l,f,1],i)),r){case li.LNGLAT:return Kv([c,l,f],e,n);case li.LNGLAT_OFFSETS:return Kv([c+s[0],l+s[1],f+(s[2]||0)],e,n);case li.METER_OFFSETS:return Kv(Y4(s,[c,l,f]),e,n);case li.CARTESIAN:default:return e.isGeospatial?[c+s[0],l+s[1],f+s[2]]:e.projectPosition([c,l,f])}}function a$(t,e){const{viewport:i,coordinateSystem:r,coordinateOrigin:s,modelMatrix:n,fromCoordinateSystem:c,fromCoordinateOrigin:l}=o$(e),{autoOffset:f=!0}=e,{geospatialOrigin:y=iC,shaderCoordinateOrigin:E=iC,offsetMode:T=!1}=f?J4(i,r,s):{},R=rk(t,{viewport:i,modelMatrix:n,coordinateSystem:c,coordinateOrigin:l,offsetMode:T});if(T){const D=i.projectPosition(y||E);zj(R,R,D)}return R}let l$=1,c$=1;class sk{constructor(){O(this,"time",0),O(this,"channels",new Map),O(this,"animations",new Map),O(this,"playing",!1),O(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:n=1}=e,c=l$++,l={time:0,delay:i,duration:r,rate:s,repeat:n};return this._setChannelTime(l,this.time),this.channels.set(c,l),c}removeChannel(e){this.channels.delete(e);for(const[i,r]of this.animations)r.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const s of i)this._setChannelTime(s,this.time);const r=this.animations.values();for(const s of r){const{animation:n,channel:c}=s;n.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const r=c$++;return this.animations.set(r,{animation:e,channel:i}),e.setTime(this.getTime(i)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const r=i-e.delay,s=e.duration*e.repeat;r>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let u$=0;const h$={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:t0.stats.get(`animation-loop-${u$++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class d${constructor(e){if(O(this,"device",null),O(this,"canvas",null),O(this,"props"),O(this,"animationProps",null),O(this,"timeline",null),O(this,"stats"),O(this,"cpuTime"),O(this,"gpuTime"),O(this,"frameRate"),O(this,"display"),O(this,"needsRedraw","initialized"),O(this,"_initialized",!1),O(this,"_running",!1),O(this,"_animationFrameId",null),O(this,"_nextFramePromise",null),O(this,"_resolveNextFrame",null),O(this,"_cpuStartTime",0),this.props={...h$,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new Vd({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=yz(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(vz(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,i;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(i=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:i.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const r=this.props.onAddHTML(i);r&&(i.innerHTML=r)}}_getSizeAndAspect(){var e,i,r,s;if(!this.device)return{width:1,height:1,aspect:1};const[n,c]=((i=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:i.getPixelSize())||[1,1];let l=1;const f=(s=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:s.canvas;return f&&f.clientHeight?l=f.clientWidth/f.clientHeight:n>0&&c>0&&(l=n/c),{width:n,height:c,aspect:l}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class rC{constructor(e){O(this,"id"),O(this,"userData",{}),O(this,"topology"),O(this,"bufferLayout",[]),O(this,"vertexCount"),O(this,"indices"),O(this,"attributes"),this.id=e.id||vc("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&bi(this.indices.usage===yr.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function p$(t,e){if(e instanceof rC)return e;const i=f$(t,e),{attributes:r,bufferLayout:s}=m$(t,e);return new rC({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:i,attributes:r})}function f$(t,e){if(!e.indices)return;const i=e.indices.value;return t.createBuffer({usage:yr.INDEX,data:i})}function m$(t,e){const i=[],r={};for(const[n,c]of Object.entries(e.attributes)){let l=n;switch(n){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}r[l]=t.createBuffer({data:c.value,id:`${n}-buffer`});const{value:f,size:y,normalized:E}=c;i.push({name:l,format:pz(f,y,E)})}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:i,vertexCount:s}}class g${constructor(e){O(this,"modules"),O(this,"moduleUniforms"),O(this,"moduleBindings"),O(this,"moduleUniformsChanged");const i=T1(Object.values(e).filter(r=>r.dependencies));for(const r of i)e[r.name]=r;Qe.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,s]of Object.entries(e)){const n=r;this.moduleUniforms[n]=s.defaultUniforms||{},this.moduleBindings[n]={}}}destroy(){}setProps(e){var i;for(const r of Object.keys(e)){const s=r,n=e[s],c=this.modules[s];if(!c){Qe.warn(`Module ${r} not found`)();continue}const l=this.moduleUniforms[s],f=this.moduleBindings[s],y=((i=c.getUniforms)==null?void 0:i.call(c,n,l))||n,{uniforms:E,bindings:T}=J2(y);this.moduleUniforms[s]={...l,...E},this.moduleBindings[s]={...f,...T}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const i of Object.values(this.moduleBindings))Object.assign(e,i);return e}getDebugTable(){var e;const i={};for(const[r,s]of Object.entries(this.moduleUniforms))for(const[n,c]of Object.entries(s))i[`${r}.${n}`]={type:(e=this.modules[r].uniformTypes)==null?void 0:e[n],value:String(c)};return i}}const nk=class ok{constructor(e){O(this,"device"),O(this,"_hashCounter",0),O(this,"_hashes",{}),O(this,"_renderPipelineCache",{}),O(this,"_computePipelineCache",{}),this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new ok(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const i={...C1.defaultProps,...e},r=this._hashRenderPipeline(i);if(!this._renderPipelineCache[r]){const s=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});s.hash=r,this._renderPipelineCache[r]={pipeline:s,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const i={...SS.defaultProps,...e},r=this._hashComputePipeline(i);if(!this._computePipelineCache[r]){const s=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});s.hash=r,this._computePipelineCache[r]={pipeline:s,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const i=e.hash,r=e instanceof SS?this._computePipelineCache:this._renderPipelineCache;r[i].useCount--,r[i].useCount===0&&(r[i].pipeline.destroy(),delete r[i])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const i=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,s="-",n=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${r}V${s}BL${n}`;default:const c=this._getHash(JSON.stringify(e.parameters));return`${i}/${r}V${s}T${e.topology}P${c}BL${n}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};O(nk,"defaultProps",{...C1.defaultProps});let _$=nk;const ak=class lk{constructor(e){O(this,"device"),O(this,"_cache",{}),this.device=e}static getDefaultShaderFactory(e){var i;return(i=e._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new lk(e)),e._lumaData.defaultShaderFactory}createShader(e){const i=this._hashShader(e);let r=this._cache[i];if(!r){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[i]=r={shader:s,useCount:0}}return r.useCount++,r.shader}release(e){const i=this._hashShader(e),r=this._cache[i];r&&(r.useCount--,r.useCount===0&&(delete this._cache[i],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};O(ak,"defaultProps",{...GP.defaultProps});let y$=ak;function v$(t,e){var i;const r={},s="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[s]:"N/A"}};for(const n of t.attributes)if(n){const c=`${n.location} ${n.name}: ${n.type}`;r[`in ${c}`]={[s]:n.stepMode||"vertex"}}for(const n of t.varyings||[]){const c=`${n.location} ${n.name}`;r[`out ${c}`]={[s]:JSON.stringify(n.accessor)}}return r}let Jr=null,Jv=null;function b$(t,{id:e,minimap:i,opaque:r,top:s="0",left:n="0",rgbaScale:c=1}){Jr||(Jr=document.createElement("canvas"),Jr.id=e,Jr.title=e,Jr.style.zIndex="100",Jr.style.position="absolute",Jr.style.top=s,Jr.style.left=n,Jr.style.border="blue 1px solid",Jr.style.transform="scaleY(-1)",document.body.appendChild(Jr),Jv=Jr.getContext("2d")),(Jr.width!==t.width||Jr.height!==t.height)&&(Jr.width=t.width/2,Jr.height=t.height/2,Jr.style.width="400px",Jr.style.height="400px");const l=t.device.readPixelsToArrayWebGL(t),f=Jv.createImageData(t.width,t.height),y=0;for(let E=0;E<l.length;E+=4)f.data[y+E+0]=l[E+0]*c,f.data[y+E+1]=l[E+1]*c,f.data[y+E+2]=l[E+2]*c,f.data[y+E+3]=r?255:l[E+3]*c;Jv.putImageData(f,0,0)}const Ch=2,w$=1e4,ck=class uk{constructor(e,i){O(this,"device"),O(this,"id"),O(this,"source"),O(this,"vs"),O(this,"fs"),O(this,"pipelineFactory"),O(this,"shaderFactory"),O(this,"userData",{}),O(this,"parameters"),O(this,"topology"),O(this,"bufferLayout"),O(this,"isInstanced"),O(this,"instanceCount",0),O(this,"vertexCount"),O(this,"indexBuffer",null),O(this,"bufferAttributes",{}),O(this,"constantAttributes",{}),O(this,"bindings",{}),O(this,"uniforms",{}),O(this,"vertexArray"),O(this,"transformFeedback",null),O(this,"pipeline"),O(this,"shaderInputs"),O(this,"_uniformStore"),O(this,"_attributeInfos",{}),O(this,"_gpuGeometry",null),O(this,"_getModuleUniforms"),O(this,"props"),O(this,"_pipelineNeedsUpdate","newly created"),O(this,"_needsRedraw","initializing"),O(this,"_destroyed",!1),O(this,"_lastDrawTimestamp",-1),O(this,"_lastLogTime",0),O(this,"_logOpen",!1),O(this,"_drawCount",0);var r,s,n,c;this.props={...uk.defaultProps,...i},i=this.props,this.id=i.id||vc("model"),this.device=e,Object.assign(this.userData,i.userData);const l=Object.fromEntries(((r=this.props.modules)==null?void 0:r.map(E=>[E.name,E]))||[]);this.setShaderInputs(i.shaderInputs||new g$(l));const f=x$(e),y=(((s=this.props.modules)==null?void 0:s.length)>0?this.props.modules:(n=this.shaderInputs)==null?void 0:n.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(c=this.props).shaderLayout||(c.shaderLayout=rj(this.props.source));const{source:E,getUniforms:T}=this.props.shaderAssembler.assembleShader({platformInfo:f,...this.props,modules:y});this.source=E,this._getModuleUniforms=T}else{const{vs:E,fs:T,getUniforms:R}=this.props.shaderAssembler.assembleShaderPair({platformInfo:f,...this.props,modules:y});this.vs=E,this.fs=T,this._getModuleUniforms=R}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||_$.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||y$.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniforms(i.uniforms),i.moduleSettings&&this.updateModuleSettings(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let i;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),z0(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,s=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var i;(i=this._gpuGeometry)==null||i.destroy();const r=e&&p$(this.device,e);r&&(this.setTopology(r.topology||"triangle-list"),this.bufferLayout=sC(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)),this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?sC(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Xw(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new dz(this.shaderInputs.modules);for(const i of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,i){e.indices&&Qe.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,s]of Object.entries(e)){const n=this.bufferLayout.find(f=>nC(f).includes(r));if(!n){Qe.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const c=nC(n);let l=!1;for(const f of c){const y=this._attributeInfos[f];y&&(this.vertexArray.setBuffer(y.location,s),l=!0)}!l&&!((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)&&Qe.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,i){for(const[r,s]of Object.entries(e)){const n=this._attributeInfos[r];n?this.vertexArray.setConstantWebGL(n.location,s):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||Qe.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){z0(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:i,uniforms:r}=J2(this._getModuleUniforms(e));Object.assign(this.bindings,i),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const i of Object.values(this.bindings))i instanceof FP?e=Math.max(e,i.texture.updateTimestamp):i instanceof yr||i instanceof Mo?e=Math.max(e,i.updateTimestamp):i instanceof HP||(e=Math.max(e,i.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const i={...e.attributes};for(const[r]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(s=>s.name===r)&&r!=="positions"&&delete i[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,i=null;this.pipeline&&(Qe.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let s=null;this.source?s=r:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:s}),this._attributeInfos=o4(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const e=Qe.level>3?0:w$;Qe.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Qe.group(Ch,`>>> DRAWING MODEL ${this.id}`,{collapsed:Qe.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=v$(this.pipeline.shaderLayout,this.id);Qe.table(Ch,e)();const i=this.shaderInputs.getDebugTable();for(const[s,n]of Object.entries(this.uniforms))i[s]={value:n};Qe.table(Ch,i)();const r=this._getAttributeDebugTable();Qe.table(Ch,this._attributeInfos)(),Qe.table(Ch,r)(),Qe.groupEnd(Ch)(),this._logOpen=!1}}_logFramebuffer(e){const i=Qe.get("framebuffer");if(this._drawCount++,!i||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&b$(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[i,r]of Object.entries(this._attributeInfos))e[r.location]={name:i,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,r=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);e.indices={name:"indices",type:i.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,i){const r=m4(i);return(e instanceof yr?new r(e.debugData):e).toString()}};O(ck,"defaultProps",{...C1.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:RP.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Pd=ck;function sC(t,e){const i=[...t];for(const r of e){const s=i.findIndex(n=>n.name===r.name);s<0?i.push(r):i[s]=r}return i}function x$(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function nC(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(i=>i.attribute):[t.name]}class _m{constructor(e,i=Pd.defaultProps){O(this,"device"),O(this,"model"),O(this,"transformFeedback"),bi(_m.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Pd(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||lU(),topology:i.topology||"point-list",...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var i;return((i=e==null?void 0:e.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const i=this.device.beginRenderPass(e);this.model.draw(i),i.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const i=this.getBuffer(e);if(i instanceof yr)return i.readAsync();const{buffer:r,byteOffset:s=0,byteLength:n=r.byteLength}=i;return r.readAsync(s,n)}}class _d{constructor(e){O(this,"id"),O(this,"topology"),O(this,"vertexCount"),O(this,"indices"),O(this,"attributes"),O(this,"userData",{});const{attributes:i={},indices:r=null,vertexCount:s=null}=e;this.id=e.id||vc("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[n,c]of Object.entries(i)){const l=ArrayBuffer.isView(c)?{value:c}:c;bi(ArrayBuffer.isView(l.value),`${this._print(n)}: must be typed array or object with value as typed array`),(n==="POSITION"||n==="positions")&&!l.size&&(l.size=3),n==="indices"?(bi(!this.indices),this.indices=l):this.attributes[n]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,i){return this}_calculateVertexCount(e,i){if(i)return i.value.length;let r=1/0;for(const s of Object.values(e)){const{value:n,size:c,constant:l}=s;!l&&n&&c>=1&&(r=Math.min(r,n.length/c))}return bi(Number.isFinite(r)),r}}class X0{constructor(e={}){O(this,"id"),O(this,"matrix",new ai),O(this,"display",!0),O(this,"position",new Be),O(this,"rotation",new Be),O(this,"scale",new Be(1,1,1)),O(this,"userData",{}),O(this,"props",{});const{id:i}=e;this.id=i||vc(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return bi(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return bi(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return bi(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,i=!0){i?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:i,rotation:r,scale:s,update:n=!0}=e;return i&&this.setPosition(i),r&&this.setRotation(r),s&&this.setScale(s),n&&this.updateMatrix(),this}updateMatrix(){const e=this.position,i=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(i),this.matrix.scale(r),this}update(e={}){const{position:i,rotation:r,scale:s}=e;return i&&this.setPosition(i),r&&this.setRotation(r),s&&this.setScale(s),this.updateMatrix(),this}getCoordinateUniforms(e,i){bi(e),i=i||this.matrix;const r=new ai(e).multiplyRight(i),s=r.invert(),n=s.transpose();return{viewMatrix:e,modelMatrix:i,objectMatrix:i,worldMatrix:r,worldInverseMatrix:s,worldInverseTransposeMatrix:n}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class yd extends X0{constructor(e={}){e=Array.isArray(e)?{children:e}:e;const{children:i=[]}=e;Qe.assert(i.every(r=>r instanceof X0),"every child must an instance of ScenegraphNode"),super(e),O(this,"children"),this.children=i}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((i,{worldMatrix:r})=>{const s=i.getBounds();if(!s)return;const[n,c]=s,l=new Be(n).add(c).divide([2,2,2]);r.transformAsPoint(l,l);const f=new Be(c).subtract(n).divide([2,2,2]);r.transformAsVector(f,f);for(let y=0;y<8;y++){const E=new Be(y&1?-1:1,y&2?-1:1,y&4?-1:1).multiply(f).add(l);for(let T=0;T<3;T++)e[0][T]=Math.min(e[0][T],E[T]),e[1][T]=Math.max(e[1][T],E[T])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(const i of e)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(e){const i=this.children,r=i.indexOf(e);return r>-1&&i.splice(r,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:i=new ai}={}){const r=new ai(i).multiplyRight(this.matrix);for(const s of this.children)s instanceof yd?s.traverse(e,{worldMatrix:r}):e(s,{worldMatrix:r})}}class ox extends X0{constructor(e){super(e),O(this,"model"),O(this,"bounds",null),O(this,"managedResources"),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}draw(e){return this.model.draw(e)}}const E$={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class hk extends dE{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:r,viewports:s,onViewportActive:n,pickingFBO:c,deviceRect:{x:l,y:f,width:y,height:E},cullRect:T,effects:R,pass:D="picking",pickZ:V,moduleParameters:H}){this.pickZ=V;const ee=this._resetColorEncoder(V),z=[l,f,y,E],W=super.render({target:c,layers:e,layerFilter:i,views:r,viewports:s,onViewportActive:n,cullRect:T,effects:R==null?void 0:R.filter(q=>q.useInPicking),pass:D,isPicking:!0,moduleParameters:H,clearColor:[0,0,0,0],colorMask:15,scissorRect:z});return this._colorEncoderState=null,{decodePickingColor:ee&&T$.bind(null,ee),stats:W}}shouldDrawLayer(e){const{pickable:i,operation:r}=e.props;return i&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,i,r){const s={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:n,operation:c}=e.props;return!this._colorEncoderState||c.includes("terrain")?s.blend=!1:n&&c.includes("draw")&&(Object.assign(s,E$),s.blend=!0,s.blendColor=A$(this._colorEncoderState,e,r)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function A$(t,e,i){const{byLayer:r,byAlpha:s}=t;let n,c=r.get(e);return c?(c.viewports.push(i),n=c.a):(n=r.size+1,n<=255?(c={a:n,layer:e,viewports:[i]},r.set(e,c),s[n]=c):(fi.warn("Too many pickable layers, only picking the first 255")(),n=0)),[0,0,0,n/255]}function T$(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const Nh={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},K0=Symbol.for("component"),lc=Symbol.for("propTypes"),Zv=Symbol.for("deprecatedProps"),vd=Symbol.for("asyncPropDefaults"),Eu=Symbol.for("asyncPropOriginal"),Zl=Symbol.for("asyncPropResolved");function kd(t,e=()=>!0){return Array.isArray(t)?dk(t,e,[]):e(t)?[t]:[]}function dk(t,e,i){let r=-1;for(;++r<t.length;){const s=t[r];Array.isArray(s)?dk(s,e,i):e(s)&&i.push(s)}return i}function S$({target:t,source:e,start:i=0,count:r=1}){const s=e.length,n=r*s;let c=0;for(let l=i;c<s;c++)t[l++]=e[c];for(;c<n;)c<n-c?(t.copyWithin(i+c,i,i+c),c*=2):(t.copyWithin(i+c,i,i+n-c),c=n);return t}class C${constructor(e,i,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const r=++this._loadCount;let s=e;typeof e=="string"&&(s=dc(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(n=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=n)}).catch(n=>{this._loadCount===r&&(this.isLoaded=!0,this._error=n||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const n of this._subscribers)n.onChange(this.getData())}}class I${constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:r=!1,persistent:s=!0}){let n=this._resources[e];n?n.setData(i,r):(n=new C$(e,i,this._context),this._resources[e]=n),n.persistent=s}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const r in i){const s=i[r],n=this._resources[s.resourceId];n&&n.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:r,requestId:s="default"}){const{_resources:n,protocol:c}=this;e.startsWith(c)&&(e=e.replace(c,""),n[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=n[e];if(this._track(r,s,l,i),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,r,s){const n=this._consumers,c=n[e]=n[e]||{};let l=c[i];const f=l&&l.resourceId&&this._resources[l.resourceId];f&&(f.unsubscribe(l),this.prune()),r&&(l?(l.onChange=s,l.resourceId=r.id):l={onChange:s,resourceId:r.id},c[i]=l,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const R$="layerManager.setLayers",M$="layerManager.activateViewport";class P${constructor(e,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=l=>{Rs(M$,this,l),l&&(this.context.viewport=l)};const{deck:r,stats:s,viewport:n,timeline:c}=i||{};this.layers=[],this.resourceManager=new I$({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:FV(),defaultShaderModules:[],renderPass:void 0,stats:s||new Vd({id:"deck.gl"}),viewport:n||new Om({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new sk,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const s=r.getNeedsRedraw(e);i=i||s}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(r=>i.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Rs(R$,this,i,e),this._lastRenderedLayers=e;const r=kd(e,Boolean);for(const s of r)s.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(r=>r.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,r=i.findIndex(s=>s.name===e.name);r>=0&&(i.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,r){r.raiseError(i,`${e} of ${r}`)}_updateLayers(e,i){const r={};for(const c of e)r[c.id]?fi.warn(`Multiple old layers with same id ${c.id}`)():r[c.id]=c;if(this._defaultShaderModulesChanged){for(const c of e)c.setNeedsUpdate(),c.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(i,r,s),this._finalizeOldLayers(r);let n=!1;for(const c of s)if(c.hasUniformTransition()){n=`Uniform transition in ${c}`;break}this._needsUpdate=n,this.layers=s}_updateSublayersRecursively(e,i,r){for(const s of e){s.context=this.context;const n=i[s.id];n===null&&fi.warn(`Multiple new layers with same id ${s.id}`)(),i[s.id]=null;let c=null;try{this._debug&&n!==s&&s.validateProps(),n?(this._transferLayerState(n,s),this._updateLayer(s)):this._initializeLayer(s),r.push(s),c=s.isComposite?s.getSubLayers():null}catch(l){this._handleError("matching",l,s)}c&&this._updateSublayersRecursively(c,i,r)}}_finalizeOldLayers(e){for(const i in e){const r=e[i];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Nh.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=Nh.MATCHED,i!==e&&(e.lifecycle=Nh.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Nh.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Nh.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function ko(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!ko(t[r],e[r],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const n of r)if(!e.hasOwnProperty(n)||!ko(t[n],e[n],i-1))return!1;return!0}return!1}class k${constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,r=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,i){const r=this.getViewports(),s={x:e[0],y:e[1]};for(let n=r.length-1;n>=0;--n){const c=r[n];if(c.containsPixel(s)){const l=e.slice();return l[0]-=c.x,l[1]-=c.y,c.unproject(l,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=kd(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!ko(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):fi.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const r=i.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var n;return(n=this.getView(e.id))==null?void 0:n.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,i,r,s){const n=e.controller;if(n&&r){const c={...i,...n,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!s||s.constructor!==n.type)&&(s=this._createController(e,c)),s&&s.setProps(c),s}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=e.length;s--;){const n=e[s],c=this.getViewState(n),l=n.makeViewport({viewState:c,width:this.width,height:this.height});let f=i[n.id];const y=!!n.controller;y&&!f&&(r=!0),(r||!y)&&f&&(f.finalize(),f=null),this.controllers[n.id]=this._updateController(n,c,l,f),l&&this._viewports.unshift(l)}for(const s in i){const n=i[s];n&&!this.controllers[s]&&n.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((r,s)=>!e[s].equals(i[s]))}}const B$=/([0-9]+\.?[0-9]*)(%|px)/;function Ll(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=B$.exec(t);if(e&&e.length>=3){const i=e[2]==="%",r=parseFloat(e[1]);return{position:i?r/100:r,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function Ol(t,e){return t.relative?Math.round(t.position*e):t.position}class L${constructor(e){const{id:i,x:r=0,y:s=0,width:n="100%",height:c="100%",padding:l=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Ll(r),this._y=Ll(s),this._width=Ll(n),this._height=Ll(c),this._padding=l&&{left:Ll(l.left||0),right:Ll(l.right||0),top:Ll(l.top||0),bottom:Ll(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&ko(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:r}){r=this.filterViewState(r);const s=this.getDimensions({width:e,height:i});return!s.height||!s.width?null:new this.ViewportType({...r,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const r in this.props.viewState)r!=="id"&&(i[r]=this.props.viewState[r]);return i}return e}getDimensions({width:e,height:i}){const r={x:Ol(this._x,e),y:Ol(this._y,i),width:Ol(this._width,e),height:Ol(this._height,i)};return this._padding&&(r.padding={left:Ol(this._padding.left,e),top:Ol(this._padding.top,i),right:Ol(this._padding.right,e),bottom:Ol(this._padding.bottom,i)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class I1{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(i=this.settings).onStart)==null||r.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:s}=this;this._handle=r.addChannel({delay:r.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const oC=()=>{},ax={BREAK:1,SNAP_TO_END:2,IGNORE:3},O$=t=>t,D$=ax.BREAK;class F${constructor(e){this._onTransitionUpdate=i=>{const{time:r,settings:{interpolator:s,startProps:n,endProps:c,duration:l,easing:f}}=i,y=f(r/l),E=s.interpolateProps(n,c,y);this.propsInTransition=this.getControllerState({...this.props,...E}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new I1(e.timeline),this.onViewStateChange=e.onViewStateChange||oC,this.onStateChange=e.onStateChange||oC}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let s=r;if(this.transition.inProgress){const{interruption:n,endProps:c}=this.transition.settings;s={...r,...n===ax.SNAP_TO_END?c:this.propsInTransition||r}}this._triggerTransition(s,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:r}=e;return(i>0||i==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===ax.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const r=this.getControllerState(e),s=this.getControllerState(i).shortestPathFrom(r),n=i.transitionInterpolator,c=n.getDuration?n.getDuration(e,i):i.transitionDuration;if(c===0)return;const l=n.initializeProps(e,s);this.propsInTransition={};const f={duration:c,easing:i.transitionEasing||O$,interpolator:n,interruption:i.transitionInterruption||D$,startProps:l.start,endProps:l.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function Br(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class N${constructor(e){const{compare:i,extract:r,required:s}=e;this._propsToCompare=i,this._propsToExtract=r||i,this._requiredProps=s}arePropsEqual(e,i){for(const r of this._propsToCompare)if(!(r in e)||!(r in i)||!Do(e[r],i[r]))return!1;return!0}initializeProps(e,i){const r={},s={};for(const n of this._propsToExtract)(n in e||n in i)&&(r[n]=e[n],s[n]=i[n]);return this._checkRequiredProps(r),this._checkRequiredProps(s),{start:r,end:s}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const r=e[i];Br(Number.isFinite(r)||Array.isArray(r),`${i} is required for transition`)})}}const U$=["longitude","latitude","zoom","bearing","pitch"],z$=["longitude","latitude","zoom"];class pk extends N${constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:U$,required:z$},super(r.transitionProps),this.opts=r}initializeProps(e,i){const r=super.initializeProps(e,i),{makeViewport:s,around:n}=this.opts;if(s&&n){const c=s(e),l=s(i),f=c.unproject(n);r.start.around=n,Object.assign(r.end,{around:l.project(f),aroundPosition:f,width:i.width,height:i.height})}return r}interpolateProps(e,i,r){const s={};for(const n of this._propsToExtract)s[n]=$0(e[n]||0,i[n]||0,r);if(i.aroundPosition&&this.opts.makeViewport){const n=this.opts.makeViewport({...i,...s});Object.assign(s,n.panByPosition(i.aroundPosition,$0(e.around,i.around,r)))}return s}}const Dl={transitionDuration:0},j$=300,v_=t=>1-(1-t)*(1-t),Ih={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Wc={};class G${constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new F$({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:r}=this.props,{offsetCenter:s}=e;return[s.x-i,s.y-r]}isPointInBounds(e,i){const{width:r,height:s}=this.props;if(i&&i.handled)return!1;const n=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=s;return n&&i&&i.stopPropagation(),n}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?j$:0;const{scrollZoom:r=!0,dragPan:s=!0,dragRotate:n=!0,doubleClickZoom:c=!0,touchZoom:l=!0,touchRotate:f=!1,keyboard:y=!0}=e,E=!!this.onViewStateChange;this.toggleEvents(Ih.WHEEL,E&&r),this.toggleEvents(Ih.PAN,E),this.toggleEvents(Ih.PINCH,E&&(l||f)),this.toggleEvents(Ih.TRIPLE_PAN,E&&f),this.toggleEvents(Ih.DOUBLE_TAP,E&&c),this.toggleEvents(Ih.KEYBOARD,E&&y),this.scrollZoom=r,this.dragPan=s,this.dragRotate=n,this.doubleClickZoom=c,this.touchZoom=l,this.touchRotate=f,this.keyboard=y}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(r=>{this._events[r]!==i&&(this._events[r]=i,i?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,i=null,r={}){const s={...e.getViewportProps(),...i},n=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),n){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:c,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const s=this.controllerState[r?"panStart":"rotateStart"]({pos:i});return this._panMove=r,this.updateViewport(s,Dl,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),r=this.controllerState.pan({pos:i});return this.updateViewport(r,Dl,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],n=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:v_},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),r=this.controllerState.rotate({pos:i});return this.updateViewport(r,Dl,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],n=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:v_},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:n}=e;let c=2/(1+Math.exp(-Math.abs(n*r)));n<0&&c!==0&&(c=1/c);const l=this.controllerState.zoom({pos:i,scale:c});return this.updateViewport(l,{...this._getTransitionProps({around:i}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.rotateStart({pos:i});return this.updateViewport(r,Dl,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const r=this.controllerState.rotate({pos:i});return this.updateViewport(r,Dl,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const r=this.getCenter(e),s=[r[0],r[1]+=e.velocityY*i/2],n=this.controllerState.rotate({pos:s});this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:v_},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return Wc._startPinchRotation=e.rotation,Wc._lastPinchEvent=e,this.updateViewport(r,Dl,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:r}=e,s=this.getCenter(e);i=i.zoom({pos:s,scale:r})}if(this.touchRotate){const{rotation:r}=e;i=i.rotate({deltaAngleX:Wc._startPinchRotation-r})}return this.updateViewport(i,Dl,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Wc._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:r}=Wc;if(this.touchZoom&&i&&r&&e.scale!==r.scale){const s=this.getCenter(e);let n=this.controllerState.rotateEnd();const c=Math.log2(e.scale),l=(c-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),f=Math.pow(2,c+l*i/2);n=n.zoom({pos:s,scale:f}).zoomEnd(),this.updateViewport(n,{...this._getTransitionProps({around:s}),transitionDuration:i,transitionEasing:v_},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Wc._startPinchRotation=null,Wc._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:i,scale:r?.5:2});return this.updateViewport(s,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:s,rotateSpeedX:n,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let f;const y={};switch(e.srcEvent.code){case"Minus":f=i?l.zoomOut(r).zoomOut(r):l.zoomOut(r),y.isZooming=!0;break;case"Equal":f=i?l.zoomIn(r).zoomIn(r):l.zoomIn(r),y.isZooming=!0;break;case"ArrowLeft":i?(f=l.rotateLeft(n),y.isRotating=!0):(f=l.moveLeft(s),y.isPanning=!0);break;case"ArrowRight":i?(f=l.rotateRight(n),y.isRotating=!0):(f=l.moveRight(s),y.isPanning=!0);break;case"ArrowUp":i?(f=l.rotateUp(c),y.isRotating=!0):(f=l.moveUp(s),y.isPanning=!0);break;case"ArrowDown":i?(f=l.rotateDown(c),y.isRotating=!0):(f=l.moveDown(s),y.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),y),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?Dl:e?{...i,transitionInterpolator:new pk({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class V${constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const aC=5,$$=1.2;class H$ extends V${constructor(e){const{width:i,height:r,latitude:s,longitude:n,zoom:c,bearing:l=0,pitch:f=0,altitude:y=1.5,position:E=[0,0,0],maxZoom:T=20,minZoom:R=0,maxPitch:D=60,minPitch:V=0,startPanLngLat:H,startZoomLngLat:ee,startRotatePos:z,startBearing:W,startPitch:q,startZoom:ce,normalize:we=!0}=e;Br(Number.isFinite(n)),Br(Number.isFinite(s)),Br(Number.isFinite(c)),super({width:i,height:r,latitude:s,longitude:n,zoom:c,bearing:l,pitch:f,altitude:y,maxZoom:T,minZoom:R,maxPitch:D,minPitch:V,normalize:we,position:E},{startPanLngLat:H,startZoomLngLat:ee,startRotatePos:z,startBearing:W,startPitch:q,startZoom:ce}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const r=this.getState().startPanLngLat||this._unproject(i);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:r=0}){const{startRotatePos:s,startBearing:n,startPitch:c}=this.getState();if(!s||n===void 0||c===void 0)return this;let l;return e?l=this._getNewRotation(e,s,c,n):l={bearing:n+i,pitch:c+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:r}){let{startZoom:s,startZoomLngLat:n}=this.getState();if(n||(s=this.getViewportProps().zoom,n=this._unproject(i)||this._unproject(e)),!n)return this;const{maxZoom:c,minZoom:l}=this.getViewportProps();let f=s+Math.log2(r);f=$a(f,l,c);const y=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...y.panByPosition(n,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),r={...this.getViewportProps()},{bearing:s,longitude:n}=r;return Math.abs(s-i.bearing)>180&&(r.bearing=s<0?s+360:s-360),Math.abs(n-i.longitude)>180&&(r.longitude=n<0?n+360:n-360),r}applyConstraints(e){const{maxZoom:i,minZoom:r,zoom:s}=e;e.zoom=$a(s,r,i);const{maxPitch:n,minPitch:c,pitch:l}=e;e.pitch=$a(l,c,n);const{normalize:f=!0}=e;return f&&Object.assign(e,AV(e)),e}_zoomFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.zoom({pos:[i/2,r/2],scale:e})}_panFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.pan({startPos:[i/2,r/2],pos:[i/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,r,s){const n=e[0]-i[0],c=e[1]-i[1],l=e[1],f=i[1],{width:y,height:E}=this.getViewportProps(),T=n/y;let R=0;c>0?Math.abs(E-f)>aC&&(R=c/(f-E)*$$):c<0&&f>aC&&(R=1-l/f),R=$a(R,-1,1);const{minPitch:D,maxPitch:V}=this.getViewportProps(),H=s+180*T;let ee=r;return R>0?ee=r+R*(V-r):R<0&&(ee=r-R*(D-r)),{pitch:ee,bearing:H}}}class q$ extends G${constructor(){super(...arguments),this.ControllerState=H$,this.transition={transitionDuration:300,transitionInterpolator:new pk({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class pE extends L${constructor(e={}){super(e)}get ViewportType(){return xu}get ControllerType(){return q$}}pE.displayName="MapView";const W$=new ik;function X$(t,e){const i=t.order??1/0,r=e.order??1/0;return i-r}class K${constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(r=>r.id===e.id)){const r=i.findIndex(s=>X$(s,e)>0);r<0?i.push(e):i.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(ko(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const s of this.effects)i[s.id]=s;const r=[];for(const s of e){const n=i[s.id];let c=s;n&&n!==s?n.setProps?(n.setProps(s.props),c=n):n.cleanup(this._context):n||s.setup(this._context),r.push(c),delete i[s.id]}for(const s in i)i[s].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(s=>s instanceof ik)||this._resolvedEffects.push(W$),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class J$ extends dE{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const Z$="deckRenderer.renderLayers";class Y${constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new J$(e),this.pickLayersPass=new hk(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const s=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const n=i.render({...r,target:s});r.effects&&this._postRender(r.effects,r),this.renderCount++,Rs(Z$,this,n,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const r of e)i.preRenderStats[r.id]=r.preRender(i),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[s]}))});for(const r of e)r.resize(i)}_postRender(e,i){const{renderBuffers:r}=this,s={...i,inputBuffer:r[0],swapBuffer:r[1]};for(const n of e)if(n.postRender){s.target=n.id===this.lastPostProcessEffect?i.target:void 0;const c=n.postRender(s);s.inputBuffer=c,s.swapBuffer=c===r[0]?r[1]:r[0]}}}const Q$={pickedColor:null,pickedObjectIndex:-1};function eH({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:r,deviceRadius:s,deviceRect:n}){const{x:c,y:l,width:f,height:y}=n;let E=s*s,T=-1,R=0;for(let D=0;D<y;D++){const V=D+l-r,H=V*V;if(H>E)R+=4*f;else for(let ee=0;ee<f;ee++){if(t[R+3]-1>=0){const z=ee+c-i,W=z*z+H;W<=E&&(E=W,T=R)}R+=4}}if(T>=0){const D=t.slice(T,T+4),V=e(D);if(V){const H=Math.floor(T/4/f),ee=T/4-H*f;return{...V,pickedColor:D,pickedX:c+ee,pickedY:l+H}}fi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Q$}function tH({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),n=s.join(",");if(!i.has(n)){const c=e(s);c?i.set(n,{...c,color:s}):fi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function fk({pickInfo:t,viewports:e,pixelRatio:i,x:r,y:s,z:n}){let c=e[0];e.length>1&&(c=rH((t==null?void 0:t.pickedViewports)||e,{x:r,y:s}));let l;if(c){const f=[r-c.x,s-c.y];n!==void 0&&(f[2]=n),l=c.unproject(f)}return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:r,y:s,pixel:[r,s],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function iH(t){const{pickInfo:e,lastPickedInfo:i,mode:r,layers:s}=t,{pickedColor:n,pickedLayer:c,pickedObjectIndex:l}=e,f=c?[c]:[];if(r==="hover"){const T=i.index,R=i.layerId,D=c?c.props.id:null;if(D!==R||l!==T){if(D!==R){const V=s.find(H=>H.props.id===R);V&&f.unshift(V)}i.layerId=D,i.index=l,i.info=null}}const y=fk(t),E=new Map;return E.set(null,y),f.forEach(T=>{let R={...y};T===c&&(R.color=n,R.index=l,R.picked=!0),R=mk({layer:T,info:R,mode:r});const D=R.layer;T===c&&r==="hover"&&(i.info=R),E.set(D.id,R),r==="hover"&&D.updateAutoHighlight(R)}),E}function mk({layer:t,info:e,mode:i}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:r}),t=t.parent}return e}function rH(t,e){for(let i=t.length-1;i>=0;i--){const r=t[i];if(r.containsPixel(e))return r}return t[0]}class sH{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new hk(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:r,viewports:s},n=this.lastPickedInfo.info){const c=n&&n.layer&&n.layer.id,l=n&&n.viewport&&n.viewport.id,f=c?r.find(T=>T.id===c):null,y=l&&s.find(T=>T.id===l)||s[0],E=y&&y.unproject([e-y.x,i-y.y]);return{...n,x:e,y:i,viewport:y,coordinate:E,layer:f}}_resizeBuffer(){var e,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:r}=this.device.getCanvasContext();(e=this.pickingFBO)==null||e.resize({width:r.width,height:r.height}),(i=this.depthFBO)==null||i.resize({width:r.width,height:r.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:r,x:s,y:n,radius:c=0,depth:l=1,mode:f="query",unproject3D:y,onViewportActive:E,effects:T}){const R=this.device.canvasContext.cssToDeviceRatio(),D=this._getPickable(e);if(!D||r.length===0)return{result:[],emptyInfo:fk({viewports:r,x:s,y:n,pixelRatio:R})};this._resizeBuffer();const V=this.device.canvasContext.cssToDevicePixels([s,n],!0),H=[V.x+Math.floor(V.width/2),V.y+Math.floor(V.height/2)],ee=Math.round(c*R),{width:z,height:W}=this.pickingFBO,q=this._getPickingRect({deviceX:H[0],deviceY:H[1],deviceRadius:ee,deviceWidth:z,deviceHeight:W}),ce={x:s-c,y:n-c,width:c*2+1,height:c*2+1};let we;const re=[],be=new Set;for(let me=0;me<l;me++){let Te;if(q){const ze=this._drawAndSample({layers:D,views:i,viewports:r,onViewportActive:E,deviceRect:q,cullRect:ce,effects:T,pass:`picking:${f}`});Te=eH({...ze,deviceX:H[0],deviceY:H[1],deviceRadius:ee,deviceRect:q})}else Te={pickedColor:null,pickedObjectIndex:-1};let Pe;if(Te.pickedLayer&&y&&this.depthFBO){const{pickedColors:ze}=this._drawAndSample({layers:[Te.pickedLayer],views:i,viewports:r,onViewportActive:E,deviceRect:{x:Te.pickedX,y:Te.pickedY,width:1,height:1},cullRect:ce,effects:T,pass:`picking:${f}:z`},!0);ze[3]&&(Pe=ze[0])}Te.pickedLayer&&me+1<l&&(be.add(Te.pickedLayer),Te.pickedLayer.disablePickingIndex(Te.pickedObjectIndex)),we=iH({pickInfo:Te,lastPickedInfo:this.lastPickedInfo,mode:f,layers:D,viewports:r,x:s,y:n,z:Pe,pixelRatio:R});for(const ze of we.values())ze.layer&&re.push(ze);if(!Te.pickedColor)break}for(const me of be)me.restorePickingColors();return{result:re,emptyInfo:we.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:r,x:s,y:n,width:c=1,height:l=1,mode:f="query",maxObjects:y=null,onViewportActive:E,effects:T}){const R=this._getPickable(e);if(!R||r.length===0)return[];this._resizeBuffer();const D=this.device.canvasContext.cssToDeviceRatio(),V=this.device.canvasContext.cssToDevicePixels([s,n],!0),H=V.x,ee=V.y+V.height,z=this.device.canvasContext.cssToDevicePixels([s+c,n+l],!0),W=z.x+z.width,q=z.y,ce={x:H,y:q,width:W-H,height:ee-q},we=this._drawAndSample({layers:R,views:i,viewports:r,onViewportActive:E,deviceRect:ce,cullRect:{x:s,y:n,width:c,height:l},effects:T,pass:`picking:${f}`}),re=tH(we),be=new Map,me=[],Te=Number.isFinite(y);for(let Pe=0;Pe<re.length&&!(Te&&me.length>=y);Pe++){const ze=re[Pe];let Ke={color:ze.pickedColor,layer:null,index:ze.pickedObjectIndex,picked:!0,x:s,y:n,pixelRatio:D};Ke=mk({layer:ze.pickedLayer,info:Ke,mode:f});const We=Ke.layer.id;be.has(We)||be.set(We,new Set);const Ze=be.get(We),Ft=Ke.object??Ke.index;Ze.has(Ft)||(Ze.add(Ft),me.push(Ke))}return me}_drawAndSample({layers:e,views:i,viewports:r,onViewportActive:s,deviceRect:n,cullRect:c,effects:l,pass:f},y=!1){const E=y?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:i,viewports:r,onViewportActive:s,pickingFBO:E,deviceRect:n,cullRect:c,effects:l,pass:f,pickZ:y,preRenderStats:{}};for(const W of l)W.useInPicking&&(T.preRenderStats[W.id]=W.preRender(T));const{decodePickingColor:R}=this.pickLayersPass.render(T),{x:D,y:V,width:H,height:ee}=n,z=new(y?Float32Array:Uint8Array)(H*ee*4);return this.device.readPixelsToArrayWebGL(E,{sourceX:D,sourceY:V,sourceWidth:H,sourceHeight:ee,target:z}),{pickedColors:z,decodePickingColor:R}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:r,deviceWidth:s,deviceHeight:n}){const c=Math.max(0,e-r),l=Math.max(0,i-r),f=Math.min(s,e+r+1)-c,y=Math.min(n,i+r+1)-l;return f<=0||y<=0?null:{x:c,y:l,width:f,height:y}}}const nH={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},oH="top-left",lC="__root";class aH{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!ko(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const r of this.resolvedWidgets)i[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)i[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const s=i[r.id];s?s.viewId!==r.viewId||s.placement!==r.placement?(this._remove(s),this._add(r)):r!==s&&(s.setProps(r.props),r=s):this._add(r),i[r.id]=null,this.resolvedWidgets.push(r)}for(const r in i){const s=i[r];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:i=null,placement:r=oH}=e,s=e.onAdd({deck:this.deck,viewId:i});s&&this._getContainer(i,r).append(s),e._element=s}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var r;const s=e||lC;let n=this.containers[s];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",(r=this.parentElement)==null||r.append(n),this.containers[s]=n);let c=n.querySelector(`.${i}`);return c||(c=document.createElement("div"),c.className=i,c.style.position="absolute",c.style.zIndex="2",Object.assign(c.style,nH[i]),n.append(c)),c}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const r in this.containers){const s=this.lastViewports[r]||null,n=r===lC||s,c=this.containers[r];n?(c.style.display="block",c.style.left=`${s?s.x:0}px`,c.style.top=`${s?s.y:0}px`,c.style.width=`${s?s.width:e}px`,c.style.height=`${s?s.height:i}px`):c.style.display="none"}}onRedraw({viewports:e,layers:i}){var r,s;const n=e.reduce((l,f)=>(l[f.id]=f,l),{}),{lastViewports:c}=this;for(const l of this.getWidgets()){const{viewId:f}=l;if(f){const y=n[f];y&&(l.onViewportChange&&!y.equals(c[f])&&l.onViewportChange(y),(r=l.onRedraw)==null||r.call(l,{viewports:[y],layers:i}))}else{if(l.onViewportChange)for(const y of e)y.equals(c[y.id])||l.onViewportChange(y);(s=l.onRedraw)==null||s.call(l,{viewports:e,layers:i})}}this.lastViewports=n,this._updateContainers()}onHover(e,i){var r,s;for(const n of this.getWidgets()){const{viewId:c}=n;(!c||c===((r=e.viewport)==null?void 0:r.id))&&((s=n.onHover)==null||s.call(n,e,i))}}onEvent(e,i){var r,s;const n=ix[i.type];if(n)for(const c of this.getWidgets()){const{viewId:l}=c;(!l||l===((r=e.viewport)==null?void 0:r.id))&&((s=c[n.handler])==null||s.call(c,e,i))}}}const lH={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class cH{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,lH),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,r=i&&i.props.getTooltip;if(!r)return;const s=r(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,i,r){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${i}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var td;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(td||(td={}));const fE={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Tr=(t,e,i)=>e?t.enable(i):t.disable(i),cC=(t,e,i)=>t.hint(i,e),Rn=(t,e,i)=>t.pixelStorei(i,e),uC=(t,e,i)=>{const r=i===36006?36009:36008;return t.bindFramebuffer(r,e)},af=(t,e,i)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(r,e)};function Yv(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const uH={3042:Tr,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Tr,2885:(t,e)=>t.cullFace(e),2929:Tr,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Tr,35723:cC,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:uC,36010:uC,34964:af,36662:af,36663:af,35053:af,35055:af,2886:(t,e)=>t.frontFace(e),33170:cC,2849:(t,e)=>t.lineWidth(e),32823:Tr,32824:"polygonOffset",10752:"polygonOffset",35977:Tr,32926:Tr,32928:Tr,32938:"sampleCoverage",32939:"sampleCoverage",3089:Tr,3088:(t,e)=>t.scissor(...e),2960:Tr,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Tr,10754:Tr,12288:Tr,12289:Tr,12290:Tr,12291:Tr,12292:Tr,12293:Tr,12294:Tr,12295:Tr,3333:Rn,3317:Rn,37440:Rn,37441:Rn,37443:Rn,3330:Rn,3332:Rn,3331:Rn,3314:Rn,32878:Rn,3316:Rn,3315:Rn,32877:Rn,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Yv(e)?e:[e,e];const[i,r]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Yv(e)&&e.length===3?[...e,...e]:e;const[i,r,s,n,c,l]=e;t.stencilFuncSeparate(1028,i,r,s),t.stencilFuncSeparate(1029,n,c,l)},stencilOp:(t,e)=>{e=Yv(e)&&e.length===3?[...e,...e]:e;const[i,r,s,n,c,l]=e;t.stencilOpSeparate(1028,i,r,s),t.stencilOpSeparate(1029,n,c,l)},viewport:(t,e)=>t.viewport(...e)};function hr(t,e,i){return e[t]!==void 0?e[t]:i[t]}const hH={blendEquation:(t,e,i)=>t.blendEquationSeparate(hr(32777,e,i),hr(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(hr(32969,e,i),hr(32968,e,i),hr(32971,e,i),hr(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(hr(32824,e,i),hr(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(hr(32938,e,i),hr(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,hr(2962,e,i),hr(2967,e,i),hr(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,hr(34816,e,i),hr(36003,e,i),hr(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,hr(2964,e,i),hr(2965,e,i),hr(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,hr(34817,e,i),hr(34818,e,i),hr(34819,e,i))},hC={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:i}):{valueChanged:!0}},blendColor:(t,e,i,r,s)=>t({32773:new Float32Array([e,i,r,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,r,s)=>t({32969:e,32968:i,32971:r,32970:s}),clearColor:(t,e,i,r,s)=>t({3106:new Float32Array([e,i,r,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,r,s)=>t({3107:[e,i,r,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,r,s)=>t({3088:new Int32Array([e,i,r,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,r)=>t({2962:e,2967:i,2963:r,34816:e,36003:i,36004:r}),stencilFuncSeparate:(t,e,i,r,s)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:r,[e===1028?2963:36004]:s}),stencilOp:(t,e,i,r)=>t({2964:e,2965:i,2966:r,34817:e,34818:i,34819:r}),stencilOpSeparate:(t,e,i,r,s)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:r,[e===1028?2966:34819]:s}),viewport:(t,e,i,r,s)=>t({2978:[e,i,r,s]})},ta=(t,e)=>t.isEnabled(e),dC={3042:ta,2884:ta,2929:ta,3024:ta,32823:ta,32926:ta,32928:ta,3089:ta,2960:ta,35977:ta},dH=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function $d(t,e){if(fH(e))return;const i={};for(const s in e){const n=Number(s),c=uH[s];c&&(typeof c=="string"?i[c]=!0:c(t,e[s],n))}const r=t.state&&t.state.cache;if(r)for(const s in i){const n=hH[s];n(t,e,r)}}function gk(t,e=fE){if(typeof e=="number"){const s=e,n=dC[s];return n?n(t,s):t.getParameter(s)}const i=Array.isArray(e)?e:Object.keys(e),r={};for(const s of i){const n=dC[s];r[s]=n?n(t,Number(s)):t.getParameter(Number(s))}return r}function pH(t){$d(t,fE)}function fH(t){for(const e in t)return!1;return!0}function mH(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&r&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}class gH{constructor(e,{copyState:i=!1,log:r=()=>{}}={}){O(this,"gl"),O(this,"program",null),O(this,"stateStack",[]),O(this,"enable",!0),O(this,"cache"),O(this,"log"),this.gl=e,this.cache=i?gk(e):Object.assign({},fE),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){bi(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];$d(this.gl,e),this.stateStack.pop()}_updateCache(e){let i=!1,r;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const n in e){bi(n!==void 0);const c=e[n],l=this.cache[n];mH(c,l)||(i=!0,r=l,s&&!(n in s)&&(s[n]=l),this.cache[n]=c)}return{valueChanged:i,oldValue:r}}}function Au(t){return t.state}function _k(t,e){const{enable:i=!0,copyState:r}=e;if(bi(r!==void 0),!t.state){t.state=new gH(t,{copyState:r}),yH(t);for(const n in hC){const c=hC[n];_H(t,n,c)}pC(t,"getParameter"),pC(t,"isEnabled")}const s=Au(t);return s.enable=i,t}function R1(t){let e=Au(t);e||(_k(t,{copyState:!1}),e=Au(t)),e.push()}function ym(t){const e=Au(t);bi(e),e.pop()}function pC(t,e){const i=t[e].bind(t);t[e]=function(r){if(r===void 0||dH.has(r))return i(r);const s=Au(t);return r in s.cache||(s.cache[r]=i(r)),s.enable?s.cache[r]:i(r)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function _H(t,e,i){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const n=Au(t),{valueChanged:c,oldValue:l}=i(n._updateCache,...s);return c&&r(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function yH(t){const e=t.useProgram.bind(t);t.useProgram=function(i){const r=Au(t);r.program!==i&&(e(i),r.program=i)}}const vH={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function bH(t,e){e={...vH,...e};let i=null;const r=n=>i=n.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);let s=null;if(s||(s=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!s)throw new Error(`Failed to create WebGL context: ${i||"Unknown error"}`);if(e.onContextLost){const{onContextLost:n}=e;t.addEventListener("webglcontextlost",c=>n(c),!1)}if(e.onContextRestored){const{onContextRestored:n}=e;t.addEventListener("webglcontextrestored",c=>n(c),!1)}return s}function fc(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function wH(t,e){const i=t.getParameter(7936),r=t.getParameter(7937);fc(t,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,n=t.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),c=t.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),l=n||i,f=c||r,y=t.getParameter(7938),E=yk(l,f),T=xH(l,f),R=EH(l,f);return{type:"webgl",gpu:E,gpuType:R,gpuBackend:T,vendor:l,renderer:f,version:y,shadingLanguage:"glsl",shadingLanguageVersion:300}}function yk(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function xH(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function EH(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(yk(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function vk(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Cs="texture-compression-bc",Li="texture-compression-astc",ia="texture-compression-etc2",AH="texture-compression-etc1-webgl",b_="texture-compression-pvrtc-webgl",Qv="texture-compression-atc-webgl",lf="float32-renderable-webgl",eb="float16-renderable-webgl",TH="rgb9e5ufloat_renderable-webgl",tb="snorm8-renderable-webgl",cf="norm16-renderable-webgl",ib="snorm16-renderable-webgl",w_="float32-filterable",fC="float16-filterable-webgl",Sf="WEBGL_compressed_texture_s3tc",Cf="WEBGL_compressed_texture_s3tc_srgb",id="EXT_texture_compression_rgtc",rd="EXT_texture_compression_bptc",SH="WEBGL_compressed_texture_etc",CH="WEBGL_compressed_texture_astc",IH="WEBGL_compressed_texture_etc1",RH="WEBGL_compressed_texture_pvrtc",MH="WEBGL_compressed_texture_atc",mC="EXT_texture_norm16",gC="EXT_render_snorm",PH="EXT_color_buffer_float",mE={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[gC],"norm16-renderable-webgl":[mC],"snorm16-renderable-webgl":[mC,gC],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Sf,Cf,id,rd],"texture-compression-bc5-webgl":[id],"texture-compression-bc7-webgl":[rd],"texture-compression-etc2":[SH],"texture-compression-astc":[CH],"texture-compression-etc1-webgl":[IH],"texture-compression-pvrtc-webgl":[RH],"texture-compression-atc-webgl":[MH]};function kH(t){return t in mE}function BH(t,e,i){return(mE[e]||[]).every(r=>fc(t,r,i))}const M1={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:tb},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:tb},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:eb,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:cf,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:ib},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:tb},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:eb,filter:fC,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:cf},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:ib},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:lf,filter:w_},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:TH},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:lf,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:cf},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:cf},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:lf,filter:w_,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:eb,filter:fC},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:cf,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:ib},"rgb32float-webgl":{gl:34837,render:lf,filter:w_,gl2ext:PH,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:lf,filter:w_,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Sf,f:Cs},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Cf,f:Cs},"bc1-rgba-unorm":{gl:33777,x:Sf,f:Cs},"bc1-rgba-unorm-srgb":{gl:35916,x:Cf,f:Cs},"bc2-rgba-unorm":{gl:33778,x:Sf,f:Cs},"bc2-rgba-unorm-srgb":{gl:35918,x:Cf,f:Cs},"bc3-rgba-unorm":{gl:33779,x:Sf,f:Cs},"bc3-rgba-unorm-srgb":{gl:35919,x:Cf,f:Cs},"bc4-r-unorm":{gl:36283,x:id,f:Cs},"bc4-r-snorm":{gl:36284,x:id,f:Cs},"bc5-rg-unorm":{gl:36285,x:id,f:Cs},"bc5-rg-snorm":{gl:36286,x:id,f:Cs},"bc6h-rgb-ufloat":{gl:36495,x:rd,f:Cs},"bc6h-rgb-float":{gl:36494,x:rd,f:Cs},"bc7-rgba-unorm":{gl:36492,x:rd,f:Cs},"bc7-rgba-unorm-srgb":{gl:36493,x:rd,f:Cs},"etc2-rgb8unorm":{gl:37492,f:ia},"etc2-rgb8unorm-srgb":{gl:37494,f:ia},"etc2-rgb8a1unorm":{gl:37496,f:ia},"etc2-rgb8a1unorm-srgb":{gl:37497,f:ia},"etc2-rgba8unorm":{gl:37493,f:ia},"etc2-rgba8unorm-srgb":{gl:37495,f:ia},"eac-r11unorm":{gl:37488,f:ia},"eac-r11snorm":{gl:37489,f:ia},"eac-rg11unorm":{gl:37490,f:ia},"eac-rg11snorm":{gl:37491,f:ia},"astc-4x4-unorm":{gl:37808,f:Li},"astc-4x4-unorm-srgb":{gl:37840,f:Li},"astc-5x4-unorm":{gl:37809,f:Li},"astc-5x4-unorm-srgb":{gl:37841,f:Li},"astc-5x5-unorm":{gl:37810,f:Li},"astc-5x5-unorm-srgb":{gl:37842,f:Li},"astc-6x5-unorm":{gl:37811,f:Li},"astc-6x5-unorm-srgb":{gl:37843,f:Li},"astc-6x6-unorm":{gl:37812,f:Li},"astc-6x6-unorm-srgb":{gl:37844,f:Li},"astc-8x5-unorm":{gl:37813,f:Li},"astc-8x5-unorm-srgb":{gl:37845,f:Li},"astc-8x6-unorm":{gl:37814,f:Li},"astc-8x6-unorm-srgb":{gl:37846,f:Li},"astc-8x8-unorm":{gl:37815,f:Li},"astc-8x8-unorm-srgb":{gl:37847,f:Li},"astc-10x5-unorm":{gl:37819,f:Li},"astc-10x5-unorm-srgb":{gl:37851,f:Li},"astc-10x6-unorm":{gl:37817,f:Li},"astc-10x6-unorm-srgb":{gl:37849,f:Li},"astc-10x8-unorm":{gl:37818,f:Li},"astc-10x8-unorm-srgb":{gl:37850,f:Li},"astc-10x10-unorm":{gl:37819,f:Li},"astc-10x10-unorm-srgb":{gl:37851,f:Li},"astc-12x10-unorm":{gl:37820,f:Li},"astc-12x10-unorm-srgb":{gl:37852,f:Li},"astc-12x12-unorm":{gl:37821,f:Li},"astc-12x12-unorm-srgb":{gl:37853,f:Li},"pvrtc-rgb4unorm-webgl":{gl:35840,f:b_},"pvrtc-rgba4unorm-webgl":{gl:35842,f:b_},"pvrtc-rbg2unorm-webgl":{gl:35841,f:b_},"pvrtc-rgba2unorm-webgl":{gl:35843,f:b_},"etc1-rbg-unorm-webgl":{gl:36196,f:AH},"atc-rgb-unorm-webgl":{gl:35986,f:Qv},"atc-rgba-unorm-webgl":{gl:35986,f:Qv},"atc-rgbai-unorm-webgl":{gl:34798,f:Qv}},LH={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},OH={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function gE(t,e,i){const r=M1[e];if(!r||r.gl===void 0)return!1;const s=r.x||r.gl2ext;return s?!!fc(t,s,i):!0}function bk(t){const e=M1[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}function DH(t,e,i){if(!gE(t,e,i)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(PP(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!fc(t,"OES_texture_float_linear, extensions",i):e.endsWith("16float")?!!fc(t,"OES_texture_half_float_linear, extensions",i):!0}function FH(t,e,i){return!(!gE(t,e,i)||typeof e=="number")}function J0(t){var e;const i=M1[t],r=bk(t),s=PP(t);return{format:r,dataFormat:(i==null?void 0:i.dataFormat)||UH(s.format,s.integer,s.normalized,r),type:s.dataType?vk(s.dataType):((e=i==null?void 0:i.types)==null?void 0:e[0])||5121,compressed:s.compressed}}function NH(t){const e=M1[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function _C(t){const e=J0(t),i=LH[e.dataFormat]||4,r=OH[e.type]||1;return i*r}function UH(t,e,i,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;default:return 6408}}const yC={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class zH extends AU{constructor(e,i,r){super([],r),O(this,"gl"),O(this,"extensions"),O(this,"testedFeatures",new Set),this.gl=e,this.extensions=i,fc(e,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const e=this.getFeatures();for(const i of e)this.has(i)&&(yield i);return[]}has(e){return this.disabledFeatures[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),kH(e)&&BH(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of e)this.has(i)}getFeatures(){return[...Object.keys(yC),...Object.keys(mE)]}getWebGLFeature(e){const i=yC[e];return typeof i=="string"?!!fc(this.gl,i,this.extensions):!!i}}class jH extends EU{constructor(e){super(),O(this,"gl"),O(this,"limits",{}),this.gl=e}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]}}function Yl(t,e,i){if(GH(e))return i(t);const{nocatch:r=!0}=e;R1(t),$d(t,e);let s;if(r)s=i(t),ym(t);else try{s=i(t)}finally{ym(t)}return s}function GH(t){for(const e in t)return!1;return!0}function VH(t,e,i,r){if(z0(e))return r(t);const s=t;R1(s.gl);try{return $H(t,e),$d(s.gl,i),r(t)}finally{ym(s.gl)}}function $H(t,e){const i=t,{gl:r}=i;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(gu("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,n=gu("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(n)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,n=gu("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,n),s==null||s.polygonModeWEBGL(1029,n)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(qH("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(lx("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;r.stencilMaskSeparate(1028,s),r.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&Qe.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,n=lx("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,n,0,s),r.stencilFuncSeparate(1029,n,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=rb("stencilPassOperation",e.stencilPassOperation),n=rb("stencilFailOperation",e.stencilFailOperation),c=rb("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,n,c,s),r.stencilOpSeparate(1029,n,c,s)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const s=vC("blendColorOperation",e.blendColorOperation||"add"),n=vC("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(s,n);const c=x_("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=x_("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=x_("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),y=x_("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(c,l,f,y)}}function lx(t,e){return gu(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function rb(t,e){return gu(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function vC(t,e){return gu(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function x_(t,e){return gu(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function HH(t,e){return`Illegal parameter ${e} for ${t}`}function gu(t,e,i){if(!(e in i))throw new Error(HH(t,e));return i[e]}function qH(t,e){return e}function wk(t){const e={};return t.addressModeU&&(e[10242]=sb(t.addressModeU)),t.addressModeV&&(e[10243]=sb(t.addressModeV)),t.addressModeW&&(e[32882]=sb(t.addressModeW)),t.magFilter&&(e[10240]=xk(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=WH(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=lx("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function sb(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function xk(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function WH(t,e){if(!e)return xk(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class cc extends yr{constructor(e,i={}){super(e,i),O(this,"device"),O(this,"gl"),O(this,"handle"),O(this,"glTarget"),O(this,"glUsage"),O(this,"glIndexType",5123),O(this,"byteLength"),O(this,"bytesUsed"),this.device=e,this.gl=this.device.gl;const r=typeof i=="object"?i.handle:void 0;this.handle=r||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=XH(this.props.usage),this.glUsage=KH(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(e,i=0,r=e.byteLength+i){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.glUsage),this.gl.bufferSubData(s,i,e),this.gl.bindBuffer(s,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(e,i,r),this.trackAllocatedMemory(r)}_initWithByteLength(e){bi(e>=0);let i=e;e===0&&(i=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,i,e.byteLength)}async readAsync(e=0,i){return this.readSyncWebGL(e,i)}readSyncWebGL(e=0,i){i=i??this.byteLength-e;const r=new Uint8Array(i),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,r,s,i),this.gl.bindBuffer(36662,null),this._setDebugData(r,e,i),r}}function XH(t){return t&yr.INDEX?34963:t&yr.VERTEX?34962:t&yr.UNIFORM?35345:34962}function KH(t){return t&yr.INDEX||t&yr.VERTEX?35044:t&yr.UNIFORM?35048:35044}class cx extends HP{constructor(e,i){super(e,i),O(this,"device"),O(this,"handle"),O(this,"parameters"),this.device=e,this.parameters=wk(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[i,r]of Object.entries(e)){const s=Number(i);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,r);break;default:this.device.gl.samplerParameteri(this.handle,s,r);break}}}}class sd extends FP{constructor(e,i){super(e,{...Mo.defaultProps,...i}),O(this,"device"),O(this,"gl"),O(this,"handle"),O(this,"texture"),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const JH={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Ek=class ux extends Mo{constructor(e,i){var r;super(e,{...JH,format:"rgba8unorm",...i}),O(this,"MAX_ATTRIBUTES"),O(this,"device"),O(this,"gl"),O(this,"handle"),O(this,"sampler"),O(this,"view"),O(this,"glFormat"),O(this,"type"),O(this,"dataFormat"),O(this,"mipmaps"),O(this,"target"),O(this,"textureUnit"),O(this,"loaded",!1),O(this,"_video"),this.device=e,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=ZH(this.props),this.loaded=!1,typeof((r=this.props)==null?void 0:r.data)=="string"&&Object.assign(this.props,{data:_z(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(e){return new sd(this.device,{...e,texture:this})}initialize(e={}){if(this.props.dimension==="cube")return this.initializeCube(e);let i=e.data;if(i instanceof Promise)return i.then(ee=>this.initialize(Object.assign({},e,{pixels:ee,data:ee}))),this;const r=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement;if(r&&i.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,i.addEventListener("loadeddata",()=>this.initialize(e)),this;const{parameters:s={}}=e,{pixels:n=null,pixelStore:c={},textureUnit:l=void 0,mipmaps:f=!0}=e;i||(i=n);let{width:y,height:E,dataFormat:T,type:R,compressed:D=!1}=e;const{depth:V=0}=e,H=bk(e.format);return{width:y,height:E,compressed:D,dataFormat:T,type:R}=this._deduceParameters({format:e.format,type:R,dataFormat:T,compressed:D,data:i,width:y,height:E}),this.width=y,this.height=E,this.glFormat=H,this.type=R,this.dataFormat=T,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=f,this.setImageData({data:i,width:y,height:E,depth:V,format:e.format,type:R,dataFormat:T,parameters:c,compressed:D}),this.setSampler(e.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),f&&this.device.isTextureFormatFilterable(e.format)&&this.generateMipmap(),r&&(this._video={video:i,parameters:s,lastTime:i.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?i.currentTime:-1}),this}initializeCube(e){const{mipmaps:i=!0,parameters:r={}}=e;return this.setCubeMapImageData(e).then(()=>{this.loaded=!0,i&&this.generateMipmap(e),this.setSampler(e.sampler),this._setSamplerParameters(r)}),this}setSampler(e={}){let i;e instanceof cx?(this.sampler=e,i=e.props):(this.sampler=new cx(this.device,e),i=e);const r=wk(i);return this._setSamplerParameters(r),this}resize(e){const{height:i,width:r,mipmaps:s=!1}=e;return r!==this.width||i!==this.height?this.initialize({width:r,height:i,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:e,parameters:i,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:i}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}generateMipmap(e={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Yl(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(e){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(e);this.trackDeallocatedMemory("Texture");const{target:i=this.target,pixels:r=null,level:s=0,glFormat:n=this.glFormat,offset:c=0,parameters:l={}}=e;let{data:f=null,type:y=this.type,width:E=this.width,height:T=this.height,dataFormat:R=this.dataFormat,compressed:D=!1}=e;f||(f=r),{type:y,dataFormat:R,compressed:D,width:E,height:T}=this._deduceParameters({format:this.props.format,type:y,dataFormat:R,compressed:D,data:f,width:E,height:T});const{gl:V}=this;V.bindTexture(this.target,this.handle);let H=null;if({data:f,dataType:H}=this._getDataType({data:f,compressed:D}),Yl(this.gl,l,()=>{switch(H){case"null":V.texImage2D(i,s,n,E,T,0,R,y,f);break;case"typed-array":V.texImage2D(i,s,n,E,T,0,R,y,f,c);break;case"buffer":this.device.gl.bindBuffer(35052,f.handle||f),this.device.gl.texImage2D(i,s,n,E,T,0,R,y,c),this.device.gl.bindBuffer(35052,null);break;case"browser-object":V.texImage2D(i,s,n,E,T,0,R,y,f);break;case"compressed":for(const[ee,z]of f.entries())V.compressedTexImage2D(i,ee,z.format,z.width,z.height,0,z.data);break;default:bi(!1,"Unknown image data type")}}),f&&f.byteLength)this.trackAllocatedMemory(f.byteLength,"Texture");else{const ee=_C(this.props.format);this.trackAllocatedMemory(this.width*this.height*ee,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:i=null,data:r=null,x:s=0,y:n=0,width:c=this.width,height:l=this.height,level:f=0,glFormat:y=this.glFormat,type:E=this.type,dataFormat:T=this.dataFormat,compressed:R=!1,offset:D=0,parameters:V={}}){if({type:E,dataFormat:T,compressed:R,width:c,height:l}=this._deduceParameters({format:this.props.format,type:E,dataFormat:T,compressed:R,data:r,width:c,height:l}),bi(this.depth===1,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const H=r;r=H.data,c=H.shape[0],l=H.shape[1]}r instanceof cc&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Yl(this.gl,V,()=>{R?this.gl.compressedTexSubImage2D(e,f,s,n,c,l,y,r):r===null?this.gl.texSubImage2D(e,f,s,n,c,l,T,E,null):ArrayBuffer.isView(r)?this.gl.texSubImage2D(e,f,s,n,c,l,T,E,r,D):typeof WebGLBuffer<"u"&&r instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,r),this.device.gl.texSubImage2D(e,f,s,n,c,l,T,E,D),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(e,f,s,n,c,l,T,E,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return Qe.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.target,null),e}_getDataType({data:e,compressed:i=!1}){return i?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof cc?{data:e.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&e instanceof WebGLBuffer?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:i,data:r}=e;let{width:s,height:n,dataFormat:c,type:l,compressed:f}=e;const y=J0(i);return c=c||y.dataFormat,l=l||y.type,f=f||y.compressed,{width:s,height:n}=this._deduceImageSize(r,s,n),{dataFormat:c,type:l,compressed:f,width:s,height:n,format:i,data:r}}_deduceImageSize(e,i,r){let s;return typeof ImageData<"u"&&e instanceof ImageData?s={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?s={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?s={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?s={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?s={width:e.videoWidth,height:e.videoHeight}:e?s={width:i,height:r}:s={width:i>=0?i:1,height:r>=0?r:1},bi(s,"Could not deduced texture size"),bi(i===void 0||s.width===i,"Deduced texture width does not match supplied width"),bi(r===void 0||s.height===r,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(e){const{gl:i}=this,{width:r,height:s,pixels:n,data:c,format:l=6408,type:f=5121}=e,y=n||c,E=await Promise.all(ux.FACES.map(T=>{const R=y[T];return Promise.all(Array.isArray(R)?R:[R])}));this.bind(),ux.FACES.forEach((T,R)=>{E[R].length>1&&this.props.mipmaps!==!1&&Qe.warn(`${this.id} has mipmap and multiple LODs.`)(),E[R].forEach((D,V)=>{r&&s?i.texImage2D(T,V,l,r,s,0,l,f,D):i.texImage2D(T,V,l,l,f,D)})}),this.unbind()}setImageDataForFace(e){const{face:i,width:r,height:s,pixels:n,data:c,format:l=6408,type:f=5121}=e,{gl:y}=this,E=n||c;return this.bind(),E instanceof Promise?E.then(T=>this.setImageDataForFace(Object.assign({},e,{face:i,data:T,pixels:T}))):this.width||this.height?y.texImage2D(i,0,l,r,s,0,l,f,E):y.texImage2D(i,0,l,l,f,E),this}setImageData3D(e){const{level:i=0,dataFormat:r,format:s,type:n,width:c,height:l,depth:f=1,offset:y=0,data:E,parameters:T={}}=e;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const R=J0(s);if(Yl(this.gl,T,()=>{ArrayBuffer.isView(E)&&this.gl.texImage3D(this.target,i,R.format,c,l,f,0,R.dataFormat,R.type,E),E instanceof cc&&(this.gl.bindBuffer(35052,E.handle),this.gl.texImage3D(this.target,i,r,c,l,f,0,s,n,y))}),E&&E.byteLength)this.trackAllocatedMemory(E.byteLength,"Texture");else{const D=_C(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*D,"Texture")}return this.loaded=!0,this}_setSamplerParameters(e){if(!z0(e)){YH(e),this.gl.bindTexture(this.target,this.handle);for(const[i,r]of Object.entries(e)){const s=Number(i),n=r;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,n);break;default:this.gl.texParameteri(this.target,s,n);break}}this.gl.bindTexture(this.target,null)}}};O(Ek,"FACES",[34069,34070,34071,34072,34073,34074]);let Ql=Ek;function ZH(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function YH(t){Qe.log(1,"texture sampler parameters",t)()}class $f extends XP{constructor(e,i){super(e,i),O(this,"device"),O(this,"gl"),O(this,"handle");const r=i.handle===null;if(this.device=e,this.gl=e.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),!r){e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const c=this.colorAttachments[n],l=36064+n;c&&this._attachOne(l,c)}if(this.depthStencilAttachment&&this._attachOne(NH(this.depthStencilAttachment.props.format),this.depthStencilAttachment),i.check!==!1){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${eq(n)}`)}this.gl.bindFramebuffer(36160,s)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(e){return new Ql(this.device,{id:`${this.id}-depth-stencil`,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,i){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight);for(const r of this.colorAttachments)r.texture.resize({width:e,height:i});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:e,height:i}),this}_attachOne(e,i){if(Array.isArray(i)){const[r,s=0,n=0]=i;return this._attachTexture(e,r,s,n),r}if(i instanceof Ql)return this._attachTexture(e,i,0,0),i;if(i instanceof sd){const r=i;return this._attachTexture(e,r.texture,r.props.baseMipLevel,r.props.baseArrayLayer),i.texture}throw new Error("attach")}_attachTexture(e,i,r,s){const{gl:n}=this.device;switch(n.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.target,s,r);break;case 34067:const c=QH(r);n.framebufferTexture2D(36160,e,c,i.handle,s);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,s);break;default:bi(!1,"Illegal texture type")}n.bindTexture(i.target,null)}}function QH(t){return t<34069?t+34069:t}function eq(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class tq extends K2{constructor(e,i){super(i),O(this,"device"),O(this,"presentationSize"),O(this,"_framebuffer",null),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new $f(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(e==null?void 0:e.useDevicePixels);this.setDevicePixelRatio(i,e);return}}commit(){}}const iq={spector:Qe.get("spector")||Qe.get("spectorjs")},rq="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",sq=1;let gr=null,bC=!1;async function nq(t){if(!globalThis.SPECTOR)try{await g4(rq)}catch(e){Qe.warn(String(e))}}function oq(t){if(t={...iq,...t},!(t!=null&&t.spector)||(!gr&&globalThis.SPECTOR&&(Qe.probe(sq,"SPECTOR found and initialized")(),gr=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=gr)),!gr))return null;if(bC||(bC=!0,gr.spyCanvases(),gr==null||gr.onCaptureStarted.add(e=>Qe.info("Spector capture started:",e)()),gr==null||gr.onCapture.add(e=>{Qe.info("Spector capture complete:",e)(),gr==null||gr.getResultUI(),gr==null||gr.resultView.display(),gr==null||gr.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return gr;gr==null||gr.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Qe.info("Spector capture stopped after 2 seconds")(),gr==null||gr.stopCapture()})}return gr}const aq="https://unpkg.com/webgl-debug@2.0.1/index.js";function Ak(t){return t.luma=t.luma||{},t.luma}async function lq(){yc()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await g4(aq))}function cq(t,e={}){return t?e.debug?hq(t,e):uq(t):null}function uq(t){const e=Ak(t);return e.realContext?e.realContext:t}function hq(t,e){if(!globalThis.WebGLDebugUtils)return Qe.warn("webgl-debug not loaded")(),t;const i=Ak(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...td,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,dq.bind(null,e),pq.bind(null,e));for(const c in td)!(c in r)&&typeof td[c]=="number"&&(r[c]=td[c]);class s{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(s,r);const n=Object.create(s);return i.realContext=t,i.debugContext=n,n.debug=!0,n}function nb(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function dq(t,e,i,r){r=Array.from(r).map(l=>l===void 0?"undefined":l);const s=globalThis.WebGLDebugUtils.glEnumToString(e),n=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,r),c=`${s} in gl.${i}(${n})`;Qe.error(c)();debugger;if(t.throwOnError)throw new Error(c)}function pq(t,e,i){let r="";if(Qe.level>=1&&(r=nb(e,i),Qe.log(1,r)()),t.break&&t.break.length>0&&(r=r||nb(e,i),t.break.every(s=>r.indexOf(s)!==-1)))debugger;for(const s of i)if(s===void 0){if(r=r||nb(e,i),t.throwOnError)throw new Error(`Undefined argument: ${r}`);Qe.error(`Undefined argument: ${r}`)();debugger}}function fq(t){const e=t.split(/\r?\n/),i=[];for(const r of e){if(r.length<=1)continue;const s=r.split(":");if(s.length===2){const[T,R]=s;i.push({message:R.trim(),type:wC(T),lineNum:0,linePos:0});continue}const[n,c,l,...f]=s;let y=parseInt(l,10);isNaN(y)&&(y=0);let E=parseInt(c,10);isNaN(E)&&(E=0),i.push({message:f.join(":").trim(),type:wC(n),lineNum:y,linePos:E})}return i}function wC(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class mq extends GP{constructor(e,i){switch(super(e,i),O(this,"device"),O(this,"handle"),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return fq(e)}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return e==null?void 0:e.getTranslatedShaderSource(this.handle)}async _compile(e){e=(r=>r.startsWith("#version ")?r:`#version 100
${r}`)(e);const{gl:i}=this.device;if(i.shaderSource(this.handle,e),i.compileShader(this.handle),Qe.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Qe.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Qe.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async r=>await new Promise(s=>setTimeout(s,r));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const gq=256,_q=1024,yq=16384,ob=6144,vq=[1,2,4,8];class bq extends UU{constructor(e,i){super(e,i),O(this,"device"),O(this,"glParameters"),this.device=e,R1(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){ym(this.device.gl)}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const i={...this.glParameters};this.props.framebuffer&&(i.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(i.viewport=e.viewport.slice(0,4),i.depthRange=[e.viewport[4],e.viewport[5]]):i.viewport=e.viewport),e.scissorRect&&(i.scissorTest=!0,i.scissor=e.scissorRect),e.blendConstant&&(i.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(i.colorMask=vq.map(r=>!!(r&e.colorMask))),this.glParameters=i,$d(this.device.gl,i)}beginOcclusionQuery(e){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;e==null||e.endOcclusionQuery()}clear(){const e={...this.glParameters};let i=0;this.props.clearColor!==!1&&(i|=yq,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=gq,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=_q,e.clearStencil=this.props.clearStencil),i!==0&&Yl(this.device.gl,e,()=>{this.device.gl.clear(i)})}clearColorBuffer(e=0,i=[0,0,0,0]){Yl(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int32Array:this.device.gl.clearBufferiv(ob,e,i);break;case Uint32Array:this.device.gl.clearBufferuiv(ob,e,i);break;case Float32Array:default:this.device.gl.clearBufferfv(ob,e,i);break}})}}const wq="Failed to deduce GL constant from typed array";function xq(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(wq)}}function hx(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const Eq={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Aq={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Hf{constructor(...e){O(this,"offset"),O(this,"stride"),O(this,"type"),O(this,"size"),O(this,"divisor"),O(this,"normalized"),O(this,"integer"),O(this,"buffer"),O(this,"index"),e.forEach(i=>this._assign(i)),Object.freeze(this)}static getBytesPerElement(e){return hx(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return bi(e.size),hx(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Hf(Eq,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Hf.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Hf.getBytesPerVertex(this)}_assign(e={}){return e=mz("Accessor",e,Aq),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function Tq(t){return Sq.includes(t)}const Sq=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Tk={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Sk(t){const e=Tk[t];if(!e)throw new Error("uniform");const[i,r,,s]=e;return{format:s,components:r,glType:i}}function Cq(t){const e=Tk[t];if(!e)throw new Error("attribute");const[,i,,r,s]=e;return{attributeType:r,vertexFormat:s,components:i}}function Iq(t,e){const i={attributes:[],bindings:[]};i.attributes=Rq(t,e);const r=kq(t,e);for(const l of r){const f=l.uniforms.map(y=>({name:y.name,format:y.format,byteOffset:y.byteOffset,byteStride:y.byteStride,arrayLength:y.arrayLength}));i.bindings.push({type:"uniform",name:l.name,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:f})}const s=Pq(t,e);let n=0;for(const l of s)if(Tq(l.type)){const{viewDimension:f,sampleType:y}=Lq(l.type);i.bindings.push({type:"texture",name:l.name,location:n,viewDimension:f,sampleType:y}),l.textureUnit=n,n+=1}s.length&&(i.uniforms=s);const c=Mq(t,e);return c!=null&&c.length&&(i.varyings=c),i}function Rq(t,e){const i=[],r=t.getProgramParameter(e,35721);for(let s=0;s<r;s++){const n=t.getActiveAttrib(e,s);if(!n)throw new Error("activeInfo");const{name:c,type:l}=n,f=t.getAttribLocation(e,c);if(f>=0){const{attributeType:y}=Cq(l),E=/instance/i.test(c)?"instance":"vertex";i.push({name:c,location:f,stepMode:E,type:y})}}return i.sort((s,n)=>s.location-n.location),i}function Mq(t,e){const i=[],r=t.getProgramParameter(e,35971);for(let s=0;s<r;s++){const n=t.getTransformFeedbackVarying(e,s);if(!n)throw new Error("activeInfo");const{name:c,type:l,size:f}=n,{glType:y,components:E}=Sk(l),T=new Hf({type:y,size:f*E}),R={location:s,name:c,accessor:T};i.push(R)}return i.sort((s,n)=>s.location-n.location),i}function Pq(t,e){const i=[],r=t.getProgramParameter(e,35718);for(let s=0;s<r;s++){const n=t.getActiveUniform(e,s);if(!n)throw new Error("activeInfo");const{name:c,size:l,type:f}=n,{name:y,isArray:E}=Oq(c);let T=t.getUniformLocation(e,y);const R={location:T,name:y,size:l,type:f,isArray:E};if(i.push(R),R.size>1)for(let D=0;D<R.size;D++){const V=`${y}[${D}]`;T=t.getUniformLocation(e,V);const H={...R,name:V,location:T};i.push(H)}}return i}function kq(t,e){const i=(n,c)=>t.getActiveUniformBlockParameter(e,n,c),r=[],s=t.getProgramParameter(e,35382);for(let n=0;n<s;n++){const c={name:t.getActiveUniformBlockName(e,n)||"",location:i(n,35391),byteLength:i(n,35392),vertex:i(n,35396),fragment:i(n,35398),uniformCount:i(n,35394),uniforms:[]},l=i(n,35395)||[],f=t.getActiveUniforms(e,l,35383),y=t.getActiveUniforms(e,l,35384),E=t.getActiveUniforms(e,l,35387),T=t.getActiveUniforms(e,l,35388);for(let R=0;R<c.uniformCount;++R){const D=t.getActiveUniform(e,l[R]);if(!D)throw new Error("activeInfo");c.uniforms.push({name:D.name,format:Sk(f[R]).format,type:f[R],arrayLength:y[R],byteOffset:E[R],byteStride:T[R]})}r.push(c)}return r.sort((n,c)=>n.location-c.location),r}const Bq={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function Lq(t){const e=Bq[t];if(!e)throw new Error("sampler");const[i,r]=e;return{viewDimension:i,sampleType:r}}function Oq(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:e[1],length:e[2]?1:0,isArray:!!e[2]}}function Dq(t,e,i,r){const s=t;let n=r;n===!0&&(n=1),n===!1&&(n=0);const c=typeof n=="number"?[n]:n;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,c);case 35664:return t.uniform2fv(e,c);case 35665:return t.uniform3fv(e,c);case 35666:return t.uniform4fv(e,c);case 5124:return t.uniform1iv(e,c);case 35667:return t.uniform2iv(e,c);case 35668:return t.uniform3iv(e,c);case 35669:return t.uniform4iv(e,c);case 35670:return t.uniform1iv(e,c);case 35671:return t.uniform2iv(e,c);case 35672:return t.uniform3iv(e,c);case 35673:return t.uniform4iv(e,c);case 5125:return s.uniform1uiv(e,c,1);case 36294:return s.uniform2uiv(e,c,2);case 36295:return s.uniform3uiv(e,c,3);case 36296:return s.uniform4uiv(e,c,4);case 35674:return t.uniformMatrix2fv(e,!1,c);case 35675:return t.uniformMatrix3fv(e,!1,c);case 35676:return t.uniformMatrix4fv(e,!1,c);case 35685:return s.uniformMatrix2x3fv(e,!1,c);case 35686:return s.uniformMatrix2x4fv(e,!1,c);case 35687:return s.uniformMatrix3x2fv(e,!1,c);case 35688:return s.uniformMatrix3x4fv(e,!1,c);case 35689:return s.uniformMatrix4x2fv(e,!1,c);case 35690:return s.uniformMatrix4x3fv(e,!1,c)}throw new Error("Illegal uniform")}function Fq(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function Nq(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const xC=4;class Uq extends C1{constructor(e,i){super(e,i),O(this,"device"),O(this,"handle"),O(this,"vs"),O(this,"fs"),O(this,"introspectedLayout"),O(this,"uniforms",{}),O(this,"bindings",{}),O(this,"varyings",null),O(this,"_uniformCount",0),O(this,"_uniformSetters",{}),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:r,bufferMode:s=35981}=i;switch(r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,s)),this._linkShaders(),Qe.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Iq(this.device.gl,this.handle),Qe.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=QU(this.introspectedLayout,i.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Qe.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,i){for(const[r,s]of Object.entries(e)){const n=this.shaderLayout.bindings.find(c=>c.name===r)||this.shaderLayout.bindings.find(c=>c.name===`${r}Uniforms`);if(!n){const c=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");i!=null&&i.disableWarnings||Qe.warn(`Unknown binding "${r}" in render pipeline "${this.id}", expected one of ${c}`)();continue}switch(s||Qe.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),n.type){case"uniform":if(!(s instanceof cc)&&!(s.buffer instanceof cc))throw new Error("buffer value");break;case"texture":if(!(s instanceof sd||s instanceof Ql||s instanceof $f))throw new Error("texture value");break;case"sampler":Qe.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(n.type)}this.bindings[r]=s}}draw(e){var i;const{renderPass:r,parameters:s=this.props.parameters,topology:n=this.props.topology,vertexArray:c,vertexCount:l,instanceCount:f,isInstanced:y=!1,firstVertex:E=0,transformFeedback:T}=e,R=Fq(n),D=!!c.indexBuffer,V=(i=c.indexBuffer)==null?void 0:i.glIndexType;if(this.linkStatus!=="success")return Qe.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||l===0)return Qe.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(l===0)return Qe.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),c.bindBeforeRender(r),T&&T.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const H=r;return VH(this.device,s,H.glParameters,()=>{D&&y?this.device.gl.drawElementsInstanced(R,l||0,V,E,f||0):D?this.device.gl.drawElements(R,l||0,V,E):y?this.device.gl.drawArraysInstanced(R,E,l||0,f||0):this.device.gl.drawArrays(R,E,l||0),T&&T.end()}),c.unbindAfterRender(r),!0}setUniformsWebGL(e){const{bindings:i}=J2(e);Object.keys(i).forEach(r=>{Qe.warn(`Unsupported value "${JSON.stringify(i[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Qe.time(xC,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Qe.timeEnd(xC,`linkProgram for ${this.id}`)(),Qe.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}Qe.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Qe.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}_reportLinkStatus(e){var i;switch(e){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((i=this.fs)==null?void 0:i.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${e}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async r=>await new Promise(s=>setTimeout(s,r));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const[,i]of Object.entries(this.bindings))i instanceof Ql&&(i.update(),e=e&&i.loaded);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let i=0,r=0;for(const s of this.shaderLayout.bindings){const n=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!n)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:c}=s,l=e.getUniformBlockIndex(this.handle,c);if(l===4294967295)throw new Error(`Invalid uniform block name ${c}`);e.uniformBlockBinding(this.handle,r,l),n instanceof cc?e.bindBufferBase(35345,r,n.handle):e.bindBufferRange(35345,r,n.buffer.handle,n.offset||0,n.size||n.buffer.byteLength-n.offset),r+=1;break;case"texture":if(!(n instanceof sd||n instanceof Ql||n instanceof $f))throw new Error("texture");let f;if(n instanceof sd)f=n.texture;else if(n instanceof Ql)f=n;else if(n instanceof $f&&n.colorAttachments[0]instanceof sd)Qe.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),f=n.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+i),e.bindTexture(f.target,f.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:i,location:r,type:s,textureUnit:n}=e,c=this.uniforms[i]??n;c!==void 0&&Dq(this.device.gl,r,s,c)}}}class zq extends jU{constructor(e){super(e,{}),O(this,"device"),O(this,"commands",[]),this.device=e}submitCommands(e=this.commands){for(const i of e)switch(i.name){case"copy-buffer-to-buffer":jq(this.device,i.options);break;case"copy-buffer-to-texture":Gq(this.device,i.options);break;case"copy-texture-to-buffer":Vq(this.device,i.options);break;case"copy-texture-to-texture":$q(this.device,i.options);break}}}function jq(t,e){const i=e.source,r=e.destination;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function Gq(t,e){throw new Error("Not implemented")}function Vq(t,e){const{source:i,mipLevel:r=0,aspect:s="all",width:n=e.source.width,height:c=e.source.height,depthOrArrayLayers:l=0,origin:f=[0,0],destination:y,byteOffset:E=0,bytesPerRow:T,rowsPerImage:R}=e;if(s!=="all")throw new Error("not supported");if(r!==0||l!==0||T||R)throw new Error("not implemented");const{framebuffer:D,destroyFramebuffer:V}=Ck(i);let H;try{const ee=y,z=n||D.width,W=c||D.height,q=J0(D.texture.props.format),ce=q.dataFormat,we=q.type;t.gl.bindBuffer(35051,ee.handle),H=t.gl.bindFramebuffer(36160,D.handle),t.gl.readPixels(f[0],f[1],z,W,ce,we,E)}finally{t.gl.bindBuffer(35051,null),H!==void 0&&t.gl.bindFramebuffer(36160,H),V&&D.destroy()}}function $q(t,e){const{source:i,destinationMipLevel:r=0,origin:s=[0,0],destinationOrigin:n=[0,0],destination:c}=e;let{width:l=e.destination.width,height:f=e.destination.height}=e;const{framebuffer:y,destroyFramebuffer:E}=Ck(i),[T,R]=s,[D,V,H]=n,ee=t.gl.bindFramebuffer(36160,y.handle);let z=null,W;if(c instanceof Ql)z=c,l=Number.isFinite(l)?l:z.width,f=Number.isFinite(f)?f:z.height,z.bind(0),W=z.target;else throw new Error("invalid destination");switch(W){case 3553:case 34067:t.gl.copyTexSubImage2D(W,r,D,V,T,R,l,f);break;case 35866:case 32879:t.gl.copyTexSubImage3D(W,r,D,V,H,T,R,l,f);break}z&&z.unbind(),t.gl.bindFramebuffer(36160,ee),E&&y.destroy()}function Ck(t){if(t instanceof Mo){const{width:e,height:i,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class Hq extends zU{constructor(e,i){super(e,i),O(this,"device"),O(this,"commandBuffer"),this.device=e,this.commandBuffer=new zq(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,i,r){}}class _E extends ez{constructor(e,i){super(e,i),O(this,"device"),O(this,"handle"),O(this,"buffer",null),O(this,"bufferValue",null),this.device=e,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return qF()==="Chrome"}destroy(){var e;super.destroy(),this.buffer&&((e=this.buffer)==null||e.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const i=e;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(e,i){const r=i;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:n,stride:c,offset:l,normalized:f,integer:y,divisor:E}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),y?this.device.gl.vertexAttribIPointer(e,s,n,c,l):this.device.gl.vertexAttribPointer(e,s,n,f,c,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,E||0),this.attributes[e]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,i){this._enable(e,!1),this.attributes[e]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const i=this.attributes[e];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(e,i)}}_getAccessor(e){const i=this.attributeInfos[e];if(!i)throw new Error(`Unknown attribute location ${e}`);const r=vk(i.bufferDataType);return{size:i.bufferComponents,type:r,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(e,i=!0){const r=_E.isConstantAttributeZeroSupported(this.device)||e!==0;(i||r)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,i){const r=qq(i),s=r.byteLength*e,n=r.length*e;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),c=c||!Wq(r,this.bufferValue),c){const l=oz(i.constructor,n);az({target:l,source:r,start:0,count:n}),this.buffer.write(l),this.bufferValue=i}return this.buffer}}function qq(t){return Array.isArray(t)?new Float32Array(t):t}function Wq(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class Xq extends tz{constructor(e,i){super(e,i),O(this,"device"),O(this,"gl"),O(this,"handle"),O(this,"layout"),O(this,"buffers",{}),O(this,"unusedBuffers",{}),O(this,"bindOnUse",!0),O(this,"_bound",!1),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Nq(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in e)this.setBuffer(i,e[i])})}setBuffer(e,i){const r=this._getVaryingIndex(e),{buffer:s,byteLength:n,byteOffset:c}=this._getBufferRange(i);if(r<0){this.unusedBuffers[e]=s,Qe.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[r]={buffer:s,byteLength:n,byteOffset:c},this.bindOnUse||this._bindBuffer(r,s,c,n)}getBuffer(e){if(EC(e))return this.buffers[e]||null;const i=this._getVaryingIndex(e);return i>=0?this.buffers[i]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let i;return this._bound?i=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof cc)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:i,byteOffset:r=0,byteLength:s=e.buffer.byteLength}=e;return{buffer:i,byteOffset:r,byteLength:s}}_getVaryingIndex(e){if(EC(e))return Number(e);for(const i of this.layout.varyings)if(e===i.name)return i.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:i,byteLength:r,byteOffset:s}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),i,s,r)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,i,r=0,s){const n=i&&i.handle;!n||s===void 0?this.gl.bindBufferBase(35982,e,n):this.gl.bindBufferRange(35982,e,n,r,s)}}function EC(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class Kq extends iz{constructor(e,i){if(super(e,i),O(this,"device"),O(this,"handle"),O(this,"target",null),O(this,"_queryPending",!1),O(this,"_pollingPromise",null),this.device=e,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e!=null&&e.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((r,s)=>{const n=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):i++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(n)};requestAnimationFrame(n)}),this._pollingPromise}}function Ik(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return bi(!1),0}}function Jq(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return bi(!1),0}}function Zq(t,e){var i,r;const{sourceX:s=0,sourceY:n=0,sourceFormat:c=6408,sourceAttachment:l=36064}=e||{};let{target:f=null,sourceWidth:y,sourceHeight:E,sourceType:T}=e||{};const{framebuffer:R,deleteFramebuffer:D}=Rk(t);bi(R);const{gl:V,handle:H}=R;y=y||R.width,E=E||R.height;const ee=l-36064;T=T||((r=(i=R.colorAttachments[ee])==null?void 0:i.texture)==null?void 0:r.type)||5121,f=eW(f,T,c,y,E),T=T||xq(f);const z=V.bindFramebuffer(36160,H);return V.readPixels(s,n,y,E,c,T,f),V.bindFramebuffer(36160,z||null),D&&R.destroy(),f}function Yq(t,e){const{target:i,sourceX:r=0,sourceY:s=0,sourceFormat:n=6408,targetByteOffset:c=0}=e||{};let{sourceWidth:l,sourceHeight:f,sourceType:y}=e||{};const{framebuffer:E,deleteFramebuffer:T}=Rk(t);bi(E),l=l||E.width,f=f||E.height;const R=E;y=y||5121;let D=i;if(!D){const H=Ik(n),ee=Jq(y),z=c+l*f*H*ee;D=R.device.createBuffer({byteLength:z})}const V=t.device.createCommandEncoder();return V.copyTextureToBuffer({source:t,width:l,height:f,origin:[r,s],destination:D,byteOffset:c}),V.destroy(),T&&E.destroy(),D}function Rk(t){return t instanceof XP?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Qq(t),deleteFramebuffer:!0}}function Qq(t,e){const{device:i,width:r,height:s,id:n}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${n}`,width:r,height:s,colorAttachments:[t]})}function eW(t,e,i,r,s){if(t)return t;e=e||5121;const n=hx(e,{clamped:!1}),c=Ik(i);return new n(r*s*c)}const tW=256,iW=1024,rW=16384,sW="clear: bad arguments";function nW(t,e){const{framebuffer:i=null,color:r=null,depth:s=null,stencil:n=null}=e||{},c={};i&&(c.framebuffer=i);let l=0;r&&(l|=rW,r!==!0&&(c.clearColor=r)),s&&(l|=tW,s!==!0&&(c.clearDepth=s)),n&&(l|=iW,s!==!0&&(c.clearStencil=s)),bi(l!==0,sW);const f=t.gl;Yl(f,c,()=>{f.clear(l)})}const uf=1,Mk=class If extends j0{constructor(e){var i,r;super({...e,id:e.id||vc("webgl-device")}),O(this,"type","webgl"),O(this,"handle"),O(this,"features"),O(this,"limits"),O(this,"info"),O(this,"canvasContext"),O(this,"lost"),O(this,"_resolveContextLost"),O(this,"renderPass",null),O(this,"gl"),O(this,"debug",!1),O(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1}),O(this,"_extensions",{}),O(this,"_polyfilled",!1),O(this,"spectorJS"),O(this,"_constants");const s=(i=e.gl)==null?void 0:i.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);const n=((r=e.gl)==null?void 0:r.canvas)||e.canvas;this.canvasContext=new tq(this,{...e,canvas:n}),this.lost=new Promise(y=>{this._resolveContextLost=y});let c=e.gl||null;if(c||(c=bH(this.canvasContext.canvas,{...e,onContextLost:y=>{var E;return(E=this._resolveContextLost)==null?void 0:E.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!c)throw new Error("WebGL context creation failed");this.handle=c,this.gl=c,this.gl.device=this,this.gl._version=2,e.spector&&(this.spectorJS=oq({...this.props,canvas:this.handle.canvas})),this.info=wH(this.gl,this._extensions),this.limits=new jH(this.gl),this.features=new zH(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:l=!0,copyState:f=!1}=e;_k(this.gl,{enable:l,copyState:f,log:(...y)=>Qe.log(1,...y)()}),e.debug&&(this.gl=cq(this.gl,{...e,throwOnError:!0}),this.debug=!0,Qe.level=Math.max(Qe.level,1),Qe.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(e){if(e instanceof If)return e;if((e==null?void 0:e.device)instanceof j0)return e.device;if(!oW(e))throw new Error("Invalid WebGL2RenderingContext");return new If({gl:e})}static async create(e={}){var i;Qe.groupCollapsed(uf,"WebGLDevice created")();const r=[];e.debug&&r.push(lq()),e.spector&&r.push(nq()),typeof e.canvas=="string"&&r.push(K2.pageLoaded);const s=await Promise.allSettled(r);for(const l of s)l.status==="rejected"&&Qe.error(`Failed to initialize debug libraries ${l.reason}`)();if(Qe.probe(uf+1,"DOM is loaded")(),(i=e.gl)!=null&&i.device)return Qe.warn("reattaching existing device")(),If.attach(e.gl);const n=new If(e),c=`Created ${n.type}${n.debug?" debug":""} context: ${n.info.vendor}, ${n.info.renderer} for canvas: ${n.canvasContext.id}`;return Qe.probe(uf,c)(),Qe.table(uf,n.info)(),Qe.groupEnd(uf)(),n}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(e){return gE(this.gl,e,this._extensions)}isTextureFormatFilterable(e){return DH(this.gl,e,this._extensions)}isTextureFormatRenderable(e){return FH(this.gl,e,this._extensions)}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const i=this._getBufferProps(e);return new cc(this,i)}_createTexture(e){return new Ql(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new cx(this,e)}createShader(e){return new mq(this,e)}createFramebuffer(e){return new $f(this,e)}createVertexArray(e){return new _E(this,e)}createTransformFeedback(e){return new Xq(this,e)}createQuerySet(e){return new Kq(this,e)}createRenderPipeline(e){return new Uq(this,e)}beginRenderPass(e){return new bq(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(e){return new Hq(this,e)}submit(){var e;(e=this.renderPass)==null||e.end(),this.renderPass=null}readPixelsToArrayWebGL(e,i){return Zq(e,i)}readPixelsToBufferWebGL(e,i){return Yq(e,i)}setParametersWebGL(e){$d(this.gl,e)}getParametersWebGL(e){return gk(this.gl,e)}withParametersWebGL(e,i){return Yl(this.gl,e,i)}clearWebGL(e){nW(this,e)}resetWebGL(){Qe.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),pH(this.gl)}loseDevice(){var e;let i=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(i=!0,r.loseContext()),(e=this._resolveContextLost)==null||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){R1(this.gl)}popState(){ym(this.gl)}setSpectorMetadata(e,i){e.__SPECTOR_Metadata=i}getGLKey(e,i){i=i||this.gl2||this.gl;const r=Number(e);for(const s in i)if(i[s]===r)return`GL.${s}`;return String(e)}setConstantAttributeWebGL(e,i){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const s=this._constants[e];switch(s&&uW(s,i)&&Qe.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=i,i.constructor){case Float32Array:aW(this,e,i);break;case Int32Array:lW(this,e,i);break;case Uint32Array:cW(this,e,i);break;default:bi(!1)}}getExtension(e){return fc(this.gl,e,this._extensions),this._extensions}};O(Mk,"type","webgl");let ab=Mk;function oW(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function aW(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break;default:bi(!1)}}function lW(t,e,i){t.gl.vertexAttribI4iv(e,i)}function cW(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function uW(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}var Pk={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,i,r,s){var n=["","webkit","Moz","MS","ms","o"],c=i.createElement("div"),l="function",f=Math.round,y=Math.abs,E=Date.now;function T(K,ie,_e){return setTimeout(q(K,_e),ie)}function R(K,ie,_e){return Array.isArray(K)?(D(K,_e[ie],_e),!0):!1}function D(K,ie,_e){var Ue;if(K)if(K.forEach)K.forEach(ie,_e);else if(K.length!==s)for(Ue=0;Ue<K.length;)ie.call(_e,K[Ue],Ue,K),Ue++;else for(Ue in K)K.hasOwnProperty(Ue)&&ie.call(_e,K[Ue],Ue,K)}function V(K,ie,_e){var Ue="DEPRECATED METHOD: "+ie+`
`+_e+` AT 
`;return function(){var qe=new Error("get-stack-trace"),Ct=qe&&qe.stack?qe.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",qt=e.console&&(e.console.warn||e.console.log);return qt&&qt.call(e.console,Ue,Ct),K.apply(this,arguments)}}var H;typeof Object.assign!="function"?H=function(K){if(K===s||K===null)throw new TypeError("Cannot convert undefined or null to object");for(var ie=Object(K),_e=1;_e<arguments.length;_e++){var Ue=arguments[_e];if(Ue!==s&&Ue!==null)for(var qe in Ue)Ue.hasOwnProperty(qe)&&(ie[qe]=Ue[qe])}return ie}:H=Object.assign;var ee=V(function(K,ie,_e){for(var Ue=Object.keys(ie),qe=0;qe<Ue.length;)(!_e||_e&&K[Ue[qe]]===s)&&(K[Ue[qe]]=ie[Ue[qe]]),qe++;return K},"extend","Use `assign`."),z=V(function(K,ie){return ee(K,ie,!0)},"merge","Use `assign`.");function W(K,ie,_e){var Ue=ie.prototype,qe;qe=K.prototype=Object.create(Ue),qe.constructor=K,qe._super=Ue,_e&&H(qe,_e)}function q(K,ie){return function(){return K.apply(ie,arguments)}}function ce(K,ie){return typeof K==l?K.apply(ie&&ie[0]||s,ie):K}function we(K,ie){return K===s?ie:K}function re(K,ie,_e){D(Pe(ie),function(Ue){K.addEventListener(Ue,_e,!1)})}function be(K,ie,_e){D(Pe(ie),function(Ue){K.removeEventListener(Ue,_e,!1)})}function me(K,ie){for(;K;){if(K==ie)return!0;K=K.parentNode}return!1}function Te(K,ie){return K.indexOf(ie)>-1}function Pe(K){return K.trim().split(/\s+/g)}function ze(K,ie,_e){if(K.indexOf&&!_e)return K.indexOf(ie);for(var Ue=0;Ue<K.length;){if(_e&&K[Ue][_e]==ie||!_e&&K[Ue]===ie)return Ue;Ue++}return-1}function Ke(K){return Array.prototype.slice.call(K,0)}function We(K,ie,_e){for(var Ue=[],qe=[],Ct=0;Ct<K.length;){var qt=K[Ct][ie];ze(qe,qt)<0&&Ue.push(K[Ct]),qe[Ct]=qt,Ct++}return Ue=Ue.sort(function(Ni,gs){return Ni[ie]>gs[ie]}),Ue}function Ze(K,ie){for(var _e,Ue,qe=ie[0].toUpperCase()+ie.slice(1),Ct=0;Ct<n.length;){if(_e=n[Ct],Ue=_e?_e+qe:ie,Ue in K)return Ue;Ct++}return s}var Ft=1;function ci(){return Ft++}function Gt(K){var ie=K.ownerDocument||K;return ie.defaultView||ie.parentWindow||e}var et=/mobile|tablet|ip(ad|hone|od)|android/i,xt="ontouchstart"in e,Tt=Ze(e,"PointerEvent")!==s,zt=xt&&et.test(navigator.userAgent),$t="touch",Ls="pen",cr="mouse",Dr="kinect",Fr=25,si=1,fr=2,wi=4,Zi=8,Gn=1,ts=2,ps=4,fs=8,Ws=16,Oe=ts|ps,is=fs|Ws,jo=Oe|is,Yt=["x","y"],xi=["clientX","clientY"];function vr(K,ie){var _e=this;this.manager=K,this.callback=ie,this.element=K.element,this.target=K.options.inputTarget,this.domHandler=function(Ue){ce(K.options.enable,[K])&&_e.handler(Ue)},this.init()}vr.prototype={handler:function(){},init:function(){this.evEl&&re(this.element,this.evEl,this.domHandler),this.evTarget&&re(this.target,this.evTarget,this.domHandler),this.evWin&&re(Gt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&be(this.element,this.evEl,this.domHandler),this.evTarget&&be(this.target,this.evTarget,this.domHandler),this.evWin&&be(Gt(this.element),this.evWin,this.domHandler)}};function Vn(K){var ie,_e=K.options.inputClass;return _e?ie=_e:Tt?ie=ue:zt?ie=fe:xt?ie=Ye:ie=Pt,new ie(K,_n)}function _n(K,ie,_e){var Ue=_e.pointers.length,qe=_e.changedPointers.length,Ct=ie&si&&Ue-qe===0,qt=ie&(wi|Zi)&&Ue-qe===0;_e.isFirst=!!Ct,_e.isFinal=!!qt,Ct&&(K.session={}),_e.eventType=ie,Go(K,_e),K.emit("hammer.input",_e),K.recognize(_e),K.session.prevInput=_e}function Go(K,ie){var _e=K.session,Ue=ie.pointers,qe=Ue.length;_e.firstInput||(_e.firstInput=Vo(ie)),qe>1&&!_e.firstMultiple?_e.firstMultiple=Vo(ie):qe===1&&(_e.firstMultiple=!1);var Ct=_e.firstInput,qt=_e.firstMultiple,Ni=qt?qt.center:Ct.center,gs=ie.center=Je(Ue);ie.timeStamp=E(),ie.deltaTime=ie.timeStamp-Ct.timeStamp,ie.angle=Xs(Ni,gs),ie.distance=rs(Ni,gs),ms(_e,ie),ie.offsetDirection=br(ie.deltaX,ie.deltaY);var ns=Os(ie.deltaTime,ie.deltaX,ie.deltaY);ie.overallVelocityX=ns.x,ie.overallVelocityY=ns.y,ie.overallVelocity=y(ns.x)>y(ns.y)?ns.x:ns.y,ie.scale=qt?Nt(qt.pointers,Ue):1,ie.rotation=qt?st(qt.pointers,Ue):0,ie.maxPointers=_e.prevInput?ie.pointers.length>_e.prevInput.maxPointers?ie.pointers.length:_e.prevInput.maxPointers:ie.pointers.length,ga(_e,ie);var wr=K.element;me(ie.srcEvent.target,wr)&&(wr=ie.srcEvent.target),ie.target=wr}function ms(K,ie){var _e=ie.center,Ue=K.offsetDelta||{},qe=K.prevDelta||{},Ct=K.prevInput||{};(ie.eventType===si||Ct.eventType===wi)&&(qe=K.prevDelta={x:Ct.deltaX||0,y:Ct.deltaY||0},Ue=K.offsetDelta={x:_e.x,y:_e.y}),ie.deltaX=qe.x+(_e.x-Ue.x),ie.deltaY=qe.y+(_e.y-Ue.y)}function ga(K,ie){var _e=K.lastInterval||ie,Ue=ie.timeStamp-_e.timeStamp,qe,Ct,qt,Ni;if(ie.eventType!=Zi&&(Ue>Fr||_e.velocity===s)){var gs=ie.deltaX-_e.deltaX,ns=ie.deltaY-_e.deltaY,wr=Os(Ue,gs,ns);Ct=wr.x,qt=wr.y,qe=y(wr.x)>y(wr.y)?wr.x:wr.y,Ni=br(gs,ns),K.lastInterval=ie}else qe=_e.velocity,Ct=_e.velocityX,qt=_e.velocityY,Ni=_e.direction;ie.velocity=qe,ie.velocityX=Ct,ie.velocityY=qt,ie.direction=Ni}function Vo(K){for(var ie=[],_e=0;_e<K.pointers.length;)ie[_e]={clientX:f(K.pointers[_e].clientX),clientY:f(K.pointers[_e].clientY)},_e++;return{timeStamp:E(),pointers:ie,center:Je(ie),deltaX:K.deltaX,deltaY:K.deltaY}}function Je(K){var ie=K.length;if(ie===1)return{x:f(K[0].clientX),y:f(K[0].clientY)};for(var _e=0,Ue=0,qe=0;qe<ie;)_e+=K[qe].clientX,Ue+=K[qe].clientY,qe++;return{x:f(_e/ie),y:f(Ue/ie)}}function Os(K,ie,_e){return{x:ie/K||0,y:_e/K||0}}function br(K,ie){return K===ie?Gn:y(K)>=y(ie)?K<0?ts:ps:ie<0?fs:Ws}function rs(K,ie,_e){_e||(_e=Yt);var Ue=ie[_e[0]]-K[_e[0]],qe=ie[_e[1]]-K[_e[1]];return Math.sqrt(Ue*Ue+qe*qe)}function Xs(K,ie,_e){_e||(_e=Yt);var Ue=ie[_e[0]]-K[_e[0]],qe=ie[_e[1]]-K[_e[1]];return Math.atan2(qe,Ue)*180/Math.PI}function st(K,ie){return Xs(ie[1],ie[0],xi)+Xs(K[1],K[0],xi)}function Nt(K,ie){return rs(ie[0],ie[1],xi)/rs(K[0],K[1],xi)}var Mt={mousedown:si,mousemove:fr,mouseup:wi},Nr="mousedown",Ds="mousemove mouseup";function Pt(){this.evEl=Nr,this.evWin=Ds,this.pressed=!1,vr.apply(this,arguments)}W(Pt,vr,{handler:function(K){var ie=Mt[K.type];ie&si&&K.button===0&&(this.pressed=!0),ie&fr&&K.which!==1&&(ie=wi),this.pressed&&(ie&wi&&(this.pressed=!1),this.callback(this.manager,ie,{pointers:[K],changedPointers:[K],pointerType:cr,srcEvent:K}))}});var Ks={pointerdown:si,pointermove:fr,pointerup:wi,pointercancel:Zi,pointerout:Zi},yn={2:$t,3:Ls,4:cr,5:Dr},vn="pointerdown",Fs="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(vn="MSPointerDown",Fs="MSPointerMove MSPointerUp MSPointerCancel");function ue(){this.evEl=vn,this.evWin=Fs,vr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}W(ue,vr,{handler:function(K){var ie=this.store,_e=!1,Ue=K.type.toLowerCase().replace("ms",""),qe=Ks[Ue],Ct=yn[K.pointerType]||K.pointerType,qt=Ct==$t,Ni=ze(ie,K.pointerId,"pointerId");qe&si&&(K.button===0||qt)?Ni<0&&(ie.push(K),Ni=ie.length-1):qe&(wi|Zi)&&(_e=!0),!(Ni<0)&&(ie[Ni]=K,this.callback(this.manager,qe,{pointers:ie,changedPointers:[K],pointerType:Ct,srcEvent:K}),_e&&ie.splice(Ni,1))}});var G={touchstart:si,touchmove:fr,touchend:wi,touchcancel:Zi},j="touchstart",Y="touchstart touchmove touchend touchcancel";function oe(){this.evTarget=j,this.evWin=Y,this.started=!1,vr.apply(this,arguments)}W(oe,vr,{handler:function(K){var ie=G[K.type];if(ie===si&&(this.started=!0),!!this.started){var _e=ye.call(this,K,ie);ie&(wi|Zi)&&_e[0].length-_e[1].length===0&&(this.started=!1),this.callback(this.manager,ie,{pointers:_e[0],changedPointers:_e[1],pointerType:$t,srcEvent:K})}}});function ye(K,ie){var _e=Ke(K.touches),Ue=Ke(K.changedTouches);return ie&(wi|Zi)&&(_e=We(_e.concat(Ue),"identifier")),[_e,Ue]}var Ee={touchstart:si,touchmove:fr,touchend:wi,touchcancel:Zi},Re="touchstart touchmove touchend touchcancel";function fe(){this.evTarget=Re,this.targetIds={},vr.apply(this,arguments)}W(fe,vr,{handler:function(K){var ie=Ee[K.type],_e=Ne.call(this,K,ie);_e&&this.callback(this.manager,ie,{pointers:_e[0],changedPointers:_e[1],pointerType:$t,srcEvent:K})}});function Ne(K,ie){var _e=Ke(K.touches),Ue=this.targetIds;if(ie&(si|fr)&&_e.length===1)return Ue[_e[0].identifier]=!0,[_e,_e];var qe,Ct,qt=Ke(K.changedTouches),Ni=[],gs=this.target;if(Ct=_e.filter(function(ns){return me(ns.target,gs)}),ie===si)for(qe=0;qe<Ct.length;)Ue[Ct[qe].identifier]=!0,qe++;for(qe=0;qe<qt.length;)Ue[qt[qe].identifier]&&Ni.push(qt[qe]),ie&(wi|Zi)&&delete Ue[qt[qe].identifier],qe++;if(Ni.length)return[We(Ct.concat(Ni),"identifier"),Ni]}var Ve=2500,De=25;function Ye(){vr.apply(this,arguments);var K=q(this.handler,this);this.touch=new fe(this.manager,K),this.mouse=new Pt(this.manager,K),this.primaryTouch=null,this.lastTouches=[]}W(Ye,vr,{handler:function(K,ie,_e){var Ue=_e.pointerType==$t,qe=_e.pointerType==cr;if(!(qe&&_e.sourceCapabilities&&_e.sourceCapabilities.firesTouchEvents)){if(Ue)wt.call(this,ie,_e);else if(qe&&Zt.call(this,_e))return;this.callback(K,ie,_e)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function wt(K,ie){K&si?(this.primaryTouch=ie.changedPointers[0].identifier,St.call(this,ie)):K&(wi|Zi)&&St.call(this,ie)}function St(K){var ie=K.changedPointers[0];if(ie.identifier===this.primaryTouch){var _e={x:ie.clientX,y:ie.clientY};this.lastTouches.push(_e);var Ue=this.lastTouches,qe=function(){var Ct=Ue.indexOf(_e);Ct>-1&&Ue.splice(Ct,1)};setTimeout(qe,Ve)}}function Zt(K){for(var ie=K.srcEvent.clientX,_e=K.srcEvent.clientY,Ue=0;Ue<this.lastTouches.length;Ue++){var qe=this.lastTouches[Ue],Ct=Math.abs(ie-qe.x),qt=Math.abs(_e-qe.y);if(Ct<=De&&qt<=De)return!0}return!1}var Ot=Ze(c.style,"touchAction"),Xt=Ot!==s,jt="compute",Vi="auto",Ai="manipulation",Dt="none",Qt="pan-x",hi="pan-y",$i=$o();function sr(K,ie){this.manager=K,this.set(ie)}sr.prototype={set:function(K){K==jt&&(K=this.compute()),Xt&&this.manager.element.style&&$i[K]&&(this.manager.element.style[Ot]=K),this.actions=K.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var K=[];return D(this.manager.recognizers,function(ie){ce(ie.options.enable,[ie])&&(K=K.concat(ie.getTouchAction()))}),Ir(K.join(" "))},preventDefaults:function(K){var ie=K.srcEvent,_e=K.offsetDirection;if(this.manager.session.prevented){ie.preventDefault();return}var Ue=this.actions,qe=Te(Ue,Dt)&&!$i[Dt],Ct=Te(Ue,hi)&&!$i[hi],qt=Te(Ue,Qt)&&!$i[Qt];if(qe){var Ni=K.pointers.length===1,gs=K.distance<2,ns=K.deltaTime<250;if(Ni&&gs&&ns)return}if(!(qt&&Ct)&&(qe||Ct&&_e&Oe||qt&&_e&is))return this.preventSrc(ie)},preventSrc:function(K){this.manager.session.prevented=!0,K.preventDefault()}};function Ir(K){if(Te(K,Dt))return Dt;var ie=Te(K,Qt),_e=Te(K,hi);return ie&&_e?Dt:ie||_e?ie?Qt:hi:Te(K,Ai)?Ai:Vi}function $o(){if(!Xt)return!1;var K={},ie=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(_e){K[_e]=ie?e.CSS.supports("touch-action",_e):!0}),K}var ti=1,Ur=2,$n=4,Yi=8,Hi=Yi,_a=16,qi=32;function Wi(K){this.options=H({},this.defaults,K||{}),this.id=ci(),this.manager=null,this.options.enable=we(this.options.enable,!0),this.state=ti,this.simultaneous={},this.requireFail=[]}Wi.prototype={defaults:{},set:function(K){return H(this.options,K),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(K){if(R(K,"recognizeWith",this))return this;var ie=this.simultaneous;return K=Di(K,this),ie[K.id]||(ie[K.id]=K,K.recognizeWith(this)),this},dropRecognizeWith:function(K){return R(K,"dropRecognizeWith",this)?this:(K=Di(K,this),delete this.simultaneous[K.id],this)},requireFailure:function(K){if(R(K,"requireFailure",this))return this;var ie=this.requireFail;return K=Di(K,this),ze(ie,K)===-1&&(ie.push(K),K.requireFailure(this)),this},dropRequireFailure:function(K){if(R(K,"dropRequireFailure",this))return this;K=Di(K,this);var ie=ze(this.requireFail,K);return ie>-1&&this.requireFail.splice(ie,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(K){return!!this.simultaneous[K.id]},emit:function(K){var ie=this,_e=this.state;function Ue(qe){ie.manager.emit(qe,K)}_e<Yi&&Ue(ie.options.event+fo(_e)),Ue(ie.options.event),K.additionalEvent&&Ue(K.additionalEvent),_e>=Yi&&Ue(ie.options.event+fo(_e))},tryEmit:function(K){if(this.canEmit())return this.emit(K);this.state=qi},canEmit:function(){for(var K=0;K<this.requireFail.length;){if(!(this.requireFail[K].state&(qi|ti)))return!1;K++}return!0},recognize:function(K){var ie=H({},K);if(!ce(this.options.enable,[this,ie])){this.reset(),this.state=qi;return}this.state&(Hi|_a|qi)&&(this.state=ti),this.state=this.process(ie),this.state&(Ur|$n|Yi|_a)&&this.tryEmit(ie)},process:function(K){},getTouchAction:function(){},reset:function(){}};function fo(K){return K&_a?"cancel":K&Yi?"end":K&$n?"move":K&Ur?"start":""}function Hn(K){return K==Ws?"down":K==fs?"up":K==ts?"left":K==ps?"right":""}function Di(K,ie){var _e=ie.manager;return _e?_e.get(K):K}function Rr(){Wi.apply(this,arguments)}W(Rr,Wi,{defaults:{pointers:1},attrTest:function(K){var ie=this.options.pointers;return ie===0||K.pointers.length===ie},process:function(K){var ie=this.state,_e=K.eventType,Ue=ie&(Ur|$n),qe=this.attrTest(K);return Ue&&(_e&Zi||!qe)?ie|_a:Ue||qe?_e&wi?ie|Yi:ie&Ur?ie|$n:Ur:qi}});function zr(){Rr.apply(this,arguments),this.pX=null,this.pY=null}W(zr,Rr,{defaults:{event:"pan",threshold:10,pointers:1,direction:jo},getTouchAction:function(){var K=this.options.direction,ie=[];return K&Oe&&ie.push(hi),K&is&&ie.push(Qt),ie},directionTest:function(K){var ie=this.options,_e=!0,Ue=K.distance,qe=K.direction,Ct=K.deltaX,qt=K.deltaY;return qe&ie.direction||(ie.direction&Oe?(qe=Ct===0?Gn:Ct<0?ts:ps,_e=Ct!=this.pX,Ue=Math.abs(K.deltaX)):(qe=qt===0?Gn:qt<0?fs:Ws,_e=qt!=this.pY,Ue=Math.abs(K.deltaY))),K.direction=qe,_e&&Ue>ie.threshold&&qe&ie.direction},attrTest:function(K){return Rr.prototype.attrTest.call(this,K)&&(this.state&Ur||!(this.state&Ur)&&this.directionTest(K))},emit:function(K){this.pX=K.deltaX,this.pY=K.deltaY;var ie=Hn(K.direction);ie&&(K.additionalEvent=this.options.event+ie),this._super.emit.call(this,K)}});function Fi(){Rr.apply(this,arguments)}W(Fi,Rr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Dt]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.scale-1)>this.options.threshold||this.state&Ur)},emit:function(K){if(K.scale!==1){var ie=K.scale<1?"in":"out";K.additionalEvent=this.options.event+ie}this._super.emit.call(this,K)}});function Ho(){Wi.apply(this,arguments),this._timer=null,this._input=null}W(Ho,Wi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Vi]},process:function(K){var ie=this.options,_e=K.pointers.length===ie.pointers,Ue=K.distance<ie.threshold,qe=K.deltaTime>ie.time;if(this._input=K,!Ue||!_e||K.eventType&(wi|Zi)&&!qe)this.reset();else if(K.eventType&si)this.reset(),this._timer=T(function(){this.state=Hi,this.tryEmit()},ie.time,this);else if(K.eventType&wi)return Hi;return qi},reset:function(){clearTimeout(this._timer)},emit:function(K){this.state===Hi&&(K&&K.eventType&wi?this.manager.emit(this.options.event+"up",K):(this._input.timeStamp=E(),this.manager.emit(this.options.event,this._input)))}});function ss(){Rr.apply(this,arguments)}W(ss,Rr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Dt]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.rotation)>this.options.threshold||this.state&Ur)}});function ya(){Rr.apply(this,arguments)}W(ya,Rr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Oe|is,pointers:1},getTouchAction:function(){return zr.prototype.getTouchAction.call(this)},attrTest:function(K){var ie=this.options.direction,_e;return ie&(Oe|is)?_e=K.overallVelocity:ie&Oe?_e=K.overallVelocityX:ie&is&&(_e=K.overallVelocityY),this._super.attrTest.call(this,K)&&ie&K.offsetDirection&&K.distance>this.options.threshold&&K.maxPointers==this.options.pointers&&y(_e)>this.options.velocity&&K.eventType&wi},emit:function(K){var ie=Hn(K.offsetDirection);ie&&this.manager.emit(this.options.event+ie,K),this.manager.emit(this.options.event,K)}});function jr(){Wi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}W(jr,Wi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ai]},process:function(K){var ie=this.options,_e=K.pointers.length===ie.pointers,Ue=K.distance<ie.threshold,qe=K.deltaTime<ie.time;if(this.reset(),K.eventType&si&&this.count===0)return this.failTimeout();if(Ue&&qe&&_e){if(K.eventType!=wi)return this.failTimeout();var Ct=this.pTime?K.timeStamp-this.pTime<ie.interval:!0,qt=!this.pCenter||rs(this.pCenter,K.center)<ie.posThreshold;this.pTime=K.timeStamp,this.pCenter=K.center,!qt||!Ct?this.count=1:this.count+=1,this._input=K;var Ni=this.count%ie.taps;if(Ni===0)return this.hasRequireFailures()?(this._timer=T(function(){this.state=Hi,this.tryEmit()},ie.interval,this),Ur):Hi}return qi},failTimeout:function(){return this._timer=T(function(){this.state=qi},this.options.interval,this),qi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Hi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function qn(K,ie){return ie=ie||{},ie.recognizers=we(ie.recognizers,qn.defaults.preset),new Js(K,ie)}qn.VERSION="2.0.7",qn.defaults={domEvents:!1,touchAction:jt,enable:!0,inputTarget:null,inputClass:null,preset:[[ss,{enable:!1}],[Fi,{enable:!1},["rotate"]],[ya,{direction:Oe}],[zr,{direction:Oe},["swipe"]],[jr],[jr,{event:"doubletap",taps:2},["tap"]],[Ho]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var il=1,Wn=2;function Js(K,ie){this.options=H({},qn.defaults,ie||{}),this.options.inputTarget=this.options.inputTarget||K,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=K,this.input=Vn(this),this.touchAction=new sr(this,this.options.touchAction),ei(this,!0),D(this.options.recognizers,function(_e){var Ue=this.add(new _e[0](_e[1]));_e[2]&&Ue.recognizeWith(_e[2]),_e[3]&&Ue.requireFailure(_e[3])},this)}Js.prototype={set:function(K){return H(this.options,K),K.touchAction&&this.touchAction.update(),K.inputTarget&&(this.input.destroy(),this.input.target=K.inputTarget,this.input.init()),this},stop:function(K){this.session.stopped=K?Wn:il},recognize:function(K){var ie=this.session;if(!ie.stopped){this.touchAction.preventDefaults(K);var _e,Ue=this.recognizers,qe=ie.curRecognizer;(!qe||qe&&qe.state&Hi)&&(qe=ie.curRecognizer=null);for(var Ct=0;Ct<Ue.length;)_e=Ue[Ct],ie.stopped!==Wn&&(!qe||_e==qe||_e.canRecognizeWith(qe))?_e.recognize(K):_e.reset(),!qe&&_e.state&(Ur|$n|Yi)&&(qe=ie.curRecognizer=_e),Ct++}},get:function(K){if(K instanceof Wi)return K;for(var ie=this.recognizers,_e=0;_e<ie.length;_e++)if(ie[_e].options.event==K)return ie[_e];return null},add:function(K){if(R(K,"add",this))return this;var ie=this.get(K.options.event);return ie&&this.remove(ie),this.recognizers.push(K),K.manager=this,this.touchAction.update(),K},remove:function(K){if(R(K,"remove",this))return this;if(K=this.get(K),K){var ie=this.recognizers,_e=ze(ie,K);_e!==-1&&(ie.splice(_e,1),this.touchAction.update())}return this},on:function(K,ie){if(K!==s&&ie!==s){var _e=this.handlers;return D(Pe(K),function(Ue){_e[Ue]=_e[Ue]||[],_e[Ue].push(ie)}),this}},off:function(K,ie){if(K!==s){var _e=this.handlers;return D(Pe(K),function(Ue){ie?_e[Ue]&&_e[Ue].splice(ze(_e[Ue],ie),1):delete _e[Ue]}),this}},emit:function(K,ie){this.options.domEvents&&wc(K,ie);var _e=this.handlers[K]&&this.handlers[K].slice();if(!(!_e||!_e.length)){ie.type=K,ie.preventDefault=function(){ie.srcEvent.preventDefault()};for(var Ue=0;Ue<_e.length;)_e[Ue](ie),Ue++}},destroy:function(){this.element&&ei(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ei(K,ie){var _e=K.element;if(_e.style){var Ue;D(K.options.cssProps,function(qe,Ct){Ue=Ze(_e.style,Ct),ie?(K.oldCssProps[Ue]=_e.style[Ue],_e.style[Ue]=qe):_e.style[Ue]=K.oldCssProps[Ue]||""}),ie||(K.oldCssProps={})}}function wc(K,ie){var _e=i.createEvent("Event");_e.initEvent(K,!0,!0),_e.gesture=ie,ie.target.dispatchEvent(_e)}H(qn,{INPUT_START:si,INPUT_MOVE:fr,INPUT_END:wi,INPUT_CANCEL:Zi,STATE_POSSIBLE:ti,STATE_BEGAN:Ur,STATE_CHANGED:$n,STATE_ENDED:Yi,STATE_RECOGNIZED:Hi,STATE_CANCELLED:_a,STATE_FAILED:qi,DIRECTION_NONE:Gn,DIRECTION_LEFT:ts,DIRECTION_RIGHT:ps,DIRECTION_UP:fs,DIRECTION_DOWN:Ws,DIRECTION_HORIZONTAL:Oe,DIRECTION_VERTICAL:is,DIRECTION_ALL:jo,Manager:Js,Input:vr,TouchAction:sr,TouchInput:fe,MouseInput:Pt,PointerEventInput:ue,TouchMouseInput:Ye,SingleTouchInput:oe,Recognizer:Wi,AttrRecognizer:Rr,Tap:jr,Pan:zr,Swipe:ya,Pinch:Fi,Rotate:ss,Press:Ho,on:re,off:be,each:D,merge:z,extend:ee,assign:H,inherit:W,bindFn:q,prefixed:Ze});var xc=typeof e<"u"?e:typeof self<"u"?self:{};xc.Hammer=qn,t.exports?t.exports=qn:e[r]=qn})(window,document,"Hammer")})(Pk);var Dm=Pk.exports;const hW=HM(Dm),ra=$M({__proto__:null,default:hW},[Dm]),kk=1,Bk=2,dx=4,dW={mousedown:kk,mousemove:Bk,mouseup:dx};function pW(t,e){for(let i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}function fW(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(pW(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function mW(t){t.prototype.handler=function(e){let i=dW[e.type];i&kk&&e.button>=0&&(this.pressed=!0),i&Bk&&e.buttons===0&&(i=dx),this.pressed&&(i&dx&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}fW(Dm.PointerEventInput);mW(Dm.MouseInput);const gW=Dm.Manager;class P1{constructor(e,i,r){this.element=e,this.callback=i,this.options={enable:!0,...r}}}const _W=ra?[[ra.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ra.Rotate,{enable:!1}],[ra.Pinch,{enable:!1}],[ra.Swipe,{enable:!1}],[ra.Pan,{threshold:0,enable:!1}],[ra.Press,{enable:!1}],[ra.Tap,{event:"doubletap",taps:2,enable:!1}],[ra.Tap,{event:"anytap",enable:!1}],[ra.Tap,{enable:!1}]]:null,AC={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},yW={doubletap:["tap"]},vW={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},yE={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},bW={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},TC={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},wW=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",nd=typeof window<"u"?window:global;let px=!1;try{const t={get passive(){return px=!0,!0}};nd.addEventListener("test",null,t),nd.removeEventListener("test",null)}catch{px=!1}const xW=wW.indexOf("firefox")!==-1,{WHEEL_EVENTS:EW}=yE,SC="wheel",CC=4.000244140625,AW=40,TW=.25;class SW extends P1{constructor(e,i,r){super(e,i,r),this.handleEvent=s=>{if(!this.options.enable)return;let n=s.deltaY;nd.WheelEvent&&(xW&&s.deltaMode===nd.WheelEvent.DOM_DELTA_PIXEL&&(n/=nd.devicePixelRatio),s.deltaMode===nd.WheelEvent.DOM_DELTA_LINE&&(n*=AW)),n!==0&&n%CC===0&&(n=Math.floor(n/CC)),s.shiftKey&&n&&(n=n*TW),this.callback({type:SC,center:{x:s.clientX,y:s.clientY},delta:-n,srcEvent:s,pointerType:"mouse",target:s.target})},this.events=(this.options.events||[]).concat(EW),this.events.forEach(s=>e.addEventListener(s,this.handleEvent,px?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===SC&&(this.options.enable=i)}}const{MOUSE_EVENTS:CW}=yE,IC="pointermove",RC="pointerover",MC="pointerout",PC="pointerenter",kC="pointerleave";class IW extends P1{constructor(e,i,r){super(e,i,r),this.handleEvent=n=>{this.handleOverEvent(n),this.handleOutEvent(n),this.handleEnterEvent(n),this.handleLeaveEvent(n),this.handleMoveEvent(n)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,this.events=(this.options.events||[]).concat(CW),this.events.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===IC&&(this.enableMoveEvent=i),e===RC&&(this.enableOverEvent=i),e===MC&&(this.enableOutEvent=i),e===PC&&(this.enableEnterEvent=i),e===kC&&(this.enableLeaveEvent=i)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(RC,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(MC,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(PC,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(kC,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(IC,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:RW}=yE,BC="keydown",LC="keyup";class MW extends P1{constructor(e,i,r){super(e,i,r),this.handleEvent=s=>{const n=s.target||s.srcElement;n.tagName==="INPUT"&&n.type==="text"||n.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:BC,srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:LC,srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(RW),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===BC&&(this.enableDownEvent=i),e===LC&&(this.enableUpEvent=i)}}const OC="contextmenu";class PW extends P1{constructor(e,i,r){super(e,i,r),this.handleEvent=s=>{this.options.enable&&this.callback({type:OC,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e===OC&&(this.options.enable=i)}}const DC=1,fx=2,FC=4,kW={pointerdown:DC,pointermove:fx,pointerup:FC,mousedown:DC,mousemove:fx,mouseup:FC},BW=0,LW=1,OW=2,DW=1,FW=2,NW=4;function UW(t){const e=kW[t.srcEvent.type];if(!e)return null;const{buttons:i,button:r}=t.srcEvent;let s=!1,n=!1,c=!1;return e===fx?(s=!!(i&DW),n=!!(i&NW),c=!!(i&FW)):(s=r===BW,n=r===LW,c=r===OW),{leftButton:s,middleButton:n,rightButton:c}}function zW(t,e){const i=t.center;if(!i)return null;const r=e.getBoundingClientRect(),s=r.width/e.offsetWidth||1,n=r.height/e.offsetHeight||1,c={x:(i.x-r.left-e.clientLeft)/s,y:(i.y-r.top-e.clientTop)/n};return{center:i,offsetCenter:c}}const lb={srcElement:"root",priority:0};class jW{constructor(e){this.handleEvent=i=>{if(this.isEmpty())return;const r=this._normalizeEvent(i);let s=i.srcEvent.target;for(;s&&s!==r.rootElement;){if(this._emit(r,s),r.handled)return;s=s.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,r,s=!1,n=!1){const{handlers:c,handlersByElement:l}=this;let f=lb;typeof r=="string"||r&&r.addEventListener?f={...lb,srcElement:r}:r&&(f={...lb,...r});let y=l.get(f.srcElement);y||(y=[],l.set(f.srcElement,y));const E={type:e,handler:i,srcElement:f.srcElement,priority:f.priority};s&&(E.once=!0),n&&(E.passive=!0),c.push(E),this._active=this._active||!E.passive;let T=y.length-1;for(;T>=0&&!(y[T].priority>=E.priority);)T--;y.splice(T+1,0,E)}remove(e,i){const{handlers:r,handlersByElement:s}=this;for(let n=r.length-1;n>=0;n--){const c=r[n];if(c.type===e&&c.handler===i){r.splice(n,1);const l=s.get(c.srcElement);l.splice(l.indexOf(c),1),l.length===0&&s.delete(c.srcElement)}}this._active=r.some(n=>!n.passive)}_emit(e,i){const r=this.handlersByElement.get(i);if(r){let s=!1;const n=()=>{e.handled=!0},c=()=>{e.handled=!0,s=!0},l=[];for(let f=0;f<r.length;f++){const{type:y,handler:E,once:T}=r[f];if(E({...e,type:y,stopPropagation:n,stopImmediatePropagation:c}),T&&l.push(r[f]),s)break}for(let f=0;f<l.length;f++){const{type:y,handler:E}=l[f];this.remove(y,E)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...UW(e),...zW(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const GW={events:null,recognizers:null,recognizerOptions:{},Manager:gW,touchAction:"none",tabIndex:0};class VW{constructor(e=null,i){this._onBasicInput=s=>{const{srcEvent:n}=s,c=vW[n.type];c&&this.manager.emit(c,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={...GW,...i},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:i}=this,r=i.Manager;this.manager=new r(e,{touchAction:i.touchAction,recognizers:i.recognizers||_W}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(AC).forEach(s=>{const n=this.manager.get(s);n&&AC[s].forEach(c=>{n.recognizeWith(c)})});for(const s in i.recognizerOptions){const n=this.manager.get(s);if(n){const c=i.recognizerOptions[s];delete c.enable,n.set(c)}}this.wheelInput=new SW(e,this._onOtherEvent,{enable:!1}),this.moveInput=new IW(e,this._onOtherEvent,{enable:!1}),this.keyInput=new MW(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new PW(e,this._onOtherEvent,{enable:!1});for(const[s,n]of this.events)n.isEmpty()||(this._toggleRecognizer(n.recognizerName,!0),this.manager.on(s,n.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,i,r){this._addEventHandler(e,i,r,!1)}once(e,i,r){this._addEventHandler(e,i,r,!0)}watch(e,i,r){this._addEventHandler(e,i,r,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){const{manager:r}=this;if(!r)return;const s=r.get(e);if(s&&s.options.enable!==i){s.set({enable:i});const n=yW[e];n&&!this.options.recognizers&&n.forEach(c=>{const l=r.get(c);i?(l.requireFailure(e),s.dropRequireFailure(c)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,i),this.moveInput.enableEventType(e,i),this.keyInput.enableEventType(e,i),this.contextmenuInput.enableEventType(e,i)}_addEventHandler(e,i,r,s,n){if(typeof e!="string"){r=i;for(const E in e)this._addEventHandler(E,e[E],r,s,n);return}const{manager:c,events:l}=this,f=TC[e]||e;let y=l.get(f);y||(y=new jW(this),l.set(f,y),y.recognizerName=bW[f]||f,c&&c.on(f,y.handleEvent)),y.add(e,i,r,s,n),y.isEmpty()||this._toggleRecognizer(y.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const c in e)this._removeEventHandler(c,e[c]);return}const{events:r}=this,s=TC[e]||e,n=r.get(s);if(n&&(n.remove(e,i),n.isEmpty())){const{recognizerName:c}=n;let l=!1;for(const f of r.values())if(f.recognizerName===c&&!f.isEmpty()){l=!0;break}l||this._toggleRecognizer(c,!1)}}}function Fl(){}const $W=({isDragging:t})=>t?"grabbing":"grab",Lk={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Fl,onWebGLInitialized:Fl,onResize:Fl,onViewStateChange:Fl,onInteractionStateChange:Fl,onBeforeRender:Fl,onAfterRender:Fl,onLoad:Fl,onError:t=>fi.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:$W,getTooltip:null,debug:!1,drawPickingColors:!1};class vm{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Vd({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:s}=this;if(r.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(r.leftButton||r.rightButton)return;{const n=r.offsetCenter;if(!n)return;s.x=n.x,s.y=n.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=r},this._onEvent=r=>{const s=ix[r.type],n=r.offsetCenter;if(!s||!n||!this.layerManager)return;const c=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:c,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:f}=l,y=f&&(f[s.handler]||f.props[s.handler]),E=this.props[s.handler];let T=!1;y&&(T=y.call(f,l,r)),T||(E==null||E(l,r),this.widgetManager.onEvent(l,r))},this._onPointerDown=r=>{const s=r.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo},this.props={...Lk,...e},e=this.props,e.viewState&&e.initialViewState&&fi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&fi.error("WebGL1 context not supported.")(),this.device=ab.attach(e.gl));let i=this.device;i||(t0.registerDevices([ab]),i=t0.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&gm.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,r,s,n,c,l,f,y,E;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(n=this.effectManager)==null||n.finalize(),this.effectManager=null,(c=this.deckRenderer)==null||c.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(f=this.eventManager)==null||f.destroy(),this.eventManager=null,(y=this.widgetManager)==null||y.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((E=this.canvas.parentElement)==null||E.removeChild(this.canvas),this.canvas=null)}setProps(e){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&fi.removed("onLayerHover","onHover")(),"onLayerClick"in e&&fi.removed("onLayerClick","onClick")(),e.initialViewState&&!ko(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),n=this.effectManager.needsRedraw(e),c=this.deckRenderer.needsRedraw(e);return i=i||r||s||n||c,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return Br(this.viewManager),this.viewManager.views}getViewports(e){return Br(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,r){Br(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(i).timeStart();const n=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return s.get(i).timeEnd(),n}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),Br(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:r,height:s}=e;if(r||r===0){const n=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=n}if(s||s===0){const n=Number.isFinite(s)?`${s}px`:s;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){var e,i;const{canvas:r}=this;if(!r)return;const s=r.clientWidth??r.width,n=r.clientHeight??r.height;(s!==this.width||n!==this.height)&&(this.width=s,this.height=n,(e=this.viewManager)==null||e.setProps({width:s,height:n}),(i=this.layerManager)==null||i.activateViewport(this.getViewports()[0]),this.props.onResize({width:s,height:n}))}_createAnimationLoop(e,i){const{gl:r,onError:s,useDevicePixels:n}=i;return new d$({device:e,useDevicePixels:n,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:c=>this._setDevice(c.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new pE({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var e,i,r;const{_pickRequest:s}=this;if(s.event){const{result:n,emptyInfo:c}=this._pick("pickObject","pickObject Time",s);this.cursorState.isHovering=n.length>0;let l=c,f=!1;for(const y of n)l=y,f=((e=y.layer)==null?void 0:e.onHover(y,s.event))||f;f||((r=(i=this.props).onHover)==null||r.call(i,l,s.event),this.widgetManager.onHover(l,s.event)),s.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,r;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof ab&&this.props.onWebGLInitialized(this.device.gl);const s=new sk;s.play(),this.animationLoop.attachTimeline(s),this.eventManager=new VW(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const c in ix)this.eventManager.on(c,this._onEvent);this.viewManager=new k$({timeline:s,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new P$(this.device,{deck:this,stats:this.stats,viewport:n,timeline:s}),this.effectManager=new K$({deck:this,device:this.device}),this.deckRenderer=new Y$(this.device),this.deckPicker=new sH(this.device),this.widgetManager=new aH({deck:this,parentElement:(r=this.canvas)==null?void 0:r.parentElement}),this.widgetManager.addDefault(new cH),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var r;const{device:s,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:s,gl:n});const c={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(r=this.deckRenderer)==null||r.renderLayers(c),c.pass==="screen"&&this.widgetManager.onRedraw({viewports:c.viewports,layers:c.layers}),this.props.onAfterRender({device:s,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),fi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const r=t0.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}vm.defaultProps=Lk;vm.VERSION=D7;function HW(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return m4(t)}}const qW=f4;function E_(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function uu(t){return t.stride||t.size*t.bytesPerElement}function WW(t,e){return t.type===e.type&&t.size===e.size&&uu(t)===uu(e)&&(t.offset||0)===(e.offset||0)}function mx(t,e){e.offset&&fi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=uu(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,n=r*i+s*t.bytesPerElement+(t.offset||0);return{...e,offset:n,stride:i}}function XW(t,e){const i=mx(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class KW{constructor(e,i,r){this._buffer=null,this.device=e,this.id=i.id||"",this.size=i.size||1;const s=i.logicalType||i.type,n=s==="float64";let{defaultValue:c}=i;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let l;n?l="float32":!s&&i.isIndexed?l="uint32":l=s||"float32";let f=HW(s||l);this.doublePrecision=n,n&&i.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...i,defaultType:f,defaultValue:c,logicalType:s,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*uu(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),gm.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,i=null){const r={};if(this.state.constant){const s=this.value;if(i){const n=mx(this.getAccessor(),i),c=n.offset/s.BYTES_PER_ELEMENT,l=n.size||this.size;r[e]=s.subarray(c,c+l)}else r[e]=s}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,i=null){const r=this.getAccessor(),s=[],n={name:this.id,byteStride:uu(r),attributes:s};if(this.doublePrecision){const c=XW(r,i||{});s.push(E_(e,{...r,...c.high}),E_(`${e}64Low`,{...r,...c.low}))}else if(i){const c=mx(r,i);s.push(E_(e,{...r,...c}))}else s.push(E_(e,r));return n}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:r,size:s}=this,n=r*s;if(i&&n&&i.length>=n){const c=new Array(s).fill(1/0),l=new Array(s).fill(-1/0);for(let f=0;f<n;)for(let y=0;y<s;y++){const E=i[f++];E<c[y]&&(c[y]=E),E>l[y]&&(l[y]=E)}e=[c,l]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof yr?r={buffer:e}:r=e;const s={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)s.type="float32";else{const n=qW(r.value);s.type=s.normalized?n.replace("int","norm"):n}s.bytesPerElement=r.value.BYTES_PER_ELEMENT,s.stride=uu(s)}if(i.bounds=null,r.constant){let n=r.value;if(n=this._normalizeValue(n,[],0),this.settings.normalized&&(n=this.normalizeConstant(n)),!(!i.constant||!this._areValuesEqual(n,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(n)?n:new Float32Array(n)}else if(r.buffer){const n=r.buffer;i.externalBuffer=n,i.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let n=r.value;i.externalBuffer=null,i.constant=!1,this.value=n;let{buffer:c}=this;const l=uu(s),f=(s.vertexOffset||0)*l;if(this.doublePrecision&&n instanceof Float64Array&&(n=Xv(n,s)),this.settings.isIndexed){const E=this.settings.defaultType;n.constructor!==E&&(n=new E(n))}const y=n.byteLength+f+l*2;(!c||c.byteLength<y)&&(c=this._createBuffer(y)),c.write(n,f)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:r=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?Xv(i,{size:this.size,startIndex:r,endIndex:s}):i.subarray(r,s),r*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,i=!1){const{state:r}=this,s=r.allocatedValue,n=gm.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=n;const{byteOffset:c}=this;let{buffer:l}=this;return(!l||l.byteLength<n.byteLength+c)&&(l=this._createBuffer(n.byteLength+c),i&&s&&l.write(s instanceof Float64Array?Xv(s,this):s,c)),r.allocatedValue=n,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=i.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof r)&&this.settings.normalized&&!("normalized"in e)&&fi.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(i=>i/255);case"unorm16":return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,r){const{defaultValue:s,size:n}=this.settings;if(Number.isFinite(e))return i[r]=e,i;if(!e){let c=n;for(;--c>=0;)i[r+c]=s[c];return i}switch(n){case 4:i[r+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:i[r+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:i[r+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:i[r+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let c=n;for(;--c>=0;)i[r+c]=Number.isFinite(e[c])?e[c]:s[c]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:r}=this;for(let s=0;s<r;s++)if(e[s]!==i[s])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:r,type:s}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:r?yr.INDEX:yr.VERTEX,indexType:r?s:void 0,byteLength:e}),this._buffer}}const NC=[],UC=[];function Ok(t,e=0,i=1/0){let r=NC;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(UC.length=t.length,r=UC):r=NC,(e>0||Number.isFinite(i))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,i),s.index=e-1),{iterable:r,objectInfo:s}}function Dk(t){return t&&t[Symbol.asyncIterator]}function JW(t,e){const{size:i,stride:r,offset:s,startIndices:n,nested:c}=e,l=t.BYTES_PER_ELEMENT,f=r?r/l:i,y=s?s/l:0,E=Math.floor((t.length-y)/f);return(T,{index:R,target:D})=>{if(!n){const z=R*f+y;for(let W=0;W<i;W++)D[W]=t[z+W];return D}const V=n[R],H=n[R+1]||E;let ee;if(c){ee=new Array(H-V);for(let z=V;z<H;z++){const W=z*f+y;D=new Array(i);for(let q=0;q<i;q++)D[q]=t[W+q];ee[z-V]=D}}else if(f===i)ee=t.subarray(V*i+y,H*i+y);else{ee=new t.constructor((H-V)*i);let z=0;for(let W=V;W<H;W++){const q=W*f+y;for(let ce=0;ce<i;ce++)ee[z++]=t[q+ce]}}return ee}}const ZW=[],n0=[[0,1/0]];function YW(t,e){if(t===n0||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],r=t.length;let s=0;for(let n=0;n<r;n++){const c=t[n];c[1]<e[0]?(i.push(c),s=n+1):c[0]>e[1]?i.push(c):e=[Math.min(c[0],e[0]),Math.max(c[1],e[1])]}return i.splice(s,0,e),i}const QW={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function Fk(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...QW[i],...e,...t,type:i}}class Nk extends KW{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:n0}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var i;(i=this.state).layoutChanged||(i.layoutChanged=!WW(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,r=this.settings.transition,s=Array.isArray(i)?e[i.find(n=>e[n])]:e[i];return Fk(s,r)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:r=0,endRow:s=1/0}=i;this.state.updateRanges=YW(this.state.updateRanges,[r,s])}else this.state.updateRanges=n0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=ZW}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,i.updateRanges!==n0),!0):!1}updateBuffer({numInstances:e,data:i,props:r,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:n},settings:{update:c,noAlloc:l}}=this;let f=!0;if(c){for(const[y,E]of n)c.call(s,this,{data:i,startRow:y,endRow:E,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[y,E]of n){const T=Number.isFinite(y)?this.getVertexOffset(y):0,R=Number.isFinite(E)?this.getVertexOffset(E):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:T,endOffset:R})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:r,settings:s}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),s.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const n=e;Br(ArrayBuffer.isView(n.value),`invalid ${s.accessor}`);const c=!!n.size&&n.size!==this.size;return r.binaryAccessor=JW(n.value,{size:n.size||this.size,stride:n.stride,offset:n.offset,startIndices:i,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,i=super.getValue();if(!e)return i;for(const r in e)Object.assign(i,super.getValue(r,e[r]));return i}getBufferLayout(e){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=s??"vertex",!i)return r;for(const n in i){const c=super._getBufferLayout(n,i[n]);r.attributes.push(...c.attributes)}return r}_autoUpdater(e,{data:i,startRow:r,endRow:s,props:n,numInstances:c}){if(e.constant)return;const{settings:l,state:f,value:y,size:E,startIndices:T}=e,{accessor:R,transform:D}=l,V=f.binaryAccessor||(typeof R=="function"?R:n[R]);Br(typeof V=="function",`accessor "${R}" is not a function`);let H=e.getVertexOffset(r);const{iterable:ee,objectInfo:z}=Ok(i,r,s);for(const W of ee){z.index++;let q=V(W,z);if(D&&(q=D.call(this,q)),T){const ce=(z.index<T.length-1?T[z.index+1]:c)-T[z.index];if(q&&Array.isArray(q[0])){let we=H;for(const re of q)e._normalizeValue(re,y,we),we+=E}else q&&q.length>E?y.set(q,H):(e._normalizeValue(q,z.target,0),S$({target:y,source:z.target,start:H,count:ce}));H+=ce*E}else e._normalizeValue(q,y,H),H+=E}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let r=!0;switch(i){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function cb(t){const{source:e,target:i,start:r=0,size:s,getData:n}=t,c=t.end||i.length,l=e.length,f=c-r;if(l>f){i.set(e.subarray(0,f),r);return}if(i.set(e,r),!n)return;let y=l;for(;y<f;){const E=n(y,e);for(let T=0;T<s;T++)i[r+y]=E[T]||0,y++}}function eX({source:t,target:e,size:i,getData:r,sourceStartIndices:s,targetStartIndices:n}){if(!s||!n)return cb({source:t,target:e,size:i,getData:r}),e;let c=0,l=0;const f=r&&((E,T)=>r(E+l,T)),y=Math.min(s.length,n.length);for(let E=1;E<y;E++){const T=s[E]*i,R=n[E]*i;cb({source:t.subarray(c,T),target:e,start:l,end:R,size:i,getData:f}),c=T,l=R}return l<e.length&&cb({source:[],target:e,start:l,size:i,getData:f}),e}function tX(t){const{device:e,settings:i,value:r}=t,s=new Nk(e,i);return s.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),s}function Uk(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function zk(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function jk(t){t.push(t.shift())}function iX(t,e){const{doublePrecision:i,settings:r,value:s,size:n}=t,c=i&&s instanceof Float64Array?2:1;let l=0;const{shaderAttributes:f}=t.settings;if(f)for(const y of Object.values(f))l=Math.max(l,y.vertexOffset??0);return(r.noAlloc?s.length:(e+l)*n)*c}function Gk({device:t,source:e,target:i}){return(!i||i.byteLength<e.byteLength)&&(i==null||i.destroy(),i=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),i}function Vk({device:t,buffer:e,attribute:i,fromLength:r,toLength:s,fromStartIndices:n,getData:c=l=>l}){const l=i.doublePrecision&&i.value instanceof Float64Array?2:1,f=i.size*l,y=i.byteOffset,E=i.settings.bytesPerElement<4?y/i.settings.bytesPerElement*4:y,T=i.startIndices,R=n&&T,D=i.isConstant;if(!R&&e&&r>=s)return e;const V=i.value instanceof Float64Array?Float32Array:i.value.constructor,H=D?i.value:new V(i.getBuffer().readSyncWebGL(y,s*V.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!D){const q=c;c=(ce,we)=>i.normalizeConstant(q(ce,we))}const ee=D?(q,ce)=>c(H,ce):(q,ce)=>c(H.subarray(q+y,q+y+f),ce),z=e?new Float32Array(e.readSyncWebGL(E,r*4).buffer):new Float32Array(0),W=new Float32Array(s);return eX({source:z,target:W,sourceStartIndices:n,targetStartIndices:T,size:f,getData:ee}),(!e||e.byteLength<W.byteLength+E)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:W.byteLength+E,usage:35050})),e.write(W,E),e}class $k{constructor({device:e,attribute:i,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new I1(r),this.attribute=i,this.attributeInTransition=tX(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,i,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=iX(this.attribute,i),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class rX extends $k{constructor({device:e,attribute:i,timeline:r}){super({device:e,attribute:i,timeline:r}),this.type="interpolation",this.transform=oX(e,i)}start(e,i){const r=this.currentLength,s=this.currentStartIndices;if(super.start(e,i,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:n,attribute:c}=this;jk(n),n[0]=Vk({device:this.device,buffer:n[0],attribute:c,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),n[1]=Gk({device:this.device,source:n[0],target:n[1]}),this.setBuffer(n[1]);const{transform:l}=this,f=l.model;let y=Math.floor(this.currentLength/c.size);Hk(c)&&(y/=2),f.setVertexCount(y),c.isConstant?(f.setAttributes({aFrom:n[0]}),f.setConstantAttributes({aTo:c.value})):f.setAttributes({aFrom:n[0],aTo:c.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:n[1]})}onUpdate(){const{duration:e,easing:i}=this.settings,{time:r}=this.transition;let s=r/e;i&&(s=i(s));const{model:n}=this.transform;n.setUniforms({time:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const sX=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,nX=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Hk(t){return t.doublePrecision&&t.value instanceof Float64Array}function oX(t,e){const i=e.size,r=Uk(i),s=zk(i),n=e.getBufferLayout();return Hk(e)?new _m(t,{vs:nX,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*i}]}],modules:[gj],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new _m(t,{vs:sX,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:n.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class aX extends $k{constructor({device:e,attribute:i,timeline:r}){super({device:e,attribute:i,timeline:r}),this.type="spring",this.texture=hX(e),this.framebuffer=dX(e,this.texture),this.transform=uX(e,i)}start(e,i){const r=this.currentLength,s=this.currentStartIndices;super.start(e,i);const{buffers:n,attribute:c}=this;for(let f=0;f<2;f++)n[f]=Vk({device:this.device,buffer:n[f],attribute:c,fromLength:r,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});n[2]=Gk({device:this.device,source:n[0],target:n[2]}),this.setBuffer(n[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/c.size)),c.isConstant?l.setConstantAttributes({aTo:c.value}):l.setAttributes({aTo:c.getBuffer()})}onUpdate(){const{buffers:e,transform:i,framebuffer:r,transition:s}=this,n=this.settings;i.model.setAttributes({aPrev:e[0],aCur:e[1]}),i.transformFeedback.setBuffers({vNext:e[2]}),i.model.setUniforms({stiffness:n.stiffness,damping:n.damping}),i.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),jk(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const lX=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,cX=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function uX(t,e){const i=Uk(e.size),r=zk(e.size);return new _m(t,{vs:lX,fs:cX,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function hX(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function dX(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const pX={interpolation:rX,spring:aX};class fX{constructor(e,{id:i,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:r}){this.numInstances=r||1;for(const s in e){const n=e[s],c=n.getTransitionSetting(i);c&&this._updateAttribute(s,n,c)}for(const s in this.transitions){const n=e[s];(!n||!n.getTransitionSetting(i))&&this._removeTransition(s)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const r=this.transitions[i];r.inProgress&&(e[i]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,i,r){const s=this.transitions[e];let n=!s||s.type!==r.type;if(n){s&&this._removeTransition(e);const c=pX[r.type];c?this.transitions[e]=new c({attribute:i,timeline:this.timeline,device:this.device}):(fi.error(`unsupported transition type '${r.type}'`)(),n=!1)}(n||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const zC="attributeManager.invalidate",mX="attributeManager.updateStart",gX="attributeManager.updateEnd",_X="attribute.updateStart",yX="attribute.allocate",vX="attribute.updateEnd";class bX{constructor(e,{id:i="attribute-manager",stats:r,timeline:s}={}){this.mergeBoundsMemoized=Lm(t$),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new fX(e,{id:`${i}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const r=this._invalidateTrigger(e,i);Rs(zC,this,e,r)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Rs(zC,this,"all")}update({data:e,numInstances:i,startIndices:r=null,transitions:s,props:n={},buffers:c={},context:l={}}){let f=!1;Rs(mX,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const y in this.attributes){const E=this.attributes[y],T=E.settings.accessor;E.startIndices=r,E.numInstances=i,n[y]&&fi.removed(`props.${y}`,`data.attributes.${y}`)(),E.setExternalBuffer(c[y])||E.setBinaryValue(typeof T=="string"?c[T]:void 0,e.startIndices)||typeof T=="string"&&!c[T]&&E.setConstantValue(n[T])||E.needsUpdate()&&(f=!0,this._updateAttribute({attribute:E,numInstances:i,data:e,props:n,context:l})),this.needsRedraw=this.needsRedraw||E.needsRedraw()}f&&Rs(gX,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const i=e.map(r=>{var s;return(s=this.attributes[r])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:r}=this,s={...r.getAttributes()};for(const n in i){const c=i[n];c.needsRedraw(e)&&!r.hasAttribute(n)&&(s[n]=c)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(e))}_add(e,i){for(const r in e){const s=e[r],n={...s,id:r,size:s.isIndexed&&1||s.size||1,...i};this.attributes[r]=new Nk(this.device,n)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:r,updateTriggers:s}=this,n=s[e];return n&&n.forEach(c=>{const l=r[c];l&&l.setNeedsUpdate(l.id,i)}),n}_updateAttribute(e){const{attribute:i,numInstances:r}=e;if(Rs(_X,i),i.constant){i.setConstantValue(i.value);return}i.allocate(r)&&Rs(yX,i,r),i.updateBuffer(e)&&(this.needsRedraw=!0,Rs(vX,i,r))}}class wX extends I1{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:r,duration:s,easing:n}}=this,c=n(e/s);this._value=$0(i,r,c)}}const jC=1e-5;function GC(t,e,i,r,s){const n=e-t,c=(i-e)*s,l=-n*r;return c+l+n+e}function xX(t,e,i,r,s){if(Array.isArray(i)){const n=[];for(let c=0;c<i.length;c++)n[c]=GC(t[c],e[c],i[c],r,s);return n}return GC(t,e,i,r,s)}function VC(t,e){if(Array.isArray(t)){let i=0;for(let r=0;r<t.length;r++){const s=t[r]-e[r];i+=s*s}return Math.sqrt(i)}return Math.abs(t-e)}class EX extends I1{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:r,stiffness:s}=this.settings,{_prevValue:n=e,_currValue:c=e}=this;let l=xX(n,c,i,r,s);const f=VC(l,i),y=VC(l,c);f<jC&&y<jC&&(l=i,this.end()),this._prevValue=c,this._currValue=l}}const AX={interpolation:wX,spring:EX};class TX{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,r,s){const{transitions:n}=this;if(n.has(e)){const f=n.get(e),{value:y=f.settings.fromValue}=f;i=y,this.remove(e)}if(s=Fk(s),!s)return;const c=AX[s.type];if(!c){fi.error(`unsupported transition type '${s.type}'`)();return}const l=new c(this.timeline);l.start({...s,fromValue:i,toValue:r}),n.set(e,l)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,r]of this.transitions)r.update(),e[i]=r.value,r.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function SX(t){const e=t[lc];for(const i in e){const r=e[i],{validate:s}=r;if(s&&!s(t[i],r))throw new Error(`Invalid prop ${i}: ${t[i]}`)}}function CX(t,e){const i=qk({newProps:t,oldProps:e,propTypes:t[lc],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=RX(t,e);let s=!1;return r||(s=MX(t,e)),{dataChanged:r,propsChanged:i,updateTriggersChanged:s,extensionsChanged:PX(t,e),transitionsChanged:IX(t,e)}}function IX(t,e){if(!t.transitions)return!1;const i={},r=t[lc];let s=!1;for(const n in t.transitions){const c=r[n],l=c&&c.type;(l==="number"||l==="color"||l==="array")&&gx(t[n],e[n],c)&&(i[n]=!0,s=!0)}return s?i:!1}function qk({newProps:t,oldProps:e,ignoreProps:i={},propTypes:r={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const n of Object.keys(t))if(!(n in i)){if(!(n in e))return`${s}.${n} added`;const c=gx(t[n],e[n],r[n]);if(c)return`${s}.${n} ${c}`}for(const n of Object.keys(e))if(!(n in i)){if(!(n in t))return`${s}.${n} dropped`;if(!Object.hasOwnProperty.call(t,n)){const c=gx(t[n],e[n],r[n]);if(c)return`${s}.${n} ${c}`}}return!1}function gx(t,e,i){let r=i&&i.equal;return r&&!r(t,e,i)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function RX(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:r,_dataDiff:s}=t;return r?r(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&s&&(i=s(t.data,e.data)||i),i}function MX(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&$C(t,e,"all"))return{all:!0};const i={};let r=!1;for(const s in t.updateTriggers)s!=="all"&&$C(t,e,s)&&(i[s]=!0,r=!0);return r?i:!1}function PX(t,e){if(e===null)return!0;const i=e.extensions,{extensions:r}=t;if(r===i)return!1;if(!i||!r||r.length!==i.length)return!0;for(let s=0;s<r.length;s++)if(!r[s].equals(i[s]))return!0;return!1}function $C(t,e,i){let r=t.updateTriggers[i];r=r??{};let s=e.updateTriggers[i];return s=s??{},qk({oldProps:s,newProps:r,triggerName:i})}const kX="count(): argument not an object",BX="count(): argument not a container";function LX(t){if(!DX(t))throw new Error(kX);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(OX(t))return Object.keys(t).length;throw new Error(BX)}function OX(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function DX(t){return t!==null&&typeof t=="object"}function HC(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=i.modules.findIndex(s=>s.name==="project32");r>=0&&i.modules.splice(r,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const r={...t.inject};for(const s in e.inject)r[s]=(r[s]||"")+e.inject[s];i.inject=r}return i}const FX={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},_x={};function NX(t,e,i,r){if(i instanceof Mo)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let s=null;i.compressed&&(s={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const n=e.createTexture({...i,sampler:{...FX,...s,...r}});return _x[n.id]=t,n}function UX(t,e){!e||!(e instanceof Mo)||_x[e.id]===t&&(e.delete(),delete _x[e.id])}const zX={boolean:{validate(t,e){return!0},equal(t,e,i){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||yx(t)&&(t.length===3||t.length===4)},equal(t,e,i){return ko(t,e,1)}},accessor:{validate(t,e){const i=Z0(t);return i==="function"||i===Z0(e.value)},equal(t,e,i){return typeof e=="function"?!0:ko(t,e,1)}},array:{validate(t,e){return e.optional&&!t||yx(t)},equal(t,e,i){const{compare:r}=i,s=Number.isInteger(r)?r:r?1:0;return r?ko(t,e,s):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:r}=i,s=Number.isInteger(r)?r:r?1:0;return r?ko(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{if(!t)return t;const{dataTransform:r}=i.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,i)=>{const r=i.context;return!r||!r.device?null:NX(i.id,r.device,t,{...e.parameters,...i.props.textureParameters})},release:(t,e,i)=>{UX(i.id,t)}}};function jX(t){const e={},i={},r={};for(const[s,n]of Object.entries(t)){const c=n==null?void 0:n.deprecatedFor;if(c)r[s]=Array.isArray(c)?c:[c];else{const l=GX(s,n);e[s]=l,i[s]=l.value}}return{propTypes:e,defaultProps:i,deprecatedProps:r}}function GX(t,e){switch(Z0(e)){case"object":return hf(t,e);case"array":return hf(t,{type:"array",value:e,compare:!1});case"boolean":return hf(t,{type:"boolean",value:e});case"number":return hf(t,{type:"number",value:e});case"function":return hf(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function hf(t,e){return"type"in e?{name:t,...zX[e.type],...e}:"value"in e?{name:t,type:Z0(e.value),...e}:{name:t,type:"object",value:e}}function yx(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Z0(t){return yx(t)?"array":t===null?"null":typeof t}function VX(t,e){let i;for(let n=e.length-1;n>=0;n--){const c=e[n];"extensions"in c&&(i=c.extensions)}const r=vx(t.constructor,i),s=Object.create(r);s[K0]=t,s[Eu]={},s[Zl]={};for(let n=0;n<e.length;++n){const c=e[n];for(const l in c)s[l]=c[l]}return Object.freeze(s),s}const $X="_mergedDefaultProps";function vx(t,e){if(!(t instanceof k1.constructor))return{};let i=$X;if(e)for(const s of e){const n=s.constructor;n&&(i+=`:${n.extensionName||n.name}`)}return Wk(t,i)||(t[i]=HX(t,e||[]))}function HX(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),r=vx(i),s=Wk(t,"defaultProps")||{},n=jX(s),c=Object.assign(Object.create(null),r,n.defaultProps),l=Object.assign(Object.create(null),r==null?void 0:r[lc],n.propTypes),f=Object.assign(Object.create(null),r==null?void 0:r[Zv],n.deprecatedProps);for(const y of e){const E=vx(y.constructor);E&&(Object.assign(c,E),Object.assign(l,E[lc]),Object.assign(f,E[Zv]))}return qX(c,t),XX(c,l),WX(c,f),c[lc]=l,c[Zv]=f,e.length===0&&!vE(t,"_propTypes")&&(t._propTypes=l),c}function qX(t,e){const i=JX(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function WX(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(r){const s=`${this.id}: ${i}`;for(const n of e[i])vE(this,n)||(this[n]=r);fi.deprecated(s,e[i].join("/"))()}})}function XX(t,e){const i={},r={};for(const s in e){const n=e[s],{name:c,value:l}=n;n.async&&(i[c]=l,r[c]=KX(c))}t[vd]=i,t[Eu]={},Object.defineProperties(t,r)}function KX(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Dk(e)?this[Eu][t]=e:this[Zl][t]=e},get(){if(this[Zl]){if(t in this[Zl])return this[Zl][t]||this[vd][t];if(t in this[Eu]){const e=this[K0]&&this[K0].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[vd][t]}}return this[vd][t]}}}function vE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Wk(t,e){return vE(t,e)&&t[e]}function JX(t){const e=t.componentName;return e||fi.warn(`${t.name}.componentName not specified`)(),e||t.name}let ZX=0;class k1{constructor(...e){this.props=VX(this,e),this.id=this.props.id,this.count=ZX++}clone(e){const{props:i}=this,r={};for(const s in i[vd])s in i[Zl]?r[s]=i[Zl][s]:s in i[Eu]&&(r[s]=i[Eu][s]);return new this.constructor({...i,...r,...e})}}k1.componentName="Component";k1.defaultProps={};const YX=Object.freeze({});class QX{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||YX}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[K0]||this.component;const i=e[Zl]||{},r=e[Eu]||e,s=e[vd]||{};for(const n in i){const c=i[n];this._createAsyncPropData(n,s[n]),this._updateAsyncProp(n,c),i[n]=this.getAsyncProp(n)}for(const n in r){const c=r[n];this._createAsyncPropData(n,s[n]),this._updateAsyncProp(n,c)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(Dk(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const r=this.asyncProps[e];return i===r.resolvedValue||i===r.lastValue?!1:(r.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(i=this._postProcessValue(r,i),r.resolvedValue=i,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,i,r){const s=this.asyncProps[e];s&&r>=s.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=i,s.resolvedLoadCount=r,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const s=r.pendingLoadCount;i.then(n=>{this.component&&(n=this._postProcessValue(r,n),this._setAsyncPropValue(e,n,s),this._onResolve(e,n))}).catch(n=>{this._onError(e,n)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const s=r.pendingLoadCount;let n=[],c=0;for await(const l of i){if(!this.component)return;const{dataTransform:f}=this.component.props;f?n=f(l,n):n=n.concat(l),Object.defineProperty(n,"__diff",{enumerable:!1,value:[{startRow:c,endRow:n.length}]}),c=n.length,this._setAsyncPropValue(e,n,s)}this._onResolve(e,n)}_postProcessValue(e,i){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(i,r,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const r=this.component&&this.component.props[lc];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class eK extends QX{constructor({attributeManager:e,layer:i}){super(i),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const r=this.layer,s=r==null?void 0:r.props.fetch;return s?s(i,{propName:e,layer:r}):super._fetch(e,i)}_onResolve(e,i){const r=this.layer;if(r){const s=r.props.onDataLoad;e==="data"&&s&&s(i,{propName:e,layer:r})}}_onError(e,i){const r=this.layer;r&&r.raiseError(i,`loading ${e} of ${this.layer}`)}}const tK="layer.changeFlag",iK="layer.initialize",rK="layer.update",sK="layer.finalize",nK="layer.matched",qC=2**24-1,oK=Object.freeze([]),aK=Lm(({oldViewport:t,viewport:e})=>t.equals(e));let sa=new Uint8ClampedArray(0);const lK={data:{type:"data",value:oK,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:r,loadOptions:s,signal:n})=>{const{resourceManager:c}=i.context;s=s||i.getLoadOptions(),r=r||i.props.loaders,n&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:n}});let l=c.contains(t);return!l&&!s&&(c.add({resourceId:t,data:dc(t,r),persistent:!1}),l=!0),l?c.subscribe({resourceId:t,onChange:f=>{var y;return(y=i.internalState)==null?void 0:y.reloadAsyncProp(e,f)},consumerId:i.id,requestId:e}):dc(t,r,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:li.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Hd extends k1{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Nh.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Br(this.internalState);const i=this.internalState.viewport||this.context.viewport,r=rk(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,n,c]=ek(r,i.pixelProjectionMatrix);return e.length===2?[s,n]:[s,n,c]}unproject(e){return Br(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){Br(this.internalState);const r=this.internalState.viewport||this.context.viewport;return a$(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const i of this.getModels())i.updateModuleSettings(e)}setShaderModuleProps(...e){for(const i of this.getModels())i.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===li.DEFAULT||e===li.LNGLAT||e===li.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){Br(e instanceof Uint8Array);const[i,r,s]=e;return i+r*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:LX(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=HC(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)e=HC(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&i)if(Array.isArray(r))for(const s of r)i.invalidateAll(s);else i.invalidateAll();if(i){const{props:s}=e,n=this.internalState.hasPickingBuffer,c=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(n!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:l,instancePickingColors:f}=i.attributes,y=l||f;y&&(c&&y.constant&&(y.constant=!1,i.invalidate(y.id)),!y.value&&!c&&(y.constant=!0,y.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e)}getPickingInfo({info:e,mode:i,sourceLayer:r}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,i){var r,s,n,c;i&&(e=new Error(`${i}: ${e.message}`,{cause:e})),(s=(r=this.props).onError)!=null&&s.call(r,e)||(c=(n=this.context)==null?void 0:n.onError)==null||c.call(n,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!aK({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){let i=!1;for(const r in e)e[r].layoutChanged()&&(i=!0);for(const r of this.getModels())this._setModelAttributes(r,e,i)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,r=this.getNumInstances(),s=this.getStartIndices();e.update({data:i.data,numInstances:r,startIndices:s,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const n=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(n)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),r=Object.create(this.props);for(const s in i)Object.defineProperty(r,s,{value:i[s]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const r=Math.floor(sa.length/4);if(this.internalState.usesPickingColorCache=!0,r<i){i>qC&&fi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),sa=gm.allocate(sa,i,{size:4,copy:!0,maxCount:Math.max(i,qC)});const s=Math.floor(sa.length/4),n=[];for(let c=r;c<s;c++)this.encodePickingColor(c,n),sa[c*4+0]=n[0],sa[c*4+1]=n[1],sa[c*4+2]=n[2]}e.value=sa.subarray(0,i*4)}_setModelAttributes(e,i,r=!1){var s;if(!Object.keys(i).length)return;if(r){const f=this.getAttributeManager();e.setBufferLayout(f.getBufferLayouts(e)),i=f.getAttributes()}const n=((s=e.userData)==null?void 0:s.excludeAttributes)||{},c={},l={};for(const f in i){if(n[f])continue;const y=i[f].getValue();for(const E in y){const T=y[E];T instanceof yr?i[f].settings.isIndexed?e.setIndexBuffer(T):c[E]=T:T&&(l[E]=T)}}e.setAttributes(c),e.setConstantAttributes(l)}disablePickingIndex(e){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:s}=this.getAttributeManager().attributes,n=r||s,c=n&&i.attributes&&i.attributes[n.id];if(c&&c.value){const l=c.value,f=this.encodePickingColor(e);for(let y=0;y<i.length;y++){const E=n.getVertexOffset(y);l[E]===f[0]&&l[E+1]===f[1]&&l[E+2]===f[2]&&this._disablePickingIndex(y)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,s=i||r;if(!s)return;const n=s.getVertexOffset(e),c=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(c-n),n)}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,r=e||i;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==sa.buffer&&(r.value=sa.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Br(!this.internalState),Br(Number.isFinite(this.props.coordinateSystem)),Rs(iK,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new eK({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(fi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new TX(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Rs(nK,this,this===e);const{state:i,internalState:r}=e;this!==e&&(this.internalState=r,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Rs(rK,this,e),!e)return;const i=this.props,r=this.context,s=this.internalState,n=r.viewport,c=this._updateUniformTransition();s.propsInTransition=c,r.viewport=s.viewport||n,this.props=c;try{const l=this._getUpdateParams(),f=this.getModels();if(r.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const E of this.props.extensions)E.updateState.call(this,l,E);const y=this.getModels()[0]!==f[0];this._postUpdate(l,y)}finally{r.viewport=n,this.props=i,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Rs(sK,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:i=null,uniforms:r={},parameters:s={}}){this._updateAttributeTransition();const n=this.props,c=this.context;this.props=this.internalState.propsInTransition||n;const l=this.props.opacity;r.opacity=Math.pow(l,1/2.2);try{if(i){const{isActive:E,isAttribute:T}=i.picking;this.setModuleParameters(i),this.setShaderModuleProps({picking:{isActive:E,isAttribute:T}})}const{getPolygonOffset:f}=this.props,y=f&&f(r)||[0,0];c.device.setParametersWebGL({polygonOffset:y});for(const E of this.getModels())E.setParameters(s);c.device.withParametersWebGL(s,()=>{const E={renderPass:e,moduleParameters:i,uniforms:r,parameters:s,context:c};for(const T of this.props.extensions)T.draw.call(this,E,T);this.draw(E)})}finally{this.props=n}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const s in e)if(e[s]){let n=!1;switch(s){case"dataChanged":const c=e[s],l=i[s];c&&Array.isArray(l)&&(i.dataChanged=Array.isArray(c)?l.concat(c):c,n=!0);default:i[s]||(i[s]=e[s],n=!0)}n&&Rs(tK,this,s,e)}const r=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=r,i.somethingChanged=r||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){var r;const s=CX(e,i);if(s.updateTriggersChanged)for(const n in s.updateTriggersChanged)s.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(s.transitionsChanged)for(const n in s.transitionsChanged)this.internalState.uniformTransitions.add(n,i[n],e[n],(r=e.transitions)==null?void 0:r[n]);return this.setChangeFlags(s)}validateProps(){SX(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(i.highlightColor=r(e)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new bX(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:r,oldProps:s}=e;this.setNeedsRedraw(),this._updateAttributes();const n=this.state.model;n!=null&&n.isInstanced&&n.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:l,highlightColor:f}=r;if(i||s.autoHighlight!==c||s.highlightedObjectIndex!==l||s.highlightColor!==f){const y={};Array.isArray(f)&&(y.highlightColor=f),(i||s.autoHighlight!==c||l!==s.highlightedObjectIndex)&&(y.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:y})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),s=r?r.getNeedsRedraw(e):!1;if(i=i||s,i)for(const n of this.props.extensions)n.onNeedsRedraw.call(this,n);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Hd.defaultProps=lK;Hd.layerName="Layer";const cK="compositeLayer.renderLayers";class Xk extends Hd{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:i}=e;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(e.object=i.__source.object,e.index=i.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,i){return i&&i.length}getSubLayerClass(e,i){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||i}getSubLayerRow(e,i,r){return e.__source={parent:this,object:i,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const i={index:-1,data:this.props.data,target:[]};return(r,s)=>r&&r.__source?(i.index=r.__source.index,e(r.__source.object,i)):e(r,s)}return e}getSubLayerProps(e={}){var i;const{opacity:r,pickable:s,visible:n,parameters:c,getPolygonOffset:l,highlightedObjectIndex:f,autoHighlight:y,highlightColor:E,coordinateSystem:T,coordinateOrigin:R,wrapLongitude:D,positionFormat:V,modelMatrix:H,extensions:ee,fetch:z,operation:W,_subLayerProps:q}=this.props,ce={id:"",updateTriggers:{},opacity:r,pickable:s,visible:n,parameters:c,getPolygonOffset:l,highlightedObjectIndex:f,autoHighlight:y,highlightColor:E,coordinateSystem:T,coordinateOrigin:R,wrapLongitude:D,positionFormat:V,modelMatrix:H,extensions:ee,fetch:z,operation:W},we=q&&e.id&&q[e.id],re=we&&we.updateTriggers,be=e.id||"sublayer";if(we){const me=this.props[lc],Te=e.type?e.type._propTypes:{};for(const Pe in we){const ze=Te[Pe]||me[Pe];ze&&ze.type==="accessor"&&(we[Pe]=this.getSubLayerAccessor(we[Pe]))}}Object.assign(ce,e,we),ce.id=`${this.props.id}-${be}`,ce.updateTriggers={all:(i=this.props.updateTriggers)==null?void 0:i.all,...e.updateTriggers,...re};for(const me of ee){const Te=me.getSubLayerProps.call(this,me);Te&&Object.assign(ce,Te,{updateTriggers:Object.assign(ce.updateTriggers,Te.updateTriggers)})}return ce}_updateAutoHighlight(e){for(const i of this.getSubLayers())i.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,i){let r=this.internalState.subLayers;const s=!r||this.needsUpdate();if(s){const n=this.renderLayers();r=kd(n,Boolean),this.internalState.subLayers=r}Rs(cK,this,s,r);for(const n of r)n.parent=this}}Xk.layerName="CompositeLayer";const uK=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,hK=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Kk=[0,0,0,255],Jk=[0,0,1],dK={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:Jk},getColor:{type:"accessor",value:Kk},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function pK(t){const{header:e,attributes:i}=t;if(!(!e||!i)&&(t.length=e.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0)){const{size:r,value:s}=i.COLOR_0;i.instanceColors={size:r,type:"unorm8",value:s}}}class bE extends Hd{getShaders(){return super.getShaders({vs:uK,fs:hK,modules:[lE,WG,hE]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:Jk},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:Kk}})}updateState(e){var i;const{changeFlags:r,props:s}=e;super.updateState(e),r.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&pK(s.data)}draw({uniforms:e}){const{pointSize:i,sizeUnits:r}=this.props,s=this.state.model;s.setUniforms(e),s.setUniforms({sizeUnits:tx[r],radiusPixels:i}),s.draw(this.context.renderPass)}_getModel(){const e=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;e.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new Pd(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _d({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}bE.layerName="PointCloudLayer";bE.defaultProps=dK;const Ln={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Be;new Be;const df=new Be,WC=new Be;class Fm{constructor(e=[0,0,0],i=0){this.radius=-0,this.center=new Be,this.fromCenterRadius(e,i)}fromCenterRadius(e,i){return this.center.from(e),this.radius=i,this}fromCornerPoints(e,i){return i=df.from(i),this.center=new Be().from(e).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Fm(this.center,this.radius)}union(e){const i=this.center,r=this.radius,s=e.center,n=e.radius,c=df.copy(s).subtract(i),l=c.magnitude();if(r>=l+n)return this.clone();if(n>=l+r)return e.clone();const f=(r+l+n)*.5;return WC.copy(c).scale((-r+f)/l).add(i),this.center.copy(WC),this.radius=f,this}expand(e){const i=df.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const i=rG(df,e);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(e){const i=this.distanceTo(e);return i*i}distanceTo(e){const i=df.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const i=this.center,r=this.radius,s=e.normal.dot(i)+e.distance;return s<-r?Ln.OUTSIDE:s<r?Ln.INTERSECTING:Ln.INSIDE}}const fK=new Be,mK=new Be,A_=new Be,T_=new Be,S_=new Be,gK=new Be,_K=new Be,Ba={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Nm{constructor(e=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new Be().from(e),this.halfAxes=new pr(i)}get halfSize(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Be(e).len(),new Be(i).len(),new Be(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),s=new Be(e).normalize(),n=new Be(i).normalize(),c=new Be(r).normalize();return new fm().fromMatrix3(new pr([...s,...n,...c]))}fromCenterHalfSizeQuaternion(e,i,r){const s=new fm(r),n=new pr().fromQuaternion(s);return n[0]=n[0]*i[0],n[1]=n[1]*i[0],n[2]=n[2]*i[0],n[3]=n[3]*i[1],n[4]=n[4]*i[1],n[5]=n[5]*i[1],n[6]=n[6]*i[2],n[7]=n[7]*i[2],n[8]=n[8]*i[2],this.center=new Be().from(e),this.halfAxes=n,this}clone(){return new Nm(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Fm){const i=this.halfAxes,r=i.getColumn(0,A_),s=i.getColumn(1,T_),n=i.getColumn(2,S_),c=fK.copy(r).add(s).add(n);return e.center.copy(this.center),e.radius=c.magnitude(),e}intersectPlane(e){const i=this.center,r=e.normal,s=this.halfAxes,n=r.x,c=r.y,l=r.z,f=Math.abs(n*s[Ba.COLUMN0ROW0]+c*s[Ba.COLUMN0ROW1]+l*s[Ba.COLUMN0ROW2])+Math.abs(n*s[Ba.COLUMN1ROW0]+c*s[Ba.COLUMN1ROW1]+l*s[Ba.COLUMN1ROW2])+Math.abs(n*s[Ba.COLUMN2ROW0]+c*s[Ba.COLUMN2ROW1]+l*s[Ba.COLUMN2ROW2]),y=r.dot(i)+e.distance;return y<=-f?Ln.OUTSIDE:y>=f?Ln.INSIDE:Ln.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=mK.from(e).subtract(this.center),r=this.halfAxes,s=r.getColumn(0,A_),n=r.getColumn(1,T_),c=r.getColumn(2,S_),l=s.magnitude(),f=n.magnitude(),y=c.magnitude();s.normalize(),n.normalize(),c.normalize();let E=0,T;return T=Math.abs(i.dot(s))-l,T>0&&(E+=T*T),T=Math.abs(i.dot(n))-f,T>0&&(E+=T*T),T=Math.abs(i.dot(c))-y,T>0&&(E+=T*T),E}computePlaneDistances(e,i,r=[-0,-0]){let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;const c=this.center,l=this.halfAxes,f=l.getColumn(0,A_),y=l.getColumn(1,T_),E=l.getColumn(2,S_),T=gK.copy(f).add(y).add(E).add(c),R=_K.copy(T).subtract(e);let D=i.dot(R);return s=Math.min(D,s),n=Math.max(D,n),T.copy(c).add(f).add(y).subtract(E),R.copy(T).subtract(e),D=i.dot(R),s=Math.min(D,s),n=Math.max(D,n),T.copy(c).add(f).subtract(y).add(E),R.copy(T).subtract(e),D=i.dot(R),s=Math.min(D,s),n=Math.max(D,n),T.copy(c).add(f).subtract(y).subtract(E),R.copy(T).subtract(e),D=i.dot(R),s=Math.min(D,s),n=Math.max(D,n),c.copy(T).subtract(f).add(y).add(E),R.copy(T).subtract(e),D=i.dot(R),s=Math.min(D,s),n=Math.max(D,n),c.copy(T).subtract(f).add(y).subtract(E),R.copy(T).subtract(e),D=i.dot(R),s=Math.min(D,s),n=Math.max(D,n),c.copy(T).subtract(f).subtract(y).add(E),R.copy(T).subtract(e),D=i.dot(R),s=Math.min(D,s),n=Math.max(D,n),c.copy(T).subtract(f).subtract(y).subtract(E),R.copy(T).subtract(e),D=i.dot(R),s=Math.min(D,s),n=Math.max(D,n),r[0]=s,r[1]=n,r}transform(e){this.center.transformAsPoint(e);const i=this.halfAxes.getColumn(0,A_);i.transformAsPoint(e);const r=this.halfAxes.getColumn(1,T_);r.transformAsPoint(e);const s=this.halfAxes.getColumn(2,S_);return s.transformAsPoint(e),this.halfAxes=new pr([...i,...r,...s]),this}getTransform(){throw new Error("not implemented")}}const XC=new Be,KC=new Be;class aa{constructor(e=[0,0,1],i=0){this.normal=new Be,this.distance=-0,this.fromNormalDistance(e,i)}fromNormalDistance(e,i){return Io(Number.isFinite(i)),this.normal.from(e).normalize(),this.distance=i,this}fromPointNormal(e,i){e=XC.from(e),this.normal.from(i).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,i,r,s){return this.normal.set(e,i,r),Io(Do(this.normal.len(),1)),this.distance=s,this}clone(){return new aa(this.normal,this.distance)}equals(e){return Do(this.distance,e.distance)&&Do(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const i=KC.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,i)}projectPointOntoPlane(e,i=[0,0,0]){const r=XC.from(e),s=this.getPointDistance(r),n=KC.copy(this.normal).scale(s);return r.subtract(n).to(i)}}const JC=[new Be([1,0,0]),new Be([0,1,0]),new Be([0,0,1])],ZC=new Be,yK=new Be;class so{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*JC.length;const i=e.center,r=e.radius;let s=0;for(const n of JC){let c=this.planes[s],l=this.planes[s+1];c||(c=this.planes[s]=new aa),l||(l=this.planes[s+1]=new aa);const f=ZC.copy(n).scale(-r).add(i);c.fromPointNormal(f,n);const y=ZC.copy(n).scale(r).add(i),E=yK.copy(n).negate();l.fromPointNormal(y,E),s+=2}return this}computeVisibility(e){let i=Ln.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case Ln.OUTSIDE:return Ln.OUTSIDE;case Ln.INTERSECTING:i=Ln.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(e,i){if(Io(Number.isFinite(i),"parentPlaneMask is required."),i===so.MASK_OUTSIDE||i===so.MASK_INSIDE)return i;let r=so.MASK_INSIDE;const s=this.planes;for(let n=0;n<this.planes.length;++n){const c=n<31?1<<n:0;if(n<31&&!(i&c))continue;const l=s[n],f=e.intersectPlane(l);if(f===Ln.OUTSIDE)return so.MASK_OUTSIDE;f===Ln.INTERSECTING&&(r|=c)}return r}}so.MASK_OUTSIDE=4294967295;so.MASK_INSIDE=0;so.MASK_INDETERMINATE=2147483647;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;new Be;const na=new pr,vK=new pr,bK=new pr,C_=new pr,YC=new pr;function wK(t,e={}){const i=GG,r=10;let s=0,n=0;const c=vK,l=bK;c.identity(),l.copy(t);const f=i*xK(l);for(;n<r&&EK(l)>f;)AK(l,C_),YC.copy(C_).transpose(),l.multiplyRight(C_),l.multiplyLeft(YC),c.multiplyRight(C_),++s>2&&(++n,s=0);return e.unitary=c.toTarget(e.unitary),e.diagonal=l.toTarget(e.diagonal),e}function xK(t){let e=0;for(let i=0;i<9;++i){const r=t[i];e+=r*r}return Math.sqrt(e)}const bx=[1,0,0],wx=[2,2,1];function EK(t){let e=0;for(let i=0;i<3;++i){const r=t[na.getElementIndex(wx[i],bx[i])];e+=2*r*r}return Math.sqrt(e)}function AK(t,e){const i=V4;let r=0,s=1;for(let y=0;y<3;++y){const E=Math.abs(t[na.getElementIndex(wx[y],bx[y])]);E>r&&(s=y,r=E)}const n=bx[s],c=wx[s];let l=1,f=0;if(Math.abs(t[na.getElementIndex(c,n)])>i){const y=t[na.getElementIndex(c,c)],E=t[na.getElementIndex(n,n)],T=t[na.getElementIndex(c,n)],R=(y-E)/2/T;let D;R<0?D=-1/(-R+Math.sqrt(1+R*R)):D=1/(R+Math.sqrt(1+R*R)),l=1/Math.sqrt(1+D*D),f=D*l}return pr.IDENTITY.to(e),e[na.getElementIndex(n,n)]=e[na.getElementIndex(c,c)]=l,e[na.getElementIndex(c,n)]=f,e[na.getElementIndex(n,c)]=-f,e}const Nl=new Be,TK=new Be,SK=new Be,CK=new Be,IK=new Be,RK=new pr,MK={diagonal:new pr,unitary:new pr};function PK(t,e=new Nm){if(!t||t.length===0)return e.halfAxes=new pr([0,0,0,0,0,0,0,0,0]),e.center=new Be,e;const i=t.length,r=new Be(0,0,0);for(const Te of t)r.add(Te);const s=1/i;r.multiplyByScalar(s);let n=0,c=0,l=0,f=0,y=0,E=0;for(const Te of t){const Pe=Nl.copy(Te).subtract(r);n+=Pe.x*Pe.x,c+=Pe.x*Pe.y,l+=Pe.x*Pe.z,f+=Pe.y*Pe.y,y+=Pe.y*Pe.z,E+=Pe.z*Pe.z}n*=s,c*=s,l*=s,f*=s,y*=s,E*=s;const T=RK;T[0]=n,T[1]=c,T[2]=l,T[3]=c,T[4]=f,T[5]=y,T[6]=l,T[7]=y,T[8]=E;const{unitary:R}=wK(T,MK),D=e.halfAxes.copy(R);let V=D.getColumn(0,SK),H=D.getColumn(1,CK),ee=D.getColumn(2,IK),z=-Number.MAX_VALUE,W=-Number.MAX_VALUE,q=-Number.MAX_VALUE,ce=Number.MAX_VALUE,we=Number.MAX_VALUE,re=Number.MAX_VALUE;for(const Te of t)Nl.copy(Te),z=Math.max(Nl.dot(V),z),W=Math.max(Nl.dot(H),W),q=Math.max(Nl.dot(ee),q),ce=Math.min(Nl.dot(V),ce),we=Math.min(Nl.dot(H),we),re=Math.min(Nl.dot(ee),re);V=V.multiplyByScalar(.5*(ce+z)),H=H.multiplyByScalar(.5*(we+W)),ee=ee.multiplyByScalar(.5*(re+q)),e.center.copy(V).add(H).add(ee);const be=TK.set(z-ce,W-we,q-re).multiplyByScalar(.5),me=new pr([be[0],0,0,0,be[1],0,0,0,be[2]]);return e.halfAxes.multiplyRight(me),e}const ub=Math.PI/180,I_=new Float32Array(16),QC=new Float32Array(12);function eI(t,e,i){const r=e[0]*ub,s=e[1]*ub,n=e[2]*ub,c=Math.sin(n),l=Math.sin(r),f=Math.sin(s),y=Math.cos(n),E=Math.cos(r),T=Math.cos(s),R=i[0],D=i[1],V=i[2];t[0]=R*T*E,t[1]=R*f*E,t[2]=R*-l,t[3]=D*(-f*y+T*l*c),t[4]=D*(T*y+f*l*c),t[5]=D*E*c,t[6]=V*(f*c+T*l*y),t[7]=V*(-T*c+f*l*y),t[8]=V*E*y}function tI(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const Zk={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:i}){const{data:r,getOrientation:s,getScale:n,getTranslation:c,getTransformMatrix:l}=this.props,f=Array.isArray(l),y=f&&l.length===16,E=Array.isArray(n),T=Array.isArray(s),R=Array.isArray(c),D=y||!f&&!!l(r[0]);D?t.constant=y:t.constant=T&&E&&R;const V=t.value;if(t.constant){let H;D?(I_.set(l),H=tI(I_)):(H=QC,eI(H,s,n),H.set(c,9)),t.value=new Float32Array(H)}else{let H=e*t.size;const{iterable:ee,objectInfo:z}=Ok(r,e,i);for(const W of ee){z.index++;let q;if(D)I_.set(y?l:l(W,z)),q=tI(I_);else{q=QC;const ce=T?s:s(W,z),we=E?n:n(W,z);eI(q,ce,we),q.set(R?c:c(W,z),9)}V[H++]=q[0],V[H++]=q[1],V[H++]=q[2],V[H++]=q[3],V[H++]=q[4],V[H++]=q[5],V[H++]=q[6],V[H++]=q[7],V[H++]=q[8],V[H++]=q[9],V[H++]=q[10],V[H++]=q[11]}}}};function Yk(t,e){return e===li.CARTESIAN||e===li.METER_OFFSETS||e===li.DEFAULT&&!t.isGeospatial}const kK=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,BK=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function hb(t){const e=t.positions||t.POSITION;fi.assert(e,'no "postions" or "POSITION" attribute in mesh');const i=e.value.length/e.size;let r=t.COLOR_0||t.colors;r||(r={size:3,value:new Float32Array(i*3).fill(1)});let s=t.NORMAL||t.normals;s||(s={size:3,value:new Float32Array(i*3).fill(0)});let n=t.TEXCOORD_0||t.texCoords;return n||(n={size:2,value:new Float32Array(i*2).fill(0)}),{positions:e,colors:r,normals:s,texCoords:n}}function iI(t){return t instanceof _d?(t.attributes=hb(t.attributes),t):t.attributes?new _d({...t,topology:"triangle-list",attributes:hb(t.attributes)}):new _d({topology:"triangle-list",attributes:hb(t)})}const LK=[0,0,0,255],OK={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:LK},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class wE extends Hd{getShaders(){return super.getShaders({vs:kK,fs:BK,modules:[lE,XG,hE]})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let i=this.state.positionBounds;if(i)return i;const{mesh:r}=this.props;if(!r)return null;if(i=(e=r.header)==null?void 0:e.boundingBox,!i){const{attributes:s}=iI(r);s.POSITION=s.POSITION||s.positions,i=yP(s)}return this.state.positionBounds=i,i}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Zk}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var i;super.updateState(e);const{props:r,oldProps:s,changeFlags:n}=e;if(r.mesh!==s.mesh||n.extensionsChanged){if(this.state.positionBounds=null,(i=this.state.model)==null||i.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);const c=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(c.NORMAL||c.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==s.texture&&r.texture instanceof Mo&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:i}=this.state;if(!i)return;const{viewport:r,renderPass:s}=this.context,{sizeScale:n,coordinateSystem:c,_instanced:l}=this.props;i.setUniforms(e),i.setUniforms({sizeScale:n,composeModelMatrix:!l||Yk(r,c),flatShading:!this.state.hasNormals}),i.draw(s)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const i=new Pd(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:iI(e),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:s}=this.state;return i.setBindings({sampler:r||s}),i.setUniforms({hasTexture:!!r}),i}setTexture(e){const{emptyTexture:i,model:r}=this.state;r&&(r.setBindings({sampler:e||i}),r.setUniforms({hasTexture:!!e}))}}wE.defaultProps=OK;wE.layerName="SimpleMeshLayer";var Ro;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Ro||(Ro={}));function Qk(t,e,i,r){const s={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};s.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:n}=r;return n&&(s.bindings.u_DiffuseEnvSampler=n.diffuseEnvSampler,s.bindings.u_SpecularEnvSampler=n.specularEnvSampler,s.bindings.u_brdfLUT=n.brdfLutTexture,s.uniforms.u_ScaleIBLAmbient=[1,1]),r!=null&&r.pbrDebug&&(s.defines.PBR_DEBUG=1,s.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],s.uniforms.u_ScaleFGDSpec=[0,0,0,0]),i.NORMAL&&(s.defines.HAS_NORMALS=1),i.TANGENT&&r!=null&&r.useTangents&&(s.defines.HAS_TANGENTS=1),i.TEXCOORD_0&&(s.defines.HAS_UV=1),r!=null&&r.imageBasedLightingEnvironment&&(s.defines.USE_IBL=1),r!=null&&r.lights&&(s.defines.USE_LIGHTS=1),e&&DK(t,e,s),s}function DK(t,e,i){if(i.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&FK(t,e.pbrMetallicRoughness,i),e.normalTexture){qf(t,e.normalTexture,"u_NormalSampler","HAS_NORMALMAP",i);const{scale:r=1}=e.normalTexture;i.uniforms.u_NormalScale=r}if(e.occlusionTexture){qf(t,e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",i);const{strength:r=1}=e.occlusionTexture;i.uniforms.u_OcclusionStrength=r}switch(e.emissiveTexture&&(qf(t,e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",i),i.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:r=.5}=e;i.defines.ALPHA_CUTOFF=1,i.uniforms.u_AlphaCutoff=r;break;case"BLEND":Qe.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),i.parameters.blendColorOperation="add",i.parameters.blendColorSrcFactor="src-alpha",i.parameters.blendColorDstFactor="one-minus-src-alpha",i.parameters.blendAlphaOperation="add",i.parameters.blendAlphaSrcFactor="one",i.parameters.blendAlphaDstFactor="one-minus-src-alpha",i.glParameters.blend=!0,i.glParameters.blendEquation=Ro.FUNC_ADD,i.glParameters.blendFunc=[Ro.SRC_ALPHA,Ro.ONE_MINUS_SRC_ALPHA,Ro.ONE,Ro.ONE_MINUS_SRC_ALPHA];break}}function FK(t,e,i){e.baseColorTexture&&qf(t,e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",i),i.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&qf(t,e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",i);const{metallicFactor:r=1,roughnessFactor:s=1}=e;i.uniforms.u_MetallicRoughnessValues=[r,s]}function qf(t,e,i,r=null,s){var n,c;const l=((c=(n=e==null?void 0:e.texture)==null?void 0:n.sampler)==null?void 0:c.parameters)||{},f=e.texture.source.image;let y,E={};f.compressed?(y=f,E={[Ro.TEXTURE_MIN_FILTER]:f.data.length>1?Ro.LINEAR_MIPMAP_NEAREST:Ro.LINEAR}):y={data:f};const T=t.createTexture({id:e.uniformName||e.id,parameters:{...l,...E},pixelStore:{[Ro.UNPACK_FLIP_Y_WEBGL]:!1},...y});s.bindings[i]=T,r&&(s.defines[r]=1),s.generatedTextures.push(T)}const NK="4.3.1",Y0={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let db;async function rI(t){return aN(t.modules),lN("basis")||(db||(db=UK(t)),await db)}async function UK(t){let e=null,i=null;return[e,i]=await Promise.all([await fu(Y0.TRANSCODER,"textures",t),await fu(Y0.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await zK(e,i)}function zK(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(r=>{t(i).then(s=>{const{BasisFile:n,initializeBasis:c}=s;c(),r({BasisFile:n})})})}let pb;async function sI(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(pb=pb||jK(t),await pb)}async function jK(t){let e=null,i=null;return[e,i]=await Promise.all([await fu(Y0.ENCODER,"textures",t),await fu(Y0.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await GK(e,i)}function GK(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(r=>{t(i).then(s=>{const{BasisFile:n,KTX2File:c,initializeBasis:l,BasisEncoder:f}=s;l(),r({BasisFile:n,KTX2File:c,BasisEncoder:f})})})}const Rh={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},VK=["","WEBKIT_","MOZ_"],nI={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let R_=null;function $K(t){if(!R_){t=t||HK()||void 0,R_=new Set;for(const e of VK)for(const i in nI)if(t&&t.getExtension(`${e}${i}`)){const r=nI[i];R_.add(r)}}return R_}function HK(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Mn=[171,75,84,88,32,50,48,187,13,10,26,10];function qK(t){const e=new Uint8Array(t);return!(e.byteLength<Mn.length||e[0]!==Mn[0]||e[1]!==Mn[1]||e[2]!==Mn[2]||e[3]!==Mn[3]||e[4]!==Mn[4]||e[5]!==Mn[5]||e[6]!==Mn[6]||e[7]!==Mn[7]||e[8]!==Mn[8]||e[9]!==Mn[9]||e[10]!==Mn[10]||e[11]!==Mn[11])}const WK={etc1:{basisFormat:0,compressed:!0,format:Rh.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Rh.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Rh.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Rh.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Rh.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Rh.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function XK(t,e){if(e.basis.containerFormat==="auto"){if(qK(t)){const r=await sI(e);return oI(r.KTX2File,t,e)}const{BasisFile:i}=await rI(e);return fb(i,t,e)}switch(e.basis.module){case"encoder":const i=await sI(e);switch(e.basis.containerFormat){case"ktx2":return oI(i.KTX2File,t,e);case"basis":default:return fb(i.BasisFile,t,e)}case"transcoder":default:const{BasisFile:r}=await rI(e);return fb(r,t,e)}}function fb(t,e,i){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const s=r.getNumImages(),n=[];for(let c=0;c<s;c++){const l=r.getNumLevels(c),f=[];for(let y=0;y<l;y++)f.push(KK(r,c,y,i));n.push(f)}return n}finally{r.close(),r.delete()}}function KK(t,e,i,r){const s=t.getImageWidth(e,i),n=t.getImageHeight(e,i),c=t.getHasAlpha(),{compressed:l,format:f,basisFormat:y}=eB(r,c),E=t.getImageTranscodedSizeInBytes(e,i,y),T=new Uint8Array(E);if(!t.transcodeImage(T,e,i,y,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:n,data:T,compressed:l,format:f,hasAlpha:c}}function oI(t,e,i){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=r.getLevels(),n=[];for(let c=0;c<s;c++)n.push(JK(r,c,i));return[n]}finally{r.close(),r.delete()}}function JK(t,e,i){const{alphaFlag:r,height:s,width:n}=t.getImageLevelInfo(e,0,0),{compressed:c,format:l,basisFormat:f}=eB(i,r),y=t.getImageTranscodedSizeInBytes(e,0,0,f),E=new Uint8Array(y);if(!t.transcodeImage(E,e,0,0,f,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:n,height:s,data:E,compressed:c,levelSize:y,hasAlpha:r,format:l}}function eB(t,e){let i=t&&t.basis&&t.basis.format;return i==="auto"&&(i=tB()),typeof i=="object"&&(i=e?i.alpha:i.noAlpha),i=i.toLowerCase(),WK[i]}function tB(){const t=$K();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const ZK={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:NK,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},YK={...ZK,parse:XK},QK={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eJ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class tJ{constructor(e){O(this,"name"),O(this,"startTime",0),O(this,"playing",!0),O(this,"speed",1),O(this,"channels",[]),Object.assign(this,e)}animate(e){if(!this.playing)return;const i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:r,target:s,path:n})=>{lJ(i,r,s,n),sJ(s,s._node)})}}class iJ{constructor(e){O(this,"animations"),this.animations=e.animations.map((i,r)=>{const s=i.name||`Animation-${r}`,n=i.samplers.map(({input:l,interpolation:f="LINEAR",output:y})=>({input:aI(e.accessors[l]),interpolation:f,output:aI(e.accessors[y])})),c=i.channels.map(({sampler:l,target:f})=>({sampler:n[l],target:e.nodes[f.node],path:f.path}));return new tJ({name:s,channels:c})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(i=>i.animate(e))}getAnimations(){return this.animations}}function aI(t){if(!t._animation){const e=eJ[t.componentType],i=QK[t.type],r=i*t.count,{buffer:s,byteOffset:n}=t.bufferView.data,c=new e(s,n+(t.byteOffset||0),r);if(i===1)t._animation=Array.from(c);else{const l=[];for(let f=0;f<c.length;f+=i)l.push(Array.from(c.slice(f,f+i)));t._animation=l}}return t._animation}const rJ=new ai;function sJ(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const i=rJ.fromQuaternion(t.rotation);e.matrix.multiplyRight(i)}t.scale&&e.matrix.scale(t.scale)}const mb=new fm;function nJ(t,e,i,r,s){if(e==="rotation"){mb.slerp({start:i,target:r,ratio:s});for(let n=0;n<mb.length;n++)t[e][n]=mb[n]}else for(let n=0;n<i.length;n++)t[e][n]=s*r[n]+(1-s)*i[n]}function oJ(t,e,{p0:i,outTangent0:r,inTangent1:s,p1:n,tDiff:c,ratio:l}){for(let f=0;f<t[e].length;f++){const y=r[f]*c,E=s[f]*c;t[e][f]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*i[f]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*y+(-2*Math.pow(l,3)+3*Math.pow(l,2))*n[f]+(Math.pow(l,3)-Math.pow(l,2))*E}}function aJ(t,e,i){for(let r=0;r<i.length;r++)t[e][r]=i[r]}function lJ(t,{input:e,interpolation:i,output:r},s,n){const c=e[e.length-1],l=t%c,f=e.findIndex(R=>R>=l),y=Math.max(0,f-1);if(!Array.isArray(s[n]))switch(n){case"translation":s[n]=[0,0,0];break;case"rotation":s[n]=[0,0,0,1];break;case"scale":s[n]=[1,1,1];break;default:Qe.warn(`Bad animation path ${n}`)()}bi(s[n].length===r[y].length);const E=e[y],T=e[f];switch(i){case"STEP":aJ(s,n,r[y]);break;case"LINEAR":if(T>E){const R=(l-E)/(T-E);nJ(s,n,r[y],r[f],R)}break;case"CUBICSPLINE":if(T>E){const R=(l-E)/(T-E),D=T-E,V=r[3*y+1],H=r[3*y+2],ee=r[3*f+0],z=r[3*f+1];oJ(s,n,{p0:V,outTangent0:H,inTangent1:ee,p1:z,tDiff:D,ratio:R})}break;default:Qe.warn(`Interpolation ${i} not supported`)();break}}const cJ=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,uJ=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function hJ(t,e){const{id:i,geometry:r,material:s,vertexCount:n,materialOptions:c,modelOptions:l}=e,f=Qk(t,s,r.attributes,c);Qe.info(4,"createGLTFModel defines: ",f.defines)();const y=[],E={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},T={id:i,geometry:r,topology:r.topology,vertexCount:n,modules:[oE],vs:lI(t,cJ),fs:lI(t,uJ),...l,bindings:{...f.bindings,...l.bindings},defines:{...f.defines,...l.defines},parameters:{...E,...f.parameters,...l.parameters},uniforms:{...f.uniforms,...l.uniforms}},R=new Pd(t,T);return new ox({managedResources:y,model:R})}function lI(t,e){return`#version 300 es
${e}`}const dJ={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class pJ{constructor(e,i={}){O(this,"device"),O(this,"options"),O(this,"gltf"),this.device=e,this.options={...dJ,...i}}instantiate(e){return this.gltf=e,(e.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new iJ(this.gltf):null}createScene(e){const i=(e.nodes||[]).map(r=>this.createNode(r));return new yd({id:e.name||e.id,children:i})}createNode(e){if(!e._node){const i=(e.children||[]).map(s=>this.createNode(s));e.mesh&&i.push(this.createMesh(e.mesh));const r=new yd({id:e.name||e.id,children:i});if(e.matrix)r.setMatrix(e.matrix);else{if(r.matrix.identity(),e.translation&&r.matrix.translate(e.translation),e.rotation){const s=new ai().fromQuaternion(e.rotation);r.matrix.multiplyRight(s)}e.scale&&r.matrix.scale(e.scale)}e._node=r}return e._node}createMesh(e){if(!e._mesh){const i=(e.primitives||[]).map((s,n)=>this.createPrimitive(s,n,e)),r=new yd({id:e.name||e.id,children:i});e._mesh=r}return e._mesh}createPrimitive(e,i,r){const s=e.name||`${r.name||r.id}-primitive-${i}`,n=fJ(e.mode||4),c=e.indices?e.indices.count:this.getVertexCount(e.attributes),l=hJ(this.device,{id:s,geometry:this.createGeometry(s,e,n),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:c});return l.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],l}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,i,r){const s={};for(const[n,c]of Object.entries(i.attributes)){const{components:l,size:f,value:y}=c;s[n]={size:f??l,value:y}}return new _d({id:e,topology:r,indices:i.indices.value,attributes:s})}createBuffer(e,i){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[i]||(r.lumaBuffers[i]=this.device.createBuffer({id:`from-${r.id}`,data:r.data||e.value})),r.lumaBuffers[i]}createSampler(e){return e}needsPOT(){return!1}}var Fa;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Fa||(Fa={}));function fJ(t){switch(t){case Fa.POINTS:return"point-list";case Fa.LINES:return"line-list";case Fa.LINE_STRIP:return"line-strip";case Fa.LINE_LOOP:return"line-loop-webgl";case Fa.TRIANGLES:return"triangle-list";case Fa.TRIANGLE_STRIP:return"triangle-strip";case Fa.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(t)}}function mJ(t,e,i){const r=new pJ(t,i),s=r.instantiate(e),n=r.createAnimator();return{scenes:s,animator:n}}function Dn(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const iB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rB={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},gJ=1.33,cI=["SCALAR","VEC2","VEC3","VEC4"],_J=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],yJ=new Map(_J),vJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},wJ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function sB(t){return cI[t-1]||cI[0]}function B1(t){const e=yJ.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function xE(t,e){const i=wJ[t.componentType],r=vJ[t.type],s=bJ[t.componentType],n=t.count*r,c=t.count*r*s;Dn(c>=0&&c<=e.byteLength);const l=rB[t.componentType],f=iB[t.type];return{ArrayType:i,length:n,byteLength:c,componentByteSize:l,numberOfComponentsInElement:f}}function nB(t){let{images:e,bufferViews:i}=t;e=e||[],i=i||[];const r=e.map(c=>c.bufferView);i=i.filter(c=>!r.includes(c));const s=i.reduce((c,l)=>c+l.byteLength,0),n=e.reduce((c,l)=>{const{width:f,height:y}=l.image;return c+f*y},0);return s+Math.ceil(4*n*gJ)}function xJ(t,e,i){const r=t.bufferViews[i];Dn(r);const s=r.buffer,n=e[s];Dn(n);const c=(r.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,c,r.byteLength)}function EJ(t,e,i){var r,s;const n=typeof i=="number"?(r=t.accessors)==null?void 0:r[i]:i;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const c=(s=t.bufferViews)==null?void 0:s[n.bufferView||0];if(!c)throw new Error(`No gltf buffer view for accessor ${c}`);const{arrayBuffer:l,byteOffset:f}=e[c.buffer],y=(f||0)+(n.byteOffset||0)+(c.byteOffset||0),{ArrayType:E,length:T,componentByteSize:R,numberOfComponentsInElement:D}=xE(n,c),V=R*D,H=c.byteStride||V;if(typeof c.byteStride>"u"||c.byteStride===V)return new E(l,y,T);const ee=new E(T);for(let z=0;z<n.count;z++){const W=new E(l,y+z*H,D);ee.set(W,z*D)}return ee}function AJ(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class es{constructor(e){O(this,"gltf"),O(this,"sourceBuffers"),O(this,"byteLength"),this.gltf={json:(e==null?void 0:e.json)||AJ(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const i=this.getUsedExtensions().find(s=>s===e),r=this.getRequiredExtensions().find(s=>s===e);return typeof i=="string"||typeof r=="string"}getExtension(e){const i=this.getUsedExtensions().find(s=>s===e),r=this.json.extensions||{};return i?r[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,i){return(e.extensions||{})[i]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,i){if(typeof i=="object")return i;const r=this.json[e]&&this.json[e][i];if(!r)throw new Error(`glTF file error: Could not find ${e}[${i}]`);return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const i=e.buffer,r=this.gltf.buffers[i];Dn(r);const s=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,e.byteLength)}getTypedArrayForAccessor(e){const i=this.getAccessor(e);return EJ(this.gltf.json,this.gltf.buffers,i)}getTypedArrayForImageData(e){e=this.getAccessor(e);const i=this.getBufferView(e.bufferView),r=this.getBuffer(i.buffer).data,s=i.byteOffset||0;return new Uint8Array(r,s,i.byteLength)}addApplicationData(e,i){return this.json[e]=i,this}addExtraData(e,i){return this.json.extras=this.json.extras||{},this.json.extras[e]=i,this}addObjectExtension(e,i,r){return e.extensions=e.extensions||{},e.extensions[i]=r,this.registerUsedExtension(i),this}setObjectExtension(e,i,r){const s=e.extensions||{};s[i]=r}removeObjectExtension(e,i){const r=(e==null?void 0:e.extensions)||{};if(r[i]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(i)||s.push(i)}delete r[i]}addExtension(e,i={}){return Dn(i),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=i,this.registerUsedExtension(e),i}addRequiredExtension(e,i={}){return Dn(i),this.addExtension(e,i),this.registerRequiredExtension(e),i}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(i=>i===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(i=>i===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var i;if((i=this.json.extensions)!=null&&i[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:i}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:i}),this.json.scenes.length-1}addNode(e){const{meshIndex:i,matrix:r}=e;this.json.nodes=this.json.nodes||[];const s={mesh:i};return r&&(s.matrix=r),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(e){const{attributes:i,indices:r,material:s,mode:n=4}=e,c={primitives:[{attributes:this._addAttributes(i),mode:n}]};if(r){const l=this._addIndices(r);c.primitives[0].indices=l}return Number.isFinite(s)&&(c.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){const i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,i){const r=q2(e),s=i||(r==null?void 0:r.mimeType),n={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(n),this.json.images.length-1}addBufferView(e,i=0,r=this.byteLength){const s=e.byteLength;Dn(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const n={buffer:i,byteOffset:r,byteLength:s};return this.byteLength+=Mm(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(n),this.json.bufferViews.length-1}addAccessor(e,i){const r={bufferView:e,type:sB(i.size),componentType:i.componentType,count:i.count,max:i.max,min:i.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,i={size:3}){const r=this.addBufferView(e);let s={min:i.min,max:i.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(e,i.size));const n={size:i.size,componentType:B1(e),count:Math.round(e.length/i.size),min:s.min,max:s.max};return this.addAccessor(r,Object.assign(n,i))}addTexture(e){const{imageIndex:i}=e,r={source:i};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,i;const r=this.byteLength,s=new ArrayBuffer(r),n=new Uint8Array(s);let c=0;for(const l of this.sourceBuffers||[])c=BN(l,n,c);(i=(e=this.json)==null?void 0:e.buffers)!=null&&i[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=s,this.sourceBuffers=[s],this.gltf.buffers=[{arrayBuffer:s,byteOffset:0,byteLength:s.byteLength}]}_removeStringFromArray(e,i){let r=!0;for(;r;){const s=e.indexOf(i);s>-1?e.splice(s,1):r=!1}}_addAttributes(e={}){const i={};for(const r in e){const s=e[r],n=this._getGltfAttributeName(r),c=this.addBinaryBuffer(s.value,s);i[n]=c}return i}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,i){const r={min:null,max:null};if(e.length<i)return r;r.min=[],r.max=[];const s=e.subarray(0,i);for(const n of s)r.min.push(n),r.max.push(n);for(let n=i;n<e.length;n+=i)for(let c=0;c<i;c++)r.min[0+c]=Math.min(r.min[0+c],e[n+c]),r.max[0+c]=Math.max(r.max[0+c],e[n+c]);return r}}function uI(t){return(t%1+1)%1}const oB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},TJ={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},aB={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function EE(t,e){return aB[e]*oB[t]}function L1(t,e,i,r){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const s=t.getTypedArrayForBufferView(e),n=O1(s,"SCALAR",i,r+1);return n instanceof BigInt64Array||n instanceof BigUint64Array?null:n}function O1(t,e,i,r=1){const s=oB[e],n=TJ[i],c=aB[i],l=r*s,f=l*c;let y=t.buffer,E=t.byteOffset;return E%c!==0&&(y=new Uint8Array(y).slice(E,E+f).buffer,E=0),new n(y,E,l)}function AE(t,e,i){var r,s,n,c,l;const f=`TEXCOORD_${e.texCoord||0}`,y=i.attributes[f],E=t.getTypedArrayForAccessor(y),T=t.gltf.json,R=e.index,D=(s=(r=T.textures)==null?void 0:r[R])==null?void 0:s.source;if(typeof D<"u"){const V=(c=(n=T.images)==null?void 0:n[D])==null?void 0:c.mimeType,H=(l=t.gltf.images)==null?void 0:l[D];if(H&&typeof H.width<"u"){const ee=[];for(let z=0;z<E.length;z+=2){const W=SJ(H,V,E,z,e.channels);ee.push(W)}return ee}}return[]}function lB(t,e,i,r,s){if(!(i!=null&&i.length))return;const n=[];for(const E of i){let T=r.findIndex(R=>R===E);T===-1&&(T=r.push(E)-1),n.push(T)}const c=new Uint32Array(n),l=t.gltf.buffers.push({arrayBuffer:c.buffer,byteOffset:c.byteOffset,byteLength:c.byteLength})-1,f=t.addBufferView(c,l,0),y=t.addAccessor(f,{size:1,componentType:B1(c),count:c.length});s.attributes[e]=y}function SJ(t,e,i,r,s=[0]){const n={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},c=i[r],l=i[r+1];let f=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(f=4);const y=CJ(c,l,t,f);let E=0;for(const T of s){const R=typeof T=="number"?Object.values(n)[T]:n[T],D=y+R.offset,V=vP(t);if(V.data.length<=D)throw new Error(`${V.data.length} <= ${D}`);const H=V.data[D];E|=H<<R.shift}return E}function CJ(t,e,i,r=1){const s=i.width,n=uI(t)*(s-1),c=Math.round(n),l=i.height,f=uI(e)*(l-1),y=Math.round(f),E=i.components?i.components:r;return(y*s+c)*E}function cB(t,e,i,r,s){const n=[];for(let c=0;c<e;c++){const l=i[c],f=i[c+1]-i[c];if(f+l>r)break;const y=l/s,E=f/s;n.push(t.slice(y,y+E))}return n}function uB(t,e,i){const r=[];for(let s=0;s<e;s++){const n=s*i;r.push(t.slice(n,n+i))}return r}function hB(t,e,i,r){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){const s=[],n=new TextDecoder("utf8");let c=0;for(let l=0;l<t;l++){const f=r[l+1]-r[l];if(f+c<=e.length){const y=e.subarray(c,f+c),E=n.decode(y);s.push(E),c+=f}}return s}return[]}const bd="EXT_mesh_features",IJ=bd;async function RJ(t,e){const i=new es(t);PJ(i,e)}function MJ(t,e){const i=new es(t);return BJ(i),i.createBinaryChunk(),i.gltf}function PJ(t,e){const i=t.gltf.json;if(i.meshes)for(const r of i.meshes)for(const s of r.primitives)kJ(t,s,e)}function kJ(t,e,i){var r,s,n;if(!((r=i==null?void 0:i.gltf)!=null&&r.loadBuffers))return;const c=(s=e.extensions)==null?void 0:s[bd],l=c==null?void 0:c.featureIds;if(l)for(const f of l){let y;if(typeof f.attribute<"u"){const E=`_FEATURE_ID_${f.attribute}`,T=e.attributes[E];y=t.getTypedArrayForAccessor(T)}else typeof f.texture<"u"&&(n=i==null?void 0:i.gltf)!=null&&n.loadImages?y=AE(t,f.texture,e):y=[];f.data=y}}function BJ(t,e){const i=t.gltf.json.meshes;if(i)for(const r of i)for(const s of r.primitives)OJ(t,s)}function LJ(t,e,i,r){e.extensions||(e.extensions={});let s=e.extensions[bd];s||(s={featureIds:[]},e.extensions[bd]=s);const{featureIds:n}=s,c={featureCount:i.length,propertyTable:r,data:i};n.push(c),t.addObjectExtension(e,bd,s)}function OJ(t,e){var i;const r=(i=e.extensions)==null?void 0:i[bd];if(!r)return;const s=r.featureIds;s.forEach((n,c)=>{if(n.data){const{accessorKey:l,index:f}=DJ(e.attributes),y=new Uint32Array(n.data);s[c]={featureCount:y.length,propertyTable:n.propertyTable,attribute:f},t.gltf.buffers.push({arrayBuffer:y.buffer,byteOffset:y.byteOffset,byteLength:y.byteLength});const E=t.addBufferView(y),T=t.addAccessor(E,{size:1,componentType:B1(y),count:y.length});e.attributes[l]=T}})}function DJ(t){const e="_FEATURE_ID_",i=Object.keys(t).filter(s=>s.indexOf(e)===0);let r=-1;for(const s of i){const n=Number(s.substring(e.length));n>r&&(r=n)}return r++,{accessorKey:`${e}${r}`,index:r}}const FJ=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:LJ,decode:RJ,encode:MJ,name:IJ},Symbol.toStringTag,{value:"Module"})),Bd="EXT_structural_metadata",NJ=Bd;async function UJ(t,e){const i=new es(t);jJ(i,e)}function zJ(t,e){const i=new es(t);return rZ(i),i.createBinaryChunk(),i.gltf}function jJ(t,e){var i,r;if(!((i=e.gltf)!=null&&i.loadBuffers))return;const s=t.getExtension(Bd);s&&((r=e.gltf)!=null&&r.loadImages&&GJ(t,s),VJ(t,s))}function GJ(t,e){const i=e.propertyTextures,r=t.gltf.json;if(i&&r.meshes)for(const s of r.meshes)for(const n of s.primitives)HJ(t,i,n,e)}function VJ(t,e){const i=e.schema;if(!i)return;const r=i.classes,s=e.propertyTables;if(r&&s)for(const n in r){const c=$J(s,n);c&&WJ(t,i,c)}}function $J(t,e){for(const i of t)if(i.class===e)return i;return null}function HJ(t,e,i,r){var s;if(!e)return;const n=(s=i.extensions)==null?void 0:s[Bd],c=n==null?void 0:n.propertyTextures;if(c)for(const l of c){const f=e[l];qJ(t,f,i,r)}}function qJ(t,e,i,r){var s;if(!e.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);const n=e.class;for(const c in e.properties){const l=`${n}_${c}`,f=(s=e.properties)==null?void 0:s[c];if(!f)continue;f.data||(f.data=[]);const y=f.data,E=AE(t,f,i);E!==null&&(lB(t,l,E,y,i),f.data=y,r.dataAttributeNames.push(l))}}function WJ(t,e,i){var r,s;const n=(r=e.classes)==null?void 0:r[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const c=i.count;for(const l in n.properties){const f=n.properties[l],y=(s=i.properties)==null?void 0:s[l];if(y){const E=XJ(t,e,f,c,y);y.data=E}}}function XJ(t,e,i,r,s){let n=[];const c=s.values,l=t.getTypedArrayForBufferView(c),f=KJ(t,i,s,r),y=JJ(t,s,r);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{n=ZJ(i,r,l,f);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{n=hB(r,l,f,y);break}case"ENUM":{n=YJ(e,i,r,l,f);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return n}function KJ(t,e,i,r){return e.array&&typeof e.count>"u"&&typeof i.arrayOffsets<"u"?L1(t,i.arrayOffsets,i.arrayOffsetType||"UINT32",r):null}function JJ(t,e,i){return typeof e.stringOffsets<"u"?L1(t,e.stringOffsets,e.stringOffsetType||"UINT32",i):null}function ZJ(t,e,i,r){const s=t.array,n=t.count,c=EE(t.type,t.componentType),l=i.byteLength/c;let f;return t.componentType?f=O1(i,t.type,t.componentType,l):f=i,s?r?cB(f,e,r,i.length,c):n?uB(f,e,n):[]:f}function YJ(t,e,i,r,s){var n;const c=e.enumType;if(!c)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const l=(n=t.enums)==null?void 0:n[c];if(!l)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${c}`);const f=l.valueType||"UINT16",y=EE(e.type,f),E=r.byteLength/y;let T=O1(r,e.type,f,E);if(T||(T=r),e.array){if(s)return QJ({valuesData:T,numberOfElements:i,arrayOffsets:s,valuesDataBytesLength:r.length,elementSize:y,enumEntry:l});const R=e.count;return R?eZ(T,i,R,l):[]}return TE(T,0,i,l)}function QJ(t){const{valuesData:e,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:s,elementSize:n,enumEntry:c}=t,l=[];for(let f=0;f<i;f++){const y=r[f],E=r[f+1]-r[f];if(E+y>s)break;const T=y/n,R=E/n,D=TE(e,T,R,c);l.push(D)}return l}function eZ(t,e,i,r){const s=[];for(let n=0;n<e;n++){const c=i*n,l=TE(t,c,i,r);s.push(l)}return s}function TE(t,e,i,r){const s=[];for(let n=0;n<i;n++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)s.push("");else{const c=t[e+n],l=tZ(r,c);l?s.push(l.name):s.push("")}return s}function tZ(t,e){for(const i of t.values)if(i.value===e)return i;return null}const iZ="schemaClassId";function rZ(t,e){var i,r;const s=t.getExtension(Bd);if(s&&s.propertyTables)for(const n of s.propertyTables){const c=n.class,l=(r=(i=s.schema)==null?void 0:i.classes)==null?void 0:r[c];n.properties&&l&&sZ(n,l,t)}}function sZ(t,e,i){for(const r in t.properties){const s=t.properties[r].data;if(s){const n=e.properties[r];if(n){const c=lZ(s,n,i);t.properties[r]=c}}}}function nZ(t,e,i=iZ){let r=t.getExtension(Bd);r||(r=t.addExtension(Bd)),r.schema=oZ(e,i,r.schema);const s=aZ(e,i,r.schema);return r.propertyTables||(r.propertyTables=[]),r.propertyTables.push(s)-1}function oZ(t,e,i){const r=i??{id:"schema_id"},s={properties:{}};for(const n of t){const c={type:n.elementType,componentType:n.componentType};s.properties[n.name]=c}return r.classes={},r.classes[e]=s,r}function aZ(t,e,i){var r;const s={class:e,count:0};let n=0;const c=(r=i.classes)==null?void 0:r[e];for(const l of t){if(n===0&&(n=l.values.length),n!==l.values.length&&l.values.length)throw new Error("Illegal values in attributes");c!=null&&c.properties[l.name]&&(s.properties||(s.properties={}),s.properties[l.name]={values:0,data:l.values})}return s.count=n,s}function lZ(t,e,i){const r={values:0};if(e.type==="STRING"){const{stringData:s,stringOffsets:n}=hZ(t);r.stringOffsets=gb(n,i),r.values=gb(s,i)}else if(e.type==="SCALAR"&&e.componentType){const s=uZ(t,e.componentType);r.values=gb(s,i)}return r}const cZ={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function uZ(t,e){const i=[];for(const s of t)i.push(Number(s));const r=cZ[e];if(!r)throw new Error("Illegal component type");return new r(i)}function hZ(t){const e=new TextEncoder,i=[];let r=0;for(const f of t){const y=e.encode(f);r+=y.length,i.push(y)}const s=new Uint8Array(r),n=[];let c=0;for(const f of i)s.set(f,c),n.push(c),c+=f.length;n.push(c);const l=new Uint32Array(n);return{stringData:s,stringOffsets:l}}function gb(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const dZ=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:nZ,decode:UJ,encode:zJ,name:NJ},Symbol.toStringTag,{value:"Module"})),dB="EXT_feature_metadata",pZ=dB;async function fZ(t,e){const i=new es(t);mZ(i,e)}function mZ(t,e){var i,r;if(!((i=e.gltf)!=null&&i.loadBuffers))return;const s=t.getExtension(dB);s&&((r=e.gltf)!=null&&r.loadImages&&gZ(t,s),_Z(t,s))}function gZ(t,e){const i=e.schema;if(!i)return;const r=i.classes,{featureTextures:s}=e;if(r&&s)for(const n in r){const c=r[n],l=vZ(s,n);l&&wZ(t,l,c)}}function _Z(t,e){const i=e.schema;if(!i)return;const r=i.classes,s=e.featureTables;if(r&&s)for(const n in r){const c=yZ(s,n);c&&bZ(t,i,c)}}function yZ(t,e){for(const i in t){const r=t[i];if(r.class===e)return r}return null}function vZ(t,e){for(const i in t){const r=t[i];if(r.class===e)return r}return null}function bZ(t,e,i){var r,s;if(!i.class)return;const n=(r=e.classes)==null?void 0:r[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const c=i.count;for(const l in n.properties){const f=n.properties[l],y=(s=i.properties)==null?void 0:s[l];if(y){const E=xZ(t,e,f,c,y);y.data=E}}}function wZ(t,e,i){var r;const s=e.class;for(const n in i.properties){const c=(r=e==null?void 0:e.properties)==null?void 0:r[n];if(c){const l=CZ(t,c,s);c.data=l}}}function xZ(t,e,i,r,s){let n=[];const c=s.bufferView,l=t.getTypedArrayForBufferView(c),f=EZ(t,i,s,r),y=AZ(t,i,s,r);return i.type==="STRING"||i.componentType==="STRING"?n=hB(r,l,f,y):TZ(i)&&(n=SZ(i,r,l,f)),n}function EZ(t,e,i,r){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?L1(t,i.arrayOffsetBufferView,i.offsetType||"UINT32",r):null}function AZ(t,e,i,r){return typeof i.stringOffsetBufferView<"u"?L1(t,i.stringOffsetBufferView,i.offsetType||"UINT32",r):null}function TZ(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function SZ(t,e,i,r){const s=t.type==="ARRAY",n=t.componentCount,c="SCALAR",l=t.componentType||t.type,f=EE(c,l),y=i.byteLength/f,E=O1(i,c,l,y);return s?r?cB(E,e,r,i.length,f):n?uB(E,e,n):[]:E}function CZ(t,e,i){const r=t.gltf.json;if(!r.meshes)return[];const s=[];for(const n of r.meshes)for(const c of n.primitives)IZ(t,i,e,s,c);return s}function IZ(t,e,i,r,s){const n={channels:i.channels,...i.texture},c=AE(t,n,s);c&&lB(t,e,c,r,s)}const RZ=Object.freeze(Object.defineProperty({__proto__:null,decode:fZ,name:pZ},Symbol.toStringTag,{value:"Module"})),MZ="4.3.1",Ld=!0,hI=1735152710,SE=12,Q0=8,PZ=1313821514,kZ=5130562,BZ=0,LZ=0,OZ=1;function DZ(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function FZ(t,e=0,i={}){const r=new DataView(t),{magic:s=hI}=i,n=r.getUint32(e,!1);return n===s||n===hI}function NZ(t,e,i=0,r={}){const s=new DataView(e),n=DZ(s,i+0),c=s.getUint32(i+4,Ld),l=s.getUint32(i+8,Ld);switch(Object.assign(t,{header:{byteOffset:i,byteLength:l,hasBinChunk:!1},type:n,version:c,json:{},binChunks:[]}),i+=SE,t.version){case 1:return UZ(t,s,i);case 2:return zZ(t,s,i,r={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function UZ(t,e,i){Ui(t.header.byteLength>SE+Q0);const r=e.getUint32(i+0,Ld),s=e.getUint32(i+4,Ld);return i+=Q0,Ui(s===BZ),xx(t,e,i,r),i+=r,i+=Ex(t,e,i,t.header.byteLength),i}function zZ(t,e,i,r){return Ui(t.header.byteLength>SE+Q0),jZ(t,e,i,r),i+t.header.byteLength}function jZ(t,e,i,r){for(;i+8<=t.header.byteLength;){const s=e.getUint32(i+0,Ld),n=e.getUint32(i+4,Ld);switch(i+=Q0,n){case PZ:xx(t,e,i,s);break;case kZ:Ex(t,e,i,s);break;case LZ:r.strict||xx(t,e,i,s);break;case OZ:r.strict||Ex(t,e,i,s);break}i+=Mm(s,4)}return i}function xx(t,e,i,r){const s=new Uint8Array(e.buffer,i,r),n=new TextDecoder("utf8").decode(s);return t.json=JSON.parse(n),Mm(r,4)}function Ex(t,e,i,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:i,byteLength:r,arrayBuffer:e.buffer}),Mm(r,4)}function pB(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const i=e.baseUri||e.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return i.substr(0,i.lastIndexOf("/")+1)+t}const GZ="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",VZ="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",$Z=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),HZ=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),qZ={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},WZ={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function XZ(t,e,i,r,s,n="NONE"){const c=await KZ();YZ(c,c.exports[WZ[s]],t,e,i,r,c.exports[qZ[n||"NONE"]])}let _b;async function KZ(){return _b||(_b=JZ()),_b}async function JZ(){let t=GZ;WebAssembly.validate($Z)&&(t=VZ,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(ZZ(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function ZZ(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const s=t.charCodeAt(r);e[r]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let i=0;for(let r=0;r<t.length;++r)e[i++]=e[r]<60?HZ[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,i)}function YZ(t,e,i,r,s,n,c){const l=t.exports.sbrk,f=r+3&-4,y=l(f*s),E=l(n.length),T=new Uint8Array(t.exports.memory.buffer);T.set(n,E);const R=e(y,r,s,E,n.length);if(R===0&&c&&c(y,f,s),i.set(T.subarray(y,y+r*s)),l(y-l(0)),R!==0)throw new Error(`Malformed buffer data: ${R}`)}const e1="EXT_meshopt_compression",QZ=e1;async function eY(t,e){var i,r;const s=new es(t);if(!((i=e==null?void 0:e.gltf)!=null&&i.decompressMeshes)||!((r=e.gltf)!=null&&r.loadBuffers))return;const n=[];for(const c of t.json.bufferViews||[])n.push(tY(s,c));await Promise.all(n),s.removeExtension(e1)}async function tY(t,e){const i=t.getObjectExtension(e,e1);if(i){const{byteOffset:r=0,byteLength:s=0,byteStride:n,count:c,mode:l,filter:f="NONE",buffer:y}=i,E=t.gltf.buffers[y],T=new Uint8Array(E.arrayBuffer,E.byteOffset+r,s),R=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await XZ(R,c,n,T,l,f),t.removeObjectExtension(e,e1)}}const iY=Object.freeze(Object.defineProperty({__proto__:null,decode:eY,name:QZ},Symbol.toStringTag,{value:"Module"})),Uh="EXT_texture_webp",rY=Uh;function sY(t,e){const i=new es(t);if(!I7("image/webp")){if(i.getRequiredExtensions().includes(Uh))throw new Error(`gltf: Required extension ${Uh} not supported by browser`);return}const{json:r}=i;for(const s of r.textures||[]){const n=i.getObjectExtension(s,Uh);n&&(s.source=n.source),i.removeObjectExtension(s,Uh)}i.removeExtension(Uh)}const nY=Object.freeze(Object.defineProperty({__proto__:null,name:rY,preprocess:sY},Symbol.toStringTag,{value:"Module"})),o0="KHR_texture_basisu",oY=o0;function aY(t,e){const i=new es(t),{json:r}=i;for(const s of r.textures||[]){const n=i.getObjectExtension(s,o0);n&&(s.source=n.source,i.removeObjectExtension(s,o0))}i.removeExtension(o0)}const lY=Object.freeze(Object.defineProperty({__proto__:null,name:oY,preprocess:aY},Symbol.toStringTag,{value:"Module"})),cY="4.3.1",uY={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:cY,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function hY(t,e,i){const r=fB(e.metadata),s=[],n=dY(e.attributes);for(const c in t){const l=t[c],f=dI(c,l,n[c]);s.push(f)}if(i){const c=dI("indices",i);s.push(c)}return{fields:s,metadata:r}}function dY(t){const e={};for(const i in t){const r=t[i];e[r.name||"undefined"]=r}return e}function dI(t,e,i){const r=i?fB(i.metadata):void 0;return X9(t,e,r)}function fB(t){Object.entries(t);const e={};for(const i in t)e[`${i}.string`]=JSON.stringify(t[i]);return e}const pI={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},pY={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},fY=4;class mY{constructor(e){O(this,"draco"),O(this,"decoder"),O(this,"metadataQuerier"),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,i={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(i);const s=this.decoder.GetEncodedGeometryType(r),n=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(s){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(r,n);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(r,n);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!n.ptr){const T=`DRACO decompression failed: ${c.error_msg()}`;throw new Error(T)}const l=this._getDracoLoaderData(n,s,i),f=this._getMeshData(n,l,i),y=yP(f.attributes),E=hY(f.attributes,l,f.indices);return{loader:"draco",loaderData:l,header:{vertexCount:n.num_points(),boundingBox:y},...f,schema:E}}finally{this.draco.destroy(r),n&&this.draco.destroy(n)}}_getDracoLoaderData(e,i,r){const s=this._getTopLevelMetadata(e),n=this._getDracoAttributes(e,r);return{geometry_type:i,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:n}}_getDracoAttributes(e,i){const r={};for(let s=0;s<e.num_attributes();s++){const n=this.decoder.GetAttribute(e,s),c=this._getAttributeMetadata(e,s);r[n.unique_id()]={unique_id:n.unique_id(),attribute_type:n.attribute_type(),data_type:n.data_type(),num_components:n.num_components(),byte_offset:n.byte_offset(),byte_stride:n.byte_stride(),normalized:n.normalized(),attribute_index:s,metadata:c};const l=this._getQuantizationTransform(n,i);l&&(r[n.unique_id()].quantization_transform=l);const f=this._getOctahedronTransform(n,i);f&&(r[n.unique_id()].octahedron_transform=f)}return r}_getMeshData(e,i,r){const s=this._getMeshAttributes(i,e,r);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,i,r){const s={};for(const n of Object.values(e.attributes)){const c=this._deduceAttributeName(n,r);n.name=c;const l=this._getAttributeValues(i,n);if(l){const{value:f,size:y}=l;s[c]={value:f,size:y,byteOffset:n.byte_offset,byteStride:n.byte_stride,normalized:n.normalized}}}return s}_getTriangleListIndices(e){const i=e.num_faces()*3,r=i*fY,s=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,s),new Uint32Array(this.draco.HEAPF32.buffer,s,i).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const i=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,i),yY(i)}finally{this.draco.destroy(i)}}_getAttributeValues(e,i){const r=pY[i.data_type];if(!r)return console.warn(`DRACO: Unsupported attribute type ${i.data_type}`),null;const s=i.num_components,n=e.num_points()*s,c=n*r.BYTES_PER_ELEMENT,l=gY(this.draco,r);let f;const y=this.draco._malloc(c);try{const E=this.decoder.GetAttribute(e,i.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,E,l,c,y),f=new r(this.draco.HEAPF32.buffer,y,n).slice()}finally{this.draco._free(y)}return{value:f,size:s}}_deduceAttributeName(e,i){const r=e.unique_id;for(const[c,l]of Object.entries(i.extraAttributes||{}))if(l===r)return c;const s=e.attribute_type;for(const c in pI)if(this.draco[c]===s)return pI[c];const n=i.attributeNameEntry||"name";return e.metadata[n]?e.metadata[n].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(e){const i=this.decoder.GetMetadata(e);return this._getDracoMetadata(i)}_getAttributeMetadata(e,i){const r=this.decoder.GetAttributeMetadata(e,i);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const i={},r=this.metadataQuerier.NumEntries(e);for(let s=0;s<r;s++){const n=this.metadataQuerier.GetEntryName(e,s);i[n]=this._getDracoMetadataField(e,n)}return i}_getDracoMetadataField(e,i){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,i,r);const s=_Y(r);return{int:this.metadataQuerier.GetIntEntry(e,i),string:this.metadataQuerier.GetStringEntry(e,i),double:this.metadataQuerier.GetDoubleEntry(e,i),intArray:s}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:i=[],octahedronAttributes:r=[]}=e,s=[...i,...r];for(const n of s)this.decoder.SkipAttributeTransform(this.draco[n])}_getQuantizationTransform(e,i){const{quantizedAttributes:r=[]}=i,s=e.attribute_type();if(r.map(n=>this.decoder[n]).includes(s)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(e))return{quantization_bits:n.quantization_bits(),range:n.range(),min_values:new Float32Array([1,2,3]).map(c=>n.min_value(c))}}finally{this.draco.destroy(n)}}return null}_getOctahedronTransform(e,i){const{octahedronAttributes:r=[]}=i,s=e.attribute_type();if(r.map(n=>this.decoder[n]).includes(s)){const n=new this.draco.AttributeQuantizationTransform;try{if(n.InitFromAttribute(e))return{quantization_bits:n.quantization_bits()}}finally{this.draco.destroy(n)}}return null}}function gY(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function _Y(t){const e=t.size(),i=new Int32Array(e);for(let r=0;r<e;r++)i[r]=t.GetValue(r);return i}function yY(t){const e=t.size(),i=new Int32Array(e);for(let r=0;r<e;r++)i[r]=t.GetValue(r);return i}const vY="1.5.6",bY="1.4.1",yb=`https://www.gstatic.com/draco/versioned/decoders/${vY}`,ln={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},vb={[ln.DECODER]:`${yb}/${ln.DECODER}`,[ln.DECODER_WASM]:`${yb}/${ln.DECODER_WASM}`,[ln.FALLBACK_DECODER]:`${yb}/${ln.FALLBACK_DECODER}`,[ln.ENCODER]:`https://raw.githubusercontent.com/google/draco/${bY}/javascript/${ln.ENCODER}`};let pf;async function wY(t){const e=t.modules||{};return e.draco3d?pf||(pf=e.draco3d.createDecoderModule({}).then(i=>({draco:i}))):pf||(pf=xY(t)),await pf}async function xY(t){let e,i;switch(t.draco&&t.draco.decoderType){case"js":e=await fu(vb[ln.FALLBACK_DECODER],"draco",t,ln.FALLBACK_DECODER);break;case"wasm":default:[e,i]=await Promise.all([await fu(vb[ln.DECODER],"draco",t,ln.DECODER),await fu(vb[ln.DECODER_WASM],"draco",t,ln.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await EY(e,i)}function EY(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(r=>{t({...i,onModuleLoaded:s=>r({draco:s})})})}const mB={...uY,parse:AY};async function AY(t,e){const{draco:i}=await wY(e),r=new mY(i);try{return r.parseSync(t,e==null?void 0:e.draco)}finally{r.destroy()}}function TY(t){const e={};for(const i in t){const r=t[i];if(i!=="indices"){const s=gB(r);e[i]=s}}return e}function gB(t){const{buffer:e,size:i,count:r}=SY(t);return{value:e,size:i,byteOffset:0,count:r,type:sB(i),componentType:B1(e)}}function SY(t){let e=t,i=1,r=0;return t&&t.value&&(e=t.value,i=t.size||1),e&&(ArrayBuffer.isView(e)||(e=CY(e,Float32Array)),r=e.length/i),{buffer:e,size:i,count:r}}function CY(t,e,i=!1){return t?Array.isArray(t)?new e(t):i&&!(t instanceof e)?new e(t):t:null}const Tu="KHR_draco_mesh_compression",IY=Tu;function RY(t,e,i){const r=new es(t);for(const s of _B(r))r.getObjectExtension(s,Tu)}async function MY(t,e,i){var r;if(!((r=e==null?void 0:e.gltf)!=null&&r.decompressMeshes))return;const s=new es(t),n=[];for(const c of _B(s))s.getObjectExtension(c,Tu)&&n.push(kY(s,c,e,i));await Promise.all(n),s.removeExtension(Tu)}function PY(t,e={}){const i=new es(t);for(const r of i.json.meshes||[])BY(),i.addRequiredExtension(Tu)}async function kY(t,e,i,r){const s=t.getObjectExtension(e,Tu);if(!s)return;const n=t.getTypedArrayForBufferView(s.bufferView),c=U2(n.buffer,n.byteOffset),l={...i};delete l["3d-tiles"];const f=await Rm(c,mB,l,r),y=TY(f.attributes);for(const[E,T]of Object.entries(y))if(E in e.attributes){const R=e.attributes[E],D=t.getAccessor(R);D!=null&&D.min&&D!=null&&D.max&&(T.min=D.min,T.max=D.max)}e.attributes=y,f.indices&&(e.indices=gB(f.indices)),t.removeObjectExtension(e,Tu),LY(e)}function BY(t,e,i=4,r,s){if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided")}function LY(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*_B(t){for(const e of t.json.meshes||[])for(const i of e.primitives)yield i}const OY=Object.freeze(Object.defineProperty({__proto__:null,decode:MY,encode:PY,name:IY,preprocess:RY},Symbol.toStringTag,{value:"Module"})),D1="KHR_texture_transform",DY=D1,M_=new Be,FY=new pr,NY=new pr;async function UY(t,e){var i;if(!new es(t).hasExtension(D1)||!((i=e.gltf)!=null&&i.loadBuffers))return;const r=t.json.materials||[];for(let s=0;s<r.length;s++)zY(s,t)}function zY(t,e){var i,r,s,n;const c=(i=e.json.materials)==null?void 0:i[t],l=[(r=c==null?void 0:c.pbrMetallicRoughness)==null?void 0:r.baseColorTexture,c==null?void 0:c.emissiveTexture,c==null?void 0:c.normalTexture,c==null?void 0:c.occlusionTexture,(s=c==null?void 0:c.pbrMetallicRoughness)==null?void 0:s.metallicRoughnessTexture],f=[];for(const y of l)y&&(n=y==null?void 0:y.extensions)!=null&&n[D1]&&jY(e,t,y,f)}function jY(t,e,i,r){const s=GY(i,r);if(!s)return;const n=t.json.meshes||[];for(const c of n)for(const l of c.primitives){const f=l.material;Number.isFinite(f)&&e===f&&VY(t,l,s)}}function GY(t,e){var i;const r=(i=t.extensions)==null?void 0:i[D1],{texCoord:s=0}=t,{texCoord:n=s}=r;if(e.findIndex(([c,l])=>c===s&&l===n)===-1){const c=qY(r);return s!==n&&(t.texCoord=n),e.push([s,n]),{originalTexCoord:s,texCoord:n,matrix:c}}return null}function VY(t,e,i){var r,s;const{originalTexCoord:n,texCoord:c,matrix:l}=i,f=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(f)){const y=(r=t.json.accessors)==null?void 0:r[f];if(y&&y.bufferView){const E=(s=t.json.bufferViews)==null?void 0:s[y.bufferView];if(E){const{arrayBuffer:T,byteOffset:R}=t.buffers[E.buffer],D=(R||0)+(y.byteOffset||0)+(E.byteOffset||0),{ArrayType:V,length:H}=xE(y,E),ee=rB[y.componentType],z=iB[y.type],W=E.byteStride||ee*z,q=new Float32Array(H);for(let ce=0;ce<y.count;ce++){const we=new V(T,D+ce*W,2);M_.set(we[0],we[1],1),M_.transformByMatrix3(l),q.set([M_[0],M_[1]],ce*z)}n===c?$Y(y,E,t.buffers,q):HY(c,y,e,t,q)}}}}function $Y(t,e,i,r){t.componentType=5126,i.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=i.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function HY(t,e,i,r,s){r.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const n=r.json.bufferViews;if(!n)return;n.push({buffer:r.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const c=r.json.accessors;c&&(c.push({bufferView:(n==null?void 0:n.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),i.attributes[`TEXCOORD_${t}`]=c.length-1)}function qY(t){const{offset:e=[0,0],rotation:i=0,scale:r=[1,1]}=t,s=new pr().set(1,0,0,0,1,0,e[0],e[1],1),n=FY.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),c=NY.set(r[0],0,0,0,r[1],0,0,0,1);return s.multiplyRight(n).multiplyRight(c)}const WY=Object.freeze(Object.defineProperty({__proto__:null,decode:UY,name:DY},Symbol.toStringTag,{value:"Module"})),hu="KHR_lights_punctual",XY=hu;async function KY(t){const e=new es(t),{json:i}=e,r=e.getExtension(hu);r&&(e.json.lights=r.lights,e.removeExtension(hu));for(const s of i.nodes||[]){const n=e.getObjectExtension(s,hu);n&&(s.light=n.light),e.removeObjectExtension(s,hu)}}async function JY(t){const e=new es(t),{json:i}=e;if(i.lights){const r=e.addExtension(hu);Dn(!r.lights),r.lights=i.lights,delete i.lights}if(e.json.lights){for(const r of e.json.lights){const s=r.node;e.addObjectExtension(s,hu,r)}delete e.json.lights}}const ZY=Object.freeze(Object.defineProperty({__proto__:null,decode:KY,encode:JY,name:XY},Symbol.toStringTag,{value:"Module"})),bm="KHR_materials_unlit",YY=bm;async function QY(t){const e=new es(t),{json:i}=e;for(const r of i.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,bm);e.removeExtension(bm)}function eQ(t){const e=new es(t),{json:i}=e;if(e.materials)for(const r of i.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,bm,{}),e.addExtension(bm))}const tQ=Object.freeze(Object.defineProperty({__proto__:null,decode:QY,encode:eQ,name:YY},Symbol.toStringTag,{value:"Module"})),Rf="KHR_techniques_webgl",iQ=Rf;async function rQ(t){const e=new es(t),{json:i}=e,r=e.getExtension(Rf);if(r){const s=nQ(r,e);for(const n of i.materials||[]){const c=e.getObjectExtension(n,Rf);c&&(n.technique=Object.assign({},c,s[c.technique]),n.technique.values=oQ(n.technique,e)),e.removeObjectExtension(n,Rf)}e.removeExtension(Rf)}}async function sQ(t,e){}function nQ(t,e){const{programs:i=[],shaders:r=[],techniques:s=[]}=t,n=new TextDecoder;return r.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=n.decode(e.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(c=>{c.fragmentShader=r[c.fragmentShader],c.vertexShader=r[c.vertexShader]}),s.forEach(c=>{c.program=i[c.program]}),s}function oQ(t,e){const i=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(r=>{t.uniforms[r].value&&!(r in i)&&(i[r]=t.uniforms[r].value)}),Object.keys(i).forEach(r=>{typeof i[r]=="object"&&i[r].index!==void 0&&(i[r].texture=e.getTexture(i[r].index))}),i}const aQ=Object.freeze(Object.defineProperty({__proto__:null,decode:rQ,encode:sQ,name:iQ},Symbol.toStringTag,{value:"Module"})),yB=[dZ,FJ,iY,nY,lY,OY,ZY,tQ,aQ,WY,RZ];function lQ(t,e={},i){var r;const s=yB.filter(n=>vB(n.name,e));for(const n of s)(r=n.preprocess)==null||r.call(n,t,e,i)}async function cQ(t,e={},i){var r;const s=yB.filter(n=>vB(n.name,e));for(const n of s)await((r=n.decode)==null?void 0:r.call(n,t,e,i))}function vB(t,e){var i;const r=((i=e==null?void 0:e.gltf)==null?void 0:i.excludeExtensions)||{};return!(t in r&&!r[t])}const bb="KHR_binary_glTF";function uQ(t){const e=new es(t),{json:i}=e;for(const r of i.images||[]){const s=e.getObjectExtension(r,bb);s&&Object.assign(r,s),e.removeObjectExtension(r,bb)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,e.removeExtension(bb)}const fI={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},hQ={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class dQ{constructor(){O(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),O(this,"json")}normalize(e,i){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!i.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),uQ(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const i in fI)this._convertTopLevelObjectToArray(e,i)}_convertTopLevelObjectToArray(e,i){const r=e[i];if(!(!r||Array.isArray(r))){e[i]=[];for(const s in r){const n=r[s];n.id=n.id||s;const c=e[i].length;e[i].push(n),this.idToIndexMap[i][s]=c}}}_convertObjectIdsToArrayIndices(e){for(const i in fI)this._convertIdsToIndices(e,i);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const i of e.textures)this._convertTextureIds(i);for(const i of e.meshes)this._convertMeshIds(i);for(const i of e.nodes)this._convertNodeIds(i);for(const i of e.scenes)this._convertSceneIds(i)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const i of e.primitives){const{attributes:r,indices:s,material:n}=i;for(const c in r)r[c]=this._convertIdToIndex(r[c],"accessor");s&&(i.indices=this._convertIdToIndex(s,"accessor")),n&&(i.material=this._convertIdToIndex(n,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(i=>this._convertIdToIndex(i,"node"))),e.meshes&&(e.meshes=e.meshes.map(i=>this._convertIdToIndex(i,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(i=>this._convertIdToIndex(i,"node")))}_convertIdsToIndices(e,i){e[i]||(console.warn(`gltf v1: json doesn't contain attribute ${i}`),e[i]=[]);for(const r of e[i])for(const s in r){const n=r[s],c=this._convertIdToIndex(n,s);r[s]=c}}_convertIdToIndex(e,i){const r=hQ[i];if(r in this.idToIndexMap){const s=this.idToIndexMap[r][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${i} with id ${e}`);return s}return e}_updateObjects(e){for(const i of this.json.buffers)delete i.type}_updateMaterial(e){var i,r,s;for(const n of e.materials){n.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const c=((i=n.values)==null?void 0:i.tex)||((r=n.values)==null?void 0:r.texture2d_0)||((s=n.values)==null?void 0:s.diffuseTex),l=e.textures.findIndex(f=>f.id===c);l!==-1&&(n.pbrMetallicRoughness.baseColorTexture={index:l})}}}function pQ(t,e={}){return new dQ().normalize(t,e)}async function fQ(t,e,i=0,r,s){var n,c,l;return mQ(t,e,i,r),pQ(t,{normalize:(n=r==null?void 0:r.gltf)==null?void 0:n.normalize}),lQ(t,r,s),(c=r==null?void 0:r.gltf)!=null&&c.loadBuffers&&t.json.buffers&&await gQ(t,r,s),(l=r==null?void 0:r.gltf)!=null&&l.loadImages&&await _Q(t,r,s),await cQ(t,r,s),t}function mQ(t,e,i,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!FZ(e,i,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=RN(e);else if(e instanceof ArrayBuffer){const c={};i=NZ(c,e,i,r.glb),Dn(c.type==="glTF",`Invalid GLB magic string ${c.type}`),t._glb=c,t.json=c.json}else Dn(!1,"GLTF: must be ArrayBuffer or string");const s=t.json.buffers||[];if(t.buffers=new Array(s.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:c}=t._glb;t.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const n=t.json.images||[];t.images=new Array(n.length).fill({})}async function gQ(t,e,i){var r,s;const n=t.json.buffers||[];for(let c=0;c<n.length;++c){const l=n[c];if(l.uri){const{fetch:f}=i;Dn(f);const y=pB(l.uri,e),E=await((r=i==null?void 0:i.fetch)==null?void 0:r.call(i,y)),T=await((s=E==null?void 0:E.arrayBuffer)==null?void 0:s.call(E));t.buffers[c]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete l.uri}else t.buffers[c]===null&&(t.buffers[c]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function _Q(t,e,i){const r=yQ(t),s=t.json.images||[],n=[];for(const c of r)n.push(vQ(t,s[c],c,e,i));return await Promise.all(n)}function yQ(t){const e=new Set,i=t.json.textures||[];for(const r of i)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function vQ(t,e,i,r,s){let n;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=pB(e.uri,r),{fetch:f}=s;n=await(await f(l)).arrayBuffer(),e.bufferView={data:n}}if(Number.isFinite(e.bufferView)){const l=xJ(t.json,t.buffers,e.bufferView);n=U2(l.buffer,l.byteOffset,l.byteLength)}Dn(n,"glTF image has no data");let c=await Rm(n,[xP,YK],{...r,mimeType:e.mimeType,basis:r.basis||{format:tB()}},s);c&&c[0]&&(c={compressed:!0,mipmaps:!1,width:c[0].width,height:c[0].height,data:c[0]}),t.images=t.images||[],t.images[i]=c}const wm={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:MZ,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:bQ,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function bQ(t,e={},i){e={...wm.options,...e},e.gltf={...wm.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await fQ({},t,r,e,i)}const wQ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xQ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},eo={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},EQ={magFilter:eo.TEXTURE_MAG_FILTER,minFilter:eo.TEXTURE_MIN_FILTER,wrapS:eo.TEXTURE_WRAP_S,wrapT:eo.TEXTURE_WRAP_T},AQ={[eo.TEXTURE_MAG_FILTER]:eo.LINEAR,[eo.TEXTURE_MIN_FILTER]:eo.NEAREST_MIPMAP_LINEAR,[eo.TEXTURE_WRAP_S]:eo.REPEAT,[eo.TEXTURE_WRAP_T]:eo.REPEAT};function TQ(){return{id:"default-sampler",parameters:AQ}}function SQ(t){return xQ[t]}function CQ(t){return wQ[t]}class IQ{constructor(){O(this,"baseUri",""),O(this,"jsonUnprocessed"),O(this,"json"),O(this,"buffers",[]),O(this,"images",[])}postProcess(e,i={}){const{json:r,buffers:s=[],images:n=[]}=e,{baseUri:c=""}=e;return Dn(r),this.baseUri=c,this.buffers=s,this.images=n,this.jsonUnprocessed=r,this.json=this._resolveTree(e.json,i),this.json}_resolveTree(e,i={}){const r={...e};return this.json=r,e.bufferViews&&(r.bufferViews=e.bufferViews.map((s,n)=>this._resolveBufferView(s,n))),e.images&&(r.images=e.images.map((s,n)=>this._resolveImage(s,n))),e.samplers&&(r.samplers=e.samplers.map((s,n)=>this._resolveSampler(s,n))),e.textures&&(r.textures=e.textures.map((s,n)=>this._resolveTexture(s,n))),e.accessors&&(r.accessors=e.accessors.map((s,n)=>this._resolveAccessor(s,n))),e.materials&&(r.materials=e.materials.map((s,n)=>this._resolveMaterial(s,n))),e.meshes&&(r.meshes=e.meshes.map((s,n)=>this._resolveMesh(s,n))),e.nodes&&(r.nodes=e.nodes.map((s,n)=>this._resolveNode(s,n)),r.nodes=r.nodes.map((s,n)=>this._resolveNodeChildren(s))),e.skins&&(r.skins=e.skins.map((s,n)=>this._resolveSkin(s,n))),e.scenes&&(r.scenes=e.scenes.map((s,n)=>this._resolveScene(s,n))),typeof this.json.scene=="number"&&r.scenes&&(r.scene=r.scenes[this.json.scene]),r}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,i){if(typeof i=="object")return i;const r=e&&e[i];return r||console.warn(`glTF file error: Could not find ${e}[${i}]`),r}_resolveScene(e,i){return{...e,id:e.id||`scene-${i}`,nodes:(e.nodes||[]).map(r=>this.getNode(r))}}_resolveNode(e,i){const r={...e,id:(e==null?void 0:e.id)||`node-${i}`};return e.mesh!==void 0&&(r.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(r.camera=this.getCamera(e.camera)),e.skin!==void 0&&(r.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(r.mesh=e.meshes.reduce((s,n)=>{const c=this.getMesh(n);return s.id=c.id,s.primitives=s.primitives.concat(c.primitives),s},{primitives:[]})),r}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(i=>this.getNode(i))),e}_resolveSkin(e,i){const r=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${i}`,inverseBindMatrices:r}}_resolveMesh(e,i){const r={...e,id:e.id||`mesh-${i}`,primitives:[]};return e.primitives&&(r.primitives=e.primitives.map(s=>{const n={...s,attributes:{},indices:void 0,material:void 0},c=s.attributes;for(const l in c)n.attributes[l]=this.getAccessor(c[l]);return s.indices!==void 0&&(n.indices=this.getAccessor(s.indices)),s.material!==void 0&&(n.material=this.getMaterial(s.material)),n})),r}_resolveMaterial(e,i){const r={...e,id:e.id||`material-${i}`};if(r.normalTexture&&(r.normalTexture={...r.normalTexture},r.normalTexture.texture=this.getTexture(r.normalTexture.index)),r.occlusionTexture&&(r.occlusionTexture={...r.occlusionTexture},r.occlusionTexture.texture=this.getTexture(r.occlusionTexture.index)),r.emissiveTexture&&(r.emissiveTexture={...r.emissiveTexture},r.emissiveTexture.texture=this.getTexture(r.emissiveTexture.index)),r.emissiveFactor||(r.emissiveFactor=r.emissiveTexture?[1,1,1]:[0,0,0]),r.pbrMetallicRoughness){r.pbrMetallicRoughness={...r.pbrMetallicRoughness};const s=r.pbrMetallicRoughness;s.baseColorTexture&&(s.baseColorTexture={...s.baseColorTexture},s.baseColorTexture.texture=this.getTexture(s.baseColorTexture.index)),s.metallicRoughnessTexture&&(s.metallicRoughnessTexture={...s.metallicRoughnessTexture},s.metallicRoughnessTexture.texture=this.getTexture(s.metallicRoughnessTexture.index))}return r}_resolveAccessor(e,i){const r=SQ(e.componentType),s=CQ(e.type),n=r*s,c={...e,id:e.id||`accessor-${i}`,bytesPerComponent:r,components:s,bytesPerElement:n,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(c.bufferView=this.getBufferView(e.bufferView)),c.bufferView){const l=c.bufferView.buffer,{ArrayType:f,byteLength:y}=xE(c,c.bufferView),E=(c.bufferView.byteOffset||0)+(c.byteOffset||0)+l.byteOffset;let T=l.arrayBuffer.slice(E,E+y);c.bufferView.byteStride&&(T=this._getValueFromInterleavedBuffer(l,E,c.bufferView.byteStride,c.bytesPerElement,c.count)),c.value=new f(T)}return c}_getValueFromInterleavedBuffer(e,i,r,s,n){const c=new Uint8Array(n*s);for(let l=0;l<n;l++){const f=i+l*r;c.set(new Uint8Array(e.arrayBuffer.slice(f,f+s)),l*s)}return c.buffer}_resolveTexture(e,i){return{...e,id:e.id||`texture-${i}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):TQ(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,i){const r={id:e.id||`sampler-${i}`,...e,parameters:{}};for(const s in r){const n=this._enumSamplerParameter(s);n!==void 0&&(r.parameters[n]=r[s])}return r}_enumSamplerParameter(e){return EQ[e]}_resolveImage(e,i){const r={...e,id:e.id||`image-${i}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},s=this.images[i];return s&&(r.image=s),r}_resolveBufferView(e,i){const r=e.buffer,s=this.buffers[r].arrayBuffer;let n=this.buffers[r].byteOffset||0;return e.byteOffset&&(n+=e.byteOffset),{id:`bufferView-${i}`,...e,buffer:this.buffers[r],data:new Uint8Array(s,n,e.byteLength)}}_resolveCamera(e,i){const r={...e,id:e.id||`camera-${i}`};return r.perspective,r.orthographic,r}}function CE(t,e){return new IQ().postProcess(t,e)}async function RQ(t){const e=[];return t.scenes.forEach(i=>{i.traverse(r=>{Object.values(r.model.uniforms).forEach(s=>{s.loaded===!1&&e.push(s)})})}),await MQ(()=>e.some(i=>!i.loaded))}async function MQ(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const PQ=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,kQ=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,bB=[255,255,255,255],BQ={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:bB},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[wm]};class IE extends Hd{getShaders(){const e=[lE,hE];return this.props._lighting==="pbr"&&e.push(oE),super.getShaders({vs:PQ,fs:kQ,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:bB,transition:!0},instanceModelMatrix:Zk})}updateState(e){super.updateState(e);const{props:i,oldProps:r}=e;i.scenegraph!==r.scenegraph?this._updateScenegraph():i._animations!==r._animations&&this._applyAnimationsProp(this.state.animator,i._animations)}finalizeState(e){var i;super.finalizeState(e),(i=this.state.scenegraph)==null||i.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var e;const i=this.props,{device:r}=this.context;let s=null;if(i.scenegraph instanceof X0)s={scenes:[i.scenegraph]};else if(i.scenegraph&&typeof i.scenegraph=="object"){const f=i.scenegraph,y=f.json?CE(f):f,E=mJ(r,y,this._getModelOptions());s={gltf:y,...E},RQ(E).then(()=>{this.setNeedsRedraw()}).catch(T=>{this.raiseError(T,"loading glTF")})}const n={layer:this,device:this.context.device},c=i.getScene(s,n),l=i.getAnimator(s,n);if(c instanceof yd){(e=this.state.scenegraph)==null||e.destroy(),this._applyAnimationsProp(l,i._animations);const f=[];c.traverse(y=>{y instanceof ox&&f.push(y.model)}),this.setState({scenegraph:c,animator:l,models:f}),this.getAttributeManager().invalidateAll()}else c!==null&&fi.warn("invalid scenegraph:",c)()}_applyAnimationsProp(e,i){if(!e||!i)return;const r=e.getAnimations();Object.keys(i).sort().forEach(s=>{const n=i[s];if(s==="*")r.forEach(c=>{Object.assign(c,n)});else if(Number.isFinite(Number(s))){const c=Number(s);c>=0&&c<r.length?Object.assign(r[c],n):fi.warn(`animation ${s} not found`)()}else{const c=r.find(({name:l})=>l===s);c?Object.assign(c,n):fi.warn(`animation ${s} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let i;return e&&(typeof e=="function"?i=e({gl:this.context.gl,layer:this}):i=e),{imageBasedLightingEnvironment:i,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:i,renderPass:r}=this.context,{sizeScale:s,sizeMinPixels:n,sizeMaxPixels:c,opacity:l,coordinateSystem:f}=this.props,y=this.getNumInstances();this.state.scenegraph.traverse((E,{worldMatrix:T})=>{if(E instanceof ox){const{model:R}=E;R.setInstanceCount(y),R.setUniforms({sizeScale:s,opacity:l,sizeMinPixels:n,sizeMaxPixels:c,composeModelMatrix:Yk(i,f),sceneModelMatrix:T,u_Camera:R.uniforms.project_uCameraPosition}),R.draw(r)}})}}IE.defaultProps=BQ;IE.layerName="ScenegraphLayer";const LQ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,OQ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function DQ(t){const e=t.positions||t.POSITION,i=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(i*4).fill(255),normalized:!0})}const FQ={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class RE extends wE{getShaders(){const e=super.getShaders();return e.modules.push(oE),{...e,vs:LQ,fs:OQ}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const i=this.getAttributeManager();e&&i.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:i,oldProps:r}=e;i.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(i.pbrMaterial)}draw(e){const{featureIds:i}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!i}),super.draw(e))}getModel(e){const{id:i,pbrMaterial:r}=this.props,s=this.parseMaterial(r,e);this.setState({parsedPBRMaterial:s});const n=this.getShaders();return DQ(e.attributes),new Pd(this.context.device,{...this.getShaders(),id:i,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...n.defines,...s==null?void 0:s.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:s==null?void 0:s.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:i}=this.state;if(i){const{mesh:r}=this.props,s=this.parseMaterial(e,r);this.setState({parsedPBRMaterial:s}),i.setBindings(s.bindings),i.setUniforms(s.uniforms)}}parseMaterial(e,i){const r=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return Qk(this.context.device,{unlit:r,...e},{NORMAL:i.attributes.normals,TEXCOORD_0:i.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const i=this.props.featureIds,r=new Uint8ClampedArray(i.length*e.size),s=[];for(let n=0;n<i.length;n++)this.encodePickingColor(i[n],s),r[n*3]=s[0],r[n*3+1]=s[1],r[n*3+2]=s[2];e.value=r}finalizeState(e){var i;super.finalizeState(e),(i=this.state.parsedPBRMaterial)==null||i.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}}RE.layerName="MeshLayer";RE.defaultProps=FQ;const NQ=6378137,UQ=6378137,zQ=6356752314245179e-9;function F1(t){return t}new Be;function jQ(t,e=[],i=F1){return"longitude"in t?(e[0]=i(t.longitude),e[1]=i(t.latitude),e[2]=t.height):"x"in t?(e[0]=i(t.x),e[1]=i(t.y),e[2]=t.z):(e[0]=i(t[0]),e[1]=i(t[1]),e[2]=t[2]),e}function GQ(t,e=[]){return jQ(t,e,Or._cartographicRadians?F1:wj)}function VQ(t,e,i=F1){return"longitude"in e?(e.longitude=i(t[0]),e.latitude=i(t[1]),e.height=t[2]):"x"in e?(e.x=i(t[0]),e.y=i(t[1]),e.z=t[2]):(e[0]=i(t[0]),e[1]=i(t[1]),e[2]=t[2]),e}function $Q(t,e){return VQ(t,e,Or._cartographicRadians?F1:xj)}const mI=1e-14,HQ=new Be,gI={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},wb={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},ff={east:new Be,north:new Be,up:new Be,west:new Be,south:new Be,down:new Be},qQ=new Be,WQ=new Be,XQ=new Be;function _I(t,e,i,r,s,n){const c=gI[e]&&gI[e][i];Io(c&&(!r||r===c));let l,f,y;const E=HQ.copy(s);if(Do(E.x,0,mI)&&Do(E.y,0,mI)){const T=Math.sign(E.z);l=qQ.fromArray(wb[e]),e!=="east"&&e!=="west"&&l.scale(T),f=WQ.fromArray(wb[i]),i!=="east"&&i!=="west"&&f.scale(T),y=XQ.fromArray(wb[r]),r!=="east"&&r!=="west"&&y.scale(T)}else{const{up:T,east:R,north:D}=ff;R.set(-E.y,E.x,0).normalize(),t.geodeticSurfaceNormal(E,T),D.copy(T).cross(R);const{down:V,west:H,south:ee}=ff;V.copy(T).scale(-1),H.copy(R).scale(-1),ee.copy(D).scale(-1),l=ff[e],f=ff[i],y=ff[r]}return n[0]=l.x,n[1]=l.y,n[2]=l.z,n[3]=0,n[4]=f.x,n[5]=f.y,n[6]=f.z,n[7]=0,n[8]=y.x,n[9]=y.y,n[10]=y.z,n[11]=0,n[12]=E.x,n[13]=E.y,n[14]=E.z,n[15]=1,n}const Mh=new Be,KQ=new Be,JQ=new Be;function ZQ(t,e,i=[]){const{oneOverRadii:r,oneOverRadiiSquared:s,centerToleranceSquared:n}=e;Mh.from(t);const c=Mh.x,l=Mh.y,f=Mh.z,y=r.x,E=r.y,T=r.z,R=c*c*y*y,D=l*l*E*E,V=f*f*T*T,H=R+D+V,ee=Math.sqrt(1/H);if(!Number.isFinite(ee))return;const z=KQ;if(z.copy(t).scale(ee),H<n)return z.to(i);const W=s.x,q=s.y,ce=s.z,we=JQ;we.set(z.x*W*2,z.y*q*2,z.z*ce*2);let re=(1-ee)*Mh.len()/(.5*we.len()),be=0,me,Te,Pe,ze;do{re-=be,me=1/(1+re*W),Te=1/(1+re*q),Pe=1/(1+re*ce);const Ke=me*me,We=Te*Te,Ze=Pe*Pe,Ft=Ke*me,ci=We*Te,Gt=Ze*Pe;ze=R*Ke+D*We+V*Ze-1;const et=-2*(R*Ft*W+D*ci*q+V*Gt*ce);be=ze/et}while(Math.abs(ze)>jG);return Mh.scale([me,Te,Pe]).to(i)}const P_=new Be,yI=new Be,YQ=new Be,wo=new Be,QQ=new Be,k_=new Be;class zi{constructor(e=0,i=0,r=0){this.centerToleranceSquared=zG,Io(e>=0),Io(i>=0),Io(r>=0),this.radii=new Be(e,i,r),this.radiiSquared=new Be(e*e,i*i,r*r),this.radiiToTheFourth=new Be(e*e*e*e,i*i*i*i,r*r*r*r),this.oneOverRadii=new Be(e===0?0:1/e,i===0?0:1/i,r===0?0:1/r),this.oneOverRadiiSquared=new Be(e===0?0:1/(e*e),i===0?0:1/(i*i),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,i,r),this.maximumRadius=Math.max(e,i,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,i=[0,0,0]){const r=yI,s=YQ,[,,n]=e;this.geodeticSurfaceNormalCartographic(e,r),s.copy(this.radiiSquared).scale(r);const c=Math.sqrt(r.dot(s));return s.scale(1/c),r.scale(n),s.add(r),s.to(i)}cartesianToCartographic(e,i=[0,0,0]){k_.from(e);const r=this.scaleToGeodeticSurface(k_,wo);if(!r)return;const s=this.geodeticSurfaceNormal(r,yI),n=QQ;n.copy(k_).subtract(r);const c=Math.atan2(s.y,s.x),l=Math.asin(s.z),f=Math.sign(tE(n,k_))*B4(n);return $Q([c,l,f],i)}eastNorthUpToFixedFrame(e,i=new ai){return _I(this,"east","north","up",e,i)}localFrameToFixedFrame(e,i,r,s,n=new ai){return _I(this,e,i,r,s,n)}geocentricSurfaceNormal(e,i=[0,0,0]){return P_.from(e).normalize().to(i)}geodeticSurfaceNormalCartographic(e,i=[0,0,0]){const r=GQ(e),s=r[0],n=r[1],c=Math.cos(n);return P_.set(c*Math.cos(s),c*Math.sin(s),Math.sin(n)).normalize(),P_.to(i)}geodeticSurfaceNormal(e,i=[0,0,0]){return P_.from(e).scale(this.oneOverRadiiSquared).normalize().to(i)}scaleToGeodeticSurface(e,i){return ZQ(e,this,i)}scaleToGeocentricSurface(e,i=[0,0,0]){wo.from(e);const r=wo.x,s=wo.y,n=wo.z,c=this.oneOverRadiiSquared,l=1/Math.sqrt(r*r*c.x+s*s*c.y+n*n*c.z);return wo.multiplyScalar(l).to(i)}transformPositionToScaledSpace(e,i=[0,0,0]){return wo.from(e).scale(this.oneOverRadii).to(i)}transformPositionFromScaledSpace(e,i=[0,0,0]){return wo.from(e).scale(this.radii).to(i)}getSurfaceNormalIntersectionWithZAxis(e,i=0,r=[0,0,0]){Io(Do(this.radii.x,this.radii.y,V4)),Io(this.radii.z>0),wo.from(e);const s=wo.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-i))return wo.set(0,0,s).to(r)}}zi.WGS84=new zi(NQ,UQ,zQ);class eee{constructor(e,i,r){O(this,"item"),O(this,"previous"),O(this,"next"),this.item=e,this.previous=i,this.next=r}}class tee{constructor(){O(this,"head",null),O(this,"tail",null),O(this,"_length",0)}get length(){return this._length}add(e){const i=new eee(e,this.tail,null);return this.tail?(this.tail.next=i,this.tail=i):(this.head=i,this.tail=i),++this._length,i}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,i){e!==i&&(this.remove(i),this._insert(e,i))}_insert(e,i){const r=e.next;e.next=i,this.tail===e?this.tail=i:r.previous=i,i.next=r,i.previous=e,++this._length}}class iee{constructor(){O(this,"_list"),O(this,"_sentinel"),O(this,"_trimTiles"),this._list=new tee,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const i=e._cacheNode;i&&this._list.splice(this._sentinel,i)}add(e,i,r){i._cacheNode||(i._cacheNode=this._list.add(i),r&&r(e,i))}unloadTile(e,i,r){const s=i._cacheNode;s&&(this._list.remove(s),i._cacheNode=null,r&&r(e,i))}unloadTiles(e,i){const r=this._trimTiles;this._trimTiles=!1;const s=this._list,n=e.maximumMemoryUsage*1024*1024,c=this._sentinel;let l=s.head;for(;l!==c&&(e.gpuMemoryUsageInBytes>n||r);){const f=l.item;l=l.next,this.unloadTile(e,f,i)}}trim(){this._trimTiles=!0}}function ree(t,e){Ui(t),Ui(e);const{rtcCenter:i,gltfUpAxis:r}=e,{computedTransform:s,boundingVolume:{center:n}}=t;let c=new ai(s);switch(i&&c.translate(i),r){case"Z":break;case"Y":const E=new ai().rotateX(Math.PI/2);c=c.multiplyRight(E);break;case"X":const T=new ai().rotateY(-Math.PI/2);c=c.multiplyRight(T);break}e.isQuantized&&c.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const l=new Be(n);e.cartesianModelMatrix=c,e.cartesianOrigin=l;const f=zi.WGS84.cartesianToCartographic(l,new Be),y=zi.WGS84.eastNorthUpToFixedFrame(l).invert();e.cartographicModelMatrix=y.multiplyRight(c),e.cartographicOrigin=f,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const vI=new Be,xb=new Be,Ax=new so([new aa,new aa,new aa,new aa,new aa,new aa]);function see(t,e){const{cameraDirection:i,cameraUp:r,height:s}=t,{metersPerUnit:n}=t.distanceScales,c=a0(t,t.center),l=zi.WGS84.eastNorthUpToFixedFrame(c),f=t.unprojectPosition(t.cameraPosition),y=zi.WGS84.cartographicToCartesian(f,new Be),E=new Be(l.transformAsVector(new Be(i).scale(n))).normalize(),T=new Be(l.transformAsVector(new Be(r).scale(n))).normalize();oee(t);const R=t.constructor,{longitude:D,latitude:V,width:H,bearing:ee,zoom:z}=t,W=new R({longitude:D,latitude:V,height:s,width:H,bearing:ee,zoom:z,pitch:0});return{camera:{position:y,direction:E,up:T},viewport:t,topDownViewport:W,height:s,cullingVolume:Ax,frameNumber:e,sseDenominator:1.15}}function nee(t,e,i){if(i===0||t.length<=i)return[t,[]];const r=[],{longitude:s,latitude:n}=e.viewport;for(const[y,E]of t.entries()){const[T,R]=E.header.mbs,D=Math.abs(s-T),V=Math.abs(n-R),H=Math.sqrt(V*V+D*D);r.push([y,H])}const c=r.sort((y,E)=>y[1]-E[1]),l=[];for(let y=0;y<i;y++)l.push(t[c[y][0]]);const f=[];for(let y=i;y<c.length;y++)f.push(t[c[y][0]]);return[l,f]}function oee(t){const e=t.getFrustumPlanes(),i=bI(e.near,t.cameraPosition),r=a0(t,i),s=a0(t,t.cameraPosition,xb);let n=0;Ax.planes[n++].fromPointNormal(r,vI.copy(r).subtract(s));for(const c in e){if(c==="near")continue;const l=e[c],f=bI(l,i,xb),y=a0(t,f,xb);Ax.planes[n++].fromPointNormal(y,vI.copy(r).subtract(y))}}function bI(t,e,i=new Be){const r=t.normal.dot(e);return i.copy(t.normal).scale(t.distance-r).add(e),i}function a0(t,e,i=new Be){const r=t.unprojectPosition(e);return zi.WGS84.cartographicToCartesian(r,i)}const aee=6378137,lee=6378137,Tx=6356752314245179e-9,od=new Be;function cee(t,e){if(t instanceof Nm){const{halfAxes:i}=t,r=hee(i);return Math.log2(Tx/(r+e[2]))}else if(t instanceof Fm){const{radius:i}=t;return Math.log2(Tx/(i+e[2]))}else if(t.width&&t.height){const{width:i,height:r}=t,s=Math.log2(aee/i),n=Math.log2(lee/r);return(s+n)/2}return 1}function wB(t,e,i){zi.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],od);const r=Math.sqrt(Math.pow(od[0]-i[0],2)+Math.pow(od[1]-i[1],2)+Math.pow(od[2]-i[2],2));return Math.log2(Tx/(r+e[2]))}function uee(t,e,i){const[r,s,n,c]=t;return wB({xmin:r,xmax:n,ymin:s,ymax:c,zmin:0,zmax:0},e,i)}function hee(t){t.getColumn(0,od);const e=t.getColumn(1),i=t.getColumn(2);return od.add(e).add(i).len()}const Pn={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Fo;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(Fo||(Fo={}));var Ha;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Ha||(Ha={}));var an;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(an||(an={}));var Od;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Od||(Od={}));const dee={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function xB(t){return t!=null}const Ms=new Be,l0=new Be,pee=new Be,fee=new Be,Xc=new Be,wI=new Be,xI=new Be,EI=new Be;function Eb(t,e,i){if(Ui(t,"3D Tile: boundingVolume must be defined"),t.box)return EB(t.box,e,i);if(t.region)return _ee(t.region);if(t.sphere)return gee(t.sphere,e,i);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function mee(t,e){if(t.box)return yee(e);if(t.region){const[i,r,s,n,c,l]=t.region;return[[Co(i),Co(r),c],[Co(s),Co(n),l]]}if(t.sphere)return vee(e);throw new Error("Unkown boundingVolume type")}function EB(t,e,i){const r=new Be(t[0],t[1],t[2]);e.transform(r,r);let s=[];if(t.length===10){const y=t.slice(3,6),E=new fm;E.fromArray(t,6);const T=new Be([1,0,0]),R=new Be([0,1,0]),D=new Be([0,0,1]);T.transformByQuaternion(E),T.scale(y[0]),R.transformByQuaternion(E),R.scale(y[1]),D.transformByQuaternion(E),D.scale(y[2]),s=[...T.toArray(),...R.toArray(),...D.toArray()]}else s=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const n=e.transformAsVector(s.slice(0,3)),c=e.transformAsVector(s.slice(3,6)),l=e.transformAsVector(s.slice(6,9)),f=new pr([n[0],n[1],n[2],c[0],c[1],c[2],l[0],l[1],l[2]]);return xB(i)?(i.center=r,i.halfAxes=f,i):new Nm(r,f)}function gee(t,e,i){const r=new Be(t[0],t[1],t[2]);e.transform(r,r);const s=e.getScale(l0),n=Math.max(Math.max(s[0],s[1]),s[2]),c=t[3]*n;return xB(i)?(i.center=r,i.radius=c,i):new Fm(r,c)}function _ee(t){const[e,i,r,s,n,c]=t,l=zi.WGS84.cartographicToCartesian([Co(e),Co(s),n],pee),f=zi.WGS84.cartographicToCartesian([Co(r),Co(i),c],fee),y=new Be().addVectors(l,f).multiplyByScalar(.5);return zi.WGS84.cartesianToCartographic(y,Xc),zi.WGS84.cartographicToCartesian([Co(r),Xc[1],Xc[2]],wI),zi.WGS84.cartographicToCartesian([Xc[0],Co(s),Xc[2]],xI),zi.WGS84.cartographicToCartesian([Xc[0],Xc[1],c],EI),EB([...y,...wI.subtract(y),...xI.subtract(y),...EI.subtract(y)],new ai)}function yee(t){const e=AB(),{halfAxes:i}=t,r=new Be(i.getColumn(0)),s=new Be(i.getColumn(1)),n=new Be(i.getColumn(2));for(let c=0;c<2;c++){for(let l=0;l<2;l++){for(let f=0;f<2;f++)Ms.copy(t.center),Ms.add(r),Ms.add(s),Ms.add(n),TB(e,Ms),n.negate();s.negate()}r.negate()}return e}function vee(t){const e=AB(),{center:i,radius:r}=t,s=zi.WGS84.scaleToGeodeticSurface(i,Ms);let n;s?n=zi.WGS84.geodeticSurfaceNormal(s):n=new Be(0,0,1);let c=new Be(n[2],-n[1],0);c.len()>0?c.normalize():c=new Be(0,1,0);const l=c.clone().cross(n);for(const f of[c,l,n]){l0.copy(f).scale(r);for(let y=0;y<2;y++)Ms.copy(i),Ms.add(l0),TB(e,Ms),l0.negate()}return e}function AB(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function TB(t,e){zi.WGS84.cartesianToCartographic(e,Ms),t[0][0]=Math.min(t[0][0],Ms[0]),t[0][1]=Math.min(t[0][1],Ms[1]),t[0][2]=Math.min(t[0][2],Ms[2]),t[1][0]=Math.max(t[1][0],Ms[0]),t[1][1]=Math.max(t[1][1],Ms[1]),t[1][2]=Math.max(t[1][2],Ms[2])}new Be;new Be;new ai;new Be;new Be;new Be;function bee(t,e){const i=t*e;return 1-Math.exp(-(i*i))}function wee(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const i=t.dynamicScreenSpaceErrorComputedDensity,r=t.dynamicScreenSpaceErrorFactor;return bee(e,i)*r}return 0}function xee(t,e,i){const r=t.tileset,s=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,n=i?s:t.lodMetricValue;if(n===0)return 0;const c=Math.max(t._distanceToCamera,1e-7),{height:l,sseDenominator:f}=e,{viewDistanceScale:y}=r.options;let E=n*l*(y||1)/(c*f);return E-=wee(r,c),E}const Ab=new Be,AI=new Be,Ul=new Be,TI=new Be,Eee=new Be,Tb=new ai,SI=new ai;function Aee(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const i=2*SB(t,e);return i<2?"OUT":!t.header.children||i<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function SB(t,e){const{topDownViewport:i}=e,r=t.header.mbs[1],s=t.header.mbs[0],n=t.header.mbs[2],c=t.header.mbs[3],l=[...t.boundingVolume.center],f=i.unprojectPosition(i.cameraPosition);zi.WGS84.cartographicToCartesian(f,Ab),AI.copy(Ab).subtract(l).normalize(),zi.WGS84.eastNorthUpToFixedFrame(l,Tb),SI.copy(Tb).invert(),Ul.copy(Ab).transform(SI);const y=Math.sqrt(Ul[0]*Ul[0]+Ul[1]*Ul[1]),E=y*y/Ul[2];TI.copy([Ul[0],Ul[1],E]);const T=TI.transform(Tb).subtract(l).normalize(),R=AI.cross(T).normalize().scale(c).add(l),D=zi.WGS84.cartesianToCartographic(R),V=i.project([s,r,n]),H=i.project(D);return Eee.copy(V).subtract(H).magnitude()}function Tee(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class CI{constructor(e=0){O(this,"_map",new Map),O(this,"_array"),O(this,"_length"),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ui(e<this._array.length),this._array[e]}set(e,i){Ui(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=i,this._map.set(i,e)}delete(e){const i=this._map.get(e);i>=0&&(this._array.splice(i,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const i=this.length++;this._array[i]=e,this._map.set(e,i)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ui(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ui(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const See={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class N1{constructor(e){O(this,"options"),O(this,"root",null),O(this,"selectedTiles",{}),O(this,"requestedTiles",{}),O(this,"emptyTiles",{}),O(this,"lastUpdate",new Date().getTime()),O(this,"updateDebounceTime",1e3),O(this,"_traversalStack",new CI),O(this,"_emptyTraversalStack",new CI),O(this,"_frameNumber",null),this.options={...See,...e}}traversalFinished(e){return!0}traverse(e,i,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,i),this._frameNumber=i.frameNumber,this.executeTraversal(e,i)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,i){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const n=r.pop();let c=!1;this.canTraverse(n,i)&&(this.updateChildTiles(n,i),c=this.updateAndPushChildren(n,i,r,n.hasRenderContent?n._selectionDepth+1:n._selectionDepth));const l=n.parent,f=!!(!l||l._shouldRefine),y=!c;n.hasRenderContent?n.refine===Fo.ADD?(this.loadTile(n,i),this.selectTile(n,i)):n.refine===Fo.REPLACE&&(this.loadTile(n,i),y&&this.selectTile(n,i)):(this.emptyTiles[n.id]=n,this.loadTile(n,i),y&&this.selectTile(n,i)),this.touchTile(n,i),n._shouldRefine=c&&f}const s=new Date().getTime();(this.traversalFinished(i)||s-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=s,this.options.onTraversalEnd(i))}updateChildTiles(e,i){const r=e.children;for(const s of r)this.updateTile(s,i)}updateAndPushChildren(e,i,r,s){const{loadSiblings:n,skipLevelOfDetail:c}=this.options,l=e.children;l.sort(this.compareDistanceToCamera.bind(this));const f=e.refine===Fo.REPLACE&&e.hasRenderContent&&!c;let y=!1,E=!0;for(const T of l)if(T._selectionDepth=s,T.isVisibleAndInRequestVolume?(r.find(T)&&r.delete(T),r.push(T),y=!0):(f||n)&&(this.loadTile(T,i),this.touchTile(T,i)),f){let R;if(T._inRequestVolume?T.hasRenderContent?R=T.contentAvailable:R=this.executeEmptyTraversal(T,i):R=!1,E=E&&R,!E)return!1}return y||(E=!1),E}updateTile(e,i){this.updateTileVisibility(e,i)}selectTile(e,i){this.shouldSelectTile(e)&&(e._selectedFrame=i.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,i){this.shouldLoadTile(e)&&(e._requestedFrame=i.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,i){e.tileset._cache.touch(e),e._touchedFrame=i.frameNumber}canTraverse(e,i){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,i):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,i,r=!1){let s=e._screenSpaceError;return r&&(s=e.getScreenSpaceError(i,!0)),s>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,i){const r=[];if(this.options.viewportTraversersMap)for(const s in this.options.viewportTraversersMap)this.options.viewportTraversersMap[s]===i.viewport.id&&r.push(s);else r.push(i.viewport.id);e.updateVisibility(i,r)}compareDistanceToCamera(e,i){return e._distanceToCamera-i._distanceToCamera}anyChildrenVisible(e,i){let r=!1;for(const s of e.children)s.updateVisibility(i),r=r||s.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,i){let r=!0;const s=this._emptyTraversalStack;for(s.push(e);s.length>0;){const n=s.pop(),c=!n.hasRenderContent&&this.canTraverse(n,i),l=!n.hasRenderContent&&n.children.length===0;if(!c&&!n.contentAvailable&&!l&&(r=!1),this.updateTile(n,i),n.isVisibleAndInRequestVolume||(this.loadTile(n,i),this.touchTile(n,i)),c){const f=n.children;for(const y of f)s.push(y)}}return r}}const II=new Be;function Cee(t){return t!=null}class Sx{constructor(e,i,r,s=""){O(this,"tileset"),O(this,"header"),O(this,"id"),O(this,"url"),O(this,"parent"),O(this,"refine"),O(this,"type"),O(this,"contentUrl"),O(this,"lodMetricType","geometricError"),O(this,"lodMetricValue",0),O(this,"boundingVolume",null),O(this,"content",null),O(this,"contentState",Pn.UNLOADED),O(this,"gpuMemoryUsageInBytes",0),O(this,"children",[]),O(this,"depth",0),O(this,"viewportIds",[]),O(this,"transform",new ai),O(this,"extensions",null),O(this,"implicitTiling",null),O(this,"userData",{}),O(this,"computedTransform"),O(this,"hasEmptyContent",!1),O(this,"hasTilesetContent",!1),O(this,"traverser",new N1({})),O(this,"_cacheNode",null),O(this,"_frameNumber",null),O(this,"_expireDate",null),O(this,"_expiredContent",null),O(this,"_boundingBox"),O(this,"_distanceToCamera",0),O(this,"_screenSpaceError",0),O(this,"_visibilityPlaneMask"),O(this,"_visible"),O(this,"_contentBoundingVolume"),O(this,"_viewerRequestVolume"),O(this,"_initialTransform",new ai),O(this,"_priority",0),O(this,"_selectedFrame",0),O(this,"_requestedFrame",0),O(this,"_selectionDepth",0),O(this,"_touchedFrame",0),O(this,"_centerZDepth",0),O(this,"_shouldRefine",!1),O(this,"_stackLength",0),O(this,"_visitedFrame",0),O(this,"_inRequestVolume",!1),O(this,"_lodJudge",null),this.header=i,this.tileset=e,this.id=s||i.id,this.url=i.url,this.parent=r,this.refine=this._getRefine(i.refine),this.type=i.type,this.contentUrl=i.contentUrl,this._initializeLodMetric(i),this._initializeTransforms(i),this._initializeBoundingVolumes(i),this._initializeContent(i),this._initializeRenderingState(i),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Pn.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Pn.UNLOADED}get contentExpired(){return this.contentState===Pn.EXPIRED}get contentFailed(){return this.contentState===Pn.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=mee(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,i){switch(this.tileset.type){case an.I3S:return SB(this,e);case an.TILES3D:return xee(this,e,i);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:i}=e.options,r=this.refine===Fo.ADD||i;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Pn.UNLOADED)return-1;const s=this.parent,n=s&&(!r||this._screenSpaceError===0||s.hasTilesetContent)?s._screenSpaceError:this._screenSpaceError,c=e.root?e.root._screenSpaceError:0;return Math.max(c-n,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Pn.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=Pn.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,s={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await dc(i,r,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Pn.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=Pn.FAILED,i}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Pn.UNLOADED,!0}updateVisibility(e,i){if(this._frameNumber===e.frameNumber)return;const r=this.parent,s=r?r._visibilityPlaneMask:so.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const n=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(n)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,s),this._visible=this._visibilityPlaneMask!==so.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=i}visibility(e,i){const{cullingVolume:r}=e,{boundingVolume:s}=this;return r.computeVisibilityWithPlaneMask(s,i)}contentVisibility(){return!0}distanceToTile(e){const i=this.boundingVolume;return Math.sqrt(Math.max(i.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const i=this.boundingVolume;return II.subVectors(i.center,e.position),e.direction.dot(II)}insideViewerRequestVolume(e){const i=this._viewerRequestVolume;return!i||i.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(Cee(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Pn.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new ai(e.transform):new ai;const i=this.parent,r=this.tileset,s=i&&i.computedTransform?i.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new ai(s).multiplyRight(this.transform);const n=i&&i._initialTransform?i._initialTransform.clone():new ai;this._initialTransform=new ai(n).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Pn.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=so.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Fo.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=Eb(e.boundingVolume,this.computedTransform,this.boundingVolume);const i=e.content;i&&(i.boundingVolume&&(this._contentBoundingVolume=Eb(i.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Eb(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new ai){const i=e.clone().multiplyRight(this.transform);i.equals(this.computedTransform)||(this.computedTransform=i,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Tee(this.tileset.tileset)}}}class Iee extends N1{compareDistanceToCamera(e,i){return i._distanceToCamera===0&&e._distanceToCamera===0?i._centerZDepth-e._centerZDepth:i._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,i){if(super.updateTileVisibility(e,i),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const c=e.children[0];this.updateTileVisibility(c,i),e._visible=c._visible;return}if(this.meetsScreenSpaceErrorEarly(e,i)){e._visible=!1;return}const s=e.refine===Fo.REPLACE,n=e._optimChildrenWithinParent===dee.USE_OPTIMIZATION;if(s&&n&&r&&!this.anyChildrenVisible(e,i)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,i){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==Fo.ADD?!1:!this.shouldRefine(e,i,!0)}}class Ree{constructor(){O(this,"frameNumberMap",new Map)}register(e,i){const r=this.frameNumberMap.get(e)||new Map,s=r.get(i)||0;r.set(i,s+1),this.frameNumberMap.set(e,r)}deregister(e,i){const r=this.frameNumberMap.get(e);if(!r)return;const s=r.get(i)||1;r.set(i,s-1)}isZero(e,i){var r;return(((r=this.frameNumberMap.get(e))==null?void 0:r.get(i))||0)===0}}const Sb={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Mee{constructor(){O(this,"_statusMap"),O(this,"pendingTilesRegister",new Ree),this._statusMap={}}add(e,i,r,s){if(!this._statusMap[i]){const{frameNumber:n,viewport:{id:c}}=s;this._statusMap[i]={request:e,callback:r,key:i,frameState:s,status:Sb.REQUESTED},this.pendingTilesRegister.register(c,n),e().then(l=>{this._statusMap[i].status=Sb.COMPLETED;const{frameNumber:f,viewport:{id:y}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(y,f),this._statusMap[i].callback(l,s)}).catch(l=>{this._statusMap[i].status=Sb.ERROR;const{frameNumber:f,viewport:{id:y}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(y,f),r(l)})}}update(e,i){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:s}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(s,r);const{frameNumber:n,viewport:{id:c}}=i;this.pendingTilesRegister.register(c,n),this._statusMap[e].frameState=i}}find(e){return this._statusMap[e]}hasPendingTiles(e,i){return!this.pendingTilesRegister.isZero(e,i)}}class Pee extends N1{constructor(e){super(e),O(this,"_tileManager"),this._tileManager=new Mee}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,i){return e._lodJudge=Aee(e,i),e._lodJudge==="DIG"}updateChildTiles(e,i){const r=e.header.children||[],s=e.children,n=e.tileset;for(const c of r){const l=`${c.id}-${i.viewport.id}`,f=s&&s.find(y=>y.id===l);if(f)f&&this.updateTile(f,i);else{let y=()=>this._loadTile(c.id,n);this._tileManager.find(l)?this._tileManager.update(l,i):(n.tileset.nodePages&&(y=()=>n.tileset.nodePagesTile.formTileFromNodePages(c.id)),this._tileManager.add(y,l,E=>this._onTileLoad(E,e,l),i))}}return!1}async _loadTile(e,i){const{loader:r}=i,s=i.getTileUrl(`${i.url}/nodes/${e}`),n={...i.loadOptions,i3s:{...i.loadOptions.i3s,isTileHeader:!0}};return await dc(s,r,n)}_onTileLoad(e,i,r){const s=new Sx(i.tileset,e,i,r);i.children.push(s);const n=this._tileManager.find(s.id).frameState;this.updateTile(s,n),this._frameNumber===n.frameNumber&&(this.traversalFinished(n)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,n)}}const kee={description:"",ellipsoid:zi.WGS84,modelMatrix:new ai,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},B_="Tiles In Tileset(s)",Cb="Tiles In Memory",RI="Tiles In View",MI="Tiles To Render",PI="Tiles Loaded",Ib="Tiles Loading",kI="Tiles Unloaded",BI="Failed Tile Loads",LI="Points/Vertices",Rb="Tile Memory Use",OI="Maximum Screen Space Error";class Bee{constructor(e,i){O(this,"options"),O(this,"loadOptions"),O(this,"type"),O(this,"tileset"),O(this,"loader"),O(this,"url"),O(this,"basePath"),O(this,"modelMatrix"),O(this,"ellipsoid"),O(this,"lodMetricType"),O(this,"lodMetricValue"),O(this,"refine"),O(this,"root",null),O(this,"roots",{}),O(this,"asset",{}),O(this,"description",""),O(this,"properties"),O(this,"extras",null),O(this,"attributions",{}),O(this,"credits",{}),O(this,"stats"),O(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),O(this,"cartographicCenter",null),O(this,"cartesianCenter",null),O(this,"zoom",1),O(this,"boundingVolume",null),O(this,"dynamicScreenSpaceErrorComputedDensity",0),O(this,"maximumMemoryUsage",32),O(this,"gpuMemoryUsageInBytes",0),O(this,"memoryAdjustedScreenSpaceError",0),O(this,"_cacheBytes",0),O(this,"_cacheOverflowBytes",0),O(this,"_frameNumber",0),O(this,"_queryParams",{}),O(this,"_extensionsUsed",[]),O(this,"_tiles",{}),O(this,"_pendingCount",0),O(this,"selectedTiles",[]),O(this,"traverseCounter",0),O(this,"geometricError",0),O(this,"lastUpdatedVieports",null),O(this,"_requestedTiles",[]),O(this,"_emptyTiles",[]),O(this,"frameStateData",{}),O(this,"_traverser"),O(this,"_cache",new iee),O(this,"_requestScheduler"),O(this,"updatePromise",null),O(this,"tilesetInitializationPromise"),this.options={...kee,...i},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||z2(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new jN({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Vd({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let i=e;return this.queryParams.length&&(i=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(i=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),i(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const i=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=i.length;const r=[];for(const s of i){const n=s.id;this._needTraverse(n)?r.push(n):this.traverseCounter--}for(const s of i){const n=s.id;if(this.roots[n]||(this.roots[n]=this._initializeTileHeaders(this.tileset,null)),!r.includes(n))continue;const c=see(s,this._frameNumber);this._traverser.traverse(this.roots[n],c,this.options)}}_needTraverse(e){let i=e;return this.options.viewportTraversersMap&&(i=this.options.viewportTraversersMap[e]),i===e}_onTraversalEnd(e){const i=e.viewport.id;this.frameStateData[i]||(this.frameStateData[i]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[i],s=Object.values(this._traverser.selectedTiles),[n,c]=nee(s,e,this.options.maximumTilesSelected);r.selectedTiles=n;for(const l of c)l.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const i=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(i.selectedTiles),this._requestedTiles=this._requestedTiles.concat(i._requestedTiles),this._emptyTiles=this._emptyTiles.concat(i._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,i){if(e.length!==i.length)return!0;const r=new Set(e.map(c=>c.id)),s=new Set(i.map(c=>c.id));let n=e.filter(c=>!s.has(c.id)).length>0;return n=n||i.filter(c=>!r.has(c.id)).length>0,n}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,i)=>e._unloadTile(i))}_updateStats(){let e=0,i=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?i+=r.content.pointCount:i+=r.content.vertexCount);this.stats.get(RI).count=this.selectedTiles.length,this.stats.get(MI).count=e,this.stats.get(LI).count=i,this.stats.get(OI).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===an.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===an.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===an.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const i=this.tileset.fullExtent;if(i){const{xmin:s,xmax:n,ymin:c,ymax:l,zmin:f,zmax:y}=i;this.cartographicCenter=new Be(s+(n-s)/2,c+(l-c)/2,f+(y-f)/2),this.cartesianCenter=new Be,zi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=wB(i,this.cartographicCenter,this.cartesianCenter);return}const r=(e=this.tileset.store)==null?void 0:e.extent;if(r){const[s,n,c,l]=r;this.cartographicCenter=new Be(s+(c-s)/2,n+(l-n)/2,0),this.cartesianCenter=new Be,zi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=uee(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Be,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:i}=e.boundingVolume;if(!i){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Be,this.zoom=1;return}i[0]!==0||i[1]!==0||i[2]!==0?(this.cartographicCenter=new Be,zi.WGS84.cartesianToCartographic(i,this.cartographicCenter)):this.cartographicCenter=new Be(0,0,-zi.WGS84.radii[0]),this.cartesianCenter=i,this.zoom=cee(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(B_),this.stats.get(Ib),this.stats.get(Cb),this.stats.get(RI),this.stats.get(MI),this.stats.get(PI),this.stats.get(kI),this.stats.get(BI),this.stats.get(LI),this.stats.get(Rb,"memory"),this.stats.get(OI)}_initializeTileHeaders(e,i){var r;const s=new Sx(this,e.root,i);if(i&&(i.children.push(s),s.depth=i.depth+1),this.type===an.TILES3D){const n=[];for(n.push(s);n.length>0;){const c=n.pop();this.stats.get(B_).incrementCount();const l=c.header.children||[];for(const f of l){const y=new Sx(this,f,c);if((r=y.contentUrl)!=null&&r.includes("?session=")){const E=new URL(y.contentUrl).searchParams.get("session");E&&(this._queryParams.session=E)}c.children.push(y),y.depth=c.depth+1,n.push(y)}}}return s}_initializeTraverser(){let e;switch(this.type){case an.TILES3D:e=Iee;break;case an.I3S:e=Pee;break;default:e=N1}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let i;try{this._onStartTileLoading(),i=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,i)}}_onTileLoadError(e,i){this.stats.get(BI).incrementCount();const r=i.message||i.toString(),s=e.url;console.error(`A 3D tile failed to load: ${e.url} ${r}`),this.options.onTileError(e,r,s)}_onTileLoad(e,i){var r,s;if(i){if(this.type===an.I3S){const n=((s=(r=this.tileset)==null?void 0:r.nodePagesTile)==null?void 0:s.nodesInNodePages)||0;this.stats.get(B_).reset(),this.stats.get(B_).addCount(n)}e&&e.content&&ree(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var i;if(this.type===an.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===an.TILES3D){const{extensionsRemoved:r=[]}=((i=e.content)==null?void 0:i.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Ib).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Ib).decrementCount()}_addTileToCache(e){this._cache.add(this,e,i=>i._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(PI).incrementCount(),this.stats.get(Cb).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Rb).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(Cb).decrementCount(),this.stats.get(kI).incrementCount(),this.stats.get(Rb).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const i=e.pop();for(const r of i.children)e.push(r);this._destroyTile(i)}this.root=null}_destroySubtree(e){const i=e,r=[];for(r.push(i);r.length>0;){e=r.pop();for(const s of e.children)r.push(s);e!==i&&this._destroyTile(e)}i.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const i=new URLSearchParams(e.queryString),r=Object.fromEntries(i.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const CB="4.3.1",mf={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function IB(t,e,i){Ui(t instanceof ArrayBuffer);const r=new TextDecoder("utf8"),s=new Uint8Array(t,e,i);return r.decode(s)}function Lee(t,e=0){const i=new DataView(t);return`${String.fromCharCode(i.getUint8(e+0))}${String.fromCharCode(i.getUint8(e+1))}${String.fromCharCode(i.getUint8(e+2))}${String.fromCharCode(i.getUint8(e+3))}`}const Oee={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Sr={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},di={...Oee,...Sr},Mb={[Sr.DOUBLE]:Float64Array,[Sr.FLOAT]:Float32Array,[Sr.UNSIGNED_SHORT]:Uint16Array,[Sr.UNSIGNED_INT]:Uint32Array,[Sr.UNSIGNED_BYTE]:Uint8Array,[Sr.BYTE]:Int8Array,[Sr.SHORT]:Int16Array,[Sr.INT]:Int32Array},Dee={DOUBLE:Sr.DOUBLE,FLOAT:Sr.FLOAT,UNSIGNED_SHORT:Sr.UNSIGNED_SHORT,UNSIGNED_INT:Sr.UNSIGNED_INT,UNSIGNED_BYTE:Sr.UNSIGNED_BYTE,BYTE:Sr.BYTE,SHORT:Sr.SHORT,INT:Sr.INT},Pb="Failed to convert GL type";class da{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const i in Mb)if(Mb[i]===e)return i;throw new Error(Pb)}static fromName(e){const i=Dee[e];if(!i)throw new Error(Pb);return i}static getArrayType(e){switch(e){case Sr.UNSIGNED_SHORT_5_6_5:case Sr.UNSIGNED_SHORT_4_4_4_4:case Sr.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const i=Mb[e];if(!i)throw new Error(Pb);return i}}static getByteSize(e){return da.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!da.getArrayType(e)}static createTypedArray(e,i,r=0,s){s===void 0&&(s=(i.byteLength-r)/da.getByteSize(e));const n=da.getArrayType(e);return new n(i,r,s)}}function Fee(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function Nee(t,e=[0,0,0]){const i=t>>11&31,r=t>>5&63,s=t&31;return e[0]=i<<3,e[1]=r<<2,e[2]=s<<3,e}new eE;new Be;new eE;new eE;function DI(t,e=255){return $a(t,0,e)/e*2-1}function FI(t){return t<0?-1:1}function Uee(t,e,i,r){if(Fee(r),t<0||t>i||e<0||e>i)throw new Error(`x and y must be unsigned normalized integers between 0 and ${i}`);if(r.x=DI(t,i),r.y=DI(e,i),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const s=r.x;r.x=(1-Math.abs(r.y))*FI(s),r.y=(1-Math.abs(s))*FI(r.y)}return r.normalize()}function zee(t,e,i){return Uee(t,e,255,i)}class ME{constructor(e,i){O(this,"json"),O(this,"buffer"),O(this,"featuresLength",0),O(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=i}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,i=di.UNSIGNED_INT,r=1){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(e,i,r,1,s.byteOffset):s}getPropertyArray(e,i,r){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(i=da.fromName(s.componentType)),this._getTypedArrayFromBinary(e,i,r,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(e,i,s)}getProperty(e,i,r,s,n){const c=this.json[e];if(!c)return c;const l=this.getPropertyArray(e,i,r);if(r===1)return l[s];for(let f=0;f<r;++f)n[f]=l[r*s+f];return n}_getTypedArrayFromBinary(e,i,r,s,n){const c=this._cachedTypedArrays;let l=c[e];return l||(l=da.createTypedArray(i,this.buffer.buffer,this.buffer.byteOffset+n,s*r),c[e]=l),l}_getTypedArrayFromArray(e,i,r){const s=this._cachedTypedArrays;let n=s[e];return n||(n=da.createTypedArray(i,r),s[e]=n),n}}const jee={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gee={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},Vee={SCALAR:(t,e,i)=>{e[i]=t},VEC2:(t,e,i)=>{e[2*i+0]=t[0],e[2*i+1]=t[1]},VEC3:(t,e,i)=>{e[3*i+0]=t[0],e[3*i+1]=t[1],e[3*i+2]=t[2]},VEC4:(t,e,i)=>{e[4*i+0]=t[0],e[4*i+1]=t[1],e[4*i+2]=t[2],e[4*i+3]=t[3]},MAT2:(t,e,i)=>{e[4*i+0]=t[0],e[4*i+1]=t[1],e[4*i+2]=t[2],e[4*i+3]=t[3]},MAT3:(t,e,i)=>{e[9*i+0]=t[0],e[9*i+1]=t[1],e[9*i+2]=t[2],e[9*i+3]=t[3],e[9*i+4]=t[4],e[9*i+5]=t[5],e[9*i+6]=t[6],e[9*i+7]=t[7],e[9*i+8]=t[8],e[9*i+9]=t[9]},MAT4:(t,e,i)=>{e[16*i+0]=t[0],e[16*i+1]=t[1],e[16*i+2]=t[2],e[16*i+3]=t[3],e[16*i+4]=t[4],e[16*i+5]=t[5],e[16*i+6]=t[6],e[16*i+7]=t[7],e[16*i+8]=t[8],e[16*i+9]=t[9],e[16*i+10]=t[10],e[16*i+11]=t[11],e[16*i+12]=t[12],e[16*i+13]=t[13],e[16*i+14]=t[14],e[16*i+15]=t[15]}};function $ee(t,e,i,r){const{componentType:s}=t;Ui(t.componentType);const n=typeof s=="string"?da.fromName(s):s,c=jee[t.type],l=Gee[t.type],f=Vee[t.type];return i+=t.byteOffset,{values:da.createTypedArray(n,e,i,c*r),type:n,size:c,unpacker:l,packer:f}}const ua=t=>t!==void 0;function Hee(t,e,i){if(!e)return null;let r=t.getExtension("3DTILES_batch_table_hierarchy");const s=e.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=s,r=s),r?qee(r,i):null}function qee(t,e){let i,r,s;const n=t.instancesLength,c=t.classes;let l=t.classIds,f=t.parentCounts,y=t.parentIds,E=n;ua(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,n));let T;if(ua(f))for(ua(f.byteOffset)&&(f.componentType=defaultValue(f.componentType,GL.UNSIGNED_SHORT),f.type=AttributeType.SCALAR,s=getBinaryAccessor(f),f=s.createArrayBufferView(e.buffer,e.byteOffset+f.byteOffset,n)),T=new Uint16Array(n),E=0,i=0;i<n;++i)T[i]=E,E+=f[i];ua(y)&&ua(y.byteOffset)&&(y.componentType=defaultValue(y.componentType,GL.UNSIGNED_SHORT),y.type=AttributeType.SCALAR,s=getBinaryAccessor(y),y=s.createArrayBufferView(e.buffer,e.byteOffset+y.byteOffset,E));const R=c.length;for(i=0;i<R;++i){const ee=c[i].length,z=c[i].instances,W=getBinaryProperties(ee,z,e);c[i].instances=combine(W,z)}const D=new Array(R).fill(0),V=new Uint16Array(n);for(i=0;i<n;++i)r=l[i],V[i]=D[r],++D[r];const H={classes:c,classIds:l,classIndexes:V,parentCounts:f,parentIndexes:T,parentIds:y};return Kee(H),H}function gf(t,e,i){if(!t)return;const r=t.parentCounts;return t.parentIds?i(t,e):r>0?Wee(t,e,i):Xee(t,e,i)}function Wee(t,e,i){const r=t.classIds,s=t.parentCounts,n=t.parentIds,c=t.parentIndexes,l=r.length,f=scratchVisited;f.length=Math.max(f.length,l);const y=++marker,E=scratchStack;for(E.length=0,E.push(e);E.length>0;){if(e=E.pop(),f[e]===y)continue;f[e]=y;const T=i(t,e);if(ua(T))return T;const R=s[e],D=c[e];for(let V=0;V<R;++V){const H=n[D+V];H!==e&&E.push(H)}}return null}function Xee(t,e,i){let r=!0;for(;r;){const s=i(t,e);if(ua(s))return s;const n=t.parentIds[e];r=n!==e,e=n}throw new Error("traverseHierarchySingleParent")}function Kee(t){const e=t.classIds.length;for(let i=0;i<e;++i)RB(t,i,stack)}function RB(t,e,i){const r=t.parentCounts,s=t.parentIds,n=t.parentIndexes,c=t.classIds.length;if(!ua(s))return;assert(e<c,`Parent index ${e} exceeds the total number of instances: ${c}`),assert(i.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),i.push(e);const l=ua(r)?r[e]:1,f=ua(r)?n[e]:e;for(let y=0;y<l;++y){const E=s[f+y];E!==e&&RB(t,E,i)}i.pop(e)}function nn(t){return t!=null}const L_=(t,e)=>t,Jee={HIERARCHY:!0,extensions:!0,extras:!0};class MB{constructor(e,i,r,s={}){O(this,"json"),O(this,"binary"),O(this,"featureCount"),O(this,"_extensions"),O(this,"_properties"),O(this,"_binaryProperties"),O(this,"_hierarchy");var n;Ui(r>=0),this.json=e||{},this.binary=i,this.featureCount=r,this._extensions=((n=this.json)==null?void 0:n.extensions)||{},this._properties={};for(const c in this.json)Jee[c]||(this._properties[c]=this.json[c]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Hee(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,i){if(this._checkBatchId(e),Ui(typeof i=="string",i),this._hierarchy){const r=gf(this._hierarchy,e,(s,n)=>{const c=s.classIds[n];return s.classes[c].name===i});return nn(r)}return!1}isExactClass(e,i){return Ui(typeof i=="string",i),this.getExactClassName(e)===i}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const i=this._hierarchy.classIds[e];return this._hierarchy.classes[i].name}}hasProperty(e,i){return this._checkBatchId(e),Ui(typeof i=="string",i),nn(this._properties[i])||this._hasPropertyInHierarchy(e,i)}getPropertyNames(e,i){this._checkBatchId(e),i=nn(i)?i:[],i.length=0;const r=Object.keys(this._properties);return i.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,i),i}getProperty(e,i){if(this._checkBatchId(e),Ui(typeof i=="string",i),this._binaryProperties){const s=this._binaryProperties[i];if(nn(s))return this._getBinaryProperty(s,e)}const r=this._properties[i];if(nn(r))return L_(r[e]);if(this._hierarchy){const s=this._getHierarchyProperty(e,i);if(nn(s))return s}}setProperty(e,i,r){const s=this.featureCount;if(this._checkBatchId(e),Ui(typeof i=="string",i),this._binaryProperties){const c=this._binaryProperties[i];if(c){this._setBinaryProperty(c,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,i,r))return;let n=this._properties[i];nn(n)||(this._properties[i]=new Array(s),n=this._properties[i]),n[e]=L_(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,i){return e.unpack(e.typedArray,i)}_setBinaryProperty(e,i,r){e.pack(r,e.typedArray,i)}_initializeBinaryProperties(){let e=null;for(const i in this._properties){const r=this._properties[i],s=this._initializeBinaryProperty(i,r);s&&(e=e||{},e[i]=s)}return e}_initializeBinaryProperty(e,i){if("byteOffset"in i){const r=i;Ui(this.binary,`Property ${e} requires a batch table binary.`),Ui(r.type,`Property ${e} requires a type.`);const s=$ee(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(e,i){if(!this._hierarchy)return!1;const r=gf(this._hierarchy,e,(s,n)=>{const c=s.classIds[n],l=s.classes[c].instances;return nn(l[i])});return nn(r)}_getPropertyNamesInHierarchy(e,i){gf(this._hierarchy,e,(r,s)=>{const n=r.classIds[s],c=r.classes[n].instances;for(const l in c)c.hasOwnProperty(l)&&i.indexOf(l)===-1&&i.push(l)})}_getHierarchyProperty(e,i){return gf(this._hierarchy,e,(r,s)=>{const n=r.classIds[s],c=r.classes[n],l=r.classIndexes[s],f=c.instances[i];return nn(f)?nn(f.typedArray)?this._getBinaryProperty(f,l):L_(f[l]):null})}_setHierarchyProperty(e,i,r,s){const n=gf(this._hierarchy,i,(c,l)=>{const f=c.classIds[l],y=c.classes[f],E=c.classIndexes[l],T=y.instances[r];return nn(T)?(Ui(l===i,`Inherited property "${r}" is read-only.`),nn(T.typedArray)?this._setBinaryProperty(T,E,s):T[E]=L_(s),!0):!1});return nn(n)}}const kb=4;function U1(t,e,i=0){const r=new DataView(e);if(t.magic=r.getUint32(i,!0),i+=kb,t.version=r.getUint32(i,!0),i+=kb,t.byteLength=r.getUint32(i,!0),i+=kb,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return i}const Ph=4,NI="b3dm tile in legacy format.";function PE(t,e,i){const r=new DataView(e);let s;t.header=t.header||{};let n=r.getUint32(i,!0);i+=Ph;let c=r.getUint32(i,!0);i+=Ph;let l=r.getUint32(i,!0);i+=Ph;let f=r.getUint32(i,!0);return i+=Ph,l>=570425344?(i-=Ph*2,s=n,l=c,f=0,n=0,c=0,console.warn(NI)):f>=570425344&&(i-=Ph,s=l,l=n,f=c,n=0,c=0,console.warn(NI)),t.header.featureTableJsonByteLength=n,t.header.featureTableBinaryByteLength=c,t.header.batchTableJsonByteLength=l,t.header.batchTableBinaryByteLength=f,t.header.batchLength=s,i}function kE(t,e,i,r){return i=Zee(t,e,i),i=Yee(t,e,i),i}function Zee(t,e,i,r){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:n,batchLength:c}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:c||0},s&&s>0){const l=IB(e,i,s);t.featureTableJson=JSON.parse(l)}return i+=s||0,t.featureTableBinary=new Uint8Array(e,i,n),i+=n||0,i}function Yee(t,e,i,r){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:n}=t.header||{};if(s&&s>0){const c=IB(e,i,s);t.batchTableJson=JSON.parse(c),i+=s,n&&n>0&&(t.batchTableBinary=new Uint8Array(e,i,n),t.batchTableBinary=new Uint8Array(t.batchTableBinary),i+=n)}return i}function PB(t,e,i){if(!e&&(!t||!t.batchIds||!i))return null;const{batchIds:r,isRGB565:s,pointCount:n=0}=t;if(r&&i){const c=new Uint8ClampedArray(n*3);for(let l=0;l<n;l++){const f=r[l],y=i.getProperty(f,"dimensions").map(E=>E*255);c[l*3]=y[0],c[l*3+1]=y[1],c[l*3+2]=y[2]}return{type:di.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}if(e&&s){const c=new Uint8ClampedArray(n*3);for(let l=0;l<n;l++){const f=Nee(e[l]);c[l*3]=f[0],c[l*3+1]=f[1],c[l*3+2]=f[2]}return{type:di.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}return e&&e.length===n*3?{type:di.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:di.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const UI=new Be;function Qee(t,e){if(!e)return null;if(t.isOctEncoded16P){const i=new Float32Array((t.pointsLength||0)*3);for(let r=0;r<(t.pointsLength||0);r++)zee(e[r*2],e[r*2+1],UI),UI.toArray(i,r*3);return{type:di.FLOAT,size:2,value:i}}return{type:di.FLOAT,size:2,value:e}}function ete(t,e,i){return t.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,tte(t,e)):{type:di.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function tte(t,e){const i=new Be,r=new Float32Array(t.pointCount*3);for(let s=0;s<t.pointCount;s++)i.set(e[s*3],e[s*3+1],e[s*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,s*3);return r}async function ite(t,e,i,r,s){i=U1(t,e,i),i=PE(t,e,i),i=kE(t,e,i),rte(t);const{featureTable:n,batchTable:c}=ste(t);return await cte(t,n,c,r,s),nte(t,n,r),ote(t,n,c),ate(t,n),i}function rte(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function ste(t){const e=new ME(t.featureTableJson,t.featureTableBinary),i=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=i,t.featuresLength=i,t.pointsLength=i,t.pointCount=i,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",di.FLOAT,3);const r=lte(t,e);return{featureTable:e,batchTable:r}}function nte(t,e,i){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",di.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",di.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",di.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",di.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=ete(t,r,i)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function ote(t,e,i){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",di.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",di.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",di.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=PB(t,r,i)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",di.UNSIGNED_BYTE,4))}function ate(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let i=null;e.hasProperty("NORMAL")?i=e.getPropertyArray("NORMAL",di.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(i=e.getPropertyArray("NORMAL_OCT16P",di.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=Qee(t,i)}}function lte(t,e){let i=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",di.UNSIGNED_SHORT,1),t.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:n}=t;i=new MB(s,n,r)}return i}async function cte(t,e,i,r,s){let n,c,l;const f=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];f&&(l=f.properties);const y=e.getExtension("3DTILES_draco_point_compression");if(y){c=y.properties;const T=y.byteOffset,R=y.byteLength;if(!c||!Number.isFinite(T)||!R)throw new Error("Draco properties, byteOffset, and byteLength must be defined");n=(t.featureTableBinary||[]).slice(T,T+R),t.hasPositions=Number.isFinite(c.POSITION),t.hasColors=Number.isFinite(c.RGB)||Number.isFinite(c.RGBA),t.hasNormals=Number.isFinite(c.NORMAL),t.hasBatchIds=Number.isFinite(c.BATCH_ID),t.isTranslucent=Number.isFinite(c.RGBA)}if(!n)return!0;const E={buffer:n,properties:{...c,...l},featureTableProperties:c,batchTableProperties:l,dequantizeInShader:!1};return await ute(t,E,r,s)}async function ute(t,e,i,r){if(!r)return;const s={...i,draco:{...i==null?void 0:i.draco,extraAttributes:e.batchTableProperties||{}}};delete s["3d-tiles"];const n=await Rm(e.buffer,mB,s,r),c=n.attributes.POSITION&&n.attributes.POSITION.value,l=n.attributes.COLOR_0&&n.attributes.COLOR_0.value,f=n.attributes.NORMAL&&n.attributes.NORMAL.value,y=n.attributes.BATCH_ID&&n.attributes.BATCH_ID.value,E=c&&n.attributes.POSITION.value.quantization,T=f&&n.attributes.NORMAL.value.quantization;if(E){const D=n.POSITION.data.quantization,V=D.range;t.quantizedVolumeScale=new Be(V,V,V),t.quantizedVolumeOffset=new Be(D.minValues),t.quantizedRange=(1<<D.quantizationBits)-1,t.isQuantizedDraco=!0}T&&(t.octEncodedRange=(1<<n.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const R={};if(e.batchTableProperties)for(const D of Object.keys(e.batchTableProperties))n.attributes[D]&&n.attributes[D].value&&(R[D.toLowerCase()]=n.attributes[D].value);t.attributes={positions:c,colors:PB(t,l,void 0),normals:f,batchIds:y,...R}}const Cx={URI:0,EMBEDDED:1};function kB(t,e,i,r){t.rotateYtoZ=!0;const s=(t.byteOffset||0)+(t.byteLength||0)-i;if(s===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=r!=null&&r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=U2(e,i,s),t.gltfByteOffset=0,t.gltfByteLength=s,i%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function BB(t,e,i,r){const s=(i==null?void 0:i["3d-tiles"])||{};if(hte(t,e),s.loadGLTF){if(!r)return;if(t.gltfUrl){const{fetch:n}=r,c=await n(t.gltfUrl,i);t.gltfArrayBuffer=await c.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const n=await Rm(t.gltfArrayBuffer,wm,i,r);t.gltf=CE(n),t.gpuMemoryUsageInBytes=nB(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function hte(t,e,i){switch(e){case Cx.URI:if(t.gltfArrayBuffer){const r=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),s=new TextDecoder().decode(r);t.gltfUrl=s.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Cx.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function dte(t,e,i,r,s){var n;i=pte(t,e,i,r),await BB(t,Cx.EMBEDDED,r,s);const c=(n=t==null?void 0:t.gltf)==null?void 0:n.extensions;return c&&c.CESIUM_RTC&&(t.rtcCenter=c.CESIUM_RTC.center),i}function pte(t,e,i,r,s){i=U1(t,e,i),i=PE(t,e,i),i=kE(t,e,i),i=kB(t,e,i,r);const n=new ME(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=n.getGlobalProperty("RTC_CENTER",di.FLOAT,3),i}async function fte(t,e,i,r,s){return i=mte(t,e,i,r),await BB(t,t.gltfFormat||0,r,s),i}function mte(t,e,i,r,s){var n;if(i=U1(t,e,i),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);i=PE(t,e,i);const c=new DataView(e);if(t.gltfFormat=c.getUint32(i,!0),i+=4,i=kE(t,e,i),i=kB(t,e,i,r),!((n=t==null?void 0:t.header)!=null&&n.featureTableJsonByteLength)||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const l=new ME(t.featureTableJson,t.featureTableBinary),f=l.getGlobalProperty("INSTANCES_LENGTH");if(l.featuresLength=f,!Number.isFinite(f))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=l.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=l.getGlobalProperty("RTC_CENTER",di.FLOAT,3);const y=new MB(t.batchTableJson,t.batchTableBinary,f);return gte(t,l,y,f),i}function gte(t,e,i,r){const s=new Array(r),n=new Be;new Be,new Be,new Be;const c=new pr,l=new fm,f=new Be,y={},E=new ai,T=[],R=[],D=[],V=[];for(let H=0;H<r;H++){let ee;if(e.hasProperty("POSITION"))ee=e.getProperty("POSITION",di.FLOAT,3,H,n);else if(e.hasProperty("POSITION_QUANTIZED")){ee=e.getProperty("POSITION_QUANTIZED",di.UNSIGNED_SHORT,3,H,n);const re=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",di.FLOAT,3);if(!re)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const be=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",di.FLOAT,3);if(!be)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const me=65535;for(let Te=0;Te<3;Te++)ee[Te]=ee[Te]/me*be[Te]+re[Te]}if(!ee)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(n.copy(ee),y.translation=n,t.normalUp=e.getProperty("NORMAL_UP",di.FLOAT,3,H,T),t.normalRight=e.getProperty("NORMAL_RIGHT",di.FLOAT,3,H,R),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",di.UNSIGNED_SHORT,2,H,T),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",di.UNSIGNED_SHORT,2,H,R),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(zi.WGS84.eastNorthUpToFixedFrame(n,E),E.getRotationMatrix3(c)):c.identity()}l.fromMatrix3(c),y.rotation=l,f.set(1,1,1);const z=e.getProperty("SCALE",di.FLOAT,1,H,D);Number.isFinite(z)&&f.multiplyByScalar(z);const W=e.getProperty("SCALE_NON_UNIFORM",di.FLOAT,3,H,T);W&&f.scale(W),y.scale=f;let q=e.getProperty("BATCH_ID",di.UNSIGNED_SHORT,1,H,V);q===void 0&&(q=H);const ce=new ai().fromQuaternion(y.rotation);E.identity(),E.translate(y.translation),E.multiplyRight(ce),E.scale(y.scale);const we=E.clone();s[H]={modelMatrix:we,batchId:q}}t.instances=s}async function _te(t,e,i,r,s,n){i=U1(t,e,i);const c=new DataView(e);for(t.tilesLength=c.getUint32(i,!0),i+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-i>12;){const l={shape:"tile3d"};t.tiles.push(l),i=await n(e,i,r,s,l)}return i}async function yte(t,e,i,r){var s,n;if(t.rotateYtoZ=!0,t.gltfUpAxis=(s=i==null?void 0:i["3d-tiles"])!=null&&s.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",(n=i==null?void 0:i["3d-tiles"])!=null&&n.loadGLTF){if(!r)return e.byteLength;const c=await Rm(e,wm,i,r);t.gltf=CE(c),t.gpuMemoryUsageInBytes=nB(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function LB(t,e=0,i,r,s={shape:"tile3d"}){switch(s.byteOffset=e,s.type=Lee(t,e),s.type){case mf.COMPOSITE:return await _te(s,t,e,i,r,LB);case mf.BATCHED_3D_MODEL:return await dte(s,t,e,i,r);case mf.GLTF:return await yte(s,t,i,r);case mf.INSTANCED_3D_MODEL:return await fte(s,t,e,i,r);case mf.POINT_CLOUD:return await ite(s,t,e,i,r);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}const vte=1952609651,bte=1;async function wte(t,e,i){if(new Uint32Array(t.slice(0,4))[0]!==vte)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==bte)throw new Error("Wrong subtree file verson, must be 1");const r=zI(t.slice(8,16)),s=new Uint8Array(t,24,r),n=new TextDecoder("utf8").decode(s),c=JSON.parse(n),l=zI(t.slice(16,24));let f=new ArrayBuffer(0);if(l&&(f=t.slice(24+r)),await O_(c,c.tileAvailability,f,i),Array.isArray(c.contentAvailability))for(const y of c.contentAvailability)await O_(c,y,f,i);else await O_(c,c.contentAvailability,f,i);return await O_(c,c.childSubtreeAvailability,f,i),c}async function O_(t,e,i,r){const s=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof s!="number")return;const n=t.bufferViews[s],c=t.buffers[n.buffer];if(!(r!=null&&r.baseUrl))throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(c.uri){const f=`${(r==null?void 0:r.baseUrl)||""}/${c.uri}`,y=await(await r.fetch(f)).arrayBuffer();e.explicitBitstream=new Uint8Array(y,n.byteOffset,n.byteLength);return}const l=t.buffers.slice(0,n.buffer).reduce((f,y)=>f+y.byteLength,0);e.explicitBitstream=new Uint8Array(i.slice(l,l+c.byteLength),n.byteOffset,n.byteLength)}function zI(t){const e=new DataView(t),i=e.getUint32(0,!0),r=e.getUint32(4,!0);return i+2**32*r}const OB={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:CB,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:wte,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var no=null;try{no=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ii(t,e,i){this.low=t|0,this.high=e|0,this.unsigned=!!i}Ii.prototype.__isLong__;Object.defineProperty(Ii.prototype,"__isLong__",{value:!0});function Bs(t){return(t&&t.__isLong__)===!0}function jI(t){var e=Math.clz32(t&-t);return t?31-e:e}Ii.isLong=Bs;var GI={},VI={};function Pu(t,e){var i,r,s;return e?(t>>>=0,(s=0<=t&&t<256)&&(r=VI[t],r)?r:(i=mi(t,0,!0),s&&(VI[t]=i),i)):(t|=0,(s=-128<=t&&t<128)&&(r=GI[t],r)?r:(i=mi(t,t<0?-1:0,!1),s&&(GI[t]=i),i))}Ii.fromInt=Pu;function oo(t,e){if(isNaN(t))return e?qa:Bo;if(e){if(t<0)return qa;if(t>=DB)return UB}else{if(t<=-HI)return dn;if(t+1>=HI)return NB}return t<0?oo(-t,e).neg():mi(t%Dd|0,t/Dd|0,e)}Ii.fromNumber=oo;function mi(t,e,i){return new Ii(t,e,i)}Ii.fromBits=mi;var t1=Math.pow;function BE(t,e,i){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(i=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?qa:Bo;if(i=i||10,i<2||36<i)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return BE(t.substring(1),e,i).neg();for(var s=oo(t1(i,8)),n=Bo,c=0;c<t.length;c+=8){var l=Math.min(8,t.length-c),f=parseInt(t.substring(c,c+l),i);if(l<8){var y=oo(t1(i,l));n=n.mul(y).add(oo(f))}else n=n.mul(s),n=n.add(oo(f))}return n.unsigned=e,n}Ii.fromString=BE;function zo(t,e){return typeof t=="number"?oo(t,e):typeof t=="string"?BE(t,e):mi(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Ii.fromValue=zo;var $I=65536,xte=1<<24,Dd=$I*$I,DB=Dd*Dd,HI=DB/2,qI=Pu(xte),Bo=Pu(0);Ii.ZERO=Bo;var qa=Pu(0,!0);Ii.UZERO=qa;var ad=Pu(1);Ii.ONE=ad;var FB=Pu(1,!0);Ii.UONE=FB;var Ix=Pu(-1);Ii.NEG_ONE=Ix;var NB=mi(-1,2147483647,!1);Ii.MAX_VALUE=NB;var UB=mi(-1,-1,!0);Ii.MAX_UNSIGNED_VALUE=UB;var dn=mi(0,-2147483648,!1);Ii.MIN_VALUE=dn;var rt=Ii.prototype;rt.toInt=function(){return this.unsigned?this.low>>>0:this.low};rt.toNumber=function(){return this.unsigned?(this.high>>>0)*Dd+(this.low>>>0):this.high*Dd+(this.low>>>0)};rt.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(dn)){var e=oo(t),i=this.div(e),r=i.mul(e).sub(this);return i.toString(t)+r.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=oo(t1(t,6),this.unsigned),n=this,c="";;){var l=n.div(s),f=n.sub(l.mul(s)).toInt()>>>0,y=f.toString(t);if(n=l,n.isZero())return y+c;for(;y.length<6;)y="0"+y;c=""+y+c}};rt.getHighBits=function(){return this.high};rt.getHighBitsUnsigned=function(){return this.high>>>0};rt.getLowBits=function(){return this.low};rt.getLowBitsUnsigned=function(){return this.low>>>0};rt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(dn)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1};rt.isZero=function(){return this.high===0&&this.low===0};rt.eqz=rt.isZero;rt.isNegative=function(){return!this.unsigned&&this.high<0};rt.isPositive=function(){return this.unsigned||this.high>=0};rt.isOdd=function(){return(this.low&1)===1};rt.isEven=function(){return(this.low&1)===0};rt.equals=function(t){return Bs(t)||(t=zo(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};rt.eq=rt.equals;rt.notEquals=function(t){return!this.eq(t)};rt.neq=rt.notEquals;rt.ne=rt.notEquals;rt.lessThan=function(t){return this.comp(t)<0};rt.lt=rt.lessThan;rt.lessThanOrEqual=function(t){return this.comp(t)<=0};rt.lte=rt.lessThanOrEqual;rt.le=rt.lessThanOrEqual;rt.greaterThan=function(t){return this.comp(t)>0};rt.gt=rt.greaterThan;rt.greaterThanOrEqual=function(t){return this.comp(t)>=0};rt.gte=rt.greaterThanOrEqual;rt.ge=rt.greaterThanOrEqual;rt.compare=function(t){if(Bs(t)||(t=zo(t)),this.eq(t))return 0;var e=this.isNegative(),i=t.isNegative();return e&&!i?-1:!e&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};rt.comp=rt.compare;rt.negate=function(){return!this.unsigned&&this.eq(dn)?dn:this.not().add(ad)};rt.neg=rt.negate;rt.add=function(t){Bs(t)||(t=zo(t));var e=this.high>>>16,i=this.high&65535,r=this.low>>>16,s=this.low&65535,n=t.high>>>16,c=t.high&65535,l=t.low>>>16,f=t.low&65535,y=0,E=0,T=0,R=0;return R+=s+f,T+=R>>>16,R&=65535,T+=r+l,E+=T>>>16,T&=65535,E+=i+c,y+=E>>>16,E&=65535,y+=e+n,y&=65535,mi(T<<16|R,y<<16|E,this.unsigned)};rt.subtract=function(t){return Bs(t)||(t=zo(t)),this.add(t.neg())};rt.sub=rt.subtract;rt.multiply=function(t){if(this.isZero())return this;if(Bs(t)||(t=zo(t)),no){var e=no.mul(this.low,this.high,t.low,t.high);return mi(e,no.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?qa:Bo;if(this.eq(dn))return t.isOdd()?dn:Bo;if(t.eq(dn))return this.isOdd()?dn:Bo;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(qI)&&t.lt(qI))return oo(this.toNumber()*t.toNumber(),this.unsigned);var i=this.high>>>16,r=this.high&65535,s=this.low>>>16,n=this.low&65535,c=t.high>>>16,l=t.high&65535,f=t.low>>>16,y=t.low&65535,E=0,T=0,R=0,D=0;return D+=n*y,R+=D>>>16,D&=65535,R+=s*y,T+=R>>>16,R&=65535,R+=n*f,T+=R>>>16,R&=65535,T+=r*y,E+=T>>>16,T&=65535,T+=s*f,E+=T>>>16,T&=65535,T+=n*l,E+=T>>>16,T&=65535,E+=i*y+r*f+s*l+n*c,E&=65535,mi(R<<16|D,E<<16|T,this.unsigned)};rt.mul=rt.multiply;rt.divide=function(t){if(Bs(t)||(t=zo(t)),t.isZero())throw Error("division by zero");if(no){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?no.div_u:no.div_s)(this.low,this.high,t.low,t.high);return mi(e,no.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?qa:Bo;var i,r,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return qa;if(t.gt(this.shru(1)))return FB;s=qa}else{if(this.eq(dn)){if(t.eq(ad)||t.eq(Ix))return dn;if(t.eq(dn))return ad;var n=this.shr(1);return i=n.div(t).shl(1),i.eq(Bo)?t.isNegative()?ad:Ix:(r=this.sub(t.mul(i)),s=i.add(r.div(t)),s)}else if(t.eq(dn))return this.unsigned?qa:Bo;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=Bo}for(r=this;r.gte(t);){i=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var c=Math.ceil(Math.log(i)/Math.LN2),l=c<=48?1:t1(2,c-48),f=oo(i),y=f.mul(t);y.isNegative()||y.gt(r);)i-=l,f=oo(i,this.unsigned),y=f.mul(t);f.isZero()&&(f=ad),s=s.add(f),r=r.sub(y)}return s};rt.div=rt.divide;rt.modulo=function(t){if(Bs(t)||(t=zo(t)),no){var e=(this.unsigned?no.rem_u:no.rem_s)(this.low,this.high,t.low,t.high);return mi(e,no.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};rt.mod=rt.modulo;rt.rem=rt.modulo;rt.not=function(){return mi(~this.low,~this.high,this.unsigned)};rt.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};rt.clz=rt.countLeadingZeros;rt.countTrailingZeros=function(){return this.low?jI(this.low):jI(this.high)+32};rt.ctz=rt.countTrailingZeros;rt.and=function(t){return Bs(t)||(t=zo(t)),mi(this.low&t.low,this.high&t.high,this.unsigned)};rt.or=function(t){return Bs(t)||(t=zo(t)),mi(this.low|t.low,this.high|t.high,this.unsigned)};rt.xor=function(t){return Bs(t)||(t=zo(t)),mi(this.low^t.low,this.high^t.high,this.unsigned)};rt.shiftLeft=function(t){return Bs(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?mi(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):mi(0,this.low<<t-32,this.unsigned)};rt.shl=rt.shiftLeft;rt.shiftRight=function(t){return Bs(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?mi(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):mi(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};rt.shr=rt.shiftRight;rt.shiftRightUnsigned=function(t){return Bs(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?mi(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?mi(this.high,0,this.unsigned):mi(this.high>>>t-32,0,this.unsigned)};rt.shru=rt.shiftRightUnsigned;rt.shr_u=rt.shiftRightUnsigned;rt.rotateLeft=function(t){var e;return Bs(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?mi(this.high,this.low,this.unsigned):t<32?(e=32-t,mi(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,mi(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))};rt.rotl=rt.rotateLeft;rt.rotateRight=function(t){var e;return Bs(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?mi(this.high,this.low,this.unsigned):t<32?(e=32-t,mi(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,mi(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))};rt.rotr=rt.rotateRight;rt.toSigned=function(){return this.unsigned?mi(this.low,this.high,!1):this};rt.toUnsigned=function(){return this.unsigned?this:mi(this.low,this.high,!0)};rt.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};rt.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};rt.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};Ii.fromBytes=function(t,e,i){return i?Ii.fromBytesLE(t,e):Ii.fromBytesBE(t,e)};Ii.fromBytesLE=function(t,e){return new Ii(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)};Ii.fromBytesBE=function(t,e){return new Ii(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const Ete=16;function zB(t){t==="X"&&(t="");const e=t.padEnd(Ete,"0");return Ii.fromString(e,!0,16)}function Ate(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const i=e%4;e=(e-i)/4;const r=e;e*=4;const s=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-s.length).join("0")+s}function Tte(t,e){const i=Ste(t).shiftRightUnsigned(2);return t.add(Ii.fromNumber(2*e+1-4).multiply(i))}function Ste(t){return t.and(t.not().add(1))}const Cte=3,Ite=30,Rte=2*Ite+1,WI=180/Math.PI;function Mte(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),i=parseInt(e[0],10),r=e[1],s=r.length;let n=0;const c=[0,0];for(let l=s-1;l>=0;l--){n=s-l;const f=r[l];let y=0,E=0;f==="1"?E=1:f==="2"?(y=1,E=1):f==="3"&&(y=1);const T=Math.pow(2,n-1);kte(T,c,y,E),c[0]+=T*y,c[1]+=T*E}if(i%2===1){const l=c[0];c[0]=c[1],c[1]=l}return{face:i,ij:c,level:n}}function Pte(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<Cte+Rte;)e="0"+e;const i=e.lastIndexOf("1"),r=e.substring(0,3),s=e.substring(3,i),n=s.length/2,c=Ii.fromString(r,!0,2).toString(10);let l="";if(n!==0)for(l=Ii.fromString(s,!0,2).toString(4);l.length<n;)l="0"+l;return`${c}/${l}`}function jB(t,e,i){const r=1<<e;return[(t[0]+i[0])/r,(t[1]+i[1])/r]}function XI(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function GB(t){return[XI(t[0]),XI(t[1])]}function VB(t,[e,i]){switch(t){case 0:return[1,e,i];case 1:return[-e,1,i];case 2:return[-e,-i,1];case 3:return[-1,-i,-e];case 4:return[i,-1,-e];case 5:return[i,e,-1];default:throw new Error("Invalid face")}}function $B([t,e,i]){const r=Math.atan2(i,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*WI,r*WI]}function kte(t,e,i,r){if(r===0){i===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}function Bte(t){const e=jB(t.ij,t.level,[.5,.5]),i=GB(e),r=VB(t.face,i);return $B(r)}const Lte=100;function KI(t){const{face:e,ij:i,level:r}=t,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(Lte*Math.pow(2,-r))),c=new Float64Array(4*n*2+2);let l=0,f=0;for(let y=0;y<4;y++){const E=s[y].slice(0),T=s[y+1],R=(T[0]-E[0])/n,D=(T[1]-E[1])/n;for(let V=0;V<n;V++){E[0]+=R,E[1]+=D;const H=jB(i,r,E),ee=GB(H),z=VB(e,ee),W=$B(z);Math.abs(W[1])>89.999&&(W[0]=f);const q=W[0]-f;W[0]+=q>180?-360:q<-180?360:0,c[l++]=W[0],c[l++]=W[1],f=W[0]}}return c[l++]=c[0],c[l++]=c[1],c}function LE(t){const e=Ote(t);return Mte(e)}function Ote(t){if(t.indexOf("/")>0)return t;const e=zB(t);return Pte(e)}function Dte(t){const e=LE(t);return Bte(e)}function Fte(t){let e;if(t.face===2||t.face===5){let i=null,r=0;for(let s=0;s<4;s++){const n=`${t.face}/${s}`,c=LE(n),l=KI(c);(typeof i>"u"||i===null)&&(i=new Float64Array(4*l.length)),i.set(l,r),r+=l.length}e=JI(i)}else{const i=KI(t);e=JI(i)}return e}function JI(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],i=[];for(let r=0;r<t.length;r+=2)e.push(t[r]),i.push(t[r+1]);return e.sort((r,s)=>r-s),i.sort((r,s)=>r-s),{west:e[0],east:e[e.length-1],north:i[i.length-1],south:i[0]}}function Nte(t,e){const i=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,s=LE(t),n=Fte(s),c=n.west,l=n.south,f=n.east,y=n.north,E=[];return E.push(new Be(c,y,i)),E.push(new Be(f,y,i)),E.push(new Be(f,l,i)),E.push(new Be(c,l,i)),E.push(new Be(c,y,r)),E.push(new Be(f,y,r)),E.push(new Be(f,l,r)),E.push(new Be(c,l,r)),E}function HB(t){const e=t.token,i={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},r=Nte(e,i),s=Dte(e),n=s[0],c=s[1],l=zi.WGS84.cartographicToCartesian([n,c,i.maximumHeight]),f=new Be(l[0],l[1],l[2]);r.push(f);const y=PK(r);return[...y.center,...y.halfAxes]}const Ute=4,zte=8,jte={QUADTREE:Ute,OCTREE:zte};function Gte(t,e,i){if(t!=null&&t.box){const r=zB(t.s2VolumeInfo.token),s=Tte(r,e),n=Ate(s),c={...t.s2VolumeInfo};switch(c.token=n,i){case"OCTREE":const l=t.s2VolumeInfo,f=l.maximumHeight-l.minimumHeight,y=f/2,E=l.minimumHeight+f/2;l.minimumHeight=E-y,l.maximumHeight=E+y;break}return{box:HB(c),s2VolumeInfo:c}}}async function qB(t){const{subtree:e,subtreeData:i={level:0,x:0,y:0,z:0},parentData:r={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:s=0,implicitOptions:n,loaderOptions:c,s2VolumeBox:l}=t,{subdivisionScheme:f,subtreeLevels:y,maximumLevel:E,contentUrlTemplate:T,subtreesUriTemplate:R,basePath:D}=n,V={children:[],lodMetricValue:0,contentUrl:""};if(!E)return ZM.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${T} won't be loaded...`),V;const H=r.localLevel+1,ee=i.level+H;if(ee>E)return V;const z=jte[f],W=Math.log2(z),q=s&1,ce=s>>1&1,we=s>>2&1,re=Kc(r.localX,q,1),be=Kc(r.localY,ce,1),me=Kc(r.localZ,we,1),Te=Kc(i.x,re,H),Pe=Kc(i.y,be,H),ze=Kc(i.z,me,H),Ke=Kc(r.mortonIndex,s,W),We=H===y&&Bb(e.childSubtreeAvailability,Ke);let Ze,Ft,ci,Gt;if(We){const et=`${D}/${R}`,xt=Rx(et,ee,Te,Pe,ze);Ze=await dc(xt,OB,c),Gt=0,Ft={level:ee,x:Te,y:Pe,z:ze},ci={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Ze=e,Gt=(z**H-1)/(z-1)+Ke,Ft=i,ci={mortonIndex:Ke,localLevel:H,localX:re,localY:be,localZ:me};if(!Bb(Ze.tileAvailability,Gt))return V;Bb(Ze.contentAvailability,Gt)&&(V.contentUrl=Rx(T,ee,Te,Pe,ze));for(let et=0;et<z;et++){const xt=Gte(l,et,f),Tt=await qB({subtree:Ze,subtreeData:Ft,parentData:ci,childIndex:et,implicitOptions:n,loaderOptions:c,s2VolumeBox:xt});(Tt.contentUrl||Tt.children.length)&&V.children.push(Tt)}return V.contentUrl||V.children.length?Vte(V,{level:ee,x:Te,y:Pe,z:ze},n,l):V}function Bb(t,e){let i;return Array.isArray(t)?(i=t[0],t.length>1&&ZM.once('Not supported extension "3DTILES_multiple_contents" has been detected')):i=t,"constant"in i?!!i.constant:i.explicitBitstream?qte(e,i.explicitBitstream):!1}function Vte(t,e,i,r){const{basePath:s,refine:n,getRefine:c,lodMetricType:l,getTileType:f,rootLodMetricValue:y,rootBoundingVolume:E}=i,T=t.contentUrl&&t.contentUrl.replace(`${s}/`,""),R=y/2**e.level,D=r!=null&&r.box?{box:r.box}:E,V=$te(D,e,i.subdivisionScheme);return{children:t.children,contentUrl:t.contentUrl,content:{uri:T},id:t.contentUrl,refine:c(n),type:f(t),lodMetricType:l,lodMetricValue:R,geometricError:R,transform:t.transform,boundingVolume:V}}function $te(t,e,i){if(t.region){const{level:r,x:s,y:n,z:c}=e,[l,f,y,E,T,R]=t.region,D=2**r,V=(y-l)/D,[H,ee]=[l+V*s,l+V*(s+1)],z=(E-f)/D,[W,q]=[f+z*n,f+z*(n+1)];let ce,we;if(i==="OCTREE"){const re=(R-T)/D;[ce,we]=[T+re*c,T+re*(c+1)]}else[ce,we]=[T,R];return{region:[H,W,ee,q,ce,we]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}function Kc(t,e,i){return(t<<i)+e}function Rx(t,e,i,r,s){const n=Hte({level:e,x:i,y:r,z:s});return t.replace(/{level}|{x}|{y}|{z}/gi,c=>n[c])}function Hte(t){const e={};for(const i in t)e[`{${i}}`]=t[i];return e}function qte(t,e){const i=Math.floor(t/8),r=t%8;return(e[i]>>r&1)===1}function OE(t,e=""){if(!e)return Ha.EMPTY;const i=e.split("?")[0].split(".").pop();switch(i){case"pnts":return Ha.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ha.SCENEGRAPH;default:return i||Ha.EMPTY}}function DE(t){switch(t){case"REPLACE":case"replace":return Fo.REPLACE;case"ADD":case"add":return Fo.ADD;default:return t}}function Mx(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const i=new URL(t,`${e}/`);return decodeURI(i.toString())}else if(t.startsWith("/"))return t;return qN(e,t)}function ZI(t,e){var i;if(!t)return null;let r;if(t.content){const s=t.content.uri||((i=t.content)==null?void 0:i.url);typeof s<"u"&&(r=Mx(s,e))}return{...t,id:r,contentUrl:r,lodMetricType:Od.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:OE(t,r),refine:DE(t.refine)}}async function Wte(t,e,i){let r=null;const s=QI(t.root);s&&t.root?r=await YI(t.root,t,e,s,i):r=ZI(t.root,e);const n=[];for(n.push(r);n.length>0;){const c=n.pop()||{},l=c.children||[],f=[];for(const y of l){const E=QI(y);let T;E?T=await YI(y,t,e,E,i):T=ZI(y,e),T&&(f.push(T),n.push(T))}c.children=f}return r}async function YI(t,e,i,r,s){var n,c,l;const{subdivisionScheme:f,maximumLevel:y,availableLevels:E,subtreeLevels:T,subtrees:{uri:R}}=r,D=Rx(R,0,0,0,0),V=Mx(D,i),H=await dc(V,OB,s),ee=(n=t.content)==null?void 0:n.uri,z=ee?Mx(ee,i):"",W=(c=e==null?void 0:e.root)==null?void 0:c.refine,q=t.geometricError,ce=(l=t.boundingVolume.extensions)==null?void 0:l["3DTILES_bounding_volume_S2"];if(ce){const be={box:HB(ce),s2VolumeInfo:ce};t.boundingVolume=be}const we=t.boundingVolume,re={contentUrlTemplate:z,subtreesUriTemplate:R,subdivisionScheme:f,subtreeLevels:T,maximumLevel:Number.isFinite(E)?E-1:y,refine:W,basePath:i,lodMetricType:Od.GEOMETRIC_ERROR,rootLodMetricValue:q,rootBoundingVolume:we,getTileType:OE,getRefine:DE};return await Xte(t,i,H,re,s)}async function Xte(t,e,i,r,s){if(!t)return null;const{children:n,contentUrl:c}=await qB({subtree:i,implicitOptions:r,loaderOptions:s});let l,f=null;return c&&(l=c,f={uri:c.replace(`${e}/`,"")}),{...t,id:l,contentUrl:l,lodMetricType:Od.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:OE(t,l),refine:DE(t.refine),content:f||t.content,children:n}}function QI(t){var e;return((e=t==null?void 0:t.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const WB={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:CB,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Kte,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Kte(t,e={},i){const r=e["3d-tiles"]||{};let s;return r.isTileset==="auto"?s=(i==null?void 0:i.url)&&i.url.indexOf(".json")!==-1:s=r.isTileset,s?Jte(t,e,i):Zte(t,e,i)}async function Jte(t,e,i){var r;const s=JSON.parse(new TextDecoder().decode(t)),n=(i==null?void 0:i.url)||"",c=Yte(n),l=await Wte(s,c,e||{});return{...s,shape:"tileset3d",loader:WB,url:n,queryString:(i==null?void 0:i.queryString)||"",basePath:c,root:l||s.root,type:an.TILES3D,lodMetricType:Od.GEOMETRIC_ERROR,lodMetricValue:((r=s.root)==null?void 0:r.geometricError)||0}}async function Zte(t,e,i){const r={content:{shape:"tile3d",featureIds:null}};return await LB(t,0,e,i,r.content),r.content}function Yte(t){return z2(t)}const eR=[0],Qte={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:WB,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,i)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class FE extends Xk{initializeState(){"onTileLoadFail"in this.props&&fi.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,i;return!!((i=(e=this.state)==null?void 0:e.tileset3d)!=null&&i.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:i,changeFlags:r}){if(e.data&&e.data!==i.data&&this._loadTileset(e.data),r.viewportChanged){const{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(r.propsChanged){const{layerMap:s}=this.state;for(const n in s)s[n].needsUpdate=!0}}activateViewport(e){const{activeViewports:i,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,i[e.id]=e;const s=r==null?void 0:r[e.id];(!s||!e.equals(s))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:i}){const r=i&&i.props.tile;return e.picked&&(e.object=r),e.sourceTile=r,e}filterSubLayer({layer:e,viewport:i}){const{tile:r}=e.props,{id:s}=i;return r.selected&&r.viewportIds.includes(s)}_updateAutoHighlight(e){const i=e.sourceTile,r=this.state.layerMap[i==null?void 0:i.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:i={}}=this.props,r=this.props.loader||this.props.loaders,s=Array.isArray(r)?r[0]:r,n={loadOptions:{...i}};let c=e;if(s.preload){const y=await s.preload(e,i);y.url&&(c=y.url),y.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:y.headers}),Object.assign(n,y)}const l=await dc(c,s,n.loadOptions),f=new Bee(l,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:f,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(f)}_onTileLoad(e){const{lastUpdatedViewports:i}=this.state;this.props.onTileLoad(e),this._updateTileset(i),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:i}=this.state,{timeline:r}=this.context,s=Object.keys(e).length;!r||!s||!i||i.selectTiles(Object.values(e)).then(n=>{this.state.frameNumber!==n&&this.setState({frameNumber:n})})}_getSubLayer(e,i){if(!e.content)return null;switch(e.type){case Ha.POINTCLOUD:return this._makePointCloudLayer(e,i);case Ha.SCENEGRAPH:return this._make3DModelLayer(e);case Ha.MESH:return this._makeSimpleMeshLayer(e,i);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,i){const{attributes:r,pointCount:s,constantRGBA:n,cartographicOrigin:c,modelMatrix:l}=e.content,{positions:f,normals:y,colors:E}=r;if(!f)return null;const T=i&&i.props.data||{header:{vertexCount:s},attributes:{POSITION:f,NORMAL:y,COLOR_0:E}},{pointSize:R,getPointColor:D}=this.props,V=this.getSubLayerClass("pointcloud",bE);return new V({pointSize:R},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:T,coordinateSystem:li.METER_OFFSETS,coordinateOrigin:c,modelMatrix:l,getColor:n||D,_offset:0})}_make3DModelLayer(e){const{gltf:i,instances:r,cartographicOrigin:s,modelMatrix:n}=e.content,c=this.getSubLayerClass("scenegraph",IE);return new c({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:r||eR,scenegraph:i,coordinateSystem:li.METER_OFFSETS,coordinateOrigin:s,modelMatrix:n,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,i){const r=e.content,{attributes:s,indices:n,modelMatrix:c,cartographicOrigin:l,coordinateSystem:f=li.METER_OFFSETS,material:y,featureIds:E}=r,{_getMeshColor:T}=this.props,R=i&&i.props.mesh||new _d({topology:"triangle-list",attributes:eie(s),indices:n}),D=this.getSubLayerClass("mesh",RE);return new D(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:R,data:eR,getColor:T(e),pbrMaterial:y,modelMatrix:c,coordinateOrigin:l,coordinateSystem:f,featureIds:E,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:i}=this.state;return e?e.tiles.map(r=>{const s=i[r.id]=i[r.id]||{tile:r};let{layer:n}=s;return r.selected&&(n?s.needsUpdate&&(n=this._getSubLayer(r,n),s.needsUpdate=!1):n=this._getSubLayer(r)),s.layer=n,n}).filter(Boolean):null}}FE.defaultProps=Qte;FE.layerName="Tile3DLayer";function eie(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const Lb=512,tie=Math.PI/180;function XB({map:t,gl:e,deck:i}){if(t.__deck)return t.__deck;const r=i==null?void 0:i.props._customRender,s=i==null?void 0:i.props.onLoad,n=JB({...i==null?void 0:i.props,_customRender:()=>{t.triggerRepaint(),r==null||r("")}});let c;return(!i||i.props.gl===e)&&(Object.assign(n,{gl:e,width:null,height:null,touchAction:"unset",viewState:xm(t)}),i!=null&&i.isInitialized?tR(i,t):n.onLoad=()=>{s==null||s(),tR(c,t)}),i?(c=i,i.setProps(n),i.userData.isExternal=!0):(c=new vm(n),t.on("remove",()=>{KB(t)})),c.userData.mapboxLayers=new Set,t.__deck=c,t.on("render",()=>{c.isInitialized&&aie(c,t)}),c}function tR(t,e){const i=()=>{t.isInitialized?lie(t,e):e.off("move",i)};e.on("move",i)}function KB(t){var e;(e=t.__deck)==null||e.finalize(),t.__deck=null}function JB(t){return{...t,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new pE({id:"mapbox"})]}}function iie(t,e){t.userData.mapboxLayers.add(e),NE(t)}function rie(t,e){t.userData.mapboxLayers.delete(e),NE(t)}function sie(t,e){NE(t)}function nie(t,e,i){let{currentViewport:r}=t.userData,s=!1;r||(r=ZB(t,e,!0),t.userData.currentViewport=r,s=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:({layer:n})=>i.id===n.id||n.props.operation.includes("terrain"),clearStack:s,clearCanvas:!1})}function xm(t){var e;const{lng:i,lat:r}=t.getCenter(),s={longitude:(i+540)%360-180,latitude:r,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(e=t.getTerrain)!=null&&e.call(t)&&oie(t,s),s}function oie(t,e){if(t.getFreeCameraOptions){const{position:i}=t.getFreeCameraOptions();if(!i||i.z===void 0)return;const r=t.transform.height,{longitude:s,latitude:n,pitch:c}=e,l=i.x*Lb,f=(1-i.y)*Lb,y=i.z*Lb,E=mm([s,n]),T=l-E[0],R=f-E[1],D=Math.sqrt(T*T+R*R),V=c*tie,H=1.5*r,ee=V<.001?H*Math.cos(V)/y:H*Math.sin(V)/D;e.zoom=Math.log2(ee);const z=H*Math.cos(V)/ee,W=y-z;e.position=[0,0,W/s0(n)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function ZB(t,e,i=!0){return new xu({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...xm(e),nearZMultiplier:i?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function aie(t,e){const{mapboxLayers:i,isExternal:r}=t.userData;if(r){const s=Array.from(i,y=>y.id),n=kd(t.props.layers,Boolean).some(y=>y&&!s.includes(y.id));let c=t.getViewports();const l=c.findIndex(y=>y.id==="mapbox"),f=c.length>1||l<0;(n||f)&&(l>=0&&(c=c.slice(),c[l]=ZB(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:c,layerFilter:y=>(!t.props.layerFilter||t.props.layerFilter(y))&&(y.viewport.id!=="mapbox"||!s.includes(y.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function lie(t,e){t.setProps({viewState:xm(e)}),t.needsRedraw({clearRedrawFlags:!0})}function NE(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(i=>{const r=i.props.type,s=new r(i.props);e.push(s)}),t.setProps({layers:e})}class cie{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,i){this.map=e,this.deck=XB({map:e,gl:i,deck:this.props.deck}),iie(this.deck,this)}onRemove(){this.deck&&rie(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&sie(this.deck)}render(){nie(this.deck,this.map,this)}}const Ob="__UNDEFINED__";function D_(t,e,i,r){if(!t||!e||!t.style||!t.style._loaded)return;const s=kd(r,Boolean);if(i!==r){const l=kd(i,Boolean),f=new Set(l.map(y=>y.id));for(const y of s)f.delete(y.id);for(const y of f)t.getLayer(y)&&t.removeLayer(y)}for(const l of s){const f=t.getLayer(l.id);f?(f.implementation||f).setProps(l.props):t.addLayer(new cie({id:l.id,deck:e}),l.props.beforeId)}const n=t.style._order,c={};for(const l of s){let{beforeId:f}=l.props;(!f||!n.includes(f))&&(f=Ob),c[f]=c[f]||[],c[f].push(l.id)}for(const l in c){const f=c[l];let y=l===Ob?n.length:n.indexOf(l),E=l===Ob?void 0:l;for(let T=f.length-1;T>=0;T--){const R=f[T],D=n.indexOf(R);D!==y-1&&(t.moveLayer(R,E),D>y&&y++),y--,E=R}}}class uie{constructor(e){this._handleStyleChange=()=>{D_(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:s,clientHeight:n}=this._map.getContainer();Object.assign(this._container.style,{width:`${s}px`,height:`${n}px`})}},this._updateViewState=()=>{const s=this._deck;s&&(s.setProps({viewState:xm(this._map)}),s.isInitialized&&s.redraw())},this._handleMouseEvent=s=>{const n=this._deck;if(!n||!n.isInitialized)return;const c={type:s.type,offsetCenter:s.point,srcEvent:s},l=this._lastMouseDownPoint;switch(!s.point&&l&&(c.deltaX=s.originalEvent.clientX-l.clientX,c.deltaY=s.originalEvent.clientY-l.clientY,c.offsetCenter={x:l.x+c.deltaX,y:l.y+c.deltaY}),c.type){case"mousedown":n._onPointerDown(c),this._lastMouseDownPoint={...s.point,clientX:s.originalEvent.clientX,clientY:s.originalEvent.clientY};break;case"dragstart":c.type="panstart",n._onEvent(c);break;case"drag":c.type="panmove",n._onEvent(c);break;case"dragend":c.type="panend",n._onEvent(c);break;case"click":c.tapCount=1,n._onEvent(c);break;case"dblclick":c.type="click",c.tapCount=2,n._onEvent(c);break;case"mousemove":c.type="pointermove",n._onPointerMove(c);break;case"mouseout":c.type="pointerleave",n._onPointerMove(c);break;default:return}};const{interleaved:i=!1,...r}=e;this._interleaved=i,this._props=r}setProps(e){this._interleaved&&e.layers&&D_(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?JB(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const i=document.createElement("div");return Object.assign(i.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=i,this._deck=new vm({...this._props,parent:i,viewState:xm(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),i}_onAddInterleaved(e){const i=e.painter.context.gl;return i instanceof WebGLRenderingContext&&fi.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=XB({map:e,gl:i,deck:new vm({...this._props,gl:i})}),e.on("styledata",this._handleStyleChange),D_(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var i;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(i=this._deck)==null||i.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),D_(e,this._deck,this._props.layers,[]),KB(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Br(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Br(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Br(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}class Fd{constructor({apiKey:e,accessToken:i="",mode:r="2d",threedTileset:s=VF}){O(this,"olaMaps"),O(this,"apiKey"),O(this,"accessToken"),O(this,"mode"),O(this,"threedTileset"),this.apiKey=e,this.mode=r,this.threedTileset=s,this.accessToken=i}addOlaLogo(e){var i;if(typeof window>"u")return;const r=document.getElementsByClassName("maplibregl-ctrl-bottom-left");let s="#000";(i=e.style)!=null&&i.includes("dark")&&(s="#FFF");for(let n=0;n<r.length;n++){const c=document.createElement("div");c.style.position="absolute",c.style.bottom="4px",c.style.left="10px",c.style.zIndex="1000",c.innerHTML=$F(s),r[n].appendChild(c)}}addAttribution(){const e=document.querySelectorAll(".maplibregl-ctrl-bottom-right .maplibregl-ctrl-attrib-inner");e==null||e.forEach(i=>{const r=i.querySelector("a");r&&(r.style.display="none");const s="ola-maps-link";if(!i.querySelector(`#${s}`)){const c=document.createElement("a");c.id=s,c.href="https://maps.olakrutrim.com/",c.target="_blank",c.textContent="Ola Maps ",i.appendChild(c)}const n="osm-link";if(!i.querySelector(`#${n}`)){const c=document.createElement("a");c.id=n,c.href="https://www.openstreetmap.org/copyright",c.target="_blank",c.textContent="| © OpenStreetMap contributors",i.appendChild(c)}})}fetchStaticMap(e){try{return fetch(e).then(i=>i.blob())}catch(i){console.log(i)}}async add3dLayer(){if(!this.threedTileset)throw new Error("3d Tileset is not initialized");const e=new FE({id:"tile-3d-layer",data:`${this.threedTileset}?api_key=${this.apiKey}`,beforeId:"poi_railway"}),i=new uie({interleaved:!0,layers:[e]});i&&this.olaMaps.on("style.load",()=>{this.olaMaps.setFilter("building-3d",["all",["!has","hide_3d"],["!=","render_as_3d",!0]]),this.olaMaps.addControl(i)})}init(e){this.olaMaps=new Da.Map({container:(e==null?void 0:e.container)||"map",center:(e==null?void 0:e.center)||[0,0],zoom:(e==null?void 0:e.zoom)||9,hash:(e==null?void 0:e.hash)||!1,style:(e==null?void 0:e.style)||GF,transformRequest:(r,s)=>{if(this.accessToken)return{url:r,headers:{Authorization:`Bearer ${this.accessToken}`}};{const n=new URL(r);return s!=="Image"&&n.searchParams.append("api_key",this.apiKey),{url:n.toString()}}},...e}),this.mode==="3d"&&this.add3dLayer(),this.addOlaLogo(e),this.addAttribution();const i={};return Object.getOwnPropertyNames(Da.Map.prototype).forEach(r=>{typeof this.olaMaps[r]=="function"&&(i[r]=this.olaMaps[r].bind(this.olaMaps))}),Object.keys(o_).forEach(r=>{typeof o_[r]=="function"?i[r]=(...s)=>new o_[r](...s):i[r]=o_[r]}),Object.getOwnPropertyNames(this.olaMaps).forEach(r=>{r in i||(i[r]=this.olaMaps[r])}),Object.assign(this.olaMaps,i)}addNavigationControls(e){return new Da.NavigationControl(e)}addGeolocateControls(e){return new Da.GeolocateControl(e)}getMercatorCoordinate(){return Da.MercatorCoordinate}addMarker(e){return new Da.Marker(e)}addPopup(e){return new Da.Popup(e)}getStaticMap(e,i){const r=this.fetchStaticMap(e);r==null||r.then(s=>{const n=URL.createObjectURL(s),c=document.createElement("img");c.src=n;const l=document.getElementById(i);l&&!l.querySelector("img")?l==null||l.appendChild(c):console.log("An image already exists in the element.")}).catch(s=>console.error(s))}}typeof window<"u"&&(window.OlaMaps=Fd);var hie={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const die=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),jn=(t,e)=>{const i=dt.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:c,children:l,...f},y)=>dt.createElement("svg",{ref:y,...hie,width:s,height:s,stroke:r,strokeWidth:c?Number(n)*24/Number(s):n,className:`lucide lucide-${die(t)}`,...f},[...e.map(([E,T])=>dt.createElement(E,T)),...(Array.isArray(l)?l:[l])||[]]));return i.displayName=`${t}`,i},pie=jn("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]]),fie=jn("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),YB=jn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),mie=jn("Layers",[["polygon",{points:"12 2 2 7 12 12 22 7 12 2",key:"1b0ttc"}],["polyline",{points:"2 17 12 22 22 17",key:"imjtdl"}],["polyline",{points:"2 12 12 17 22 12",key:"5dexcv"}]]),iR=jn("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]),gie=jn("Locate",[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]]),QB=jn("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),c0=jn("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),e6=jn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),_ie=jn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),yie=jn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),vie=jn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),bie=jn("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),wie="https://api.olamaps.io";class xie{constructor(){Gg(this,"apiKey");Gg(this,"clientId");Gg(this,"clientSecret");if(this.apiKey="JzTn7KxSegCBa7zxf7zdEBb2CbGkHpLsObU8R3Gy",this.clientId="56514ccd-eec1-4291-9c0b-e66ec7a9c16b",this.clientSecret="c09738b0ac52451789e1f14c4331e0c0",!this.apiKey||!this.clientId||!this.clientSecret)throw new Error("Missing Ola Maps API credentials")}async makeRequest(e,i={},r="GET"){const s=new URL(e,wie);s.searchParams.append("api_key",this.apiKey),Object.keys(i).forEach(c=>{i[c]!==void 0&&i[c]!==null&&s.searchParams.append(c,i[c].toString())});const n=await fetch(s.toString(),{method:r,headers:{"X-Request-Id":"XXX","Content-Type":"application/json"}});if(!n.ok)throw new Error(`Ola Maps API error: ${n.status} ${n.statusText}`);return n.json()}async autocomplete(e,i){const r={input:e};return i&&(r.location=`${i.lat},${i.lng}`),this.makeRequest("/places/v1/autocomplete",r)}async getPlaceDetails(e){return this.makeRequest("/places/v1/details",{place_id:e})}async getAdvancedPlaceDetails(e){return this.makeRequest("/places/v1/details/advanced",{place_id:e})}async nearbySearch(e,i,r,s){const n={location:`${e.lat},${e.lng}`};return i&&(n.layers=i),r&&(n.types=r),s&&(n.radius=s),this.makeRequest("/places/v1/nearbysearch",n)}async advancedNearbySearch(e,i,r,s){const n={location:`${e.lat},${e.lng}`};return i&&(n.layers=i),r&&(n.types=r),s&&(n.radius=s),this.makeRequest("/places/v1/nearbysearch/advanced",n)}async getPhoto(e){return this.makeRequest("/places/v1/photo",{photo_reference:e})}async textSearch(e){return this.makeRequest("/places/v1/textsearch",{input:e})}async validateAddress(e){return this.makeRequest("/places/v1/addressvalidation",{address:e})}async getElevation(e){return this.makeRequest("/places/v1/elevation",{location:`${e.lat},${e.lng}`})}async geocode(e){return this.makeRequest("/places/v1/geocode",{address:e})}async reverseGeocode(e,i){return this.makeRequest("/places/v1/reverse-geocode",{latlng:`${e},${i}`})}async getDirections(e,i,r="driving",s){const n={origin:`${e.lat},${e.lng}`,destination:`${i.lat},${i.lng}`,travel_mode:r};return s&&s.length>0&&(n.waypoints=s.map(c=>`${c.lat},${c.lng}`).join("|")),console.log("Directions API request params:",n),this.makeRequest("/routing/v1/directions",n,"POST")}async getDistanceMatrix(e,i){const r={origins:e.map(s=>`${s.lat},${s.lng}`).join("|"),destinations:i.map(s=>`${s.lat},${s.lng}`).join("|")};return this.makeRequest("/routing/v1/distanceMatrix",r)}async snapToRoad(e){const i={points:e.map(r=>`${r.lat},${r.lng}`).join("|"),enhancePath:!1};return this.makeRequest("/routing/v1/snapToRoad",i)}async getSpeedLimits(e){const i={points:e.map(r=>`${r.lat},${r.lng}`).join("|"),snapStrategy:"snaptoroad"};return this.makeRequest("/routing/v1/speedLimits",i)}async optimizeRoute(e){const i={locations:e.map(r=>`${r.lat},${r.lng}`).join("|")};return this.makeRequest("/routing/v1/routeOptimizer",i,"POST")}async getNearestRoads(e,i=100){const r={points:`${e.lat},${e.lng}`,radius:i};return this.makeRequest("/routing/v1/nearestRoads",r)}async getTrafficSignals(e,i=500){return this.nearbySearch(e,"venue","traffic_light",i)}}const Eie="modulepreload",Aie=function(t){return"/"+t},rR={},Um=function(e,i,r){if(!i||i.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(i.map(n=>{if(n=Aie(n),n in rR)return;rR[n]=!0;const c=n.endsWith(".css"),l=c?'[rel="stylesheet"]':"";if(!!r)for(let E=s.length-1;E>=0;E--){const T=s[E];if(T.href===n&&(!c||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${l}`))return;const y=document.createElement("link");if(y.rel=c?"stylesheet":Eie,c||(y.as="script",y.crossOrigin=""),y.href=n,document.head.appendChild(y),c)return new Promise((E,T)=>{y.addEventListener("load",E),y.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n})},Tie=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>Um(()=>Promise.resolve().then(()=>qd),void 0).then(({default:r})=>r(...i)):e=fetch,(...i)=>e(...i)};class UE extends Error{constructor(e,i="FunctionsError",r){super(e),this.name=i,this.context=r}}class Sie extends UE{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class sR extends UE{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class nR extends UE{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Px;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Px||(Px={}));var Cie=globalThis&&globalThis.__awaiter||function(t,e,i,r){function s(n){return n instanceof i?n:new i(function(c){c(n)})}return new(i||(i=Promise))(function(n,c){function l(E){try{y(r.next(E))}catch(T){c(T)}}function f(E){try{y(r.throw(E))}catch(T){c(T)}}function y(E){E.done?n(E.value):s(E.value).then(l,f)}y((r=r.apply(t,e||[])).next())})};class Iie{constructor(e,{headers:i={},customFetch:r,region:s=Px.Any}={}){this.url=e,this.headers=i,this.region=s,this.fetch=Tie(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,i={}){var r;return Cie(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:c}=i;let l={},{region:f}=i;f||(f=this.region);const y=new URL(`${this.url}/${e}`);f&&f!=="any"&&(l["x-region"]=f,y.searchParams.set("forceFunctionRegion",f));let E;c&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",E=c):typeof c=="string"?(l["Content-Type"]="text/plain",E=c):typeof FormData<"u"&&c instanceof FormData?E=c:(l["Content-Type"]="application/json",E=JSON.stringify(c)));const T=yield this.fetch(y.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),s),body:E}).catch(H=>{throw new Sie(H)}),R=T.headers.get("x-relay-error");if(R&&R==="true")throw new sR(T);if(!T.ok)throw new nR(T);let D=((r=T.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),V;return D==="application/json"?V=yield T.json():D==="application/octet-stream"?V=yield T.blob():D==="text/event-stream"?V=T:D==="multipart/form-data"?V=yield T.formData():V=yield T.text(),{data:V,error:null,response:T}}catch(s){return{data:null,error:s,response:s instanceof nR||s instanceof sR?s.context:void 0}}})}}var un={},zE={},z1={},zm={},j1={},G1={},Rie=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Nd=Rie();const Mie=Nd.fetch,t6=Nd.fetch.bind(Nd),i6=Nd.Headers,Pie=Nd.Request,kie=Nd.Response,qd=Object.freeze(Object.defineProperty({__proto__:null,Headers:i6,Request:Pie,Response:kie,default:t6,fetch:Mie},Symbol.toStringTag,{value:"Module"})),Bie=EO(qd);var V1={};Object.defineProperty(V1,"__esModule",{value:!0});let Lie=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};V1.default=Lie;var r6=uo&&uo.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(G1,"__esModule",{value:!0});const Oie=r6(Bie),Die=r6(V1);let Fie=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Oie.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,i){return this.headers=Object.assign({},this.headers),this.headers[e]=i,this}then(e,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var c,l,f;let y=null,E=null,T=null,R=n.status,D=n.statusText;if(n.ok){if(this.method!=="HEAD"){const z=await n.text();z===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?E=z:E=JSON.parse(z))}const H=(c=this.headers.Prefer)===null||c===void 0?void 0:c.match(/count=(exact|planned|estimated)/),ee=(l=n.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");H&&ee&&ee.length>1&&(T=parseInt(ee[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(E)&&(E.length>1?(y={code:"PGRST116",details:`Results contain ${E.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},E=null,T=null,R=406,D="Not Acceptable"):E.length===1?E=E[0]:E=null)}else{const H=await n.text();try{y=JSON.parse(H),Array.isArray(y)&&n.status===404&&(E=[],y=null,R=200,D="OK")}catch{n.status===404&&H===""?(R=204,D="No Content"):y={message:H}}if(y&&this.isMaybeSingle&&(!((f=y==null?void 0:y.details)===null||f===void 0)&&f.includes("0 rows"))&&(y=null,R=200,D="OK"),y&&this.shouldThrowOnError)throw new Die.default(y)}return{error:y,data:E,count:T,status:R,statusText:D}});return this.shouldThrowOnError||(s=s.catch(n=>{var c,l,f;return{error:{message:`${(c=n==null?void 0:n.name)!==null&&c!==void 0?c:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(l=n==null?void 0:n.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(f=n==null?void 0:n.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,i)}returns(){return this}overrideTypes(){return this}};G1.default=Fie;var Nie=uo&&uo.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(j1,"__esModule",{value:!0});const Uie=Nie(G1);let zie=class extends Uie.default{select(e){let i=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!i?"":(s==='"'&&(i=!i),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:i=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const c=n?`${n}.order`:"order",l=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${l?`${l},`:""}${e}.${i?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:i,referencedTable:r=i}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,i,{foreignTable:r,referencedTable:s=r}={}){const n=typeof s>"u"?"offset":`${s}.offset`,c=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(c,`${i-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:i=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:c="text"}={}){var l;const f=[e?"analyze":null,i?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),y=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${y}"; options=${f};`,c==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};j1.default=zie;var jie=uo&&uo.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(zm,"__esModule",{value:!0});const Gie=jie(j1);let Vie=class extends Gie.default{eq(e,i){return this.url.searchParams.append(e,`eq.${i}`),this}neq(e,i){return this.url.searchParams.append(e,`neq.${i}`),this}gt(e,i){return this.url.searchParams.append(e,`gt.${i}`),this}gte(e,i){return this.url.searchParams.append(e,`gte.${i}`),this}lt(e,i){return this.url.searchParams.append(e,`lt.${i}`),this}lte(e,i){return this.url.searchParams.append(e,`lte.${i}`),this}like(e,i){return this.url.searchParams.append(e,`like.${i}`),this}likeAllOf(e,i){return this.url.searchParams.append(e,`like(all).{${i.join(",")}}`),this}likeAnyOf(e,i){return this.url.searchParams.append(e,`like(any).{${i.join(",")}}`),this}ilike(e,i){return this.url.searchParams.append(e,`ilike.${i}`),this}ilikeAllOf(e,i){return this.url.searchParams.append(e,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(e,i){return this.url.searchParams.append(e,`ilike(any).{${i.join(",")}}`),this}is(e,i){return this.url.searchParams.append(e,`is.${i}`),this}in(e,i){const r=Array.from(new Set(i)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,i){return typeof i=="string"?this.url.searchParams.append(e,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(e,`cs.{${i.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(i)}`),this}containedBy(e,i){return typeof i=="string"?this.url.searchParams.append(e,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(e,`cd.{${i.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(i)}`),this}rangeGt(e,i){return this.url.searchParams.append(e,`sr.${i}`),this}rangeGte(e,i){return this.url.searchParams.append(e,`nxl.${i}`),this}rangeLt(e,i){return this.url.searchParams.append(e,`sl.${i}`),this}rangeLte(e,i){return this.url.searchParams.append(e,`nxr.${i}`),this}rangeAdjacent(e,i){return this.url.searchParams.append(e,`adj.${i}`),this}overlaps(e,i){return typeof i=="string"?this.url.searchParams.append(e,`ov.${i}`):this.url.searchParams.append(e,`ov.{${i.join(",")}}`),this}textSearch(e,i,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const c=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${c}.${i}`),this}match(e){return Object.entries(e).forEach(([i,r])=>{this.url.searchParams.append(i,`eq.${r}`)}),this}not(e,i,r){return this.url.searchParams.append(e,`not.${i}.${r}`),this}or(e,{foreignTable:i,referencedTable:r=i}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,i,r){return this.url.searchParams.append(e,`${i}.${r}`),this}};zm.default=Vie;var $ie=uo&&uo.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(z1,"__esModule",{value:!0});const _f=$ie(zm);let Hie=class{constructor(e,{headers:i={},schema:r,fetch:s}){this.url=e,this.headers=i,this.schema=r,this.fetch=s}select(e,{head:i=!1,count:r}={}){const s=i?"HEAD":"GET";let n=!1;const c=(e??"*").split("").map(l=>/\s/.test(l)&&!n?"":(l==='"'&&(n=!n),l)).join("");return this.url.searchParams.set("select",c),r&&(this.headers.Prefer=`count=${r}`),new _f.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:i,defaultToNull:r=!0}={}){const s="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),i&&n.push(`count=${i}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const c=e.reduce((l,f)=>l.concat(Object.keys(f)),[]);if(c.length>0){const l=[...new Set(c)].map(f=>`"${f}"`);this.url.searchParams.set("columns",l.join(","))}}return new _f.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:i,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){const c="POST",l=[`resolution=${r?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),n||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const f=e.reduce((y,E)=>y.concat(Object.keys(E)),[]);if(f.length>0){const y=[...new Set(f)].map(E=>`"${E}"`);this.url.searchParams.set("columns",y.join(","))}}return new _f.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:i}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),i&&s.push(`count=${i}`),this.headers.Prefer=s.join(","),new _f.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const i="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new _f.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};z1.default=Hie;var $1={},H1={};Object.defineProperty(H1,"__esModule",{value:!0});H1.version=void 0;H1.version="0.0.0-automated";Object.defineProperty($1,"__esModule",{value:!0});$1.DEFAULT_HEADERS=void 0;const qie=H1;$1.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${qie.version}`};var s6=uo&&uo.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(zE,"__esModule",{value:!0});const Wie=s6(z1),Xie=s6(zm),Kie=$1;let Jie=class n6{constructor(e,{headers:i={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Kie.DEFAULT_HEADERS),i),this.schemaName=r,this.fetch=s}from(e){const i=new URL(`${this.url}/${e}`);return new Wie.default(i,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new n6(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,i={},{head:r=!1,get:s=!1,count:n}={}){let c;const l=new URL(`${this.url}/rpc/${e}`);let f;r||s?(c=r?"HEAD":"GET",Object.entries(i).filter(([E,T])=>T!==void 0).map(([E,T])=>[E,Array.isArray(T)?`{${T.join(",")}}`:`${T}`]).forEach(([E,T])=>{l.searchParams.append(E,T)})):(c="POST",f=i);const y=Object.assign({},this.headers);return n&&(y.Prefer=`count=${n}`),new Xie.default({method:c,url:l,headers:y,schema:this.schemaName,body:f,fetch:this.fetch,allowEmpty:!1})}};zE.default=Jie;var Wd=uo&&uo.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(un,"__esModule",{value:!0});un.PostgrestError=un.PostgrestBuilder=un.PostgrestTransformBuilder=un.PostgrestFilterBuilder=un.PostgrestQueryBuilder=un.PostgrestClient=void 0;const o6=Wd(zE);un.PostgrestClient=o6.default;const a6=Wd(z1);un.PostgrestQueryBuilder=a6.default;const l6=Wd(zm);un.PostgrestFilterBuilder=l6.default;const c6=Wd(j1);un.PostgrestTransformBuilder=c6.default;const u6=Wd(G1);un.PostgrestBuilder=u6.default;const h6=Wd(V1);un.PostgrestError=h6.default;var Zie=un.default={PostgrestClient:o6.default,PostgrestQueryBuilder:a6.default,PostgrestFilterBuilder:l6.default,PostgrestTransformBuilder:c6.default,PostgrestBuilder:u6.default,PostgrestError:h6.default};const{PostgrestClient:Yie,PostgrestQueryBuilder:tne,PostgrestFilterBuilder:ine,PostgrestTransformBuilder:rne,PostgrestBuilder:sne,PostgrestError:nne}=Zie;function Qie(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const ere=Qie(),tre="2.11.15",ire=`realtime-js/${tre}`,rre="1.0.0",d6=1e4,sre=1e3;var Wf;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Wf||(Wf={}));var Is;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Is||(Is={}));var To;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(To||(To={}));var kx;(function(t){t.websocket="websocket"})(kx||(kx={}));var su;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(su||(su={}));class nre{constructor(){this.HEADER_LENGTH=1}decode(e,i){return e.constructor===ArrayBuffer?i(this._binaryDecode(e)):i(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const i=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,i,r)}_decodeBroadcast(e,i,r){const s=i.getUint8(1),n=i.getUint8(2);let c=this.HEADER_LENGTH+2;const l=r.decode(e.slice(c,c+s));c=c+s;const f=r.decode(e.slice(c,c+n));c=c+n;const y=JSON.parse(r.decode(e.slice(c,e.byteLength)));return{ref:null,topic:l,event:f,payload:y}}}class p6{constructor(e,i){this.callback=e,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ji;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(ji||(ji={}));const oR=(t,e,i={})=>{var r;const s=(r=i.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((n,c)=>(n[c]=ore(c,t,e,s),n),{})},ore=(t,e,i,r)=>{const s=e.find(l=>l.name===t),n=s==null?void 0:s.type,c=i[t];return n&&!r.includes(n)?f6(n,c):Bx(c)},f6=(t,e)=>{if(t.charAt(0)==="_"){const i=t.slice(1,t.length);return ure(e,i)}switch(t){case ji.bool:return are(e);case ji.float4:case ji.float8:case ji.int2:case ji.int4:case ji.int8:case ji.numeric:case ji.oid:return lre(e);case ji.json:case ji.jsonb:return cre(e);case ji.timestamp:return hre(e);case ji.abstime:case ji.date:case ji.daterange:case ji.int4range:case ji.int8range:case ji.money:case ji.reltime:case ji.text:case ji.time:case ji.timestamptz:case ji.timetz:case ji.tsrange:case ji.tstzrange:return Bx(e);default:return Bx(e)}},Bx=t=>t,are=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},lre=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},cre=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},ure=(t,e)=>{if(typeof t!="string")return t;const i=t.length-1,r=t[i];if(t[0]==="{"&&r==="}"){let n;const c=t.slice(1,i);try{n=JSON.parse("["+c+"]")}catch{n=c?c.split(","):[]}return n.map(l=>f6(e,l))}return t},hre=t=>typeof t=="string"?t.replace(" ","T"):t,m6=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Db{constructor(e,i,r={},s=d6){this.channel=e,this.event=i,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,i){var r;return this._hasReceived(e)&&i((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:i}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(i))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var aR;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(aR||(aR={}));class Xf{constructor(e,i){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(i==null?void 0:i.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:n,onLeave:c,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Xf.syncState(this.state,s,n,c),this.pendingDiffs.forEach(f=>{this.state=Xf.syncDiff(this.state,f,n,c)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},s=>{const{onJoin:n,onLeave:c,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Xf.syncDiff(this.state,s,n,c),l())}),this.onJoin((s,n,c)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:n,newPresences:c})}),this.onLeave((s,n,c)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:n,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,i,r,s){const n=this.cloneDeep(e),c=this.transformState(i),l={},f={};return this.map(n,(y,E)=>{c[y]||(f[y]=E)}),this.map(c,(y,E)=>{const T=n[y];if(T){const R=E.map(ee=>ee.presence_ref),D=T.map(ee=>ee.presence_ref),V=E.filter(ee=>D.indexOf(ee.presence_ref)<0),H=T.filter(ee=>R.indexOf(ee.presence_ref)<0);V.length>0&&(l[y]=V),H.length>0&&(f[y]=H)}else l[y]=E}),this.syncDiff(n,{joins:l,leaves:f},r,s)}static syncDiff(e,i,r,s){const{joins:n,leaves:c}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(l,f)=>{var y;const E=(y=e[l])!==null&&y!==void 0?y:[];if(e[l]=this.cloneDeep(f),E.length>0){const T=e[l].map(D=>D.presence_ref),R=E.filter(D=>T.indexOf(D.presence_ref)<0);e[l].unshift(...R)}r(l,E,f)}),this.map(c,(l,f)=>{let y=e[l];if(!y)return;const E=f.map(T=>T.presence_ref);y=y.filter(T=>E.indexOf(T.presence_ref)<0),e[l]=y,s(l,y,f),y.length===0&&delete e[l]}),e}static map(e,i){return Object.getOwnPropertyNames(e).map(r=>i(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((i,r)=>{const s=e[r];return"metas"in s?i[r]=s.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):i[r]=s,i},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var lR;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(lR||(lR={}));var cR;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(cR||(cR={}));var Na;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Na||(Na={}));class jE{constructor(e,i={config:{}},r){this.topic=e,this.params=i,this.socket=r,this.bindings={},this.state=Is.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new Db(this,To.join,this.params,this.timeout),this.rejoinTimer=new p6(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Is.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Is.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Is.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Is.errored,this.rejoinTimer.scheduleTimeout())}),this._on(To.reply,{},(s,n)=>{this._trigger(this._replyEventName(n),s)}),this.presence=new Xf(this),this.broadcastEndpointURL=m6(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,i=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Is.closed){const{config:{broadcast:n,presence:c,private:l}}=this.params;this._onError(E=>e==null?void 0:e(Na.CHANNEL_ERROR,E)),this._onClose(()=>e==null?void 0:e(Na.CLOSED));const f={},y={broadcast:n,presence:c,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(E=>E.filter))!==null&&s!==void 0?s:[],private:l};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:y},f)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:E})=>{var T;if(this.socket.setAuth(),E===void 0){e==null||e(Na.SUBSCRIBED);return}else{const R=this.bindings.postgres_changes,D=(T=R==null?void 0:R.length)!==null&&T!==void 0?T:0,V=[];for(let H=0;H<D;H++){const ee=R[H],{filter:{event:z,schema:W,table:q,filter:ce}}=ee,we=E&&E[H];if(we&&we.event===z&&we.schema===W&&we.table===q&&we.filter===ce)V.push(Object.assign(Object.assign({},ee),{id:we.id}));else{this.unsubscribe(),this.state=Is.errored,e==null||e(Na.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=V,e&&e(Na.SUBSCRIBED);return}}).receive("error",E=>{this.state=Is.errored,e==null||e(Na.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(E).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Na.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,i={}){return await this.send({type:"presence",event:"track",payload:e},i.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,i,r){return this._on(e,i,r)}async send(e,i={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:c}=e,f={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:c,private:this.private}]})};try{const y=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(r=i.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=y.body)===null||s===void 0?void 0:s.cancel()),y.ok?"ok":"error"}catch(y){return y.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var c,l,f;const y=this._push(e.type,e,i.timeout||this.timeout);e.type==="broadcast"&&!(!((f=(l=(c=this.params)===null||c===void 0?void 0:c.config)===null||l===void 0?void 0:l.broadcast)===null||f===void 0)&&f.ack)&&n("ok"),y.receive("ok",()=>n("ok")),y.receive("error",()=>n("error")),y.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Is.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(To.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Db(this,To.leave,{},e),r.receive("ok",()=>{i(),s("ok")}).receive("timeout",()=>{i(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,i,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),c=await this.socket.fetch(e,Object.assign(Object.assign({},i),{signal:s.signal}));return clearTimeout(n),c}_push(e,i,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Db(this,e,i,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,i,r){return i}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,i,r){var s,n;const c=e.toLocaleLowerCase(),{close:l,error:f,leave:y,join:E}=To;if(r&&[l,f,y,E].indexOf(c)>=0&&r!==this._joinRef())return;let R=this._onMessage(c,i,r);if(i&&!R)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(D=>{var V,H,ee;return((V=D.filter)===null||V===void 0?void 0:V.event)==="*"||((ee=(H=D.filter)===null||H===void 0?void 0:H.event)===null||ee===void 0?void 0:ee.toLocaleLowerCase())===c}).map(D=>D.callback(R,r)):(n=this.bindings[c])===null||n===void 0||n.filter(D=>{var V,H,ee,z,W,q;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in D){const ce=D.id,we=(V=D.filter)===null||V===void 0?void 0:V.event;return ce&&((H=i.ids)===null||H===void 0?void 0:H.includes(ce))&&(we==="*"||(we==null?void 0:we.toLocaleLowerCase())===((ee=i.data)===null||ee===void 0?void 0:ee.type.toLocaleLowerCase()))}else{const ce=(W=(z=D==null?void 0:D.filter)===null||z===void 0?void 0:z.event)===null||W===void 0?void 0:W.toLocaleLowerCase();return ce==="*"||ce===((q=i==null?void 0:i.event)===null||q===void 0?void 0:q.toLocaleLowerCase())}else return D.type.toLocaleLowerCase()===c}).map(D=>{if(typeof R=="object"&&"ids"in R){const V=R.data,{schema:H,table:ee,commit_timestamp:z,type:W,errors:q}=V;R=Object.assign(Object.assign({},{schema:H,table:ee,commit_timestamp:z,eventType:W,new:{},old:{},errors:q}),this._getPayloadRecords(V))}D.callback(R,r)})}_isClosed(){return this.state===Is.closed}_isJoined(){return this.state===Is.joined}_isJoining(){return this.state===Is.joining}_isLeaving(){return this.state===Is.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,i,r){const s=e.toLocaleLowerCase(),n={type:s,filter:i,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,i){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var n;return!(((n=s.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&jE.isEqual(s.filter,i))}),this}static isEqual(e,i){if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const r in e)if(e[r]!==i[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(To.close,{},e)}_onError(e){this._on(To.error,{},i=>e(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Is.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const i={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(i.new=oR(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(i.old=oR(e.columns,e.old_record)),i}}const uR=()=>{},dre=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class pre{constructor(e,i){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=d6,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=uR,this.ref=0,this.logger=uR,this.conn=null,this.sendBuffer=[],this.serializer=new nre,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=n=>{let c;return n?c=n:typeof fetch>"u"?c=(...l)=>Um(()=>Promise.resolve().then(()=>qd),void 0).then(({default:f})=>f(...l)):c=fetch,(...l)=>c(...l)},this.endPoint=`${e}/${kx.websocket}`,this.httpEndpoint=m6(e),i!=null&&i.transport?this.transport=i.transport:this.transport=null,i!=null&&i.params&&(this.params=i.params),i!=null&&i.timeout&&(this.timeout=i.timeout),i!=null&&i.logger&&(this.logger=i.logger),(i!=null&&i.logLevel||i!=null&&i.log_level)&&(this.logLevel=i.logLevel||i.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),i!=null&&i.heartbeatIntervalMs&&(this.heartbeatIntervalMs=i.heartbeatIntervalMs);const s=(r=i==null?void 0:i.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=i!=null&&i.reconnectAfterMs?i.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=i!=null&&i.encode?i.encode:(n,c)=>c(JSON.stringify(n)),this.decode=i!=null&&i.decode?i.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new p6(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(i==null?void 0:i.fetch),i!=null&&i.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(i==null?void 0:i.worker)||!1,this.workerUrl=i==null?void 0:i.workerUrl}this.accessToken=(i==null?void 0:i.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=ere),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:rre}))}disconnect(e,i){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,i??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const i=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const e=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,i,r){this.logger(e,i,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Wf.connecting:return su.Connecting;case Wf.open:return su.Open;case Wf.closing:return su.Closing;default:return su.Closed}}isConnected(){return this.connectionState()===su.Open}channel(e,i={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(n=>n.topic===r);if(s)return s;{const n=new jE(`realtime:${e}`,i,this);return this.channels.push(n),n}}push(e){const{topic:i,event:r,payload:s,ref:n}=e,c=()=>{this.encode(e,l=>{var f;(f=this.conn)===null||f===void 0||f.send(l)})};this.log("push",`${i} ${r} (${n})`,s),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){let i=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(r=>{const s={access_token:i,version:ire};i&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(To.access_token,{access_token:i})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(sre,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let i=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${e}"`),i.unsubscribe())}_remove(e){this.channels=this.channels.filter(i=>i.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,i=>{let{topic:r,event:s,payload:n,ref:c}=i;r==="phoenix"&&s==="phx_reply"&&this.heartbeatCallback(i.payload.status=="ok"?"ok":"error"),c&&c===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${r} ${s} ${c&&"("+c+")"||""}`,n),Array.from(this.channels).filter(l=>l._isMember(r)).forEach(l=>l._trigger(s,n,c)),this.stateChangeCallbacks.message.forEach(l=>l(i))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this.workerRef.terminate()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(i=>i(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(i=>i(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(To.error))}_appendParams(e,i){if(Object.keys(i).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(i);return`${e}${r}${s}`}_workerObjectUrl(e){let i;if(e)i=e;else{const r=new Blob([dre],{type:"application/javascript"});i=URL.createObjectURL(r)}return i}}class GE extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Zr(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class fre extends GE{constructor(e,i,r){super(e),this.name="StorageApiError",this.status=i,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Lx extends GE{constructor(e,i){super(e),this.name="StorageUnknownError",this.originalError=i}}var mre=globalThis&&globalThis.__awaiter||function(t,e,i,r){function s(n){return n instanceof i?n:new i(function(c){c(n)})}return new(i||(i=Promise))(function(n,c){function l(E){try{y(r.next(E))}catch(T){c(T)}}function f(E){try{y(r.throw(E))}catch(T){c(T)}}function y(E){E.done?n(E.value):s(E.value).then(l,f)}y((r=r.apply(t,e||[])).next())})};const g6=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>Um(()=>Promise.resolve().then(()=>qd),void 0).then(({default:r})=>r(...i)):e=fetch,(...i)=>e(...i)},gre=()=>mre(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Um(()=>Promise.resolve().then(()=>qd),void 0)).Response:Response}),Ox=t=>{if(Array.isArray(t))return t.map(i=>Ox(i));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([i,r])=>{const s=i.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[s]=Ox(r)}),e},_re=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)};var ku=globalThis&&globalThis.__awaiter||function(t,e,i,r){function s(n){return n instanceof i?n:new i(function(c){c(n)})}return new(i||(i=Promise))(function(n,c){function l(E){try{y(r.next(E))}catch(T){c(T)}}function f(E){try{y(r.throw(E))}catch(T){c(T)}}function y(E){E.done?n(E.value):s(E.value).then(l,f)}y((r=r.apply(t,e||[])).next())})};const Fb=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),yre=(t,e,i)=>ku(void 0,void 0,void 0,function*(){const r=yield gre();t instanceof r&&!(i!=null&&i.noResolveJson)?t.json().then(s=>{const n=t.status||500,c=(s==null?void 0:s.statusCode)||n+"";e(new fre(Fb(s),n,c))}).catch(s=>{e(new Lx(Fb(s),s))}):e(new Lx(Fb(t),t))}),vre=(t,e,i,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(_re(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,Object.assign(Object.assign({},s),i))};function jm(t,e,i,r,s,n){return ku(this,void 0,void 0,function*(){return new Promise((c,l)=>{t(i,vre(e,r,s,n)).then(f=>{if(!f.ok)throw f;return r!=null&&r.noResolveJson?f:f.json()}).then(f=>c(f)).catch(f=>yre(f,l,r))})})}function i1(t,e,i,r){return ku(this,void 0,void 0,function*(){return jm(t,"GET",e,i,r)})}function Ua(t,e,i,r,s){return ku(this,void 0,void 0,function*(){return jm(t,"POST",e,r,s,i)})}function Dx(t,e,i,r,s){return ku(this,void 0,void 0,function*(){return jm(t,"PUT",e,r,s,i)})}function bre(t,e,i,r){return ku(this,void 0,void 0,function*(){return jm(t,"HEAD",e,Object.assign(Object.assign({},i),{noResolveJson:!0}),r)})}function _6(t,e,i,r,s){return ku(this,void 0,void 0,function*(){return jm(t,"DELETE",e,r,s,i)})}var on=globalThis&&globalThis.__awaiter||function(t,e,i,r){function s(n){return n instanceof i?n:new i(function(c){c(n)})}return new(i||(i=Promise))(function(n,c){function l(E){try{y(r.next(E))}catch(T){c(T)}}function f(E){try{y(r.throw(E))}catch(T){c(T)}}function y(E){E.done?n(E.value):s(E.value).then(l,f)}y((r=r.apply(t,e||[])).next())})};const wre={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},hR={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class xre{constructor(e,i={},r,s){this.url=e,this.headers=i,this.bucketId=r,this.fetch=g6(s)}uploadOrUpdate(e,i,r,s){return on(this,void 0,void 0,function*(){try{let n;const c=Object.assign(Object.assign({},hR),s);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(c.upsert)});const f=c.metadata;typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",c.cacheControl),f&&n.append("metadata",this.encodeMetadata(f)),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",c.cacheControl),f&&n.append("metadata",this.encodeMetadata(f))):(n=r,l["cache-control"]=`max-age=${c.cacheControl}`,l["content-type"]=c.contentType,f&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(f)))),s!=null&&s.headers&&(l=Object.assign(Object.assign({},l),s.headers));const y=this._removeEmptyFolders(i),E=this._getFinalPath(y),T=yield(e=="PUT"?Dx:Ua)(this.fetch,`${this.url}/object/${E}`,n,Object.assign({headers:l},c!=null&&c.duplex?{duplex:c.duplex}:{}));return{data:{path:y,id:T.Id,fullPath:T.Key},error:null}}catch(n){if(Zr(n))return{data:null,error:n};throw n}})}upload(e,i,r){return on(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,i,r)})}uploadToSignedUrl(e,i,r,s){return on(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),c=this._getFinalPath(n),l=new URL(this.url+`/object/upload/sign/${c}`);l.searchParams.set("token",i);try{let f;const y=Object.assign({upsert:hR.upsert},s),E=Object.assign(Object.assign({},this.headers),{"x-upsert":String(y.upsert)});typeof Blob<"u"&&r instanceof Blob?(f=new FormData,f.append("cacheControl",y.cacheControl),f.append("",r)):typeof FormData<"u"&&r instanceof FormData?(f=r,f.append("cacheControl",y.cacheControl)):(f=r,E["cache-control"]=`max-age=${y.cacheControl}`,E["content-type"]=y.contentType);const T=yield Dx(this.fetch,l.toString(),f,{headers:E});return{data:{path:n,fullPath:T.Key},error:null}}catch(f){if(Zr(f))return{data:null,error:f};throw f}})}createSignedUploadUrl(e,i){return on(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);i!=null&&i.upsert&&(s["x-upsert"]="true");const n=yield Ua(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),c=new URL(this.url+n.url),l=c.searchParams.get("token");if(!l)throw new GE("No token returned by API");return{data:{signedUrl:c.toString(),path:e,token:l},error:null}}catch(r){if(Zr(r))return{data:null,error:r};throw r}})}update(e,i,r){return on(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,i,r)})}move(e,i,r){return on(this,void 0,void 0,function*(){try{return{data:yield Ua(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Zr(s))return{data:null,error:s};throw s}})}copy(e,i,r){return on(this,void 0,void 0,function*(){try{return{data:{path:(yield Ua(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Zr(s))return{data:null,error:s};throw s}})}createSignedUrl(e,i,r){return on(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield Ua(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:i},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const c=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${c}`)},{data:n,error:null}}catch(s){if(Zr(s))return{data:null,error:s};throw s}})}createSignedUrls(e,i,r){return on(this,void 0,void 0,function*(){try{const s=yield Ua(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:e},{headers:this.headers}),n=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(c=>Object.assign(Object.assign({},c),{signedUrl:c.signedURL?encodeURI(`${this.url}${c.signedURL}${n}`):null})),error:null}}catch(s){if(Zr(s))return{data:null,error:s};throw s}})}download(e,i){return on(this,void 0,void 0,function*(){const s=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),c=n?`?${n}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield i1(this.fetch,`${this.url}/${s}/${l}${c}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(Zr(l))return{data:null,error:l};throw l}})}info(e){return on(this,void 0,void 0,function*(){const i=this._getFinalPath(e);try{const r=yield i1(this.fetch,`${this.url}/object/info/${i}`,{headers:this.headers});return{data:Ox(r),error:null}}catch(r){if(Zr(r))return{data:null,error:r};throw r}})}exists(e){return on(this,void 0,void 0,function*(){const i=this._getFinalPath(e);try{return yield bre(this.fetch,`${this.url}/object/${i}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Zr(r)&&r instanceof Lx){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,i){const r=this._getFinalPath(e),s=[],n=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";n!==""&&s.push(n);const l=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",f=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});f!==""&&s.push(f);let y=s.join("&");return y!==""&&(y=`?${y}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${y}`)}}}remove(e){return on(this,void 0,void 0,function*(){try{return{data:yield _6(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(i){if(Zr(i))return{data:null,error:i};throw i}})}list(e,i,r){return on(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},wre),i),{prefix:e||""});return{data:yield Ua(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(Zr(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const i=[];return e.width&&i.push(`width=${e.width}`),e.height&&i.push(`height=${e.height}`),e.resize&&i.push(`resize=${e.resize}`),e.format&&i.push(`format=${e.format}`),e.quality&&i.push(`quality=${e.quality}`),i.join("&")}}const Ere="2.10.4",Are={"X-Client-Info":`storage-js/${Ere}`};var kh=globalThis&&globalThis.__awaiter||function(t,e,i,r){function s(n){return n instanceof i?n:new i(function(c){c(n)})}return new(i||(i=Promise))(function(n,c){function l(E){try{y(r.next(E))}catch(T){c(T)}}function f(E){try{y(r.throw(E))}catch(T){c(T)}}function y(E){E.done?n(E.value):s(E.value).then(l,f)}y((r=r.apply(t,e||[])).next())})};class Tre{constructor(e,i={},r,s){const n=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href,this.headers=Object.assign(Object.assign({},Are),i),this.fetch=g6(r)}listBuckets(){return kh(this,void 0,void 0,function*(){try{return{data:yield i1(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Zr(e))return{data:null,error:e};throw e}})}getBucket(e){return kh(this,void 0,void 0,function*(){try{return{data:yield i1(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(i){if(Zr(i))return{data:null,error:i};throw i}})}createBucket(e,i={public:!1}){return kh(this,void 0,void 0,function*(){try{return{data:yield Ua(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Zr(r))return{data:null,error:r};throw r}})}updateBucket(e,i){return kh(this,void 0,void 0,function*(){try{return{data:yield Dx(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Zr(r))return{data:null,error:r};throw r}})}emptyBucket(e){return kh(this,void 0,void 0,function*(){try{return{data:yield Ua(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(Zr(i))return{data:null,error:i};throw i}})}deleteBucket(e){return kh(this,void 0,void 0,function*(){try{return{data:yield _6(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(i){if(Zr(i))return{data:null,error:i};throw i}})}}class Sre extends Tre{constructor(e,i={},r,s){super(e,i,r,s)}from(e){return new xre(this.url,this.headers,e,this.fetch)}}const Cre="2.53.0";let Mf="";typeof Deno<"u"?Mf="deno":typeof document<"u"?Mf="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Mf="react-native":Mf="node";const Ire={"X-Client-Info":`supabase-js-${Mf}/${Cre}`},Rre={headers:Ire},Mre={schema:"public"},Pre={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},kre={};var Bre=globalThis&&globalThis.__awaiter||function(t,e,i,r){function s(n){return n instanceof i?n:new i(function(c){c(n)})}return new(i||(i=Promise))(function(n,c){function l(E){try{y(r.next(E))}catch(T){c(T)}}function f(E){try{y(r.throw(E))}catch(T){c(T)}}function y(E){E.done?n(E.value):s(E.value).then(l,f)}y((r=r.apply(t,e||[])).next())})};const Lre=t=>{let e;return t?e=t:typeof fetch>"u"?e=t6:e=fetch,(...i)=>e(...i)},Ore=()=>typeof Headers>"u"?i6:Headers,Dre=(t,e,i)=>{const r=Lre(i),s=Ore();return(n,c)=>Bre(void 0,void 0,void 0,function*(){var l;const f=(l=yield e())!==null&&l!==void 0?l:t;let y=new s(c==null?void 0:c.headers);return y.has("apikey")||y.set("apikey",t),y.has("Authorization")||y.set("Authorization",`Bearer ${f}`),r(n,Object.assign(Object.assign({},c),{headers:y}))})};var Fre=globalThis&&globalThis.__awaiter||function(t,e,i,r){function s(n){return n instanceof i?n:new i(function(c){c(n)})}return new(i||(i=Promise))(function(n,c){function l(E){try{y(r.next(E))}catch(T){c(T)}}function f(E){try{y(r.throw(E))}catch(T){c(T)}}function y(E){E.done?n(E.value):s(E.value).then(l,f)}y((r=r.apply(t,e||[])).next())})};function Nre(t){return t.endsWith("/")?t:t+"/"}function Ure(t,e){var i,r;const{db:s,auth:n,realtime:c,global:l}=t,{db:f,auth:y,realtime:E,global:T}=e,R={db:Object.assign(Object.assign({},f),s),auth:Object.assign(Object.assign({},y),n),realtime:Object.assign(Object.assign({},E),c),storage:{},global:Object.assign(Object.assign(Object.assign({},T),l),{headers:Object.assign(Object.assign({},(i=T==null?void 0:T.headers)!==null&&i!==void 0?i:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Fre(this,void 0,void 0,function*(){return""})};return t.accessToken?R.accessToken=t.accessToken:delete R.accessToken,R}const y6="2.71.1",zh=30*1e3,Fx=3,Nb=Fx*zh,zre="http://localhost:9999",jre="supabase.auth.token",Gre={"X-Client-Info":`gotrue-js/${y6}`},Nx="X-Supabase-Api-Version",v6={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Vre=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,$re=10*60*1e3;class VE extends Error{constructor(e,i,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=r}}function Ht(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class Hre extends VE{constructor(e,i,r){super(e,i,r),this.name="AuthApiError",this.status=i,this.code=r}}function qre(t){return Ht(t)&&t.name==="AuthApiError"}class b6 extends VE{constructor(e,i){super(e),this.name="AuthUnknownError",this.originalError=i}}class bc extends VE{constructor(e,i,r,s){super(e,r,s),this.name=i,this.status=r}}class jl extends bc{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Wre(t){return Ht(t)&&t.name==="AuthSessionMissingError"}class F_ extends bc{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class N_ extends bc{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class U_ extends bc{constructor(e,i=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Xre(t){return Ht(t)&&t.name==="AuthImplicitGrantRedirectError"}class dR extends bc{constructor(e,i=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ux extends bc{constructor(e,i){super(e,"AuthRetryableFetchError",i,void 0)}}function Ub(t){return Ht(t)&&t.name==="AuthRetryableFetchError"}class pR extends bc{constructor(e,i,r){super(e,"AuthWeakPasswordError",i,"weak_password"),this.reasons=r}}class zx extends bc{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const r1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),fR=` 	
\r=`.split(""),Kre=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<fR.length;e+=1)t[fR[e].charCodeAt(0)]=-2;for(let e=0;e<r1.length;e+=1)t[r1[e].charCodeAt(0)]=e;return t})();function mR(t,e,i){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;i(r1[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;i(r1[r]),e.queuedBits-=6}}function w6(t,e,i){const r=Kre[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)i(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function gR(t){const e=[],i=c=>{e.push(String.fromCodePoint(c))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},n=c=>{Yre(c,r,i)};for(let c=0;c<t.length;c+=1)w6(t.charCodeAt(c),s,n);return e.join("")}function Jre(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Zre(t,e){for(let i=0;i<t.length;i+=1){let r=t.charCodeAt(i);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(t.charCodeAt(i+1)-56320&65535|s)+65536,i+=1}Jre(r,e)}}function Yre(t,e,i){if(e.utf8seq===0){if(t<=127){i(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&i(e.codepoint)}}function Qre(t){const e=[],i={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)w6(t.charCodeAt(s),i,r);return new Uint8Array(e)}function ese(t){const e=[];return Zre(t,i=>e.push(i)),new Uint8Array(e)}function tse(t){const e=[],i={queue:0,queuedBits:0},r=s=>{e.push(s)};return t.forEach(s=>mR(s,i,r)),mR(null,i,r),e.join("")}function ise(t){return Math.round(Date.now()/1e3)+t}function rse(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const xo=()=>typeof window<"u"&&typeof document<"u",Jc={tested:!1,writable:!1},x6=()=>{if(!xo())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Jc.tested)return Jc.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Jc.tested=!0,Jc.writable=!0}catch{Jc.tested=!0,Jc.writable=!1}return Jc.writable};function sse(t){const e={},i=new URL(t);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((s,n)=>{e[n]=s})}catch{}return i.searchParams.forEach((r,s)=>{e[s]=r}),e}const E6=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>Um(()=>Promise.resolve().then(()=>qd),void 0).then(({default:r})=>r(...i)):e=fetch,(...i)=>e(...i)},nse=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",jh=async(t,e,i)=>{await t.setItem(e,JSON.stringify(i))},Zc=async(t,e)=>{const i=await t.getItem(e);if(!i)return null;try{return JSON.parse(i)}catch{return i}},zl=async(t,e)=>{await t.removeItem(e)};class q1{constructor(){this.promise=new q1.promiseConstructor((e,i)=>{this.resolve=e,this.reject=i})}}q1.promiseConstructor=Promise;function zb(t){const e=t.split(".");if(e.length!==3)throw new zx("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Vre.test(e[r]))throw new zx("JWT not in base64url format");return{header:JSON.parse(gR(e[0])),payload:JSON.parse(gR(e[1])),signature:Qre(e[2]),raw:{header:e[0],payload:e[1]}}}async function ose(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function ase(t,e){return new Promise((r,s)=>{(async()=>{for(let n=0;n<1/0;n++)try{const c=await t(n);if(!e(n,null,c)){r(c);return}}catch(c){if(!e(n,c)){s(c);return}}})()})}function lse(t){return("0"+t.toString(16)).substr(-2)}function cse(){const e=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=i.length;let s="";for(let n=0;n<56;n++)s+=i.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,lse).join("")}async function use(t){const i=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",i),s=new Uint8Array(r);return Array.from(s).map(n=>String.fromCharCode(n)).join("")}async function hse(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const i=await use(t);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Bh(t,e,i=!1){const r=cse();let s=r;i&&(s+="/PASSWORD_RECOVERY"),await jh(t,`${e}-code-verifier`,s);const n=await hse(r);return[n,r===n?"plain":"s256"]}const dse=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function pse(t){const e=t.headers.get(Nx);if(!e||!e.match(dse))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function fse(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function mse(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const gse=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Lh(t){if(!gse.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function jb(){const t={};return new Proxy(t,{get:(e,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const r=i.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function _R(t){return JSON.parse(JSON.stringify(t))}var _se=globalThis&&globalThis.__rest||function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(i[r[s]]=t[r[s]]);return i};const iu=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),yse=[502,503,504];async function yR(t){var e;if(!nse(t))throw new Ux(iu(t),0);if(yse.includes(t.status))throw new Ux(iu(t),t.status);let i;try{i=await t.json()}catch(n){throw new b6(iu(n),n)}let r;const s=pse(t);if(s&&s.getTime()>=v6["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?r=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(r=i.error_code),r){if(r==="weak_password")throw new pR(iu(i),t.status,((e=i.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new jl}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((n,c)=>n&&typeof c=="string",!0))throw new pR(iu(i),t.status,i.weak_password.reasons);throw new Hre(iu(i),t.status||500,r)}const vse=(t,e,i,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),i))};async function ii(t,e,i,r){var s;const n=Object.assign({},r==null?void 0:r.headers);n[Nx]||(n[Nx]=v6["2024-01-01"].name),r!=null&&r.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const c=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(c.redirect_to=r.redirectTo);const l=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",f=await bse(t,e,i+l,{headers:n,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(f):{data:Object.assign({},f),error:null}}async function bse(t,e,i,r,s,n){const c=vse(e,r,s,n);let l;try{l=await t(i,Object.assign({},c))}catch(f){throw console.error(f),new Ux(iu(f),0)}if(l.ok||await yR(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(f){await yR(f)}}function La(t){var e;let i=null;Ase(t)&&(i=Object.assign({},t),t.expires_at||(i.expires_at=ise(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:i,user:r},error:null}}function vR(t){const e=La(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((i,r)=>i&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Wl(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function wse(t){return{data:t,error:null}}function xse(t){const{action_link:e,email_otp:i,hashed_token:r,redirect_to:s,verification_type:n}=t,c=_se(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:i,hashed_token:r,redirect_to:s,verification_type:n},f=Object.assign({},c);return{data:{properties:l,user:f},error:null}}function Ese(t){return t}function Ase(t){return t.access_token&&t.refresh_token&&t.expires_in}const Gb=["global","local","others"];var Tse=globalThis&&globalThis.__rest||function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(i[r[s]]=t[r[s]]);return i};class Sse{constructor({url:e="",headers:i={},fetch:r}){this.url=e,this.headers=i,this.fetch=E6(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,i=Gb[0]){if(Gb.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Gb.join(", ")}`);try{return await ii(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ht(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,i={}){try{return await ii(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:Wl})}catch(r){if(Ht(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:i}=e,r=Tse(e,["options"]),s=Object.assign(Object.assign({},r),i);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await ii(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:xse,redirectTo:i==null?void 0:i.redirectTo})}catch(i){if(Ht(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(e){try{return await ii(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Wl})}catch(i){if(Ht(i))return{data:{user:null},error:i};throw i}}async listUsers(e){var i,r,s,n,c,l,f;try{const y={nextPage:null,lastPage:0,total:0},E=await ii(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(i=e==null?void 0:e.page)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:"",per_page:(n=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:""},xform:Ese});if(E.error)throw E.error;const T=await E.json(),R=(c=E.headers.get("x-total-count"))!==null&&c!==void 0?c:0,D=(f=(l=E.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&f!==void 0?f:[];return D.length>0&&(D.forEach(V=>{const H=parseInt(V.split(";")[0].split("=")[1].substring(0,1)),ee=JSON.parse(V.split(";")[1].split("=")[1]);y[`${ee}Page`]=H}),y.total=parseInt(R)),{data:Object.assign(Object.assign({},T),y),error:null}}catch(y){if(Ht(y))return{data:{users:[]},error:y};throw y}}async getUserById(e){Lh(e);try{return await ii(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Wl})}catch(i){if(Ht(i))return{data:{user:null},error:i};throw i}}async updateUserById(e,i){Lh(e);try{return await ii(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:i,headers:this.headers,xform:Wl})}catch(r){if(Ht(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,i=!1){Lh(e);try{return await ii(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:i},xform:Wl})}catch(r){if(Ht(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Lh(e.userId);try{const{data:i,error:r}=await ii(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:i,error:r}}catch(i){if(Ht(i))return{data:null,error:i};throw i}}async _deleteFactor(e){Lh(e.userId),Lh(e.id);try{return{data:await ii(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(i){if(Ht(i))return{data:null,error:i};throw i}}}function bR(t={}){return{getItem:e=>t[e]||null,setItem:(e,i)=>{t[e]=i},removeItem:e=>{delete t[e]}}}function Cse(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Oh={debug:!!(globalThis&&x6()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class A6 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ise extends A6{}async function Rse(t,e,i){Oh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Oh.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Oh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await i()}finally{Oh.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw Oh.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Ise(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Oh.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}Cse();const Mse={url:zre,storageKey:jre,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Gre,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function wR(t,e,i){return await i()}const Dh={};class Em{constructor(e){var i,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Em.nextInstanceID,Em.nextInstanceID+=1,this.instanceID>0&&xo()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Mse),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Sse({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=E6(s.fetch),this.lock=s.lock||wR,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:xo()&&(!((i=globalThis==null?void 0:globalThis.navigator)===null||i===void 0)&&i.locks)?this.lock=Rse:this.lock=wR,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:x6()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=bR(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=bR(this.memoryStorage)),xo()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}get jwks(){var e,i;return(i=(e=Dh[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(e){Dh[this.storageKey]=Object.assign(Object.assign({},Dh[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,i;return(i=(e=Dh[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Dh[this.storageKey]=Object.assign(Object.assign({},Dh[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${y6}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const i=sse(window.location.href);let r="none";if(this._isImplicitGrantCallback(i)?r="implicit":await this._isPKCECallback(i)&&(r="pkce"),xo()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:n}=await this._getSessionFromURL(i,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),Xre(n)){const f=(e=n.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:c,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",c,"redirect type",l),await this._saveSession(c),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return Ht(i)?{error:i}:{error:new b6("Unexpected error during initialization",i)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var i,r,s;try{const n=await ii(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:La}),{data:c,error:l}=n;if(l||!c)return{data:{user:null,session:null},error:l};const f=c.session,y=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:y,session:f},error:null}}catch(n){if(Ht(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var i,r,s;try{let n;if("email"in e){const{email:E,password:T,options:R}=e;let D=null,V=null;this.flowType==="pkce"&&([D,V]=await Bh(this.storage,this.storageKey)),n=await ii(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:R==null?void 0:R.emailRedirectTo,body:{email:E,password:T,data:(i=R==null?void 0:R.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken},code_challenge:D,code_challenge_method:V},xform:La})}else if("phone"in e){const{phone:E,password:T,options:R}=e;n=await ii(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:E,password:T,data:(r=R==null?void 0:R.data)!==null&&r!==void 0?r:{},channel:(s=R==null?void 0:R.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken}},xform:La})}else throw new N_("You must provide either an email or phone number and a password");const{data:c,error:l}=n;if(l||!c)return{data:{user:null,session:null},error:l};const f=c.session,y=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",f)),{data:{user:y,session:f},error:null}}catch(n){if(Ht(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let i;if("email"in e){const{email:n,password:c,options:l}=e;i=await ii(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:c,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:vR})}else if("phone"in e){const{phone:n,password:c,options:l}=e;i=await ii(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:c,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:vR})}else throw new N_("You must provide either an email or phone number and a password");const{data:r,error:s}=i;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new F_}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(i){if(Ht(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOAuth(e){var i,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:i}=e;if(i==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}async signInWithSolana(e){var i,r,s,n,c,l,f,y,E,T,R,D;let V,H;if("message"in e)V=e.message,H=e.signature;else{const{chain:ee,wallet:z,statement:W,options:q}=e;let ce;if(xo())if(typeof z=="object")ce=z;else{const re=window;if("solana"in re&&typeof re.solana=="object"&&("signIn"in re.solana&&typeof re.solana.signIn=="function"||"signMessage"in re.solana&&typeof re.solana.signMessage=="function"))ce=re.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof z!="object"||!(q!=null&&q.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ce=z}const we=new URL((i=q==null?void 0:q.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in ce&&ce.signIn){const re=await ce.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},q==null?void 0:q.signInWithSolana),{version:"1",domain:we.host,uri:we.href}),W?{statement:W}:null));let be;if(Array.isArray(re)&&re[0]&&typeof re[0]=="object")be=re[0];else if(re&&typeof re=="object"&&"signedMessage"in re&&"signature"in re)be=re;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in be&&"signature"in be&&(typeof be.signedMessage=="string"||be.signedMessage instanceof Uint8Array)&&be.signature instanceof Uint8Array)V=typeof be.signedMessage=="string"?be.signedMessage:new TextDecoder().decode(be.signedMessage),H=be.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in ce)||typeof ce.signMessage!="function"||!("publicKey"in ce)||typeof ce!="object"||!ce.publicKey||!("toBase58"in ce.publicKey)||typeof ce.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");V=[`${we.host} wants you to sign in with your Solana account:`,ce.publicKey.toBase58(),...W?["",W,""]:[""],"Version: 1",`URI: ${we.href}`,`Issued At: ${(s=(r=q==null?void 0:q.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((n=q==null?void 0:q.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${q.signInWithSolana.notBefore}`]:[],...!((c=q==null?void 0:q.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${q.signInWithSolana.expirationTime}`]:[],...!((l=q==null?void 0:q.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${q.signInWithSolana.chainId}`]:[],...!((f=q==null?void 0:q.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${q.signInWithSolana.nonce}`]:[],...!((y=q==null?void 0:q.signInWithSolana)===null||y===void 0)&&y.requestId?[`Request ID: ${q.signInWithSolana.requestId}`]:[],...!((T=(E=q==null?void 0:q.signInWithSolana)===null||E===void 0?void 0:E.resources)===null||T===void 0)&&T.length?["Resources",...q.signInWithSolana.resources.map(be=>`- ${be}`)]:[]].join(`
`);const re=await ce.signMessage(new TextEncoder().encode(V),"utf8");if(!re||!(re instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");H=re}}try{const{data:ee,error:z}=await ii(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:V,signature:tse(H)},!((R=e.options)===null||R===void 0)&&R.captchaToken?{gotrue_meta_security:{captcha_token:(D=e.options)===null||D===void 0?void 0:D.captchaToken}}:null),xform:La});if(z)throw z;return!ee||!ee.session||!ee.user?{data:{user:null,session:null},error:new F_}:(ee.session&&(await this._saveSession(ee.session),await this._notifyAllSubscribers("SIGNED_IN",ee.session)),{data:Object.assign({},ee),error:z})}catch(ee){if(Ht(ee))return{data:{user:null,session:null},error:ee};throw ee}}async _exchangeCodeForSession(e){const i=await Zc(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(i??"").split("/");try{const{data:n,error:c}=await ii(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:La});if(await zl(this.storage,`${this.storageKey}-code-verifier`),c)throw c;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new F_}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:s??null}),error:c})}catch(n){if(Ht(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:i,provider:r,token:s,access_token:n,nonce:c}=e,l=await ii(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:c,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:La}),{data:f,error:y}=l;return y?{data:{user:null,session:null},error:y}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new F_}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:f,error:y})}catch(i){if(Ht(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOtp(e){var i,r,s,n,c;try{if("email"in e){const{email:l,options:f}=e;let y=null,E=null;this.flowType==="pkce"&&([y,E]=await Bh(this.storage,this.storageKey));const{error:T}=await ii(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(i=f==null?void 0:f.data)!==null&&i!==void 0?i:{},create_user:(r=f==null?void 0:f.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:y,code_challenge_method:E},redirectTo:f==null?void 0:f.emailRedirectTo});return{data:{user:null,session:null},error:T}}if("phone"in e){const{phone:l,options:f}=e,{data:y,error:E}=await ii(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},create_user:(n=f==null?void 0:f.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},channel:(c=f==null?void 0:f.channel)!==null&&c!==void 0?c:"sms"}});return{data:{user:null,session:null,messageId:y==null?void 0:y.message_id},error:E}}throw new N_("You must provide either an email or phone number.")}catch(l){if(Ht(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var i,r;try{let s,n;"options"in e&&(s=(i=e.options)===null||i===void 0?void 0:i.redirectTo,n=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:c,error:l}=await ii(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:La});if(l)throw l;if(!c)throw new Error("An error occurred on token verification.");const f=c.session,y=c.user;return f!=null&&f.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),{data:{user:y,session:f},error:null}}catch(s){if(Ht(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var i,r,s;try{let n=null,c=null;return this.flowType==="pkce"&&([n,c]=await Bh(this.storage,this.storageKey)),await ii(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(i=e.options)===null||i===void 0?void 0:i.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:c}),headers:this.headers,xform:wse})}catch(n){if(Ht(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:i},error:r}=e;if(r)throw r;if(!i)throw new jl;const{error:s}=await ii(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(Ht(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const i=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:c}=await ii(this.fetch,"POST",i,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:c}}else if("phone"in e){const{phone:r,type:s,options:n}=e,{data:c,error:l}=await ii(this.fetch,"POST",i,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:l}}throw new N_("You must provide either an email or phone number and a type")}catch(i){if(Ht(i))return{data:{user:null,session:null},error:i};throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(e,i){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await i()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=i();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await e(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const i=await Zc(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Nb:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const c=await Zc(this.userStorage,this.storageKey+"-user");c!=null&&c.user?e.user=c.user:e.user=jb()}if(this.storage.isServer&&e.user){let c=this.suppressGetSessionWarning;e=new Proxy(e,{get:(f,y,E)=>(!c&&y==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c=!0,this.suppressGetSessionWarning=!0),Reflect.get(f,y,E))})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ii(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Wl}):await this._useSession(async i=>{var r,s,n;const{data:c,error:l}=i;if(l)throw l;return!(!((r=c.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new jl}:await ii(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(s=c.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0,xform:Wl})})}catch(i){if(Ht(i))return Wre(i)&&(await this._removeSession(),await zl(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:i};throw i}}async updateUser(e,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,i))}async _updateUser(e,i={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new jl;const c=s.session;let l=null,f=null;this.flowType==="pkce"&&e.email!=null&&([l,f]=await Bh(this.storage,this.storageKey));const{data:y,error:E}=await ii(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i==null?void 0:i.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:f}),jwt:c.access_token,xform:Wl});if(E)throw E;return c.user=y.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}})}catch(r){if(Ht(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new jl;const i=Date.now()/1e3;let r=i,s=!0,n=null;const{payload:c}=zb(e.access_token);if(c.exp&&(r=c.exp,s=r<=i),s){const{session:l,error:f}=await this._callRefreshToken(e.refresh_token);if(f)return{data:{user:null,session:null},error:f};if(!l)return{data:{user:null,session:null},error:null};n=l}else{const{data:l,error:f}=await this._getUser(e.access_token);if(f)throw f;n={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-i,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(i){if(Ht(i))return{data:{session:null,user:null},error:i};throw i}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async i=>{var r;if(!e){const{data:c,error:l}=i;if(l)throw l;e=(r=c.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new jl;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(i){if(Ht(i))return{data:{user:null,session:null},error:i};throw i}}async _getSessionFromURL(e,i){try{if(!xo())throw new U_("No browser detected.");if(e.error||e.error_description||e.error_code)throw new U_(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new dR("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new U_("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new dR("No code detected.");const{data:W,error:q}=await this._exchangeCodeForSession(e.code);if(q)throw q;const ce=new URL(window.location.href);return ce.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ce.toString()),{data:{session:W.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:c,expires_in:l,expires_at:f,token_type:y}=e;if(!n||!l||!c||!y)throw new U_("No session defined in URL");const E=Math.round(Date.now()/1e3),T=parseInt(l);let R=E+T;f&&(R=parseInt(f));const D=R-E;D*1e3<=zh&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${D}s, should have been closer to ${T}s`);const V=R-T;E-V>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",V,R,E):E-V<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",V,R,E);const{data:H,error:ee}=await this._getUser(n);if(ee)throw ee;const z={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:T,expires_at:R,refresh_token:c,token_type:y,user:H.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:z,redirectType:e.type},error:null}}catch(r){if(Ht(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const i=await Zc(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&i)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async i=>{var r;const{data:s,error:n}=i;if(n)return{error:n};const c=(r=s.session)===null||r===void 0?void 0:r.access_token;if(c){const{error:l}=await this.admin.signOut(c,e);if(l&&!(qre(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await zl(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const i=rse(),r={id:i,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async i=>{var r,s;try{const{data:{session:n},error:c}=i;if(c)throw c;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,i={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await Bh(this.storage,this.storageKey,!0));try{return await ii(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(n){if(Ht(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:i,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=i.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(i){if(Ht(i))return{data:null,error:i};throw i}}async linkIdentity(e){var i;try{const{data:r,error:s}=await this._useSession(async n=>{var c,l,f,y,E;const{data:T,error:R}=n;if(R)throw R;const D=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await ii(this.fetch,"GET",D,{headers:this.headers,jwt:(E=(y=T.session)===null||y===void 0?void 0:y.access_token)!==null&&E!==void 0?E:void 0})});if(s)throw s;return xo()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(Ht(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async i=>{var r,s;const{data:n,error:c}=i;if(c)throw c;return await ii(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(i){if(Ht(i))return{data:null,error:i};throw i}}async _refreshAccessToken(e){const i=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{const r=Date.now();return await ase(async s=>(s>0&&await ose(200*Math.pow(2,s-1)),this._debug(i,"refreshing attempt",s),await ii(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:La})),(s,n)=>{const c=200*Math.pow(2,s);return n&&Ub(n)&&Date.now()+c-r<zh})}catch(r){if(this._debug(i,"error",r),Ht(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(i,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,i){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",i,"url",r),xo()&&!i.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,i;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await Zc(this.storage,this.storageKey);if(s&&this.userStorage){let c=await Zc(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:s.user},await jh(this.userStorage,this.storageKey+"-user",c)),s.user=(e=c==null?void 0:c.user)!==null&&e!==void 0?e:jb()}else if(s&&!s.user&&!s.user){const c=await Zc(this.storage,this.storageKey+"-user");c&&(c!=null&&c.user)?(s.user=c.user,await zl(this.storage,this.storageKey+"-user"),await jh(this.storage,this.storageKey,s)):s.user=jb()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const n=((i=s.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<Nb;if(this._debug(r,`session has${n?"":" not"} expired with margin of ${Nb}s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:c}=await this._callRefreshToken(s.refresh_token);c&&(console.error(c),Ub(c)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:l}=await this._getUser(s.access_token);!l&&(c!=null&&c.user)?(s.user=c.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(r,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var i,r;if(!e)throw new jl;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new q1;const{data:n,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!n.session)throw new jl;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const l={session:n.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(n){if(this._debug(s,"error",n),Ht(n)){const c={session:null,error:n};return Ub(n)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(c),c}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,i,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",i,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:i});const n=[],c=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,i)}catch(f){n.push(f)}});if(await Promise.all(c),n.length>0){for(let l=0;l<n.length;l+=1)console.error(n[l]);throw n[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const i=Object.assign({},e),r=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&i.user&&await jh(this.userStorage,this.storageKey+"-user",{user:i.user});const s=Object.assign({},i);delete s.user;const n=_R(s);await jh(this.storage,this.storageKey,n)}else{const s=_R(i);await jh(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await zl(this.storage,this.storageKey),await zl(this.storage,this.storageKey+"-code-verifier"),await zl(this.storage,this.storageKey+"-user"),this.userStorage&&await zl(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&xo()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),zh);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async i=>{const{data:{session:r}}=i;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/zh);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${zh}ms, refresh threshold is ${Fx} ticks`),s<=Fx&&await this._callRefreshToken(r.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof A6)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!xo()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const i=`#_onVisibilityChanged(${e})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,i,r){const s=[`provider=${encodeURIComponent(i)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[n,c]=await Bh(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(c)}`});s.push(l.toString())}if(r!=null&&r.queryParams){const n=new URLSearchParams(r.queryParams);s.push(n.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async i=>{var r;const{data:s,error:n}=i;return n?{data:null,error:n}:await ii(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(i){if(Ht(i))return{data:null,error:i};throw i}}async _enroll(e){try{return await this._useSession(async i=>{var r,s;const{data:n,error:c}=i;if(c)return{data:null,error:c};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:f,error:y}=await ii(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return y?{data:null,error:y}:(e.factorType==="totp"&&(!((s=f==null?void 0:f.totp)===null||s===void 0)&&s.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),{data:f,error:null})})}catch(i){if(Ht(i))return{data:null,error:i};throw i}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var r;const{data:s,error:n}=i;if(n)return{data:null,error:n};const{data:c,error:l}=await ii(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),{data:c,error:l})})}catch(i){if(Ht(i))return{data:null,error:i};throw i}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var r;const{data:s,error:n}=i;return n?{data:null,error:n}:await ii(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(i){if(Ht(i))return{data:null,error:i};throw i}})}async _challengeAndVerify(e){const{data:i,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:i.id,code:e.code})}async _listFactors(){const{data:{user:e},error:i}=await this.getUser();if(i)return{data:null,error:i};const r=(e==null?void 0:e.factors)||[],s=r.filter(c=>c.factor_type==="totp"&&c.status==="verified"),n=r.filter(c=>c.factor_type==="phone"&&c.status==="verified");return{data:{all:r,totp:s,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var i,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=zb(s.access_token);let l=null;c.aal&&(l=c.aal);let f=l;((r=(i=s.user.factors)===null||i===void 0?void 0:i.filter(T=>T.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(f="aal2");const E=c.amr||[];return{data:{currentLevel:l,nextLevel:f,currentAuthenticationMethods:E},error:null}}))}async fetchJwk(e,i={keys:[]}){let r=i.keys.find(l=>l.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(l=>l.kid===e),r&&this.jwks_cached_at+$re>s)return r;const{data:n,error:c}=await ii(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!n.keys||n.keys.length===0||(this.jwks=n,this.jwks_cached_at=s,r=n.keys.find(l=>l.kid===e),!r)?null:r}async getClaims(e,i={}){try{let r=e;if(!r){const{data:D,error:V}=await this.getSession();if(V||!D.session)return{data:null,error:V};r=D.session.access_token}const{header:s,payload:n,signature:c,raw:{header:l,payload:f}}=zb(r);i!=null&&i.allowExpired||fse(n.exp);const y=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,i!=null&&i.keys?{keys:i.keys}:i==null?void 0:i.jwks);if(!y){const{error:D}=await this.getUser(r);if(D)throw D;return{data:{claims:n,header:s,signature:c},error:null}}const E=mse(s.alg),T=await crypto.subtle.importKey("jwk",y,E,!0,["verify"]);if(!await crypto.subtle.verify(E,T,c,ese(`${l}.${f}`)))throw new zx("Invalid JWT signature");return{data:{claims:n,header:s,signature:c},error:null}}catch(r){if(Ht(r))return{data:null,error:r};throw r}}}Em.nextInstanceID=0;const Pse=Em;class kse extends Pse{constructor(e){super(e)}}var Bse=globalThis&&globalThis.__awaiter||function(t,e,i,r){function s(n){return n instanceof i?n:new i(function(c){c(n)})}return new(i||(i=Promise))(function(n,c){function l(E){try{y(r.next(E))}catch(T){c(T)}}function f(E){try{y(r.throw(E))}catch(T){c(T)}}function y(E){E.done?n(E.value):s(E.value).then(l,f)}y((r=r.apply(t,e||[])).next())})};class Lse{constructor(e,i,r){var s,n,c;if(this.supabaseUrl=e,this.supabaseKey=i,!e)throw new Error("supabaseUrl is required.");if(!i)throw new Error("supabaseKey is required.");const l=Nre(e),f=new URL(l);this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const y=`sb-${f.hostname.split(".")[0]}-auth-token`,E={db:Mre,realtime:kre,auth:Object.assign(Object.assign({},Pre),{storageKey:y}),global:Rre},T=Ure(r??{},E);this.storageKey=(s=T.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=T.global.headers)!==null&&n!==void 0?n:{},T.accessToken?(this.accessToken=T.accessToken,this.auth=new Proxy({},{get:(R,D)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(D)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((c=T.auth)!==null&&c!==void 0?c:{},this.headers,T.global.fetch),this.fetch=Dre(i,this._getAccessToken.bind(this),T.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},T.realtime)),this.rest=new Yie(new URL("rest/v1",f).href,{headers:this.headers,schema:T.db.schema,fetch:this.fetch}),this.storage=new Sre(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),T.accessToken||this._listenForAuthEvents()}get functions(){return new Iie(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,i={},r={}){return this.rest.rpc(e,i,r)}channel(e,i={config:{}}){return this.realtime.channel(e,i)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,i;return Bse(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(i=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&i!==void 0?i:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:i,detectSessionInUrl:r,storage:s,storageKey:n,flowType:c,lock:l,debug:f},y,E){const T={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new kse({url:this.authUrl.href,headers:Object.assign(Object.assign({},T),y),storageKey:n,autoRefreshToken:e,persistSession:i,detectSessionInUrl:r,storage:s,flowType:c,lock:l,debug:f,fetch:E,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new pre(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,r)=>{this._handleTokenChanged(i,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,i,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ose=(t,e,i)=>new Lse(t,e,i);function Dse(){if(typeof window<"u"||typeof process>"u"||process.version===void 0||process.version===null)return!1;const t=process.version.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}Dse()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Fse="https://vxjtmbtvgurmiuufwlfa.supabase.co",Nse="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ4anRtYnR2Z3VybWl1dWZ3bGZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NjUyOTQsImV4cCI6MjA2OTU0MTI5NH0.ALMGOD3VrvdCOd9CJm3X5BORUQM58isNoK9m3EkBFlE";Ose(Fse,Nse);const u0=new xie,jx=({onLocationSelect:t,currentLocation:e,showLocateButton:i=!1,hasSelectedLocation:r=!1})=>{const[s,n]=dt.useState(""),[c,l]=dt.useState([]),[f,y]=dt.useState(!1),[E,T]=dt.useState(!1),[R,D]=dt.useState([]),V=dt.useRef(),H=dt.useRef(null),ee=dt.useRef(null);dt.useEffect(()=>{const re=localStorage.getItem("recent_searches");re&&D(JSON.parse(re))},[]),dt.useEffect(()=>{const re=be=>{ee.current&&!ee.current.contains(be.target)&&T(!1)};if(E)return document.addEventListener("mousedown",re),()=>document.removeEventListener("mousedown",re)},[E]),dt.useEffect(()=>{if(V.current&&clearTimeout(V.current),s.length<2){l([]),T(!1);return}return V.current=setTimeout(async()=>{var re;y(!0);try{const me=((re=(await u0.autocomplete(s,e||void 0)).predictions)==null?void 0:re.map(Te=>{var Pe,ze,Ke,We;return{place_id:Te.place_id,name:((Pe=Te.structured_formatting)==null?void 0:Pe.main_text)||Te.description,address:((ze=Te.structured_formatting)==null?void 0:ze.secondary_text)||Te.description,location:((Ke=Te.geometry)==null?void 0:Ke.location)||{lat:0,lng:0},place_type:((We=Te.types)==null?void 0:We[0])||"place",rating:Te.rating}}))||[];l(me),T(!0)}catch(be){console.error("Search error:",be),l([])}finally{y(!1)}},300),()=>{V.current&&clearTimeout(V.current)}},[s,e]);const z=async re=>{var be,me,Te;try{let Pe=re.location;(!Pe.lat||!Pe.lng)&&(Pe=((me=(be=(await u0.getPlaceDetails(re.place_id)).result)==null?void 0:be.geometry)==null?void 0:me.location)||Pe),t({lat:Pe.lat,lng:Pe.lng,address:re.address,name:re.name});const ze=[re,...R.filter(Ke=>Ke.place_id!==re.place_id)].slice(0,5);D(ze),localStorage.setItem("recent_searches",JSON.stringify(ze)),n(re.name),T(!1),(Te=H.current)==null||Te.blur()}catch(Pe){console.error("Error selecting location:",Pe)}},W=()=>{s.length===0&&R.length>0&&!r&&T(!0)},q=re=>{const be=re.relatedTarget;(!be||!be.closest(".search-results"))&&setTimeout(()=>T(!1),150)},ce=()=>{var re;n(""),l([]),T(!1),(re=H.current)==null||re.focus()},we=async()=>{var re,be,me,Te,Pe,ze;if(e){y(!0);try{const Ke=await u0.reverseGeocode(e.lat,e.lng),We=((be=(re=Ke.results)==null?void 0:re[0])==null?void 0:be.formatted_address)||"Current Location",Ze=((Te=(me=Ke.results)==null?void 0:me[0])==null?void 0:Te.name)||"Your Location";t({lat:e.lat,lng:e.lng,address:We,name:Ze}),n(Ze),T(!1),(Pe=H.current)==null||Pe.blur()}catch(Ke){console.error("Error getting current address:",Ke),t({lat:e.lat,lng:e.lng,address:"Current Location",name:"Your Location"}),n("Your Location"),T(!1),(ze=H.current)==null||ze.blur()}finally{y(!1)}}};return $e.jsxs("div",{ref:ee,className:"relative",children:[$e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg border border-gray-200",children:[$e.jsxs("div",{className:"flex items-center px-4 py-3",children:[$e.jsx(e6,{className:"w-5 h-5 text-gray-400 mr-3"}),$e.jsx("input",{ref:H,type:"text",value:s,onChange:re=>n(re.target.value),onFocus:W,onBlur:q,placeholder:"Search for places, addresses...",className:"flex-1 outline-none text-gray-800 placeholder-gray-500"}),i&&e&&$e.jsx("button",{onClick:we,className:"ml-2 p-1 text-gray-400 hover:text-ola-green transition-colors",title:"Use my location",children:$e.jsx(gie,{className:"w-4 h-4"})}),s&&$e.jsx("button",{onClick:ce,className:"ml-2 text-gray-400 hover:text-gray-600",children:"×"})]}),f&&$e.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2",children:$e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-ola-green"})})]}),E&&$e.jsxs("div",{className:"search-results absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 max-h-80 overflow-y-auto z-50",children:[s.length===0&&R.length>0&&$e.jsxs($e.Fragment,{children:[$e.jsx("div",{className:"px-4 py-2 text-sm font-medium text-gray-500 border-b",children:"Recent Searches"}),R.map(re=>$e.jsxs("button",{onClick:()=>z(re),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center",children:[$e.jsx(YB,{className:"w-4 h-4 text-gray-400 mr-3"}),$e.jsxs("div",{className:"flex-1",children:[$e.jsx("div",{className:"font-medium text-gray-900",children:re.name}),$e.jsx("div",{className:"text-sm text-gray-500",children:re.address})]})]},re.place_id))]}),c.length>0&&$e.jsxs($e.Fragment,{children:[s.length>0&&R.length>0&&$e.jsx("div",{className:"px-4 py-2 text-sm font-medium text-gray-500 border-b",children:"Search Results"}),c.map(re=>$e.jsxs("button",{onClick:()=>z(re),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center",children:[$e.jsx(QB,{className:"w-4 h-4 text-gray-400 mr-3"}),$e.jsxs("div",{className:"flex-1",children:[$e.jsx("div",{className:"font-medium text-gray-900",children:re.name}),$e.jsx("div",{className:"text-sm text-gray-500",children:re.address}),re.rating&&$e.jsxs("div",{className:"flex items-center mt-1",children:[$e.jsx(_ie,{className:"w-3 h-3 text-yellow-400 mr-1"}),$e.jsx("span",{className:"text-xs text-gray-600",children:re.rating})]})]}),$e.jsx("div",{className:"text-xs text-gray-400 capitalize",children:re.place_type.replace("_"," ")})]},re.place_id))]}),s.length>=2&&c.length===0&&!f&&$e.jsxs("div",{className:"px-4 py-6 text-center text-gray-500",children:['No results found for "',s,'"']})]})]})},Use=t=>{const e=[];let i=0,r=0,s=0;for(;i<t.length;){let n,c=0,l=0;do n=t.charCodeAt(i++)-63,l|=(n&31)<<c,c+=5;while(n>=32);const f=l&1?~(l>>1):l>>1;r+=f,c=0,l=0;do n=t.charCodeAt(i++)-63,l|=(n&31)<<c,c+=5;while(n>=32);const y=l&1?~(l>>1):l>>1;s+=y,e.push([s/1e5,r/1e5])}return e},zse=t=>{var i;if(t.instructions)return t.instructions;const e=t.instruction||t.html_instructions||((i=t.maneuver)==null?void 0:i.instruction)||t.narrative||t.text;return e?e.replace(/<[^>]*>/g,""):t.maneuver?jse(t.maneuver,t.maneuver.modifier):"Continue on route"},jse=(t,e,i)=>{if(i&&i!==t)return i;const s={turn:e?`Turn ${e}`:"Turn",depart:"Start your route",arrive:"You have arrived",merge:"Merge","on-ramp":"Take the ramp","off-ramp":"Exit the ramp",fork:"Take the fork","end-of-road":"Continue at end of road",continue:"Continue straight",roundabout:"Enter roundabout",rotary:"Enter rotary","roundabout-turn":"Exit roundabout",notification:"Continue","new-name":"Continue on new road",suppress:"Continue"}[t]||`Continue ${t}`;if(e){const c={left:"left",right:"right","sharp-left":"sharp left","sharp-right":"sharp right","slight-left":"slight left","slight-right":"slight right",straight:"straight",uturn:"to make a U-turn"}[e]||e;return t==="turn"?`Turn ${c}`:s.includes("Continue")?s:`${s} ${c}`}return s},Gse=t=>{var r,s;if(t.summary&&t.summary.trim())return t.summary;const i=(((s=(r=t.legs)==null?void 0:r[0])==null?void 0:s.steps)||[]).map(n=>n.instructions).filter(n=>n&&n.includes(" on ")).map(n=>{const c=n.match(/on (.+?)(?:\s|$|,)/);return c?c[1]:null}).filter(n=>n&&n.length>2).slice(0,2);return i.length>0?`Via ${i.join(", ")}`:`Route ${t.routeIndex||1}`},Vse=t=>{if(!t)return{hasTraffic:!1,severity:"low"};try{const e=t.split(" | ");let i=0;e.forEach(n=>{const c=n.split(",").map(Number);if(c.length>=3){const l=c[2];i=Math.max(i,l)}});const r=i>0;let s="low";return i>10?s="high":i>5&&(s="medium"),{hasTraffic:r,severity:s}}catch{return{hasTraffic:!1,severity:"low"}}},$se=(t,e)=>{const i=parseFloat(t.replace(/[^\d.]/g,""))||0,r=i*e,s=r/21.8,n=i*.21,c=Math.max(0,n-r);return{co2:r,trees:s,savings:c}},Hse=({map:t,onClose:e,currentLocation:i})=>{const[r,s]=dt.useState(null),[n,c]=dt.useState(null),[l,f]=dt.useState([]),[y,E]=dt.useState(0),[T,R]=dt.useState("driving"),[D,V]=dt.useState(!1),[H,ee]=dt.useState([]),[z,W]=dt.useState(null),q=[{id:"driving",icon:fie,label:"Car",carbonFactor:.21,color:"bg-red-500",bgColor:"bg-red-50",textColor:"text-red-700"},{id:"electric_scooter",icon:bie,label:"E-Scooter",carbonFactor:.05,color:"bg-blue-500",bgColor:"bg-blue-50",textColor:"text-blue-700"},{id:"bicycling",icon:pie,label:"Cycling",carbonFactor:0,color:"bg-green-500",bgColor:"bg-green-50",textColor:"text-green-700"},{id:"walking",icon:yie,label:"Walking",carbonFactor:0,color:"bg-green-600",bgColor:"bg-green-50",textColor:"text-green-700"}];dt.useEffect(()=>{r&&n&&ce()},[r,n,T]);const ce=async()=>{var me,Te;if(!(!r||!n||!t)){V(!0);try{const ze={driving:"driving",walking:"walking",bicycling:"cycling",electric_scooter:"driving"}[T]||"driving";console.log(`Calculating route for mode: ${ze} (original: ${T})`);const Ke=await u0.getDirections({lat:r.lat,lng:r.lng},{lat:n.lat,lng:n.lng},ze);if(console.log("Directions API response:",Ke),!Ke)throw new Error("No response from directions API");if(Ke.routes&&Ke.routes.length>0){const We=Ke.routes.map((Ze,Ft)=>{var ci,Gt,et,xt,Tt,zt;return{distance:((Gt=(ci=Ze.legs)==null?void 0:ci[0])==null?void 0:Gt.readable_distance)||"Unknown",duration:((xt=(et=Ze.legs)==null?void 0:et[0])==null?void 0:xt.readable_duration)||"Unknown",steps:((zt=(Tt=Ze.legs)==null?void 0:Tt[0])==null?void 0:zt.steps)||[],geometry:Ze.overview_polyline,summary:Gse(Ze),routeIndex:Ft+1,travelAdvisory:Ze.travel_advisory}});console.log("Transformed routes:",We),console.log("Sample steps for debugging:",(Te=(me=We[0])==null?void 0:me.steps)==null?void 0:Te.slice(0,3)),console.log("Travel advisory data:",We.map(Ze=>({routeIndex:Ze.routeIndex,travelAdvisory:Ze.travelAdvisory,hasAdvisory:!!Ze.travelAdvisory}))),f(We),E(0),we(We[0])}else console.log("No routes found in response:",Ke)}catch(Pe){console.error("Error calculating route:",Pe)}finally{V(!1)}}},we=me=>{if(!t||!me.geometry){console.log("Cannot display route - missing map or geometry:",{map:!!t,geometry:!!me.geometry});return}console.log("Displaying route on map:",me),re();const Te=()=>{try{const Pe=[],ze="JzTn7KxSegCBa7zxf7zdEBb2CbGkHpLsObU8R3Gy";if(r){const Ft=new Fd({apiKey:ze}).addMarker({offset:[0,0],anchor:"bottom",color:"#00C851"}).setLngLat([r.lng,r.lat]).addTo(t);Pe.push(Ft)}if(n){const Ft=new Fd({apiKey:ze}).addMarker({offset:[0,0],anchor:"bottom",color:"#FF4444"}).setLngLat([n.lng,n.lat]).addTo(t);Pe.push(Ft)}ee(Pe);const Ke=`route-${Date.now()}`;let We=me.geometry;if(typeof We=="string"){console.log("Geometry is encoded polyline:",We);try{const Ze=Use(We);We={type:"LineString",coordinates:Ze},console.log("Decoded polyline to coordinates:",Ze.length,"points")}catch(Ze){console.error("Error decoding polyline:",Ze);return}}if(We&&We.coordinates){console.log("Adding route source and layer:",We);const Ze=Gt=>({driving:"#FF6B35",walking:"#4CAF50",bicycling:"#2196F3",electric_scooter:"#9C27B0"})[Gt]||"#00C851",Ft=Gt=>({driving:6,walking:4,bicycling:5,electric_scooter:5})[Gt]||6,ci=(()=>({driving:"driving",walking:"walking",bicycling:"bicycling",electric_scooter:"electric_scooter"})[T]||"driving")();if(t.addSource(Ke,{type:"geojson",data:{type:"Feature",properties:{mode:ci},geometry:We}}),t.addLayer({id:Ke,type:"line",source:Ke,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":Ze(ci),"line-width":Ft(ci),"line-opacity":.8}}),t.addLayer({id:`${Ke}-outline`,type:"line",source:Ke,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#FFFFFF","line-width":Ft(ci)+2,"line-opacity":.3}},Ke),W(Ke),We.coordinates&&We.coordinates.length>0){const Gt=We.coordinates,et=Gt.map($t=>$t[1]),xt=Gt.map($t=>$t[0]),Tt=(Math.min(...et)+Math.max(...et))/2,zt=(Math.min(...xt)+Math.max(...xt))/2;t.flyTo({center:[zt,Tt],zoom:12})}}if(!We&&r&&n){const Ze=(r.lat+n.lat)/2,Ft=(r.lng+n.lng)/2;t.flyTo({center:[Ft,Ze],zoom:12})}}catch(Pe){console.error("Error displaying route on map:",Pe)}};t.isStyleLoaded()?Te():t.on("load",Te)},re=()=>{H.forEach(me=>me.remove()),ee([]),z&&t&&(t.getLayer(z)&&t.removeLayer(z),t.getLayer(`${z}-outline`)&&t.removeLayer(`${z}-outline`),t.getSource(z)&&t.removeSource(z),W(null))},be=()=>{const me=r;s(n),c(me)};return $e.jsxs("div",{className:"bg-white rounded-lg shadow-lg h-full flex flex-col",children:[$e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[$e.jsxs("div",{className:"flex items-center",children:[$e.jsx(c0,{className:"w-5 h-5 text-ola-green mr-2"}),$e.jsx("h2",{className:"font-semibold text-gray-900",children:"Directions"})]}),$e.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:$e.jsx(vie,{className:"w-5 h-5"})})]}),$e.jsx("div",{className:"p-4 border-b",children:$e.jsx("div",{className:"grid grid-cols-4 gap-1 bg-gray-100 rounded-lg p-1",children:q.map(me=>{const Te=me.icon,Pe=T===me.id;return $e.jsxs("button",{onClick:()=>R(me.id),className:`flex flex-col items-center justify-center py-3 px-2 rounded-md transition-all duration-200 ${Pe?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[$e.jsxs("div",{className:"flex items-center mb-1",children:[$e.jsx(Te,{className:"w-4 h-4"}),me.carbonFactor===0&&$e.jsx(iR,{className:"w-2 h-2 text-green-500 ml-1"})]}),$e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:me.label})]},me.id)})})}),$e.jsxs("div",{className:"p-4 space-y-3 border-b",children:[$e.jsxs("div",{className:"relative",children:[$e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:$e.jsx("div",{className:"w-3 h-3 bg-ola-green rounded-full"})}),$e.jsxs("div",{className:"pl-8",children:[$e.jsx(jx,{onLocationSelect:s,currentLocation:i,showLocateButton:!0,hasSelectedLocation:!!r},"origin-search"),r&&$e.jsx("div",{className:"mt-1 text-sm text-gray-600 truncate",children:r.address})]})]}),$e.jsx("button",{onClick:be,className:"w-full flex justify-center py-1",children:$e.jsx("div",{className:"w-6 h-6 border border-gray-300 rounded flex items-center justify-center hover:bg-gray-50",children:$e.jsx("div",{className:"text-gray-400",children:"⇅"})})}),$e.jsxs("div",{className:"relative",children:[$e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2",children:$e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"})}),$e.jsxs("div",{className:"pl-8",children:[$e.jsx(jx,{onLocationSelect:c,currentLocation:i,showLocateButton:!1,hasSelectedLocation:!!n},"destination-search"),n&&$e.jsx("div",{className:"mt-1 text-sm text-gray-600 truncate",children:n.address})]})]})]}),$e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[D&&$e.jsxs("div",{className:"p-4 text-center",children:[$e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-ola-green mx-auto mb-2"}),$e.jsx("p",{className:"text-sm text-gray-600",children:"Calculating route..."})]}),l.length>0&&$e.jsxs("div",{className:"p-4",children:[$e.jsx("div",{className:"space-y-3",children:l.map((me,Te)=>{const Pe=Vse(me.travelAdvisory),ze=q.find(We=>We.id===T),Ke=$se(me.distance,(ze==null?void 0:ze.carbonFactor)||0);return $e.jsxs("button",{onClick:()=>{E(Te),we(me)},className:`w-full p-4 text-left rounded-lg border transition-colors ${y===Te?"border-ola-green bg-green-50":"border-gray-200 hover:bg-gray-50"}`,children:[$e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[$e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-900",children:[$e.jsx(c0,{className:"w-4 h-4 mr-2 text-ola-green"}),me.summary,Pe.hasTraffic&&$e.jsx("div",{className:`ml-2 w-2 h-2 rounded-full ${Pe.severity==="high"?"bg-red-500":Pe.severity==="medium"?"bg-yellow-500":"bg-orange-400"}`})]}),$e.jsx("div",{className:"text-sm font-semibold text-gray-700",children:me.distance})]}),$e.jsxs("div",{className:"flex items-center justify-between",children:[$e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[$e.jsx(YB,{className:"w-4 h-4 mr-1"}),me.duration]}),Ke.co2===0&&$e.jsxs("div",{className:"flex items-center text-xs text-green-600",children:[$e.jsx(iR,{className:"w-3 h-3 mr-1"}),"Zero emissions"]}),Ke.co2>0&&Ke.savings>0&&$e.jsxs("div",{className:"text-xs text-gray-500",children:[Ke.co2.toFixed(1)," kg CO₂"]})]})]},Te)})}),l[y]&&l[y].steps.length>0&&$e.jsxs("div",{className:"mt-6 border-t pt-4",children:[$e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[$e.jsx(c0,{className:"w-4 h-4 mr-2 text-ola-green"}),"Turn-by-turn directions"]}),$e.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[l[y].steps.slice(0,8).map((me,Te)=>{var Pe,ze;return $e.jsxs("div",{className:"flex items-start",children:[$e.jsx("div",{className:"w-6 h-6 rounded-full bg-ola-green text-white flex items-center justify-center mr-3 mt-0.5 flex-shrink-0 text-xs font-medium",children:Te+1}),$e.jsxs("div",{className:"flex-1 min-w-0",children:[$e.jsx("div",{className:"text-sm text-gray-900 font-medium",children:zse(me)}),(me.readable_distance||me.distance)&&$e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[me.readable_distance||((Pe=me.distance)==null?void 0:Pe.text)||me.distance,(me.readable_duration||me.duration)&&` • ${me.readable_duration||((ze=me.duration)==null?void 0:ze.text)||me.duration}`]})]})]},Te)}),l[y].steps.length>8&&$e.jsxs("div",{className:"text-center py-2 text-sm text-gray-500 bg-gray-50 rounded-lg",children:["+",l[y].steps.length-8," more steps"]})]})]})]}),!D&&l.length===0&&(r||n)&&$e.jsx("div",{className:"p-4 text-center text-gray-500",children:!r||!n?"Enter both origin and destination to get directions":"No routes found"})]})]})},qse=({map:t,currentLocation:e})=>{const[i,r]=dt.useState([]),[s,n]=dt.useState([]),c=dt.useRef(),l=re=>["red","green","yellow"][re%3],f=(re,be)=>{const Te={red:45,green:30,yellow:6,walk:20}[re],Pe=Math.max(5,Math.floor(Te*.2)),ze=(be*7+13)%(Te-Pe+1);return Pe+ze};dt.useEffect(()=>{if(!(!t||!e))return T(),c.current=setInterval(()=>{E()},1e3),()=>{c.current&&clearInterval(c.current),we()}},[t,e]),dt.useEffect(()=>{y()},[i]);const y=()=>{!i.length||!s.length||s.forEach(({element:re,signal:be})=>{const me=i.find(We=>We.id===be.id);if(!me||!re)return;const Te=re.querySelector(".signal-circle"),Pe=re.querySelector(".signal-arrow"),ze=re.querySelector(".timer-display"),Ke=re.querySelector(".walk-dot");if(Te){const We=q(me.currentState);Te.style.background!==We&&(Te.style.background=We,Te.style.transition="background 0.3s ease")}if(Pe){const We=ce(me.currentState);Pe.textContent!==We&&(Pe.textContent=We)}if(ze){const We=me.countdown.toString();ze.textContent=We,me.countdown<=5?(ze.style.animation="timer-pulse 1s infinite",ze.style.color="#FF3B30"):(ze.style.animation="none",ze.style.color="white"),ze.style.transform="translateZ(0)"}if(me.pedestrianWalk&&!Ke){const We=document.createElement("div");We.className="walk-dot",We.style.cssText=`
          position: absolute;
          bottom: -4px;
          right: 2px;
          width: 6px;
          height: 6px;
          background: #00C851;
          border-radius: 50%;
          border: 1px solid white;
          animation: walk-blink 1s infinite;
        `,re.appendChild(We)}else!me.pedestrianWalk&&Ke&&Ke.remove()})},E=()=>{r(re=>re.map(be=>{let me=be.countdown-1,Te=be.currentState,Pe=!1,ze=be.cycleCount,Ke=be.completedCycles||0;if(me<=0)switch(be.currentState){case"red":Te="green",me=30,console.log(`Signal ${be.id}: Red → Green, countdown: ${me}`);break;case"green":Te="yellow",me=6,console.log(`Signal ${be.id}: Green → Yellow, countdown: ${me}`);break;case"yellow":Ke=Ke+1,Ke>=2?(Te="walk",me=20,Pe=!0,Ke=0,console.log(`Signal ${be.id}: Yellow → Walk (after 2 cycles), countdown: ${me}`)):(Te="red",me=45,console.log(`Signal ${be.id}: Yellow → Red, countdown: ${me}, completed cycles: ${Ke}`));break;case"walk":Te="red",me=45,Pe=!1,console.log(`Signal ${be.id}: Walk → Red, countdown: ${me}`);break}else be.currentState==="walk"&&(Pe=!0),(be.countdown%10===0||be.countdown<=5)&&console.log(`Signal ${be.id}: ${be.currentState} countdown: ${me}`);return{...be,currentState:Te,countdown:me,pedestrianWalk:Pe,cycleCount:ze,completedCycles:Ke}}))},T=async()=>{if(console.log("Starting traffic signal detection..."),e)console.log("Creating demo traffic signals around current location"),R(e);else{const re={lat:28.7041,lng:77.1025};console.log("Creating demo traffic signals at default location"),R(re)}setTimeout(async()=>{await D()},2e3)},R=re=>{const be=[];for(let me=0;me<4;me++){const Te=l(me),Pe={id:`demo_signal_${me+1}`,lat:re.lat+(me%2===0?.001:-.001)*(me+1),lng:re.lng+(me<2?.001:-.001)*(me+1),name:`Traffic Signal ${me+1}`,currentState:Te,countdown:f(Te,me),pedestrianWalk:!1,cycleCount:0,completedCycles:0};be.push(Pe)}console.log(`Creating ${be.length} demo traffic signals with quick timers for demo`),r(be),W(be)},D=async()=>{if(t){console.log("Starting global traffic signal detection...");try{console.log("Method 1: Comprehensive DOM search...");const re=H();if(re.length>0){console.log("✅ Found traffic signal icons via DOM search:",re.length),z(re);return}console.log("Method 2: Query all map features...");const be=await V();if(be.length>0){console.log("✅ Found traffic signals via map features:",be.length),z(be);return}console.log("Method 3: Broad POI search...");const me=await ee();if(me.length>0){console.log("✅ Found traffic signals via POI:",me.length),z(me);return}console.log("No traffic signals found - trying fallback detection"),setTimeout(()=>D(),2e3)}catch(re){console.error("Error detecting traffic signals:",re),setTimeout(()=>D(),3e3)}}},V=async()=>{try{if(console.log("Querying ALL map features for traffic patterns..."),t.queryRenderedFeatures){const re=t.queryRenderedFeatures();console.log("Total rendered features:",(re==null?void 0:re.length)||0);const be=(re==null?void 0:re.filter(Te=>{var We,Ze,Ft,ci,Gt,et,xt,Tt;const Pe=Te.properties||{},ze=Te.layer||{};return Pe.class==="traffic_signals"||Pe.type==="traffic_signals"||Pe.subclass==="traffic_signals"||Pe.amenity==="traffic_signals"||Pe.highway==="traffic_signals"||((We=ze.id)==null?void 0:We.includes("traffic"))||((Ze=ze.id)==null?void 0:Ze.includes("signal"))||((Ft=ze.id)==null?void 0:Ft.includes("poi"))||((ci=ze.id)==null?void 0:ci.includes("symbol"))||((et=(Gt=Pe.name)==null?void 0:Gt.toLowerCase())==null?void 0:et.includes("traffic"))||((Tt=(xt=Pe.name)==null?void 0:xt.toLowerCase())==null?void 0:Tt.includes("signal"))||Pe.class==="poi"||ze.type==="symbol"}))||[];if(console.log("Traffic-related features found:",be.length),be.length>0)return be;const me=["poi-traffic-light","poi-traffic-signal","traffic-signals","traffic_signals","poi","symbols","places","poi-label","symbol","icon","poi-scalerank1","poi-scalerank2","poi-scalerank3","poi-scalerank4"];for(const Te of me)try{const Pe=t.queryRenderedFeatures(void 0,{layers:[Te]});if(Pe&&Pe.length>0&&(console.log(`Found ${Pe.length} features in layer ${Te}`),Te.includes("poi")||Te.includes("symbol")))return Pe}catch(Pe){console.log(`Layer ${Te} query failed:`,Pe)}}}catch(re){console.log("queryAllMapFeatures failed:",re)}return[]},H=()=>{try{const re=t.getContainer();if(!re)return[];console.log("Searching for ALL traffic signal icons globally...");const be=['img[src*="traffic"]','img[src*="signal"]','img[src*="light"]','img[alt*="traffic"]','img[alt*="signal"]','img[title*="traffic"]','img[title*="signal"]','svg[class*="traffic"]','svg[class*="signal"]','svg[id*="traffic"]','svg[id*="signal"]','div[class*="traffic"]','div[class*="signal"]','div[id*="traffic"]','div[id*="signal"]','[data-poi*="traffic"]','[data-type*="traffic"]','[data-amenity*="traffic"]','[data-highway*="signal"]',".ola-marker",".mapbox-marker",".marker",'[class*="poi"]',".icon",".symbol",".pin"],me=[];return be.forEach(Te=>{try{const Pe=re.querySelectorAll(Te);console.log(`Selector "${Te}" found ${Pe.length} elements`),Pe.forEach(ze=>{const Ke=ze.getBoundingClientRect(),We=re.getBoundingClientRect();if(Ke.width>0&&Ke.height>0&&Ke.width<200&&Ke.height<200){if(ze.closest(".enhanced-traffic-signal"))return;const Ze=t.unproject([Ke.left-We.left+Ke.width/2,Ke.top-We.top+Ke.height/2]);me.push({id:`global_signal_${me.length}`,lat:Ze.lat,lng:Ze.lng,name:`Traffic Signal ${me.length+1}`,element:ze,selector:Te})}})}catch(Pe){console.log(`Selector ${Te} failed:`,Pe)}}),console.log(`Found ${me.length} potential traffic signal icons globally`),me}catch(re){return console.log("findAllTrafficSignalIcons failed:",re),[]}},ee=async()=>{try{const re=t.getBounds();if(t.queryPOI){console.log("Querying ALL POI data...");const be=await t.queryPOI({bounds:re,types:["traffic_signals","poi","amenity","highway"],limit:100});return console.log(`Found ${(be==null?void 0:be.length)||0} POIs total`),be||[]}if(t.queryFeatures)return console.log("Trying queryFeatures for POIs..."),await t.queryFeatures({bounds:re,types:["poi","symbol"],limit:100})}catch(re){console.log("queryAllPOIData failed:",re)}return[]},z=re=>{console.log(`Enhancing ${re.length} signals globally...`);const be=re.map((me,Te)=>{var ze,Ke,We,Ze,Ft,ci,Gt;const Pe=l(Te);return{id:me.id||`global_signal_${Te}`,lat:me.lat||((Ke=(ze=me.geometry)==null?void 0:ze.coordinates)==null?void 0:Ke[1])||((We=me.latlng)==null?void 0:We.lat),lng:me.lng||((Ft=(Ze=me.geometry)==null?void 0:Ze.coordinates)==null?void 0:Ft[0])||((ci=me.latlng)==null?void 0:ci.lng),name:me.name||((Gt=me.properties)==null?void 0:Gt.name)||`Traffic Signal ${Te+1}`,currentState:Pe,countdown:f(Pe,Te),pedestrianWalk:!1,cycleCount:0,completedCycles:0}}).filter(me=>me.lat&&me.lng);console.log(`Enhanced ${be.length} traffic signals globally`),be.length>0?(r(be),W(be)):(console.log("No signals to enhance, retrying detection..."),setTimeout(()=>D(),2e3))},W=re=>{if(!t)return;const be=re.map(me=>{const Te=document.createElement("div");if(Te.className="enhanced-traffic-signal",Te.innerHTML=`
        <!-- Pill-shaped Traffic Signal Toggle -->
        <div class="pill-toggle" style="
          background: rgba(0, 0, 0, 0.85);
          border-radius: 20px;
          padding: 4px;
          display: flex;
          align-items: center;
          gap: 8px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.3);
          border: 1px solid rgba(255,255,255,0.1);
        ">
          
          <!-- Signal State Circle -->
          <div class="signal-circle" style="
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: ${q(me.currentState)};
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.9);
          ">
            <!-- Arrow Icon -->
            <div class="signal-arrow" style="
              color: white;
              font-size: 12px;
              font-weight: bold;
              text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            ">${ce(me.currentState)}</div>
          </div>
          
          <!-- Timer Display -->
          <div class="timer-display" style="
            color: white;
            font-size: 16px;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            padding-right: 8px;
            min-width: 20px;
            text-align: center;
            ${me.countdown<=5?"animation: timer-pulse 1s infinite;":""}
          ">${me.countdown}</div>
          
        </div>
        
        <!-- Walk Indicator (if active) -->
        ${me.pedestrianWalk?`
          <div class="walk-dot" style="
            position: absolute;
            bottom: -4px;
            right: 2px;
            width: 6px;
            height: 6px;
            background: #00C851;
            border-radius: 50%;
            border: 1px solid white;
            animation: walk-blink 1s infinite;
          "></div>
        `:""}
      `,!document.getElementById("modern-signal-animations")){const We=document.createElement("style");We.id="modern-signal-animations",We.textContent=`
          @keyframes timer-pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
          }
          
          @keyframes walk-blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
          }
          
          .enhanced-traffic-signal:hover .pill-toggle {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
          }
          
          .enhanced-traffic-signal:hover .signal-circle {
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
          }
          
          .pill-toggle {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
          }
          
          .signal-circle {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          }
          
          .timer-display {
            transition: all 0.2s ease;
          }
          
          .signal-arrow {
            transition: all 0.2s ease;
          }
        `,document.head.appendChild(We)}const Pe="JzTn7KxSegCBa7zxf7zdEBb2CbGkHpLsObU8R3Gy";return{marker:new Fd({apiKey:Pe}).addMarker({offset:[0,-10],anchor:"bottom",element:Te}).setLngLat([me.lng,me.lat]).addTo(t),signal:me,element:Te}});n(be)},q=re=>({red:"#FF3B30",yellow:"#FF9500",green:"#30D158",walk:"#007AFF"})[re],ce=re=>({red:"■",yellow:"▲",green:"↑",walk:"🚶"})[re],we=()=>{s.forEach(({marker:re})=>{re&&re.remove&&re.remove()}),n([]),r([])};return null},Wse=()=>{const t=dt.useRef(null),e=dt.useRef(null),i=dt.useRef(null),[r,s]=dt.useState(!1),[n,c]=dt.useState(!0),[l,f]=dt.useState(!1),[y,E]=dt.useState(null),T="JzTn7KxSegCBa7zxf7zdEBb2CbGkHpLsObU8R3Gy",R=[parseFloat("77.1025"),parseFloat("28.7041")],D=parseInt("12");dt.useEffect(()=>!t.current||!T?void 0:((async()=>{try{const z=new Fd({apiKey:T}),W="default",q=z.init({styleName:W,container:t.current,center:R,zoom:D}),ce=z.addGeolocateControls({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});q.addControl(ce,"bottom-right"),i.current=ce;const we=z.addNavigationControls();q.addControl(we,"top-right"),q.on("load",()=>{s(!0),i.current&&i.current.trigger()}),ce.on("geolocate",re=>{E({lat:re.coords.latitude,lng:re.coords.longitude})}),e.current=q}catch(z){console.error("Error initializing map:",z)}})(),()=>{e.current&&e.current.remove()}),[T]);const V=(ee,z)=>e.current?new Fd({apiKey:T}).addMarker({offset:(z==null?void 0:z.offset)||[0,0],anchor:(z==null?void 0:z.anchor)||"bottom",color:(z==null?void 0:z.color)||"#0066CC"}).setLngLat(ee).addTo(e.current):void 0,H=(ee,z)=>{e.current&&e.current.flyTo({center:ee,zoom:z||15,essential:!0})};return $e.jsxs("div",{className:"relative h-screen w-screen",children:[$e.jsx("div",{ref:t,className:"absolute inset-0 z-0",style:{width:"100%",height:"100%"}}),n&&$e.jsx("div",{className:"absolute top-4 left-4 right-4 z-10 md:left-4 md:right-auto md:w-96",children:$e.jsx(jx,{onLocationSelect:ee=>{H([ee.lng,ee.lat]),V([ee.lng,ee.lat])},currentLocation:y})}),l&&$e.jsx("div",{className:"absolute left-4 top-20 bottom-4 z-10 w-80 md:w-96",children:$e.jsx(Hse,{map:e.current,onClose:()=>f(!1),currentLocation:y})}),r&&y&&$e.jsx(qse,{map:e.current,currentLocation:y}),$e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 flex flex-col gap-2",children:[$e.jsx("button",{onClick:()=>c(!n),className:"bg-white hover:bg-gray-50 p-3 rounded-lg shadow-lg transition-colors",title:"Toggle Search",children:$e.jsx(e6,{className:"w-5 h-5"})}),$e.jsx("button",{onClick:()=>f(!l),className:"bg-white hover:bg-gray-50 p-3 rounded-lg shadow-lg transition-colors",title:"Navigation",children:$e.jsx(c0,{className:"w-5 h-5"})}),$e.jsx("button",{onClick:()=>{y&&H([y.lng,y.lat],16)},className:"bg-ola-green hover:bg-green-600 text-white p-3 rounded-lg shadow-lg transition-colors",title:"My Location",children:$e.jsx(QB,{className:"w-5 h-5"})})]}),$e.jsx("div",{className:"absolute bottom-4 right-4 z-10",children:$e.jsx("button",{className:"bg-white hover:bg-gray-50 p-3 rounded-lg shadow-lg transition-colors",title:"Map Layers",children:$e.jsx(mie,{className:"w-5 h-5"})})}),!r&&$e.jsx("div",{className:"absolute inset-0 z-20 bg-white bg-opacity-90 flex items-center justify-center",children:$e.jsxs("div",{className:"text-center",children:[$e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-ola-green mx-auto mb-4"}),$e.jsx("p",{className:"text-gray-600",children:"Loading Ola Maps..."})]})})]})};function Xse(){return $e.jsx(FF,{children:$e.jsx("div",{className:"h-screen w-screen overflow-hidden",children:$e.jsx(LF,{children:$e.jsx(VM,{path:"/",element:$e.jsx(Wse,{})})})})})}Vb.createRoot(document.getElementById("root")).render($e.jsx(kR.StrictMode,{children:$e.jsx(Xse,{})}));
